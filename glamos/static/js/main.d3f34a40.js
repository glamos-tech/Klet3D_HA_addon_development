/*! For license information please see main.d3f34a40.js.LICENSE.txt */
"use strict";(this.webpackChunkintegration=this.webpackChunkintegration||[]).push([[179],{3721:(e,t,i)=>{var o=i(537),s=i(336);const n=document.URL+"static/media/logo-text@2x.23f596ec.png",a=document.URL+"static/media/logo-text.23f596ec.png",r={default:n,retina:a};var l=i(683);class h extends o.Component{render(){return(0,l.jsxs)("header",{className:"layout__header",children:[this.props.title&&(0,l.jsx)("h1",{className:"layout__title",children:this.props.title}),this.props.controls&&(0,l.jsx)("div",{className:"layout__controls",children:this.props.controls})]})}}const c=h;var d=i(6226),p=i.n(d);const m=document.URL+"static/media/http-error.cf84c924.png";var u=i(1317);const g=p().default.create({headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}),f=(e,t,i)=>{let o,s={headers:{}};return t?(o="https://app.glamos.eu/api",o+="/glamos",o+=e):o=e,i&&(s.headers["Cache-Control"]="no-store"),{headers:s,apiURI:encodeURI(o)}};function b(e){u.log("HTTP error"),u.log(e),u.log(this.mounted);const t=w(this.mounted,x(e));this.props.setResponseError?this.props.setResponseError({responseError:t}):this.setState({responseError:t}),this.loadingComponentContainer&&this.loadingComponentContainer.current&&s.unmountComponentAtNode(this.loadingComponentContainer.current),this.props.loadingComponentContainer&&s.unmountComponentAtNode(this.props.loadingComponentContainer),this.props.mainComponentThis&&this.props.mainComponentThis.loadingComponentContainer&&this.props.mainComponentThis.loadingComponentContainer.current&&s.unmountComponentAtNode(this.props.mainComponentThis.loadingComponentContainer.current)}const x=e=>String(e).includes("403")?"403":String(e).includes("401")?"401":String(e).includes("400")?"400":String(e).includes("404")?"404":String(e).includes("500")?"500":String(e).includes("501")?"501":String(e).includes("502")?"502":String(e).includes("Error: Network Error")?"Network Error":e,C={get:function(e,t){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=f(e,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3?arguments[3]:void 0);return g.get(o.apiURI,{...i,...o.headers}).then((e=>{t(e.data)})).catch(b.bind(this))},post:function(e,t,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=f(e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4?arguments[4]:void 0);return g.post(s.apiURI,t,{...o,...s.headers}).then((e=>{i(e)})).catch(b.bind(this))},put:function(e,t,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=f(e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4?arguments[4]:void 0);return g.put(o.apiURI,t,{...o,...s.headers}).then((e=>{i(e)})).catch(b.bind(this))},patch:function(e,t,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=f(e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4?arguments[4]:void 0);return g.patch(s.apiURI,t,{...o,...s.headers}).then((e=>{i(e)})).catch(b.bind(this))},delete:function(e,t){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=f(e,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3?arguments[3]:void 0);return g.delete(o.apiURI,{...i,...o.headers}).then((e=>{t(e)})).catch(b.bind(this))}},w=(e,t)=>t&&e&&("403"===t||"401"===t)?(u.log("Invalid token"),t):!(!t||!e||"400"!==t&&"404"!==t&&"500"!==t&&"501"!==t&&"502"!==t&&"Network Error"!==t)&&t,y=e=>!(!e||"Network Error"!==e&&"400"!==e&&"404"!==e&&"500"!==e&&"501"!==e&&"502"!==e),S=e=>"no_servers"===e?(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("p",{children:"Please create server and then add gateways (hotspots) to that server here."}),(0,l.jsx)("p",{children:"Add gateways for area you want to test/track"}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsx)("p",{children:"You will find your API key for integration of your devices in account."}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["For support contact: ",(0,l.jsx)("a",{href:"mailto: slaven@glamos.eu",children:"slaven@glamos.eu"})]}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["Find instructions at"," ",(0,l.jsx)("a",{target:"_blank",href:"https://glamos.eu/manual",rel:"noreferrer",children:"https://glamos.eu/manual"})]})]}):"no_gateways"===e?(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("p",{children:"Please add gateways (hotspots) to your server in gateways."}),(0,l.jsx)("p",{children:"Add gateways for area you want to test/track"}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsx)("p",{children:"You will find your API key for integration of your devices in account."}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["For support contact: ",(0,l.jsx)("a",{href:"mailto: slaven@glamos.eu",children:"slaven@glamos.eu"})]}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["Find instructions at"," ",(0,l.jsx)("a",{target:"_blank",href:"https://glamos.eu/manual",rel:"noreferrer",children:"https://glamos.eu/manual"})]})]}):"no_devices"===e?(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("p",{children:"Please first add your device here"}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsx)("p",{children:"You will find your API key for integration of your devices inaccount."}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["For support contact: ",(0,l.jsx)("a",{href:"mailto: slaven@glamos.eu",children:"slaven@glamos.eu"})]}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["Find instructions at"," ",(0,l.jsx)("a",{target:"_blank",href:"https://glamos.eu/manual",rel:"noreferrer",children:"https://glamos.eu/manual"})]})]}):"no_online_devices"===e?(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("p",{children:"Looks like you didn't activate any device. In order to see device data you must activate licence for it."}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["Please go to devices page and activate licence."," ",(0,l.jsx)("a",{target:"_blank",href:"https://glamos.eu/blog/new-chapter-glamos/",rel:"noreferrer",children:"More details"})]}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["For support contact: ",(0,l.jsx)("a",{href:"mailto: slaven@glamos.eu",children:"slaven@glamos.eu"})]}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["Find instructions at"," ",(0,l.jsx)("a",{target:"_blank",href:"https://glamos.eu/manual",rel:"noreferrer",children:"https://glamos.eu/manual"})]})]}):"Network Error"===e?(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("p",{children:"Error getting data (network error)"}),(0,l.jsx)("p",{children:"Check your internet connnection and try again."}),(0,l.jsx)("br",{}),(0,l.jsx)("br",{}),(0,l.jsxs)("p",{children:["If that doesn't work, please contact support at ",(0,l.jsx)("a",{href:"mailto: slaven@glamos.eu",children:"slaven@glamos.eu"})]})]}):"400"===e?(0,l.jsxs)("div",{className:"http-error error-container",children:[(0,l.jsx)("img",{alt:"HTTP error",src:m}),(0,l.jsx)("p",{children:"Ooops, looks like an error happened."}),(0,l.jsx)("p",{children:(0,l.jsx)("b",{children:"HTTP 400 Bad request"})})]}):"404"===e?(0,l.jsxs)("div",{className:"http-error error-container",children:[(0,l.jsx)("img",{alt:"HTTP error",src:m}),(0,l.jsx)("p",{children:"Ooops, looks like an error happened."}),(0,l.jsx)("p",{children:(0,l.jsx)("b",{children:"HTTP 404 Not Found"})})]}):"500"===e?(0,l.jsxs)("div",{className:"http-error error-container",children:[(0,l.jsx)("img",{alt:"HTTP error",src:m}),(0,l.jsx)("p",{children:"Ooops, looks like an error happened."}),(0,l.jsx)("p",{children:(0,l.jsx)("b",{children:"HTTP 500 Internal Server Error"})})]}):"501"===e?(0,l.jsxs)("div",{className:"http-error error-container",children:[(0,l.jsx)("img",{alt:"HTTP error",src:m}),(0,l.jsx)("p",{children:"Ooops, looks like an error happened."}),(0,l.jsx)("p",{children:(0,l.jsx)("b",{children:"HTTP 501 Not Implemented"})})]}):"502"===e?(0,l.jsxs)("div",{className:"http-error error-container",children:[(0,l.jsx)("img",{alt:"HTTP error",src:m}),(0,l.jsx)("p",{children:"Ooops, looks like an error happened."}),(0,l.jsx)("p",{children:(0,l.jsx)("b",{children:"HTTP 502 Bad Gateway"})})]}):null,v="eagrar_storage";let j={};j={...(()=>{const e=localStorage.getItem(v);return e?JSON.parse(e):{}})()};var D=i(1614);const T=(e,t)=>{const i=Number(Math.round(e+"e"+t)+"e-"+t);return isNaN(i)?0:i},I=(e,t,i)=>{let o,s;return()=>{let n=+new Date;o&&n<o+i?(clearTimeout(s),s=setTimeout((function(){o=n,t(e)}),i)):(o=n,t(e))}},_=e=>(()=>{let e,t=0;for(e in window.localStorage)t+=2*((window.localStorage[e].length||0)+(e.length||0));return t})()+(e=>{let t=new ArrayBuffer(2*e.length),i=new Uint16Array(t);for(let o=0,s=e.length;o<s;o++)i[o]=e.charCodeAt(o);return i})(JSON.stringify(e)).byteLength<5138022.4,L=()=>"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,M=e=>!e&&0!==e,k=e=>!e&&0!==e,O=(e,t,i)=>(0,D.ZP)(e,t).to(i),R=(e,t,i)=>e>=i.left&&e<=i.left+i.width&&t>=i.top&&t<=i.top+i.height,P=e=>e*(Math.PI/180),F=e=>e*(180/Math.PI),A=e=>e.getDate().toString().padStart(2,"0")+"."+(e.getMonth()+1).toString().padStart(2,"0")+"."+e.getFullYear()+" "+e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")+":"+e.getSeconds().toString().padStart(2,"0"),W=e=>{const t={timeZone:e,hour12:!1,weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},i=Intl.DateTimeFormat("en-US",t).formatToParts(new Date),o=i.find((e=>"year"===e.type)).value,s=new Date("".concat(i.find((e=>"month"===e.type)).value," 1, 2000")).getMonth(),n=i.find((e=>"day"===e.type)).value,a=i.find((e=>"hour"===e.type)).value,r=i.find((e=>"minute"===e.type)).value,l=i.find((e=>"second"===e.type)).value;return new Date(o,s,n,a,r,l)};var B=i(1317);function E(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C.get.call(this,"/location",(t=>{B.log("Ipapify response:"),B.log(t),this.mounted&&t?t.latitude&&t.longitude?(B.log("Postavi lat long u prvom"),this.setState({[e]:[t.longitude,t.latitude]},(()=>!!i&&i()))):t.geoplugin_latitude&&t.geoplugin_longitude?(B.log("postavi lat long u drugom"),this.setState({[e]:[t.geoplugin_longitude,t.geoplugin_latitude]},(()=>!!i&&i()))):i&&i():i&&i()}),!0,!0)}var V=i(1317);const N={isEmpty:function(){return!String(arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ").replace(/ /g,"").length&&"Entry can not be empty."},isNumber:function(){return!!isNaN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")&&"Entry can be just a number."},isEmail:function(){return!/\S+@\S+\.\S+/.test(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")&&"Invalid e-mail format."},isGpsCoordinate:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return N.isEmpty(e)?"Entry can not be empty.":N.isNumber(e)?"Entry can be just a number.":"gps_lat"===t?!(Number(e)>=-90&&Number(e)<=90)&&"Latitude out of bounds([-90, 90]).":!(Number(e)>=-180&&Number(e)<=180)&&"Longitude out of bounds([-180, 180])."},isValidGpsCoordinates:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";V.log("Ptimljen koordinate: "+e);const t=e.replace(/\s+/g,"").split(",");return t&&2===t.length?N.isGpsCoordinate(t[0],"gps_lat")||N.isGpsCoordinate(t[1],"gps_long"):"Invalid GPS coordinates. Please follow specified format."},deviceEUI:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.length>0&&(16!==e.length&&"DevEUI must be 16 characters long")},isLicenseNumber:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!1;if("string"===typeof e)if(19!==e.length)t=!0;else{const i=e.split("-");if(V.log("License parts"),V.log(i),4!==i.length)t=!0;else for(let e=0;e<i.length;e++)if(4!==i[e].length){t=!0;break}}else t=!0;return!!t&&"Invalid license format"},isHexColor:function(){return!/^#?([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")&&"Invalid hex color format"}},z=(e,t)=>{for(let i=0;i<t.length;i++)if(e[i].value!==t[i].value)return!0;return!1},H=(e,t)=>JSON.stringify(e)!==JSON.stringify(t),G=[...[{field:"gps_lat",label:"Floorplan latitude",placeholder:"e.g. 43.5079",validate:e=>N.isEmpty(e)||N.isGpsCoordinate(e,"gps_lat"),isGpsCoord:!0},{field:"gps_long",label:"Floorplan longitude",placeholder:"e.g. 16.43699",validate:e=>N.isEmpty(e)||N.isGpsCoordinate(e,"gps_long"),isGpsCoord:!0}],{field:"bearing_angle",label:"Floorplan bearing(\xb0)",placeholder:"e.g. 45\xb0",validate:e=>N.isEmpty(e)||N.isNumber(e),defaultValue:0}],q=[{name:"Light",value:"light-v8"},{name:"Satellite",value:"satellite-v9"},{name:"Outdoors",value:"outdoors-v9"},{name:"3D Terrain",value:"TERRAIN"},{name:"3D Buildings",value:"BUILDINGS"},{name:"Dark",value:"dark-v10"}];var Y=i(8569);const U=class{constructor(){this.hover=!1,this.selected=!1,this.highlighted=!1,this.emissiveColor=4473924}updateMeshHighlight(){const e=this.hover||this.selected;this.highlighted=e;const t=e?this.emissiveColor:0;this.mesh.traverse((i=>{if(i instanceof Y.Kj0)if(i.material.isMaterial)i.material.emissive?i.material.emissive.setHex(t):this.mesh.textColor&&!e?i.material.color.setHex(this.mesh.textColor.getHex()):i.material.color.setHex(t);else for(const o of i.material)o.emissive?o.emissive.setHex(t):this.mesh.textColor&&!e?o.color.setHex(this.mesh.textColor.getHex()):o.color.setHex(t)}))}mouseOver(){this.hover=!0,this.updateMeshHighlight()}mouseOff(){this.hover=!1,this.updateMeshHighlight()}setSelected(){this.selected=!0,this.updateMeshHighlight()}setUnselected(){this.selected=!1,this.updateMeshHighlight()}customIntersectionPlanes(){return[]}};const X=class extends U{constructor(e,t,i,o,s,n,a,r){let l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(super(),this.scene=e,this.errorGlow=new Y.Kj0,this.error=!1,this.errorColor=16711680,this.allowRotate="lightSource"!==s,this.fixed=r.fixed||!1,this.resizable=r.resizable||!1,this.dragOffset=new Y.Pa4,this.position=new Y.Pa4,this.scale=new Y.Pa4,this.meshPositionOffsetFromCenter=new Y.Pa4(0,0,0),this.loadedObjectPositionOffsetFromCenter=new Y.Pa4(0,0,0),this.loadedObjectSizeVector=new Y.Pa4,this.initialHalfSize=new Y.Pa4,this.rotation=0,this.rotateLastAngle=0,this.floorNumber=n,this.itemStartHeight=this.floorNumber*a.wallHeight,this.floorplan3DThis=a,this.objectType=s,this.objects3DArray=t,this.object3DProperties=i,this.object2D=o,this.object2DPositionTolerance=Math.pow(10,-8),this.meshScaleXSign=Ht(this.objectType)&&"reverse"===this.object2D.hinge?-1:1,je.includes(this.objectType)&&(this.meshScaleXSign*=-1),this.meshScaleYSign=1,this.meshScaleZSign=ve.includes(this.objectType)?-1:1,this.sceneTransformedCalled=!1,this.debugMode=l,"lightSource"===this.objectType){const e=this.floorplan3DThis.wallHeight/10,t=new Y.xo$(e,32,15),i=new Y.xoR({emissive:this.floorplan3DThis.lightSourceLightSphereMaterialColor});this.mesh=new Y.Kj0(t,i)}else{const{object:e}=this.objects3DArray.find((e=>e.floorplanItemType===this.objectType)),t=e.deepClone();this.mesh=t,this.loadedObjectPositionOffsetFromCenter=this.position.clone().sub(this.getMeshCenter()),this.meshPositionOffsetFromCenter=this.loadedObjectPositionOffsetFromCenter.clone()}this.mesh.isFloorplanItem=!0,this.mesh.itemObject=this,(new Y.ZzF).setFromObject(this.mesh).getSize(this.loadedObjectSizeVector);for(let c in this.object3DProperties)this.mesh[c]=this.object3DProperties[c];this.initialHalfSize=this.meshHalfSize(),this.halfSize=this.initialHalfSize.clone();const h=new Y.Pa4(this.object2D.x,this.itemStartHeight/this.floorplan3DThis.scaleFactor+!k(this.object2D.additionalParams.positionY)?this.object2D.additionalParams.positionY+this.object2D.additionalParams.height3D/2:0,this.object2D.y).multiplyScalar(this.floorplan3DThis.scaleFactor);if(this.setItemPosition(h),this.debugMode){const e=new Y.xo$(5,32,15),t=new Y.vBJ({color:16776960}),i=new Y.Kj0(e,t);i.position.set(h.x,h.y,h.z),this.scene.add(i)}this.position_set=!0,Gt(this.objectType)&&(this.mesh.light=this.floorplan3DThis.createPointLight(this.position,this.floorNumber)),this.scene===this.floorplan3DThis.floorplan3DOnMapScene&&document.addEventListener("sceneTransformed",(e=>this.onSceneTransformed(e)),{once:!0})}initObject(){"lightSource"===this.objectType?this.resize(this.loadedObjectSizeVector.x/this.floorplan3DThis.scaleFactor,this.loadedObjectSizeVector.y/this.floorplan3DThis.scaleFactor,this.loadedObjectSizeVector.z/this.floorplan3DThis.scaleFactor):this.resize(this.object2D.additionalParams.width3D,this.object2D.additionalParams.height3D,this.object2D.additionalParams.depth3D),this.rotateItem(P(this.object2D.angle),-1),this.rotateLastAngle=-P(this.object2D.angle);let e=this.getItemCenter();if("onWall"===this.object2D.family){const t=1===this.object2D.angleSign?-1:1,i=t*(this.object2D.additionalParams.onWallThick/2+this.object2D.additionalParams.depth3D/2)*Math.sin(this.object2D.additionalParams.onWallAngle)*this.floorplan3DThis.scaleFactor,o=-t*(this.object2D.additionalParams.onWallThick/2+this.object2D.additionalParams.depth3D/2)*Math.cos(this.object2D.additionalParams.onWallAngle)*this.floorplan3DThis.scaleFactor;e.x=this.object2D.x*this.floorplan3DThis.scaleFactor+i,e.z=this.object2D.y*this.floorplan3DThis.scaleFactor+o,Gt(this.objectType)&&this.mesh.light.position.set(this.mesh.position.x,this.mesh.position.y,this.mesh.position.z)}if(this.setItemPosition(e),this.placeInRoom(),this.scene.add(this.mesh),Gt(this.objectType)&&(this.scene.add(this.mesh.light),this.debugMode)){const e=new Y.xG9(this.mesh.light,20,16711680);this.scene.add(e)}this.scene.needsUpdate=!0}setItemPosition(e,t){(t=t||this.mesh)===this.mesh&&1===Ut(this.objectType)&&(e.y=this.itemStartHeight+(this.object2D.additionalParams.positionY+this.object2D.additionalParams.height3D/2)*this.floorplan3DThis.scaleFactor);const i=e.clone().add(this.getItemMeshRotatedPositionOffsetFromCenter());if(t.position.set(i.x,i.y,i.z),t===this.mesh)if(this.position.copy(i),"onWall"!==this.object2D.family&&"inWall"!==this.object2D.family){const t=e.x/this.floorplan3DThis.scaleFactor-this.object2D.x,i=e.z/this.floorplan3DThis.scaleFactor-this.object2D.y;t>this.object2DPositionTolerance&&(this.object2D.x+=t),i>this.object2DPositionTolerance&&(this.object2D.y+=i),this.object2D.update(this.floorplan3DThis.props.mainComponentThis)}else if(!this.boundToFloor){const t=this.floorplan3DThis.props.mainComponentThis.convertSvgToValueUnits((e.y-this.itemStartHeight)/this.floorplan3DThis.scaleFactor-this.object2D.additionalParams.height3D/2);this.object2D.additionalParams.positionY=this.floorplan3DThis.props.mainComponentThis.convertValueToSvgUnits(t),this.floorplan3DThis.props.mainComponentThis.activeItemPositionsRef.current&&this.floorplan3DThis.props.mainComponentThis.activeItemPositionsRef.current.setPositionYInputValues(t)}Gt(this.objectType)&&this.mesh.light&&this.mesh.light.position.set(e.x,e.y,e.z)}rotateItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i=i||this.mesh,"onWall"===this.object2D.family&&(e+=P(this.object2D.params.onWallOffsetAngle));let s=e*=t;i===this.mesh&&(s=e-this.rotation);const n=i===this.mesh?this.getItemCenter():this.getMeshCenter(i);if(this.floorplan3DThis.rotateAroundPoint(i,n,new Y.Pa4(0,1,0),s),i===this.mesh&&(this.rotation=e,this.position=n.add(this.getItemMeshRotatedPositionOffsetFromCenter())),zt(this.objectType)&&!o)if(this.object2D.angleSign!==this.object2D.additionalParams.arrowControlPointAngleSign){let e=P(this.object2D.angle);0===this.object2D.angleSign&&1===this.object2D.additionalParams.arrowControlPointAngleSign?e+=Math.PI:e-=Math.PI,this.rotateItem(e,-1,this.mesh,!0)}else this.rotateItem(P(this.object2D.angle),-1,this.mesh,!0)}remove(){Gt(this.objectType)&&(this.scene.remove(this.mesh.light),this.floorplan3DThis.disposeObject(this.mesh.light)),this.scene.remove(this.mesh),this.floorplan3DThis.disposeObject(this.mesh),this.removed()}resize(e,t,i){const o=new Y.Pa4(e/this.loadedObjectSizeVector.x,t/this.loadedObjectSizeVector.y,i/this.loadedObjectSizeVector.z).multiplyScalar(this.floorplan3DThis.scaleFactor);this.scale.set(this.meshScaleXSign*o.x,this.meshScaleYSign*o.y,this.meshScaleZSign*o.z);const s=this.getMeshCenter();this.mesh.scale.set(this.scale.x,this.scale.y,this.scale.z);const n=this.getMeshCenter(),a=s.sub(n);this.mesh.translateX(a.x),this.mesh.translateY(a.y),this.mesh.translateZ(a.z),this.position.copy(this.mesh.position),this.meshPositionOffsetFromCenter=this.loadedObjectPositionOffsetFromCenter.clone().multiply(this.scale),this.halfSize=this.initialHalfSize.clone().multiply(o),this.resized(),this.mesh.needsUpdate=!0}clickPressed(e){this.dragOffset.copy(e.point).sub(this.position)}clickDragged(e,t){if(e){if(t){const t=e.point.clone().sub(this.dragOffset);this.moveToPosition(t.sub(this.getItemMeshRotatedPositionOffsetFromCenter()),e)}else this.moveToPosition(e.point,e);if(this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&this.isWallItem){const t=this.floorplan3DThis.getFloorplanViewSceneItem(this.object2D);if(t){const i={};i.point=e.point,i.object={};const o=this.floorplan3DThis.floorplanViewWalls3D.find((e=>e.wall2D.wallId===this.itemWall.wall3D.wall2D.wallId));i.object.wall3D=o,i.object.uuid=this.itemWall.wallPlane.planeObject.uuid===this.itemWall.wall3D.interiorWallPlane.planeObject.uuid?o.interiorWallPlane.planeObject.uuid:o.exteriorWallPlane.planeObject.uuid,t.moveToPosition(this.getItemCenter(),i)}}}}rotate(e){if(e){const t=this.getItemCenter();let i=this.floorplan3DThis.props.mainComponentThis.qSVG.angleBetweenLines(0,1,e.point.x-t.x,e.point.z-t.z);const o=Math.PI/16;for(let e=-4;e<=4;e++)if(Math.abs(i-e*(Math.PI/2))<o){i=e*(Math.PI/2);break}if(this.isValidRotation(i))this.hideError(),this.rotateItem(i),"onWall"!==this.object2D.family&&"inWall"!==this.object2D.family&&(this.object2D.angle=-T(F(i),0),this.floorplan3DThis.props.mainComponentThis.activeItemRotationsRef.current&&this.floorplan3DThis.props.mainComponentThis.activeItemRotationsRef.current.setRotationInputValues(this.object2D.angle),this.object2D.update(this.floorplan3DThis.props.mainComponentThis));else{this.error||(this.error=!0,this.errorGlow=this.createErrorGlow(this.errorColor,.8,!0),this.scene.add(this.errorGlow));const e=t.clone().add(this.getItemMeshRotatedPositionOffsetFromCenter(this.errorGlow));this.errorGlow.position.set(e.x,e.y,e.z),this.floorplan3DThis.rotateAroundPoint(this.errorGlow,t,new Y.Pa4(0,1,0),i-this.rotateLastAngle)}this.rotateLastAngle=i}}moveToPosition(e){this.setItemPosition(e)}clickReleased(){this.rotateLastAngle=this.rotation,this.error&&this.hideError()}meshHalfSize(){const e=new Y.ZzF;return e.setFromObject(this.mesh),e.max.clone().sub(e.min).divideScalar(2)}getXZCorners(){const e=new Y.ZzF;e.setFromObject(this.mesh);const t=[new Y.Pa4(e.min.x,e.min.y,e.min.z),new Y.Pa4(e.max.x,e.min.y,e.min.z),new Y.Pa4(e.min.x,e.max.y,e.min.z),new Y.Pa4(e.min.x,e.min.y,e.max.z),new Y.Pa4(e.max.x,e.max.y,e.min.z),new Y.Pa4(e.max.x,e.min.y,e.max.z),new Y.Pa4(e.min.x,e.max.y,e.max.z),new Y.Pa4(e.max.x,e.max.y,e.max.z)],i=Nt(t.map((e=>new Y.FM8(e.x,e.z))));return[{x:i.minX,y:i.minY},{x:i.minX,y:i.maxY},{x:i.maxX,y:i.minY},{x:i.maxX,y:i.maxY}]}getItemMeshRotatedPositionOffsetFromCenter(e){e=e||this.mesh;const t=new Y.yGw;return t.makeRotationFromEuler(e.rotation),this.meshPositionOffsetFromCenter.clone().applyMatrix4(t)}getMeshCenter(e){e=e||this.mesh;const t=new Y.Pa4;return(new Y.ZzF).setFromObject(e).getCenter(t),this.sceneTransformedCalled&&this.floorplan3DThis.processSceneVec3(t),t}getItemCenter(){return this.position.clone().sub(this.getItemMeshRotatedPositionOffsetFromCenter())}showError(e){e=e||this.getItemCenter(),this.error||(this.error=!0,this.errorGlow=this.createErrorGlow(this.errorColor,.8,!0),this.scene.add(this.errorGlow)),this.setItemPosition(e,this.errorGlow)}hideError(){this.error&&(this.error=!1,this.scene.remove(this.errorGlow))}createErrorGlow(e,t,i){i=i||!1,t=t||.2;const o=new Y.vBJ({color:e,blending:Y.WMw,opacity:.2,transparent:!0,depthTest:!i}),s=this.mesh.deepClone();return s.traverse((e=>{e instanceof Y.Kj0&&(e.material.isMaterial?(e.material=o,e.material.needsUpdate=!0):(e.material=e.material.map((()=>o)),e.material.needsUpdate=!0))})),s.position.copy(this.position),s.scale.copy(this.scale),s}placeInRoom(){}resized(){}removed(){}isValidPosition(){return!0}isValidRotation(){return!0}onSceneTransformed(){this.sceneTransformedCalled=!0}};const Z=class extends X{constructor(e,t,i,o,s,n,a,r){super(e,t,i,o,s,n,a,r)}placeInRoom(){}resized(){const e=this.getItemCenter();this.setItemPosition(new Y.Pa4(e.x,this.halfSize.y,e.z))}moveToPosition(e){this.isValidPosition(e)?(this.hideError(),e.y=this.halfSize.y,this.setItemPosition(e)):this.showError(e)}isValidPosition(e){const t=this.floorplan3DThis.floorplanFloors.find((e=>e.floorNumber===this.floorNumber)).wallData;return!!this.floorplan3DThis.props.mainComponentThis.floorFreeObjectPositionValidation(new Y.FM8(e.x,e.z).divideScalar(this.floorplan3DThis.scaleFactor),t,this.halfSize.x/this.floorplan3DThis.scaleFactor,this.halfSize.z/this.floorplan3DThis.scaleFactor,-F(this.rotation))}isValidRotation(e){const t=this.floorplan3DThis.floorplanFloors.find((e=>e.floorNumber===this.floorNumber)).wallData,i=this.getItemCenter();return this.floorplan3DThis.props.mainComponentThis.floorFreeObjectPositionValidation(new Y.FM8(i.x,i.z).divideScalar(this.floorplan3DThis.scaleFactor),t,this.halfSize.x/this.floorplan3DThis.scaleFactor,this.halfSize.z/this.floorplan3DThis.scaleFactor,-F(e))}};const K=class extends X{constructor(e,t,i,o,s,n,a,r){super(e,t,i,o,s,n,a,r),this.allowRotate=!1,this.wallOffsetScalar=0,this.isWallItem=!0,this.itemWall=null,this.floorWalls=this.floorplan3DThis.floorplanFloors.find((e=>e.floorNumber===this.floorNumber)).wallData,this.walls3DArray=this.scene===this.floorplan3DThis.floorplan3DOnMapScene?this.floorplan3DThis.currentWalls3D:this.floorplan3DThis.floorplanViewWalls3D}createItemWall(e,t){const i=new Y.FM8(t.x,t.z).divideScalar(this.floorplan3DThis.scaleFactor),o=this.walls3DArray.find((t=>t.wall2D.wallId===e.wallId));return kt(i,o.interiorLineEquation).distance<kt(i,o.exteriorLineEquation).distance?{wall3D:o,wallPlane:o.interiorWallPlane}:{wall3D:o,wallPlane:o.exteriorWallPlane}}closestItemWall(){const e=this.getItemCenter(),t=new Y.FM8(e.x,e.z).divideScalar(this.floorplan3DThis.scaleFactor),i=this.floorplan3DThis.props.mainComponentThis.editor.nearWall(t,this.floorWalls);if(i){if(this.addToWall){const e=zt(this.objectType)?this.object2D.additionalParams.arrowControlPointAngleSign:this.object2D.angleSign,t=this.walls3DArray.find((e=>e.wall2D.wallId===i.wall.wallId));return 1===e?{wall3D:t,wallPlane:t.exteriorWallPlane}:{wall3D:t,wallPlane:t.interiorWallPlane}}return this.createItemWall(i.wall,e)}return null}removed(){null!=this.itemWall&&(this.itemWall.wall3D.removeWallObject(this,this.addToWall?"inWall":"onWall"),this.addToWall&&this.redrawWall())}redrawWall(){this.addToWall&&this.itemWall&&this.itemWall.wall3D.redrawWallExteriorInteriorPlanes()}updateSize(){this.wallOffsetScalar=this.halfSize.z,this.sizeX=2*this.halfSize.x,this.sizeY=2*this.halfSize.y}resized(){this.updateSize();const e=this.getItemCenter();this.itemWall?(this.boundToFloor&&(e.y=this.halfSize.y),this.boundMove(e),this.setItemPosition(e)):this.boundToFloor&&this.setItemPosition(new Y.Pa4(e.x,this.halfSize.y,e.z)),this.redrawWall()}placeInRoom(){const e=this.closestItemWall();if(e){const t=this.getItemCenter();this.changeItemWall(t,t,e,!0),this.updateSize()}}moveToPosition(e,t){if(t){const i=t.object.wall3D.interiorWallPlane.planeObject.uuid===t.object.uuid?t.object.wall3D.interiorWallPlane:t.object.wall3D.exteriorWallPlane;this.changeItemWall(e,t.point,{wall3D:t.object.wall3D,wallPlane:i})}this.boundMove(e),this.setItemPosition(e),this.redrawWall()}getWallOffset(e){return-1*e*this.wallOffsetScalar}changeItemWall(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=new Y.FM8(t.x,t.z).divideScalar(this.floorplan3DThis.scaleFactor),n=this.floorplan3DThis.props.mainComponentThis.editor.nearWall(s);if(n){let a=!0;o&&this.position_set||(this.floorplan3DThis.props.mainComponentThis.inWallonWallObjectBinderJoinToWall(n.wall,n,s,this.object2D)?this.rotateItem(P(this.object2D.angle),-1):a=!1,e.x=this.object2D.x*this.floorplan3DThis.scaleFactor,e.z=this.object2D.y*this.floorplan3DThis.scaleFactor),a&&(null!=this.itemWall&&(this.addToWall?(this.itemWall.wall3D.removeWallObject(this,"inWall"),this.redrawWall()):this.itemWall.wall3D.removeWallObject(this,"onWall")),i.wall3D.wall2D.wallId===n.wall.wallId?this.itemWall=i:this.itemWall=this.createItemWall(n.wall,t),this.addToWall?(i.wall3D.addWallObject(this,"inWall"),this.redrawWall()):i.wall3D.addWallObject(this,"onWall"))}}customIntersectionPlanes(){let e=[];for(let t=0;t<this.walls3DArray.length;t++)e.push(this.walls3DArray[t].interiorWallPlane.planeObject),e.push(this.walls3DArray[t].exteriorWallPlane.planeObject);return e}boundMove(e){const t=this.itemWall.wallPlane.planeObject.uuid===this.itemWall.wall3D.interiorWallPlane.planeObject.uuid;let i=t?this.itemWall.wall3D.interiorLineCoords:this.itemWall.wall3D.exteriorLineCoords;i=i.map((e=>new Y.FM8(e.x,e.y)));const o=Mt(i[0],i[1])*this.floorplan3DThis.scaleFactor,{transform3Dto2DMatrix:s,transform2Dto3DMatrix:n}=this.itemWall.wall3D.calculateWallPlaneTransformMatrices(i[0].multiplyScalar(this.floorplan3DThis.scaleFactor),i[1].multiplyScalar(this.floorplan3DThis.scaleFactor));e.applyMatrix4(s),e.x<this.sizeX/2+0?e.x=this.sizeX/2+0:e.x>o-this.sizeX/2-0&&(e.x=o-this.sizeX/2-0),this.boundToFloor?e.y=this.halfSize.y+.01:e.y<this.sizeY/2+0?e.y=this.sizeY/2+0:e.y>this.itemWall.wall3D.wallHeight-this.sizeY/2-0&&(e.y=this.itemWall.wall3D.wallHeight-this.sizeY/2-0),e.z=this.getWallOffset(t?1:-1),e.applyMatrix4(n)}};const J=class extends K{constructor(e,t,i,o,s,n,a,r){super(e,t,i,o,s,n,a,r),this.addToWall=!0}getWallOffset(e){return e*this.itemWall.wall3D.wall2D.thick*this.floorplan3DThis.scaleFactor/2}changeDoorHinge(){Ht(this.objectType)&&(this.floorplan3DThis.props.mainComponentThis.setDoorObject2DHinge(this.object2D),this.meshScaleXSign*=-1,this.resize(this.object2D.additionalParams.width3D,this.object2D.additionalParams.height3D,this.object2D.additionalParams.depth3D))}onWindowRotationOptionsChange(){zt(this.objectType)&&this.rotateItem(Math.abs(this.rotation),Math.sign(this.rotation))}};const Q=class extends J{constructor(e,t,i,o,s,n,a,r){super(e,t,i,o,s,n,a,r),this.boundToFloor=!0}};const $=class extends Z{constructor(e,t,i,o,s,n,a,r){super(e,t,i,o,s,n,a,r),this.obstructFloorMoves=!1,this.mesh.receiveShadow=!0}};const ee=class extends K{constructor(e,t,i,o,s,n,a,r){super(e,t,i,o,s,n,a,r),this.boundToFloor=!0}},te=[{gradientStartColor:"rgb(245, 88, 71)",gradientStopColor:"rgb(255, 0, 0)"},{gradientStartColor:"rgb(228, 192, 110)",gradientStopColor:"rgb(255, 176, 0)"},{gradientStartColor:"rgb(136, 204, 108)",gradientStopColor:"rgb(96, 196, 55)"},{gradientStartColor:"rgb(119, 225, 244)",gradientStopColor:"rgb(0, 217, 255)"},{gradientStartColor:"rgb(79, 114, 166)",gradientStopColor:"rgb(40, 77, 126)"},{gradientStartColor:"rgb(102, 102, 102)",gradientStopColor:"rgb(170, 170, 170)"},{gradientStartColor:"rgb(250, 250, 250)",gradientStopColor:"rgb(234, 234, 234)"},{gradientStartColor:"rgb(249, 173, 103)",gradientStopColor:"rgb(249, 127, 0)"},{gradientStartColor:"rgb(167, 132, 217)",gradientStopColor:"rgb(137, 81, 218)"},{gradientStartColor:"rgb(223, 103, 189)",gradientStopColor:"rgb(226, 42, 174)"},{gradientStartColor:"rgb(60, 59, 59)",gradientStopColor:"rgb(0, 0, 0)"},{gradientStartColor:"rgb(226, 198, 149)",gradientStopColor:"rgb(198, 157, 86)"}],ie=["None","Lounge","Lunchroom","Kitchen","Bathroom","Bedroom","Locker","Office","Hall","Loggia","Balcony","Terrace","Corridor","Garage"],oe=[{title:"Color",fill:"#f9f3e4"},{title:"Unknown",fill:"#666666",width:256,height:256},{id:"concrete",title:"Concrete",fill:"url(#Concrete)",width:256,height:256,scale:128},{id:"brick",title:"Brick",fill:"url(#Brick)",width:256,height:256,scale:128},{id:"stone",title:"Stone",fill:"url(#Stone)",width:256,height:256,scale:128},{id:"knauf",title:"Knauf",fill:"url(#Knauf)",width:256,height:256,scale:128},{id:"wood",title:"Wood",fill:"url(#Wood)",width:256,height:256,scale:128},{id:"glass",title:"Glass",fill:"url(#Glass)",width:256,height:256,scale:128},{id:"plastic",title:"Plastic",fill:"url(#Plastic)",width:256,height:256,scale:128},{id:"metal",title:"Metal",fill:"url(#Metal)",width:256,height:256,scale:128},{id:"granite",title:"Granite",fill:"url(#Granite)",width:256,height:256,scale:128}],se=[{field:"interiorPlaneMaterial",label:"Side 1:",validate:e=>N.isEmpty(e)||N.isHexColor(e),defaultColorValue:oe.find((e=>"Color"===e.title)).fill,selectRefPropertyName:"interiorPlaneMaterialSelectRef",dropdownRefPropertyName:"interiorPlaneMaterialDropdownRef"},{field:"exteriorPlaneMaterial",label:"Side 2:",validate:e=>N.isEmpty(e)||N.isHexColor(e),defaultColorValue:oe.find((e=>"Color"===e.title)).fill,selectRefPropertyName:"exteriorPlaneMaterialSelectRef",dropdownRefPropertyName:"exteriorPlaneMaterialDropdownRef"}],ne=[{name:"Light",value:"light-v8"},{name:"Satellite",value:"satellite-v9"},{name:"Dark",value:"dark-v10"}],ae={1:X,2:Z,3:Q,4:J,5:$,6:ee,7:K},re=[2,3,5,6],le=[3,4,6,7],he={1:"free",2:"floorFree",3:"inWall",4:"inWall",5:"floorFree",6:"onWall",7:"onWall"},ce=["CCTV","hangingLight","fluorescent","ceiling-lamp","lamp2","ceilingFan"],de=["doubleFrenchWindow2","doubleWindow2","frenchWindow2","smallWindow2","window_2x4","window_2x6","window_4x5","window_3x1","window_4x1","window_2x1_medium_with_large_pane","window_double_2x3_frame_sill","window_2x3_frame_sill","window_2x1_with_sliders","window_deep","window-08","turn-window","fixed_window_2x2","window_shop","window_stain_glass","glassblock"],pe=["door","glass_door_framless","screen-door","puerta","craftsmanDoorClosed","sliderPocketDoor","double_door_2","double_door","double_plain_door_with_little_part","exterior-door-05","exterior-door-07","frontDoor2","glass_door","double_door_with_little_part","glassDoor2","japanesedoor","garage-door","garage-door2","emergencyGlassDoubleDoor","revdoor","elevator","elevator-door"],me=["hangingLight","lamp2","ceiling-lamp","minispot","painting_light","track-lights","wall-spotlight","wall_lamp","fluorescent","fluorescent-strip","lightSource","porch-light","street_light_modern","farola1"],ue=["washbasin_jay_hardy","bathroom3","hand-washbasin","stone-washbasin","ergonomic-washbasin","bathroom_vanity","modernVanity","bathroom_sink","mobilettoLavaboWenge","wash_basin_corner","islandBath","bathtub_jet_system","corner_bathtub","mixer-tap-for-shower","shower","doccia","shower_cabin","shower-cabin-with-seat","toilet_hang_round","japanese-toilet","turkish-toilet","small-urinal","bidet","towel2","com_bath3","towel3","showerCurtain","barreAppuiCoude","folding-grab-bar","savon","com_bath2_jabon_pijo","potBrossesADent","secheCheveux","potty","toiletBrush","bathroom-tissue","pesePersonne","basin","bathmat","clothes-basket","clothes_line","clothes_washing_machine","dryer_machine","fer","plancheARepasser"],ge=["bedFlowers","air-mattress","bed3","bed1","bedWithTexture","captains-bed","juniorBed","convertible-sofa-BZ-opened","bunkBed","litMezzanine2","mezzanine-bed","crib","adjustable-hospital-bed","armoireLotus","mobileCiliegio","mobileangoloCiliegio","mobileAngoloInterno","mobileAzzurro","corner","wardrobe2","changing-table","chest","kommode","bedsideTable","bedsideTable2","comoCiliegio","dressing-table","clothes-rack","mensolaCurvaAcero","pensileAcero","folded_clothes","futon","hanging-clothes1","casque","hospital-table-on-wheels","hotelSafe","sleepingBag","bootieSeparated","slippersSeparated","sneakersSeparated","mocassinSeparated","womanShoesSeparated","blocks","doll","doll-house","smiley","teddyBear","train","letters","housePuzzle","rubix2","bed2"],fe=["awning_bracket","barbecue","basketball_net_and_board","barnum","campingLamp","campingTent","deckChair","diving-board","dog-house","entry-bell-ring","entry-bell-speech-unit","privacyFence2","fence_grid","fence_picket","flag_hinged_pole","football-goal","big-football-goal","waterFountain","fountain","garden-hut","gate_grind","greenhouse","grillNgauge","hammock","hangingUmbrella","jacuzzi","boiteALettre","motorbike","painted-bench","passage-pieton","pedestrianRailing1","pedestrianRailing2","pergola","picnic_table","pool_ladder","porch-column-03","rainGutterPart1","rainGutterPart2","rattanArmchair","rattanSofa","rattanTable","round-swimming-pool","sandpit","bonecoDeNeve","solar_panel_140W","stoneLantern","swimming-pool","ext_table","silla_teca","feu-de-signalisation-simple","trampoline","umbrella","wheelie_bin","outdoorLamp","window_shutter","window_flat_roof_skylight_bubble","external-unity-air-conditioning","column_balustrade","column_balustrade_corner","birch","bush","cafe-chair","cafe-table","ext_chair","child_swing","parque","croisement2et2","routeCourbe2VoiesAvecTrottoirs6","routeCourbe2VoiesAvecTrottoirs90Deg","route2VoiesAvecTrottoirs","voiesFerreesAiguillage","voiesFerreesCourbe20m","voiesFerreesDroit10m","hedgeTextured","lavender-bush","palm","pansy","tree","lombardyPoplar","pine","plantie","rock1","rock2","rock3","roses-bush"],be=["kitchenUpperCabinet","kitchenSmallUpperCabinet","kitchenSmallLowerCabinet","lowerCabinet","lowerCornerCabinet","drawersCabinet","kitchenLowerCabinet","kitchenIsland","kitchenDrawersCabinet","smallUpperCabinet","upperCabinet","highCabinet","kitchenSink","sinkCabinet2","islandExtension","upperCornerCabinet","upperShelves","meubleChaussures","kitchenGlassDoorCabinet","dishwasher","refrigerator","largeFridge","rangeHood","chest-freezer","stove1","stove","largeStove","oven","ovenFront","hood","kitchenHood","induction-cooker-2-zones","induction-cooker-4-zones","mano_cooktop","lavastoviglie","doubleOven","sgabello","tabouretBar","stool2","baby_high_chair","boiler","bouilloire","toaster","coffeeBrewer","percolateur","coffee-maker","cooker","electronicScale","autocuiseur","sandwichMaker","small-oven","spiceTower","saltShaker","grillePain","towel","poubelleInox","tray","kitchenKnife","kitchenKnifeStandSet","poele","casserole","paperTowelHolder","bolDeRiz","plate-and-ustensils","ensemble-assiette-couteau-fourchette-cuillere-verre","kitchen-glass-jar-high","cocktailGlass","glass","coffee-mug","coffeePress","choppingBoard","baguettes","bowl","mamadeira","utensilsPot","aspirateur","broom","shovel","bucket","eponge","food-box-pasta","food-box-corn-flakes","tetrapak","caffe_final","butter","cupcake","birthday_cake","bowlWithFruits","bowlWithSalad","bread","apples","baguettePain","toast","steak","roasted-chicken","citrouille","pizza","hotDog","hamburger","frenchFries"],xe=["clear_sofa","L_shaped_sofa","couch2","couch3","futon-couch","simple_sofa","sofa1","convertible-sofa-BZ-closed","clicClac","dining_room","cabinet2","elementHautSalon","meubleHiFiHaut","stainlessSteelShelf","shelves_storage_steel","shelves_storage_wood","dresserWithDrawers","full-bookcase","tourRangeCD","pinewoodRackLowHeight","pinewoodRackMediumHeight","longcase_clock","rocking_chair","fotel","armchair3","chair_granmother","chair","kitchenChair","thonet","chair3","chair4","white_kitchen_chair","childChair","children_chair","foldingChair","folding_chair","chaiseOrange","osakaChair","ryokanChair","stool_small","green_stool","pianoBench","black_table","folding-table","children_table","coffee_table","table_wood_and_iron","tableBasse2","couchTable","round-table","table-on-trestles","white_kitchen_table","table","table-with-leaning-feet","tableCuisine2","glass-dining-table","meubleHiFiBas","table_half_round","oakTable","tableWithTablecloth","wall-flat-tv","curvedTVForTable","curvedWallOLEDTV","dvd","playstation4","ps4-joystick","tv-remote-control","video-projector","wirelessOfficePhone3","fireplace1","fireplace2","carpet","puff","round-carpet","desklamp","JapaneseLantern","lamp","little_lamp2","MIDI-keyboard","batterie","microphone-with-foot","luckyBamboo","bonsai-tree","boston-fern","cactus","decorativePlant","flowers","mediumIndoorPlant","orchids","augalas","maceta","plant","roses","succulentPlant","yuccaPlant","christmas_tree"],Ce=["abdominalBench","internal-unity-air-conditioning","iphone","backpack","storeCalifornien","livreAvecReliure","book","livres","cageFuret","cardboard-box","arbreAChat","CCTV","ceilingFan","chimney","clock2","clothes-hanger","clothes-horse","crate","curtain","curtains","dart_game","doormat","electric_water_heater","electricWheelchair","emergencySign","fence","flipper","foldedNewspaper","folding-armchair","table_football","ButterflyFrame","frame","frame1","frame3HorizontalNorwayPhotos","frame3VerticalSummerPhotos","HaiVanPassFrame","furnace","gaz_water_heater","gift","glasses","barreAppui","marteau","cendrier","headphones","indoor-bike","intercom","intercom_with_screen","iron-railing-separated-hooks-2","keys","litiere","lockedLocker","revue","mini_stereo","mirror","mobile","mower","bdOuverte","revueOuverte","ovalMirror","pallet","poolTable","punching-ball","wheelchairSymbol","radiator3","gardeCorps","railing_glass","rectangularMirror","reflex_camera","round-chimney","japanese_style_screen","tournevis","sewing_machine","shippingContainer","smoke-detector","ballonFoot","speaker2","square-double-switch","frame_square","square-switch","square-plug-TypeB","square-plug-TypeE","step-ladder-metal","AtorHaut","suitcase","surveillanceCamera","table_tennis","tablet","tatami","treadmill","putekasse","umbrellaFolded","vase3","jar","walker-with-wheels","double-switch-whites","wall_handrail","switch-whites","plug-TypeB-whites","plug-TypeE-whites","wheelchair","window-blinds","wood_logs","complements2"],we=["mobile45160W","mobile45198W","mobile4580W","office_furniture1","cassettieraW","office_box","chair2","office_chair","chair_office_y","pcstul","lbDesk","office_desk","bureauInfoOuvert","wooden_office_pear_table","bureau3","inkjet_and_scanner_printer","laptop","monitorLCD","phone","imprimanteFaxPhotocopieur","penbox","pencil1","water_cooler","whiteBoard","lamp_office","dustbin"],ye=["staircase_90_bottom","staircase_180_long","escalator","staircase_180_landing","staircase_90_landing","stairs_90_closed_legal_high","stairs_rail","stairs_180_circular_notopstep_rail","staircase_360_circle","stairs_180_square","stair_ladder_loft","staircase_samba_265x150x85","stair_straight_open_stringer","staircase_ladder_steep","staircase_90_top","staircase_270_box","staircase_u2h"],Se=["seat_leon","smart-car","sportive","break","decapotable","monospace","renault-scenic","suv","pickup","4x4","renaultKangoo","van","truck","dafTruck","scooter","bicycle","scooter2","remorque","caravane","stroller","bus","cityBus","tramway","locomotive","wagon"],ve=["craftsmanDoorClosed","door","exterior-door-05","exterior-door-07","garage-door2","glassDoor2","glass_door","glass_door_framless","puerta","double_door_with_little_part","double_door_2","doubleFrenchWindow2","doubleWindow2","fixed_window_2x2","frenchWindow2","smallWindow2","window_2x1_medium_with_large_pane","window_2x1_with_sliders","window_2x4","window_2x6","window_3x1","window_4x1","window_4x5","window_deep","window_double_2x3_frame_sill","awning_bracket","fireplace1","fireplace2","curvedWallOLEDTV","wall-flat-tv","wash_basin_corner","toiletBrush","turkish-toilet","bathroom_vanity","highCabinet","kitchenIsland","largeFridge","largeStove","lowerCabinet","kitchenLowerCabinet","refrigerator","sinkCabinet2","dishwasher","stove1","barreAppuiCoude","folding-grab-bar","toilet_hang_round","mixer-tap-for-shower","shower","stone-washbasin","bathroom-tissue","towel2","com_bath3","towel3","small-urinal","bathroom3","awning_bracket","basketball_net_and_board","entry-bell-ring","entry-bell-speech-unit","window_shutter","doubleOven","kitchenGlassDoorCabinet","upperCabinet","hood","kitchenHood","oven","rangeHood","kitchenSmallUpperCabinet","smallUpperCabinet","towel","tray","upperCornerCabinet","upperShelves","curvedWallOLEDTV","glassDoorCabinet","stainlessSteelShelf","clock","clock2","curtain","curtains","dart_game","emergencySign","ButterflyFrame","frame","frame3VerticalSummerPhotos","frame3HorizontalNorwayPhotos","HaiVanPassFrame","barreAppui","intercom","intercom_with_screen","mirror","ovalMirror","wheelchairSymbol","radiator3","rectangularMirror","smoke-detector","square-double-switch","frame_square","square-switch","square-plug-TypeB","square-plug-TypeE","surveillanceCamera","double-switch-whites","wall_handrail","switch-whites","plug-TypeB-whites","plug-TypeE-whites","window-blinds","radiator1","stairs_rail","washbasin_jay_hardy","ergonomic-washbasin","external-unity-air-conditioning","kitchenUpperCabinet","drawersCabinet","kitchenDrawersCabinet","lavastoviglie","AtorHaut","putekasse"],je=["door","double_door","double_plain_door_with_little_part","exterior-door-05","exterior-door-07.","frontDoor2","glassDoor2","glass_door","double_door_with_little_part","doubleFrenchWindow2","doubleWindow2","frenchWindow2","smallWindow2","window_2x1_medium_with_large_pane","window_2x4","window_2x6","window_3x1","window_4x1","window_4x5"],De=(e,t,i,o,s,n)=>({dimensions:{width3D:e,depth3D:t,height3D:i},author:o,itemType:n,title:s}),Te={doubleFrenchWindow2:De(150,25,221,"Seber Rider","Double French window",4),doubleWindow2:De(150,25,126,"Seber Rider","Double window",4),fixed_window_2x2:De(60,16,60,"Ola-Kristian Hoff","Fixed small window",4),smallWindow2:De(100,25,76,"Seber Rider","Small window",4),frenchWindow2:De(100,25,221,"Seber Rider","French window",4),"turn-window":De(59,13.5,102,"Scopia","Turn window",4),"window-08":De(62.6,16.6,128,"Kator Legaz","Double hung window",4),window_2x1_medium_with_large_pane:De(110,31.3,130,"Scopia","Double window with large pane",4),window_2x1_with_sliders:De(188,25,218,"Scopia","Sliding window",4),window_2x3_frame_sill:De(56,35,110,"Ola-Kristian Hoff","Window 2x3",4),window_2x4:De(108.5,31.3,200,"Scopia","Double window 4 panes",4),window_2x6:De(108.5,31.3,218,"Scopia","Double French window small panes",4),window_3x1:De(188,32.2,218,"Scopia","Triple French window",4),window_4x1:De(250.3,32.2,218,"Scopia","Quadruple French window",4),window_4x5:De(160.3,32.2,218,"Scopia","Quadruple French window small panes",4),window_deep:De(105,60,150,"Ola-Kristian Hoff","Deep window",4),window_double_2x3_frame_sill:De(123,25,110,"Ola-Kristian Hoff","Double small window 2x3 panes with sill",4),window_shop:De(300,15,200,"Ola-Kristian Hoff","Shop window",4),window_stain_glass:De(80,16,120,"Ola-Kristian Hoff","Window stain glass",4),glassblock:De(21,8.8,168,"RonnieTandriady","Glass blocks",1)},Ie={craftsmanDoorClosed:De(100.9,18.7,209.6,"Mchnz","Craftsman door",3),door:De(91.5,14.5,208.5,"eTeks","Door",3),double_door:De(176,17.5,210,"Scopia","Double door with panes",3),double_plain_door_with_little_part:De(132.7,17.5,210,"Scopia","Double door with small part",3),"elevator-door":De(185.6,21.5,244.9,"Scopia","Elevator door",3),emergencyGlassDoubleDoor:De(219.1,28.4,210,"Siath","Emergency glass double door",3),"exterior-door-05":De(99,18.5,205,"Kator Legaz","Exterior door",3),"exterior-door-07":De(102,18,205,"Kator Legaz","Exterior door",3),frontDoor2:De(112,20,216,"Seber Rider","Front door",3),"garage-door":De(391,26,221.3,"Scopia","Garage door",3),"garage-door2":De(441.2,32,216.7,"Scopia","Garage door",3),glassDoor2:De(84.5,14.1,204,"Scopia","Glass door",3),glass_door:De(104.4,17.5,210,"Scopia","Glass door",3),glass_door_framless:De(91,20,210.5,"Ola-Kristian Hoff","Glass door",3),puerta:De(87,13.7,210,"Scopia","Door",3),revdoor:De(384,300,230,"Ola-Kristian Hoff","Revolving door",3),"screen-door":De(87.6,9.7,200,"Kator Legaz","Screen door",3),sliderPocketDoor:De(94.8,12.2,212.5,"Ola-Kristian Hoff","Slider pocket door",3),double_door_2:De(176,17.5,210,"Scopia","Double door",3),double_door_with_little_part:De(132.7,17.5,210,"Scopia","Double door with panes",3),japanesedoor:De(298,9.7,210,"RonnieTandriady","Japanese door",3),elevator:De(185.6,189.6,245.4,"Scopia","Elevator",3)},_e={floorUplight:De(33,33,181,"eTeks","Floor uplight",2),fluorescent:De(105,24.3,10.6,"Kator Legaz","Fluorescent light",1),hangingLight:De(43.9,43.9,86,"Jay-Artist","Hanging light",1),lightSource:De(0,0,0,"eTeks","Simple light",1),lustreBoule:De(30,30,67.6,"Sheep","Pendant light",1),painting_light:De(40,14.6,2.6,"Ronnie Tantriady","Painting light",7),"porch-light":De(17.7,17,32,"Kator Legaz","Porch light",7),spotlight:De(6.8,9.9,13.1,"eTeks","Spotlight",1),street_light_modern:De(34,245,770,"Ola-Kristian Hoff","Street light",2),"track-lights":De(100,17,13.8,"Kator Legaz","Track lights",7),"wall-spotlight":De(6,23.5,10.3,"Kator Legaz","Wall spotlight",7),wall_lamp:De(22.3,11,9,"alaX","Wall lamp",7),"ceiling-lamp":De(30,30,5.4,"Scopia","Ceiling lamp",1),farola1:De(43.9,43.5,250,"Scopia","Street lamp",2),lamp2:De(53.4,51.3,63.4,"Megeon","Lamp",1),minispot:De(7,7,.3,"Emmanuel Puybaret","Mini spot",1),"fluorescent-strip":De(55,8.9,8.3,"Kator Legaz","Fluorescent strip",7)},Le={barreAppuiCoude:De(76.9,11,36.4,"Emmanuel Puybaret","Angled grab bar",7),basin:De(76.8,65.8,27,"Scopia","Basin",1),bathmat:De(73.3,47,1.4,"Kator Legaz","Bathmat",5),bathtub_jet_system:De(160,70,58,"Ola-Kristian Hoff","Bathtub jet system",2),bidet:De(39.9,53.6,51.3,"Arusano","Bidet",2),com_bath2_jabon_pijo:De(5.7,5.7,13.7,"Scopia","Bottle",1),"clothes-basket":De(53.9,53.8,67.4,"Scopia","Clothes basket",1),clothes_line:De(500,15,140,"Ola-Kristian Hoff","Clothes line",1),corner_bathtub:De(160,160,80.3,"Scopia","Corner bathtub",2),wash_basin_corner:De(50,50,81,"Ola-Kristian Hoff","Corner washbasin",6),"ergonomic-washbasin":De(60,46,53.8,"Scopia","Ergonomic washbasin",7),"folding-grab-bar":De(7,62.4,17.7,"Scopia","Folding grab bar",7),secheCheveux:De(15.8,15.3,7.2,"Toomy","Hair dryer",1),"hand-washbasin":De(49.1,30,27,"Scopia","Hand washbasin",7),toilet_hang_round:De(38,56.5,82,"Ola-Kristian Hoff","Hanged toilet",7),islandBath:De(169.6,93.7,108.1,"Scopia","Island bath",5),"japanese-toilet":De(52.7,83.6,98,"Scopia","Japanese toilet unit",2),"mixer-tap-for-shower":De(29,34.7,99.1,"Scopia","Mixer tap for shower",7),potty:De(30.3,30.3,18.4,"Icarus","Potty",1),pesePersonne:De(28.2,32.1,2.8,"Emmanuel Puybaret","Scale",2),"shower-cabin-with-seat":De(100.5,170.4,213.5,"Scopia","Shower cabin",2),shower_cabin:De(90,90,199,"Ola-Kristian Hoff","Shower cabin",2),doccia:De(70,70,200,"LucaPresidente","Shower cabin",2),showerCurtain:De(90.3,29.4,190,"Kator Legaz","Shower curtain",1),shower:De(20.8,53.8,114.3,"Wfg5001","Shower head and faucet",7),savon:De(7,5.8,16.7,"Toomy","Soap",1),"stone-washbasin":De(53.7,45.5,36.8,"Scopia","Stone washbasin",7),toiletBrush:De(9.6,12.9,38.6,"Nhumrod","Toilet brush",6),"bathroom-tissue":De(21.3,17.3,15,"Kator Legaz","Toilet paper dispenser",7),potBrossesADent:De(7.2,8.7,18.2,"Toomy","Tooth brushes and paste",1),towel2:De(21.8,13.7,66.9,"Wfg5001","Towel",7),com_bath3:De(60,16.8,41.8,"Scopia","Towel rack",7),towel3:De(59.6,8.1,47.8,"Wfg5001","Towel rack",7),"turkish-toilet":De(45,70.5,68.6,"Scopia","Turkish toilet",6),"small-urinal":De(34,27.1,61.8,"Scopia","Urinal",7),bathroom_vanity:De(107.1,38.5,207.8,"Scopia","Vanity",6),modernVanity:De(90.4,70.8,93.3,"Dobbs","Vanity",2),washbasin_jay_hardy:De(59.7,43.1,86.7,"Jay-Artist","Washbasin",6),bathroom3:De(71.9,40.3,48.4,"Scopia","Washbasin",7),bathroom_sink:De(122,55,78,"Ola-Kristian Hoff","Washbasin with cabinet",2),mobilettoLavaboWenge:De(81,42.5,101.3,"LucaPresidente","Washbasin with cabinet",2),dryer_machine:De(59,61.8,84.2,"Scopia","Dryer machine",2),clothes_washing_machine:De(59,60.1,84.2,"Scopia","Clothes washing machine",2),fer:De(13.7,13.2,30.6,"Toomy","Iron",1),plancheARepasser:De(137.1,54.5,79.5,"Toomy","Ironing board",2)},Me={bedFlowers:De(202.2,228.2,144.2,"Flowers","Bed",2),"air-mattress":De(69.4,181.9,15.8,"Scopia","Air mattress",2),mobileangoloCiliegio:De(86.7,86,240,"LucaPresidente","Angle wardrobe cherry",2),bed3:De(202.2,228.2,144.2,"SVAFnemesis","Bed",2),bed1:De(170.5,216.5,110.8,"Scopia","Bed",2),bed2:De(144.7,213.7,107.7,"Blend swap","Bed",2),bedWithTexture:De(198,226.4,76.5,"Nhumrod","Bed",2),bedsideTable:De(50,41.4,48,"SirOccor","Bedside table",2),bedsideTable2:De(48.6,48.1,45.4,"Nhumrod","Bedside table",2),blocks:De(60,50,34.6,"LucaPresidente","Blocks",1),mobileAngoloInterno:De(105,105,240,"LucaPresidente","Blue corner wardrobe",2),mobileAzzurro:De(100,57,240,"LucaPresidente","Blue wardrobe",2),bootieSeparated:De(21,26.8,17.5,"Cgrifter","Bootie",1),bunkBed:De(113.1,205,160,"NabHlEsCK & eTeks","Bunk bed",2),"captains-bed":De(98.2,209.2,86.6,"Scopia","Captain's bed",2),"changing-table":De(122.7,48.1,97.5,"Scopia","Changing table",2),chest:De(143.5,53.6,82,"Elhzar","Chest",2),kommode:De(95.1,41.9,93,"JabberWalky","Chest",2),juniorBed:De(105.7,197.8,65.6,"SirOccor & eTeks","Child bed",2),"clothes-rack":De(111.9,35.8,125.1,"Scopia","Clothes rack",2),corner:De(52.5,52.5,240,"LucaPresidente","Corner bookcase",2),mensolaCurvaAcero:De(40,40,3,"LucaPresidente","Corner shelf maple",7),crib:De(72.8,124.3,110.9,"Scopia","Crib",2),pensileAcero:De(40,25,40,"LucaPresidente","Cube shelf maple",1),doll:De(14.4,12.1,16,"Scopia","Doll",1),"doll-house":De(69,32.4,86.8,"Scopia","Doll house",1),comoCiliegio:De(160,60,70,"LucaPresidente","Dresser cherry",2),"dressing-table":De(85.7,46.5,135.9,"Scopia","Dressing table",2),folded_clothes:De(26.3,40.4,12.2,"Scopia","Folded clothes",1),futon:De(142,211.3,18.2,"Scopia","Futon",5),"hanging-clothes1":De(32.5,59,142.5,"Kator Legaz","Hanging clothes",1),casque:De(26,37.9,30.1,"Scopia","Helmet",1),"adjustable-hospital-bed":De(100,209.6,89.7,"Scopia","Hospital bed",2),"hospital-table-on-wheels":De(76.6,45.5,74.5,"Scopia","Hospital table on wheels",2),hotelSafe:De(44,39.6,20,"Scopia","Hotel safe",1),letters:De(40.1,12.7,18,"LucaPresidente","Letter cubes",1),litMezzanine2:De(296.4,184.9,210,"Clyriss","Mezzanine bed",2),"mezzanine-bed":De(121.8,259,192.6,"Scopia","Mezzanine bed",2),mocassinSeparated:De(22.2,28.1,10.5,"Mocassin","Scopia",1),"convertible-sofa-BZ-opened":De(158.3,190.1,47.8,"Scopia","Opened convertible sofa BZ",2),housePuzzle:De(15.5,15.6,1.3,"Snu","Puzzle",1),rubix2:De(5.6,5.6,5.6,"Farcgs","Rubik's cube",1),sleepingBag:De(88.2,200,10.1,"Scopia","Sleeping bag",2),slippersSeparated:De(23.7,28.1,6.1,"Mik1190","Slippers",1),smiley:De(13.4,13.4,20.9,"LucaPresidente","Smiley tower",1),sneakersSeparated:De(23.7,30.1,11.8,"Scopia","Sneakers",1),teddyBear:De(33.1,21.8,32.2,"Mantislate","Teddy bear",1),train:De(119,97,10.2,"LucaPresidente","Train",2),armoireLotus:De(179.5,67.5,221.4,"Ga\xebl Bettinelli","Wardrobe",2),mobileCiliegio:De(100,50,240,"LucaPresidente","Wardrobe cherry",2),wardrobe2:De(173.5,60,208,"Richu","Wardrobe",2),womanShoesSeparated:De(18.9,24.9,16.5,"Scopia","Woman shoes",1)},ke={"external-unity-air-conditioning":De(77.1,28.4,54.2,"Scopia","Air conditioning - External unit",7),awning_bracket:De(310,169.4,61.6,"Ola-Kristian Hoff","Awning",7),column_balustrade:De(30,24.4,92.5,"Ola-Kristian Hoff","Balustrade column",2),column_balustrade_corner:De(54.4,54.4,92.5,"Ola-Kristian Hoff","Balustrade corner",2),barbecue:De(39.2,48.4,50.9,"Sophie","Barbecue",2),barnum:De(300.3,300.5,340.1,"Scopia","Barnum",2),basketball_net_and_board:De(109,60.9,105.6,"Scopia","Basketball net",7),birch:De(394,375,750,"Ola-Kristian Hoff","Birch",2),bush:De(151.6,143.5,131.2,"Scopia","Bush",2),"cafe-chair":De(49.5,51.7,85,"Kator Legaz","Cafe chair",2),"cafe-table":De(74.2,74.2,70,"Kator Legaz","Cafe table",2),campingLamp:De(15.4,15.4,36.7,"Bloknayrb","Camping lamp",1),campingTent:De(248.1,236.2,141.4,"Scopia","Camping tent",2),ext_chair:De(100,76.4,73.4,"Scopia","Chair",2),child_swing:De(162.8,160.7,176.3,"Scopia","Child swing",2),parque:De(406.9,95.9,200,"Scopia","Children game",2),croisement2et2:De(1045,1045,18,"Scopia","Crossroad 2x2 lanes",5),routeCourbe2VoiesAvecTrottoirs6:De(778,1111.9,18,"Scopia","Curved road lanes 6.5m",5),routeCourbe2VoiesAvecTrottoirs90Deg:De(1045,1045,18,"Scopia","Curved road lanes 90\xb0",5),deckChair:De(71.4,125.5,82.2,"BigMouse","Deck chair",2),"diving-board":De(42,183,28,"Scopia","Diving board",1),"dog-house":De(71.6,90,71.9,"Scopia","Dog house",2),"entry-bell-ring":De(3.8,2.4,10,"Scopia","Entry bell ring",7),"entry-bell-speech-unit":De(10.4,2,20.3,"Scopia","Entry speech unit",7),privacyFence2:De(73.9,7.4,100.8,"Pencilart","Fence",2),fence_grid:De(200,5,105,"Ola-Kristian Hoff","Fence grid",1),fence_picket:De(85,6,125,"Ola-Kristian Hoff","Fence picket",1),flag_hinged_pole:De(230,140,820,"Ola-Kristian Hoff","Flag hinged pole",2),"football-goal":De(152.4,89,120,"Scopia","Football goal",2),"big-football-goal":De(732,180.9,244,"Scopia","Big football goal",2),waterFountain:De(51.4,51.4,46.5,"Sparkywalk","Fountain",2),fountain:De(184.9,184.9,150,"NabHlEsCK & eTeks","Fountain",2),"garden-hut":De(171,182,198,"Scopia","Garden hut",2),gate_grind:De(191,11.5,86,"Ola-Kristian Hoff","Gate",2),greenhouse:De(310,310,290,"Ola-Kristian Hoff","Greenhouse",2),grillNgauge:De(180,69.5,135,"Pencilart","Grill",2),hammock:De(350.5,164.3,158.5,"Scopia","Hammock",2),hangingUmbrella:De(240,297,272.1,"Seber Rider","Hanging umbrella",2),hedgeTextured:De(154.7,59.4,100,"Scopia","Hedge",1),jacuzzi:De(228,228,94.8,"Scopia","Jacuzzi",2),"lavender-bush":De(81.8,82.1,64.7,"Scopia","Lavender bush",2),boiteALettre:De(31,30,30,"Venceslas","Letters box",1),lombardyPoplar:De(203,192,750,"Wolfram Diestel","Lombardy poplar",2),motorbike:De(91.4,33,74.6,"Ulanbek","Motorbike",2),"painted-bench":De(142.6,51.8,80,"Kator Legaz","Painted bench",2),palm:De(530,547,950,"Wolfram Diestel","Palm tree",2),pansy:De(30.8,30.3,21.5,"Scopia","Pansy",2),"passage-pieton":De(400,750,.3,"Scopia","Pedestrian crossing",5),pedestrianRailing1:De(208.1,4.8,103.9,"Colkaih","Pedestrian railing",2),pedestrianRailing2:De(200,5,108.9,"Colkaih","Pedestrian railing",2),pergola:De(240,255.6,263,"Sophie","Pergola",2),picnic_table:De(180.2,145.3,75,"Hawkdawg","Picnic table",2),pine:De(340,320,600,"Ola-Kristian Hoff","Pine",2),plantie:De(68.9,27.7,37.3,"Rendars","Plant box",2),pool_ladder:De(50,50,190,"Ola-Kristian Hoff","Pool ladder",1),"porch-column-03":De(33.3,33.3,250,"Kator Legaz","Porch column",2),voiesFerreesDroit10m:De(1e3,440,39.9,"Scopia","Railroad 10m",5),voiesFerreesCourbe20m:De(2034.3,692.8,39.9,"Scopia","Railroad curve 20m",5),voiesFerreesAiguillage:De(2006.6,692.8,39.9,"Scopia","Railroad switch",5),rainGutterPart1:De(200,12,6.5,"Dingenskirchen","Rain gutter Part 1",1),rainGutterPart2:De(10,91.6,260,"Dingenskirchen","Rain gutter Part 2",1),rattanArmchair:De(71,72.4,78.7,"Scopia","Rattan armchair",2),rattanSofa:De(128.5,72.4,78.7,"Scopia","Rattan sofa",2),rattanTable:De(120,60,40,"Scopia","Rattan table",2),route2VoiesAvecTrottoirs:De(1300,1045,18,"Scopia","Road 2 lanes",5),rock1:De(50.5,33.7,50,"1000bones","Rock",2),rock2:De(69,53.4,30.7,"1000bones","Rock",2),rock3:De(68.5,42.3,43.8,"1000bones","Rock",2),"roses-bush":De(39.6,45.3,36.1,"Scopia","Roses bush",2),"round-swimming-pool":De(165,165,52,"Scopia","Round swimming pool",2),sandpit:De(130.3,120.2,26,"Scopia","Sandpit",2),bonecoDeNeve:De(94,71.1,98.8,"Zema","Snowman",2),solar_panel_140W:De(125,66.8,3,"Ola-Kristian Hoff","Solar panel",1),stoneLantern:De(34.7,34.7,49.4,"Argonius","Stone lantern",2),"swimming-pool":De(1713.4,997.6,100.5,"Scopia","Swimming pool",2),ext_table:De(202.2,154.7,40,"Scopia","Table",2),silla_teca:De(58,67,98.4,"Scopia","Teck chair",2),"feu-de-signalisation-simple":De(37.5,53.3,316.6,"Scopia","Traffic light",2),trampoline:De(300,300,53.2,"Scopia","Trampoline",2),tree:De(600,640,800,"Ola-Kristian Hoff","Tree",2),umbrella:De(223.1,222.7,199.8,"BigMouse","Umbrella",2),wheelie_bin:De(60,62.5,101.5,"Ola-Kristian Hoff","Wheelie bin",2),outdoorLamp:De(21.3,21.3,59.1,"Mindfront","Outdoor lamp",1),window_shutter:De(43.9,2.9,129,"Ola-Kristian Hoff","Window shutter",7),window_flat_roof_skylight_bubble:De(100,100,45,"Ola-Kristian Hoff","Flat roof skylight bubble",1)},Oe={apples:De(25.7,25.7,16,"Scopia","Apples",1),mamadeira:De(5,5,14.7,"Valdps","Baby bottle",1),baby_high_chair:De(60,64.4,104,"Scopia","Baby high chair",2),sgabello:De(32,36,85,"LucaPresidente","Bar stool",2),birthday_cake:De(24,24,10.6,"Scopia","Birthday cake",1),boiler:De(17.9,16.2,20,"Jay-Artist","Boiler",1),bouilloire:De(16.7,20.2,22.1,"Toomy","Boiler",1),bowl:De(40.1,40.1,20.4,"Scopia","Bowl",1),bowlWithFruits:De(32,33.6,14.1,"Scopia","Bowl with fruits",1),bowlWithSalad:De(25,25,11.7,"Scopia","Bowl with salad",1),bread:De(6,23.5,10.3,"Yd","Bread",1),baguettePain:De(54.7,7.5,4.1,"Emmanuel Puybaret","Baguette",1),broom:De(36.6,8.2,156,"Scopia","Broom",1),bucket:De(30,28,26.5,"Ola-Kristian Hoff","Bucket",1),butter:De(16,7.5,3.4,"BMF","Butter",1),"chest-freezer":De(130,85.8,74,"Scopia","Chest freezer",2),choppingBoard:De(37.6,26,4.5,"Jay-Artist","Chopping board",1),baguettes:De(1.4,21,.6,"Toomy","Chopsticks",1),cocktailGlass:De(8.3,8.3,13.1,"Xablend1222","Cocktail glass",1),coffeeBrewer:De(13.4,38.5,27.2,"TreyClaine","Coffee brewer",1),caffe_final:De(10,10,4.3,"Reduno","Coffee cup",1),percolateur:De(20.5,30.4,27.9,"Toomy","Coffee machine",1),"coffee-maker":De(18.6,28.7,30,"Kator Legaz","Coffee maker",1),"coffee-mug":De(8.5,12,10.8,"Kator Legaz","Coffee mug",1),coffeePress:De(16.3,10.3,26.5,"Cephei","Coffee press",1),cooker:De(28.9,40,27.1,"Scopia","Cooker",1),mano_cooktop:De(58,50,3.8,"Mano","Cooktop",1),"food-box-corn-flakes":De(19.1,9.1,27.1,"Kator Legaz","Corn flakes box",1),cupcake:De(5.9,5.9,7.5,"Dvachib","Cup cake",1),lavastoviglie:De(60,62.6,78,"LucaPresidente","Dishwasher",6),doubleOven:De(60,51.5,108.9,"Martanda","Double oven",7),drawersCabinet:De(60,61.2,88.5,"Vladoffsky","Drawers cabinet",6),kitchenDrawersCabinet:De(44.2,61.2,87.8,"Jay-Artist","Drawers cabinet",6),electronicScale:De(15,22,2,"Scopia","Electronic scale",1),frenchFries:De(20.4,19.2,3.5,"Scopia","French fries",1),glass:De(7.5,7.4,19.5,"Jay-Artist","Glass",1),kitchenGlassDoorCabinet:De(33.6,32.1,77.1,"Jay-Artist & eTeks","Glass door cabinet",7),"kitchen-glass-jar-high":De(9.9,9.9,21.8,"Scopia","Glass jar",1),upperCabinet:De(60,41,56.6,"Vladoffsky","Upper cabinet",7),hamburger:De(11,11,8.6,"SaiZyca2","Hamburger",1),highCabinet:De(60,61.2,217,"Vladoffsky","High cabinet",6),hood:De(101.6,39.2,48.6,"Jay-Artist","Hood",7),kitchenHood:De(59.8,51.4,14.3,"Scopia","Hood",7),hotDog:De(21.1,7.3,6.5,"Erickfree","Hot dog",1),"induction-cooker-2-zones":De(30,52,.4,"Scopia","Induction cooker 2 zones",1),"induction-cooker-4-zones":De(56,49.5,.4,"Scopia","Induction cooker 4 zones",1),kitchenIsland:De(93.9,69.9,83.1,"Jay-Artist","Island",6),islandExtension:De(60,123.7,88.5,"Vladoffsky","Island extension",2),kitchenKnife:De(3.5,26.3,2.1,"Jay-Artist","Kitchen knife",1),kitchenUpperCabinet:De(109.4,32.1,77.1,"Jay-Artist","Upper cabinet",7),kitchenKnifeStandSet:De(9,27.1,21.9,"Scopia","Knife stand",1),largeFridge:De(92.5,80.6,184.3,"Vladoffsky","Large fridge",6),largeStove:De(103.9,72.3,85.2,"Jay-Artist","Large stove",6),lowerCabinet:De(60,61.2,88.5,"Vladoffsky","Lower cabinet",6),kitchenLowerCabinet:De(97.6,61.6,87.8,"Jay-Artist","Lower cabinet",6),lowerCornerCabinet:De(81,82.3,88.5,"Vladoffsky","Lower corner cabinet",2),tetrapak:De(9.6,9.5,26.5,"Tastykle3d & eTeks","Milk",1),oven:De(60,51.5,57.8,"Martanda","Oven",7),ovenFront:De(60,6.7,55,"LucaPresidente","Oven front",1),poele:De(25.7,43.2,5.4,"Toomy","Pan",1),casserole:De(17.4,30.3,8.5,"Toomy","Pan",1),paperTowelHolder:De(16,16,29.2,"Scopia","Paper towel holder",1),"food-box-pasta":De(13.9,5.4,19.7,"Scopia","Pasta box",1),pizza:De(29.7,30,.9,"Toomy","Pizza",1),"plate-and-ustensils":De(27,34,13.2,"Kator Legaz","Plate, glass and cultery",1),"ensemble-assiette-couteau-fourchette-cuillere-verre":De(41.7,38.9,14,"Scopia","Plate, glasses and cutlery",1),citrouille:De(29.4,29.4,24.7,"Sophie","Pumpkin",1),rangeHood:De(60,31.8,42.6,"Donypolo","Range hood",7),refrigerator:De(90,95.9,172.3,"Hilander","Refrigerator",6),bolDeRiz:De(11,11,6,"Toomy","Rice bowl",1),autocuiseur:De(25.8,22.5,22.8,"Tommy","Rice cooker",1),"roasted-chicken":De(30,20.3,19.5,"Scopia","Roasted chicken",1),saltShaker:De(4.1,4.1,7.9,"Jswing","Salt shaker",1),sandwichMaker:De(24,25.2,6.8,"Scopia","Sandwich maker",1),meubleChaussures:De(71.7,39.6,102.3,"Ga\xebl Bettinelli","Shoe cabinet",2),shovel:De(27,53.8,16.1,"Scopia","Shovel",1),kitchenSink:De(97.6,61.6,97.6,"Jay-Artist & Kator Legaz & eTeks","Sink",2),sinkCabinet2:De(60,61.2,121.2,"Vladoffsky","Sink cabinet",6),dishwasher:De(45,60,84.5,"Scopia","Small dishwasher",6),kitchenSmallLowerCabinet:De(48.7,61.6,87.8,"Jay-Artist","Small lower cabinet",6),"small-oven":De(56.4,47.3,36.4,"Scopia","Small oven",1),kitchenSmallUpperCabinet:De(33.6,32.1,77.1,"Jay-Artist","Small upper cabinet",7),smallUpperCabinet:De(60,41,56.6,"Vladoffsky","Small upper cabinet",7),spiceTower:De(15.9,15.9,31,"Scopia","Spice tower",1),eponge:De(10,6,1.4,"Toomy","Sponge",1),steak:De(32.4,19.3,5.1,"Scopia","Steak",1),tabouretBar:De(51.1,44.2,101.7,"Ga\xebl Bettinelli","Stool",2),stool2:De(36.1,36.1,78,"Vladoffsky","Stool",2),stove1:De(83.3,93.6,104,"Pencilart","Stove",6),stove:De(33.3,60,5.6,"Doniypolo","Stove",1),toast:De(10.1,9.9,.8,"Toomy","Toast",1),grillePain:De(34.2,11.9,18,"Toomy","Toaster",1),toaster:De(27,15.5,17.4,"Scopia","Toaster",1),towel:De(14.5,13.4,45.4,"Jay-Artist","Towel",7),poubelleInox:De(29,34.2,65.2,"Ga\xebl Bettinelli","Trash can",2),tray:De(39,29.4,5.5,"Scopia","Tray",1),upperCornerCabinet:De(81,81,72,"Vladoffsky","Upper corner cabinet",7),upperShelves:De(35,35,72,"Vladoffsky","Upper shelves cabinet",7),utensilsPot:De(12.2,11.1,40.2,"Oldtimer","Utensils pot",1),aspirateur:De(142.8,32.8,82.3,"Tommy","Vacuum",2)},Re={"convertible-sofa-BZ-closed":De(143.2,102.3,87.3,"Scopia","Convertible sofa BZ",2),clicClac:De(182,93.3,93.1,"Ga\xebl Bettinelli","Sofa bed",2),chair_granmother:De(61,58,105,"Ola-Kristian Hoff","Armchair",2),fotel:De(73.5,61.1,69.7,"TripleJ","Armchair",2),armchair3:De(59.1,69.4,94.9,"eTeks","Armchair",2),luckyBamboo:De(15.5,14.9,34,"Renderbob","Bamboo",1),black_table:De(170.1,90,75,"Scopia","Black table",2),"bonsai-tree":De(44.5,38.2,42.9,"Scopia","Bonsai tree",1),bookcase:De(166.4,33.1,186.4,"Gerardbelnder","Bookcase",2),dining_room:De(255.6,36.4,175,"Scopia","Bookcase",2),cabinet2:De(223.4,64.5,210.6,"Peter Smolik","Bookcase",2),elementHautSalon:De(51.9,42.6,163.2,"Ga\xebl Bettinelli","Bookcase",2),"boston-fern":De(65,61,44.5,"Scopia","Boston fern",1),cactus:De(14.8,12.8,22.5,"Evivivi","Cactus",1),carpet:De(160,225,1,"Emmanuel Puybaret","Carpet",5),tourRangeCD:De(19.9,17,179.6,"Ga\xebl Bettinelli","CD rack",2),chair:De(42,47.4,88,"Scopia","Chair",2),kitchenChair:De(43,44,91,"Cisco336","Chair",2),thonet:De(54.7,57.7,75.4,"JoelEapen","Chair",2),chair3:De(43.3,50.4,90.6,"MatBot","Chair",2),chair4:De(48.4,44.2,88.4,"Scopia","Chair",2),white_kitchen_chair:De(42.7,46.9,86,"Scopia","Chair",2),childChair:De(38.2,39.5,67,"Radio hate","Child chair",2),children_chair:De(28,28,51,"Scopia","Children chair",2),children_table:De(63,48,45,"Scopia","Children table",2),christmas_tree:De(127.8,129.6,202.9,"Scopia","Christmas tree",2),clear_sofa:De(193.9,75.9,80,"Scopia","Clear sofa",2),coffee_table:De(89.6,45.9,47.5,"Scopia","Coffee table",2),table_wood_and_iron:De(121.4,75.9,50.3,"Scopia","Coffee table",2),tableBasse2:De(112.5,59.8,39.1,"Ga\xebl Bettinelli","Coffee table",2),L_shaped_sofa:De(233.7,143.6,80,"Nhumrod","Corner sofa",2),sofa:De(147,87,87,"eTeks","Corner sofa",2),couch2:De(230,159.7,86.6,"Karagez","Couch",2),couch3:De(201,90.9,84.3,"MatBot","Couch",2),couchTable:De(101.1,70.1,44,"Jabberwalky","Couch table",2),curvedTVForTable:De(126.3,18.1,79.9,"Jabberwalky","Curved TV",1),curvedWallOLEDTV:De(151,13,87,"RonnieTantriady","Curved wall TV",7),decorativePlant:De(31.8,32.2,60.6,"Nmn9","Decorative plant",1),dresserWithDrawers:De(160.5,51.9,81,"Hsdevys","Dresser with drawers",2),batterie:De(104.9,92.8,115.6,"Sophie","Drums",2),dvd:De(43,28.2,5.6,"Scopia","DVD player",1),fireplace1:De(115.4,35.1,105,"Scopia","Fireplace",6),fireplace2:De(121,44.9,250,"Scopia","Fireplace",6),flowers:De(20.9,15.9,50,"Peter Smolik","Flowers",1),foldingChair:De(50.8,60,91.2,"Giovagiova","Folding chair",2),folding_chair:De(49,50.9,76.5,"alaX","Folding chair",2),"folding-table":De(186,77.6,75,"Kator Legaz","Folding table",2),"full-bookcase":De(89.8,34.7,221,"Kator Legaz","Full bookcase",2),"futon-couch":De(196,89.8,87.8,"Kator Legaz","Futon couch",2),glassDoorCabinet:De(70,38.7,198.2,"eTeks","Glass door cabinet",7),"glass-dining-table":De(161.8,97.6,75,"Kator Legaz","Glass table",2),table_half_round:De(102,58.6,78,"Ola-Kristian Hoff","Half round table",2),mediumIndoorPlant:De(72.5,76.6,67.9,"Betomo16","Indoor plant",1),"ps4-joystick":De(16.2,10.6,6.2,"Scopia","Joystick",1),longcase_clock:De(50,30,200,"Ola-Kristian Hoff","Longcase clock",2),"microphone-with-foot":De(67.4,98.7,142.8,"Scopia","Microphone with foot",2),oakTable:De(124,124,74.1,"Doug C","Oak table",2),chaiseOrange:De(41.2,46.7,95,"Icybones","Orange chair",2),orchids:De(31.1,35.3,57.4,"Elysia","Orchids",1),"oriental-rug":De(185.8,257.7,2.5,"Kator Legaz","Oriental rug",5),osakaChair:De(47.5,52.5,77,"Daniliescudsg","Osaka chair",2),pianoBench:De(61.9,35.5,52.2,"Simonrepp","Piano bench",2),throwPillow:De(35,17,32.1,"Pencilart","Pillow",1),pinewoodRackLowHeight:De(89.8,30.2,56.5,"Dingenskirchen","Pinewood rack low height",2),pinewoodRackMediumHeight:De(89.8,30.2,143,"Dingenskirchen","Pinewood rack medium height",2),augalas:De(60.9,34.9,31.5,"MZiemys","Plant",1),maceta:De(59,65,58,"Scopia","Plant",1),plant:De(81.8,69,117.1,"Ndakasha","Plant",1),playstation4:De(32.7,29.5,5.5,"Scopia","PlayStation4",1),puff:De(91.3,84.8,60.3,"Scopia","Puff",2),rocking_chair:De(65,80,109,"Ola-Kristian Hoff","Rocking chair",2),roses:De(22.8,27.3,52.9,"Scopia","Roses",1),"round-carpet":De(80,80,.5,"Scopia","Round carpet",5),"round-table":De(110,110,75.7,"Scopia","Round table",2),ryokanChair:De(53.3,59,54.8,"Scopia","Ryokan chair",2),meubleHiFiHaut:De(155.9,41.4,183,"Ga\xebl Bettinelli","Shelf unit",2),simple_sofa:De(179.8,67.3,95,"Scopia","Sofa",2),sofa1:De(234,79.4,79.2,"Peter Smolik","Sofa",2),sofa2:De(200,86.5,88,"eTeks","Sofa",2),stainlessSteelShelf:De(48,18,10,"N Mi","Stainless steel shelf",7),shelves_storage_steel:De(80,30,180,"Ola-Kristian Hoff","Steel shelves",2),stool_small:De(30,30,45,"alaX","Stool",2),green_stool:De(42.9,42.9,46,"Dalenryder","Stool",2),stool:De(40,40,46,"eTeks","Stool",2),succulentPlant:De(13.7,12.9,11.4,"Nmn9","Succulent plant",1),"table-on-trestles":De(160,66.4,76.1,"Scopia","Table on trestles",2),white_kitchen_table:De(110,70.1,75,"Scopia","Table",2),table:De(144.3,93.4,72.4,"Jay-Artist","Table",2),"table-with-leaning-feet":De(150,65,75,"Scopia","Table",2),tableCuisine2:De(174.2,91.1,75,"Icybones","Table",2),tableWithTablecloth:De(80.3,81.2,75,"Sizzler","Table with table cloth",2),"tv-remote-control":De(4.5,18,1.7,"Scopia","TV remote control",1),meubleHiFiBas:De(103.8,44.4,33.3,"Ga\xebl Bettinelli","TV shelf unit",2),"video-projector":De(47,37.8,15.1,"Scopia","Video projector",1),"wall-flat-tv":De(102.8,10.9,65.9,"Scopia","Wall flat TV",7),winchesterArmchair:De(112,93.4,80.4,"Gnanasaireddy","Winchester armchair",2),wirelessOfficePhone3:De(11.2,15.8,17.1,"DennisH2010","Wireless phone",1),shelves_storage_wood:De(78,31.5,171,"Ola-Kristian Hoff","Wood shelves",2),yuccaPlant:De(107.9,102.4,180,"Betomo16","Yucca",2),desklamp:De(24.4,24.4,40,"ColdShiverGames","Desk lamp",1),JapaneseLantern:De(15.6,15.6,35.1,"Mindfront","Japanese lantern",1),lamp:De(30.5,30.5,40.9,"Bulgakov","Lamp",1),little_lamp2:De(31,31,43,"Scopia","Little lamp",1),"MIDI-keyboard":De(80,25.3,8.4,"Kator Legaz","Musical keyboard",1)},Pe={abdominalBench:De(67.2,192.9,86.9,"Muhtesemozcinar","Abdominal bench",2),"internal-unity-air-conditioning":De(88.5,19.8,28.5,"Scopia","Air conditioning - Internal unit",7),iphone:De(5.8,11.5,.9,"Bheema","Apple iPhone",1),backpack:De(28.9,33.7,40,"Jo.3D","Backpack",1),storeCalifornien:De(296.4,16.2,216,"Julie Fabre","Blind",7),livreAvecReliure:De(17.6,10.9,3.8,"Toomy","Book",1),book:De(28.1,18.4,2.4,"Jay-Artist","Book",1),livres:De(24,16.9,26.9,"Toomy","Books",1),cageFuret:De(79,50,74.5,"Ga\xebl Bettinelli","Cage",1),"cardboard-box":De(55,35,30,"Scopia","Cardboard box",1),arbreAChat:De(65,48.8,89.6,"Scopia","Cat tree",2),CCTV:De(14,14,11.7,"Scopia","CCTV",1),ceilingFan:De(91.3,79.8,39.2,"PrinterKiller","Ceiling fan",1),chimney:De(67.3,67.3,250,"Scopia","Chimney",1),clock:De(33.4,1.9,33.4,"Robert Pastierovic","Clock",7),clock2:De(30,3,30,"alaX","Clock",7),"clothes-hanger":De(43,1.3,21.5,"Kator Legaz","Clothes hanger",1),"clothes-horse":De(65,95,87,"Scopia","Clothes horse",2),crate:De(60,58.9,59.4,"GyngaNynja","Crate",1),curtain:De(130,5,225,"Scopia","Curtain",7),curtains:De(150,22.9,225,"eTeks","Curtains",7),dart_game:De(45.3,16.3,45.3,"Scopia","Dart game",7),doormat:De(60,30,1.1,"Scopia","Doormat",5),electric_water_heater:De(45.6,45.9,61.9,"Scopia","Electric water heater",1),electricWheelchair:De(55.4,88.6,91.4,"Scopia","Electric wheelchair",2),emergencySign:De(30,3.5,9,"Marcinc53","Emergency sign",7),fence:De(179.6,5.8,104.9,"Dobbs","Fence",1),flipper:De(72,132.6,184.8,"Scopia","Flipper",2),foldedNewspaper:De(29.3,20.2,2.1,"Scopia","Folded newspaper",1),"folding-armchair":De(59.2,60.6,90.7,"Scopia","Folding armchair",2),table_football:De(150.3,124.6,100.9,"Jeff2207","Football table",2),ButterflyFrame:De(48.7,1.6,47.9,"Emmanuel Puybaret","Frame Butterfly",7),frame:De(50,2.2,35,"eTeks","Frame",7),frame1:De(14.5,14.5,19.6,"Scopia & eTeks","Frame Chambord",1),frame3HorizontalNorwayPhotos:De(25.4,3,52.5,"Emmanuel Puybaret","Frame Norway photos",7),frame3VerticalSummerPhotos:De(52.5,3,25.4,"Kator Legaz","Frame summer photos",7),HaiVanPassFrame:De(77.2,1.5,47.9,"Emmanuel Puybaret","Frame Hai Van Pass",7),furnace:De(66.7,97.7,125.6,"Scopia","Furnace",2),gaz_water_heater:De(40.5,34.5,67.6,"Scopia","Gaz water heater",1),gift:De(23.2,18.1,25.1,"Tadine","Gift",1),glasses:De(15,14.4,2.8,"Scopia","Glasses",1),barreAppui:De(57.6,11,7.5,"Emmanuel Puybaret","Grab bar",7),marteau:De(34.6,12.9,3.3,"Scopia","Hammer",1),cendrier:De(12,12,3.4,"Scopia","Ash tray",1),headphones:De(18.9,8.2,20,"Alaskaman","Headphones",1),"indoor-bike":De(71.8,101.2,131.3,"Scopia","Indoor bike",2),intercom:De(9.8,5.4,36.4,"Scopia","Intercom",7),intercom_with_screen:De(19,6.2,36,"Scopia","Intercom with screen",7),"iron-railing-separated-hooks-2":De(135,11,70,"Scopia","Iron railing",1),keys:De(11.5,11.4,2.9,"Scopia","Keys",1),litiere:De(28.9,50.2,42.9,"Scopia","Litter",2),lockedLocker:De(20,22,40,"Twin97","Locked locker",1),revue:De(20,28,.6,"Scopia","Magazine",1),pileMagazines:De(27.3,33.7,1.2,"Toomy","Magazines pile",1),mini_stereo:De(48.9,21,21,"Scopia","Mini stereo",1),mirror:De(40,.5,40,"Emmanuel Puybaret","Mirror",7),mobile:De(4.9,11,1.3,"Songkro","Mobile phone",1),mower:De(51,96.5,104.2,"Scopia","Mower",2),bdOuverte:De(42.4,29.8,2.6,"Toomy","Opened comics book",1),revueOuverte:De(39.3,28.2,2.8,"Scopia","Opened magazine",1),ovalMirror:De(55,1,105,"Emmanuel Puybaret","Oval mirror",7),pallet:De(120,120.4,12,"Shivraj","Pallet",1),poolTable:De(256,139.2,82.3,"Jeffie","Pool table",2),"punching-ball":De(45.9,45.9,152.8,"Scopia","Punching ball",2),wheelchairSymbol:De(149,149,.1,"Emmanuel Puybaret","PWD symbol",7),radiator3:De(55.4,20.7,64.3,"Testinator","Radiator",7),gardeCorps:De(140,6,107.8,"Julie Fabre","Railing",2),railing_glass:De(155,5,130,"Ola-Kristian Hoff","Railing glass",1),rectangularMirror:De(50,1,70,"Emmanuel Puybaret","Rectangular mirror",7),reflex_camera:De(12.5,14.9,9.8,"Scopia","Reflex camera",1),"round-chimney":De(36.6,36.5,99.7,"Scopia","Round chimney",1),japanese_style_screen:De(178,15.8,189,"Scopia","Japanese style screen",2),tournevis:De(25.5,3.1,3.1,"Scopia","Screwdriver",1),sewing_machine:De(52,12,44,"Ola-Kristian Hoff","Sewing machine",1),shippingContainer:De(243,606,259,"Bhoult","Shipping container",2),"smoke-detector":De(10,1.8,10,"Scopia","Smoke detector",7),ballonFoot:De(22,22,22,"DooL","Soccer ball",2),speaker2:De(22.1,25.4,35.4,"Nhumrod","Speaker",1),"square-double-switch":De(8.5,1.1,8.5,"Scopia","Square double switch",7),frame_square:De(100,10,100,"Ola-Kristian Hoff & Annik","Square frame",7),"square-switch":De(8.5,1.1,8.5,"Scopia","Square switch",7),"square-plug-TypeB":De(8.5,.7,8.5,"Scopia","Square type B plug",7),"square-plug-TypeE":De(8.5,.7,8.5,"Scopia","Square type E plug",7),"step-ladder-metal":De(57.8,75.9,180,"Step ladder","Scopia",2),AtorHaut:De(60.2,52.8,203.1,"Ga\xebl Bettinelli","Stove",3),suitcase:De(99.8,31.5,72.5,"Pyrophorus","Suitcase",1),surveillanceCamera:De(22.9,39,18.3,"Starkerg","Surveillance camera",7),table_tennis:De(274,173,96,"Bheema","Table tennis",2),tablet:De(17,24,.8,"Scopia","Tablet",1),tatami:De(100,200,5.5,"Scopia","Tatami",5),treadmill:De(88.5,195.8,152.6,"Muhtesemozcinar","Treadmill",2),putekasse:De(118,45,58,"Ola-Kristian Hoff","Trunk",2),umbrellaFolded:De(35.8,35.7,80,"Ralmon","Umbrella",1),vase3:De(23.5,23.5,50.9,"Scopia","Vase",1),jar:De(24.4,24.4,40,"Scopia","Vase",1),"walker-with-wheels":De(60.2,72.2,93,"Scopia","Walker with wheels",2),"double-switch-whites":De(8.5,1.1,8.5,"Scopia","Wall double switch",7),wall_handrail:De(230,9.9,9.8,"Ola-Kristian Hoff","Wall handrail",7),"switch-whites":De(8.5,1.1,8.5,"Scopia","Wall switch",7),"plug-TypeB-whites":De(8.5,.7,8.5,"Scopia","Wall type B plug",7),"plug-TypeE-whites":De(8.5,.7,8.5,"Scopia","Wall type E plug",7),wheelchair:De(64.4,76.9,91,"Bgamage","Wheelchair",2),"window-blinds":De(80,8.2,94,"Kator Legaz","Window blind",7),wood_logs:De(40.3,69.9,31.8,"Scopia","Wood logs",2),complements2:De(13,13,15,"Scopia","Candle",1),radiator1:De(216.3,14.3,83.4,"Knyghtfall13x","Horizontal radiator",7)},Fe={angolo160W:De(45,45,160,"LucaPresidente","Angle shelf",2),angolo198W:De(45,45,198,"LucaPresidente","Angle shelf",2),angolo80W:De(45,45,80,"LucaPresidente","Angle shelf",2),office_furniture1:De(299.5,54.5,150,"Scopia","Bookcase",2),mobile45160W:De(45,48.8,160,"LucaPresidente","Bookcase 45x160",2),mobile45198W:De(45,48.8,190,"LucaPresidente","Bookcase 45x198",2),mobile4580W:De(45,48.8,80,"LucaPresidente","Bookcase 45x80",2),office_box:De(212,53.5,174.9,"Scopia","Box",2),chair2:De(57.9,60.9,90.2,"Peter Smolik","Chair",2),office_chair:De(63.5,63.7,100,"Scopia","Office chair",2),chair_office_y:De(48,49.5,87,"Ola-Kristian Hoff","Chair",2),pcstul:De(136.3,93.1,144.3,"Jarda Benkowsky","Computer desk",2),lbDesk:De(160,80,72.3,"Wiresoulstudio","Desk",2),office_desk:De(160,80,72,"Ola-Kristian Hoff","Desk",2),bureauInfoOuvert:De(77.9,85.9,76.4,"Ga\xebl Bettinelli","Desk2",2),bureau3:De(120,59,72.5,"Ga\xebl Bettinelli","Desk1",2),cassettieraW:De(42,53.8,53.5,"LucaPresidente","Drawer unit on casters",2),dustbin:De(23.3,23.3,35,"Ndakasha","Dustbin",1),inkjet_and_scanner_printer:De(44.6,33.2,18.9,"Scopia","Inkjet printer and scanner",1),laptop:De(33.9,25.3,26.6,"Mayollo","Laptop",1),monitorLCD:De(66.4,30.7,56.8,"Carvalho","Monitor LCD",1),penbox:De(7.3,8.3,17,"Scopia","Penbox",1),pencil1:De(1,13.5,.7,"Scopia","Pencil",1),phone:De(19.7,21.9,7.3,"Scopia","Phone",1),imprimanteFaxPhotocopieur:De(105.8,69.5,110,"Cristophe Tellerain","Photocopier printer",2),water_cooler:De(27.4,31.8,132.2,"Scopia","Water cooler",2),whiteBoard:De(124.7,55.1,129,"Redsymbzone","White board",2),wooden_office_pear_table:De(160,120,75.4,"Scopia","Wooden table",2),lamp_office:De(16,50,47,"Ola-Kristian Hoff","Desk lamp",1)},Ae={staircase_90_bottom:De(100,330,352.2,"Ola-Kristian Hoff","Bottom winder staircase",2),staircase_180_long:De(100,330,353.1,"Ola-Kristian Hoff","Double winder staircase",2),escalator:De(129.1,882.2,424.8,"Scopia","Escalator",2),staircase_180_landing:De(200,260,349,"Ola-Kristian Hoff","Half landing staircase",2),staircase_90_landing:De(225,228.3,347.8,"Ola-Kristian Hoff","Quarter landing staircase",2),stairs_90_closed_legal_high:De(166,300,362.8,"Ola-Kristian Hoff","Quarter landing staircase",2),stairs_rail:De(329.8,6,234.5,"Ola-Kristian Hoff","Stairs rail",7),stairs_180_circular_notopstep_rail:De(600,301,355,"Ola-Kristian Hoff","Semiciruclar staircase",2),staircase_360_circle:De(230,230,353.4,"Ola-Kristian Hoff","Spiral staircase",2),stairs_180_square:De(200,100,335.6,"Ola-Kristian Hoff","Square spiral staircase",2),stair_ladder_loft:De(58,114,262,"Ola-Kristian Hoff","Staircase ladder",2),staircase_samba_265x150x85:De(85,150,262,"Ola-Kristian Hoff","Staircase samba",2),stair_straight_open_stringer:De(80,334.3,350.2,"Ola-Kristian Hoff","Staircase with open stringer",2),staircase_ladder_steep:De(94.4,167.1,356.7,"Ola-Kristian Hoff","Steep staircase",2),staircase_90_top:De(100,330,353.1,"Ola-Kristian Hoff","Top winder staircase",2),staircase_270_box:De(225,225,341.4,"Ola-Kristian Hoff","Triple winder staircase",2),staircase_u2h:De(338,176,342.5,"Ola-Kristian Hoff","Triple winder staircase",2)},We={"4x4":De(186.4,381.6,194.3,"Scopia","4x4",2),bicycle:De(46,149.2,84.3,"Scopia","Bicycle",2),bus:De(279.5,1404.3,366.7,"Scopia","Bus",2),caravane:De(211.9,547,236.3,"Scopia","Caravan",2),cityBus:De(303.1,1219.2,302,"Scopia","City bus",2),carSegmentB:De(184.4,393.9,141.3,"Scopia","City car",2),decapotable:De(210.4,459.2,141.2,"Scopia","Convertible",2),locomotive:De(2247.3,292.2,647.2,"Scopia","Locomotive",2),monospace:De(212.7,467.2,179,"Scopia","Minivan",2),pickup:De(215.2,524.3,180.8,"Scopia","Pickup",2),renaultKangoo:De(203.4,403.4,177,"Scopia","Renault Kangoo",2),"renault-scenic":De(212.7,426.2,196.2,"Scopia","Renault Scenic",2),scooter:De(34,86.4,88,"Scopia","Scooter",2),scooter2:De(76.4,173.1,120.8,"Scopia","Scooter",2),seat_leon:De(192.4,419.5,146,"Scopia","Seat Leon",2),"smart-car":De(170.8,252.8,154.6,"Scopia","Smart car",2),sportive:De(210.2,447.8,128,"Scopia","Sports car",2),break:De(200.4,457.3,155.4,"Scopia","Station wagon",2),stroller:De(48,81.2,99.2,"Scopia","Stroller",2),suv:De(209.1,463.1,162.7,"Scopia","SUV",2),remorque:De(180.2,313.4,102.4,"Scopia","Trailer",2),tramway:De(4223.4,244.8,481.6,"Scopia","Tramway",2),truck:De(271.8,630,340,"Scopia","Truck",2),dafTruck:De(305.8,1653.6,400.5,"Kartoffelphantom","DAF truck",2),van:De(240.5,595.8,256.5,"Scopia","Van",2),wagon:De(2315.5,292,412.4,"Scopia","Wagon",2)},Be={...Le,...Me,...ke,...Oe,...Re,...Pe,...Fe,...Ae,...We},Ee={window:{title:"Windows",models:de,details:Te},door:{title:"Doors",models:pe,details:Ie},light:{title:"Lights",models:me,details:_e},bathroom:{title:"Bathroom",models:ue,details:Le},bedroom:{title:"Bedroom",models:ge,details:Me},exterior:{title:"Exterior",models:fe,details:ke},kitchen:{title:"Kitchen",models:be,details:Oe},livingRoom:{title:"Living room",models:xe,details:Re},other:{title:"Other",models:Ce,details:Pe},office:{title:"Office",models:we,details:Fe},staircase:{title:"Staircase",models:ye,details:Ae},vehicles:{title:"Vehicles",models:Se,details:We}},Ve=["none","3_blue_and_white_lines_wallpaper","3_brown_lines_wallpaper","3_green_and_white_lines_wallpaper","3_red_and_white_lines_wallpaper","african-wallpaper-2","african-wallpaper","alu_siding_greyscale2","animal-skin","asphalte-clair-4x4m","asphalte-fonce-4x4m","balanced-blue-sponge-wallpaint","balanced-green-sponge-wallpaint","basic-white-tile","bathroom-tile-beige","bathroom_tiles-multicolour","bathroom_tiles","bathroom_tiles_2","beech","beige-bricks-wall-bricks","beige-carpet-square","beige-granite-cook-tops","beige-leather","beigeTile","beige_brown_tiles","beige_fabric","beige_fabric2","beige_grey_squares_wallpaper","beige_pattern","beige_tiles","beige_waves_wallpaper","big-stones-floor-tiles","big-sun-sky","birch","black-and-white-stones","blackAndWhiteTiles","bleachedWood","blue-and-geometric-kitchen-tiles","blue-and-green-plaid-furniture-fabric","blue-fabric","blue-fibres_fabric-for-furniture","blue-painted-wood","blue-rectangles-bathroom-tiles","blue-sponge-wallpaint","blue-wall-pattern","blueSky","blueSlates","blueSlates2","blueTiles","blue_and_white_wallpaper","blue_cells_wallpaper","blue_diamants_wallpaper","blue_lines_wallpaper","blue_with_stars_wallpaper","boxTree","brass","brick-wall-with-old-stones","brown-cercles","brown-circles-floor-carpeting","brown-esparto-fibers","brown-sponge-wallpaint","brown-terrazzo-floor-tiles","brown_lines_with_white_bands_wallpaper","brown_waves_combinated_2_wallpaper","brown_waves_combinated_wallpaper","browns-and-blue-geometrics-kitchen-tiles","browns-bathroom-tiles","browns_wallpaper","butterflies_wallpaper","carpet-with-coloured-tiles","carpet-with-geometric-shapes","cercles_and_stars_wallpaper","cheetah-skin","cherry","chess-parquet","claret-cotton-velvet","classic-red-squares-fabric-for-furniture","classic-red-wallpaper","classic-roof","clay-floor","cloudy","cobblest","coloured-glass-stones","coloured-stones-stonewalls","compact-and-grey-marble-for-cook-tops","concentrated-stones-roughcast","concrete-wall-1","concrete-wall-2","concrete-wall-3","corrugated-roof","dark-blue-seamless-floor-carpeting","dark-blue-sponge-wallpaint","dark-brown-sponge-wallpaint","dark-brown_leather","dark-ceramic-tiles","dark-granite-cook-tops","dark-green-sponge-wallpaint","dark-leather","dark-wall-paper","darkBlueTile","darkBlueTiles","darkBrown","darkWood","detailed-mosaic-arab-wall","drawing_lines_wallpaper","dry_mud","dryflowers_wallpaper","encircled_grey_wallpaper","encircled_wallpaper","english-parquet-1","english-parquet-2","english-parquet-3","english-parquet-dark","esparto-floor-carpeting","false-ceiling-2","false-ceiling-3","false-ceiling","fantasy-wall-mosaic","field-of-daisies","field-of-poppies","field-with-floral-stripes","field-with-white-and-yellow-flowers","fireplace-stones","fish_in_the_sea_wallpaper","floor-carpet-grey-and-white","floor-carpeting-grey","floor-slates","floor-stones-1","floor-stones-2","floor-tiles-hexagonal","flowers_and_yellow_fabric-for-furniture","fruits-kitchen-tiles","geometric-brown-carpet","geometric-kitchen-tiles","geometric_dark_flowers_wallpaper","geometric_green_wallpaper","geometry_colors_wallpaper","giraffe-skin","glass-tiles-wall","gold_circles_wallpaper","granite","grass","grass2","grass3","grass_darker","gray-and-cyan-floor-carpeting","gray-and-green-floor-carpeting","gray-carpet","gray-medium-thick-floor-carpeting","gray-medium-thick-with-squares-floor-carpeting","gray-metal-floor","green-and-black-bathroom-tiles","green-and-bone-kitchen-tiles","green-and-yello-geometry-kitchen-tiles","green-apples-and-white-kitchen-tiles","green-apples-kitchen-tiles","green-fabric-for-furniture","green_leather","green_waves_wallpaper","green_with_leaves_wallpaper","grey-ceramic-tiles","grey-dark-parquet","grey-rough-stonewall","greyTile","grey_marble_for_cook-tops","ground-gravel","ground-pebbles-2","ground-pebbles","hairy-gray-floor-carpeting","hexagon-red-slate","hungarian_parquet","hut-wall-texture","irregular-cercles","irregular-orange-kitchen-tiles","japanese-wallpaper-pink-and-lila-flowers","japanese-wallpaper-with-cranes-and-trees","japanese-wallpaper-with-cranes","laft_05","laft_05_light","leopard-skin","letter_O_wallpaper","light-beige-parquet","light-brown-sponge-wallpaint","light-brown-tiles","light-moss-yellow","lightBlueTile","light_wood","lilac_70s_wallpaper","little-browns-kitchen-wall-tiles","little-stones-bathroom","logWall","logs-wall-2","logs-wall-3","logs-wall","marble-floor-tiles","marble-tiles","marbleWall","mexican-carpet","moon-and-stars","mosaic-patchwork","multi-grey-stones-floor-tiles","multifruit-multicolor-kitchen-tiles","multifruit-orange-kitchen-tiles","natural_colors_wallpaper","navy-blue-stripes","night-sky","oak-brown-parquet","oak","oak2","oak3","old-and-light-gray-parquet","old-and-red-bricks-wall","old-bricks-floor","old-brown-parquet","old-carpet","old-floor-tile","old-grey-parquet","old-mosaic-arab-wall","old-mosaic-wall-arab-2","old-roof-tiles","old-stones-wall","old-wooden-wall","oldWood","oldWoodenFloor","old_grey_bricks","orange-and-browns-kitchen-tiles","orange-fabric-for-furniture","orange-leather","orange-line-and-flowers-kitchen-tiles","orange-napkin-texture","orange_pattern","oranges_70s_wallpaper","oriental-carpet","overlapping-white-wood","overlapping-white-wood_brighter","paneling-for-interior","pansy-purple-velvet","pastel-blue-sponge-wallpaint","pastel-brown-sponge-wallpaint","pastel-cyan-sponge-wallpaint","pastel-gray-sponge-wallpaint","pastel-lilac-sponge-wallpaint","pastel-orange-sponge-wallpaint","pastel-yellow-sponge-wallpaint","pavement","pavement_2","paves-autobloquants-60x60cm","pavingStone","paving_stone_2","peacock-velvet","peacock_blue_velvet","pebbles","persianCarpet","pine","pink-carpet","pink_clouds_wallpaper","pink_squares_fabric-for-furniture","pink_squares_wallpaper","poplar","portuguese-wall-2","portuguese-wall","rattan-for-outdoor-furniture","rattan-furniture","rattan-red","rattan-texture-2","rattan-texture-3","rattan-texture-4","rawPine","rectangularStones","red-american-carpet","red-and-black-plaid-furniture-fabric","red-and-yellow-floor-carpeting","red-bricks-wall","red-brown-parquet","red-building-bricks","red-carpet-large-hair","red-sponge-wallpaint","red-stones-brown-background-stonewalls","red-stripes","red-tomatoes-and-white-kitchen-tiles","red-tomatoes-kitchen-tiles","redOak","redTiles","red_bricks","red_slates","red_tiles","red_with_stars_wallpaper","rough-brown-kitchen-tiles","roughcast","roundBlueSlates","rustic-brown-beige-bathroom-tiles","rusty-metal-texture","salmon-sponge-wallpaint","sandy-soil-2","sandy-soil","sauna_panel","sea-rush-woven","sea-texture","sky-dawn","smallBricks","smallRedBricks","smallWhiteBricks","soil","square-roof-slates","square_shapes","stain_glass","stain_glass_2","stained-brown-ceramic-floor-tiles","stone-bricks-stonewall","stone2Wall","stone3Wall","stoneTiles","stoneWall","stones_wall_coloured","stoneway-floor-tiles","straw-roof","striped-fabric-texture","sunset-sky","swimming-pool-ceramic","swimming-pool-top-cyan","swimming-pool-top","swimmingPool","teira-blue-velvet","terrazo-floor","terrazzo-floor-tiles","texture_knit","thatched-roof","thin-grey-ceramics-floor-tiles","tiger-skin","tile-ext-border","tiled-stones-for-bathroom","travertine-tiles","trendy-wall-paper","trunk","vertical-wood","vertical_blue_lines","vertical_lines","veryCloudy","wall-coloured-glass","wall-effect-beige-tadelakt","wall-effect-gray-tadelakt","wall-effect-green-tadelakt","wall-fabric-blue-duck","wall-fabric-blue-ink","wall-fabric-gold","wall-frosted-glass","wall-glass-geometric-tiles","wall-metal-texture","wall-portuguese-mosaic-3-green","wall-portuguese-mosaic-3","wall-striped-canvas","wall-tile-bathroom","wall-tiles-brown","wallBeigeTile","wall_texture_white","wall_with_little_stones","wallpaper-chiyogami","wallpaper-japanese-blue-flowers","wallpaper-japanese-painted","wallpaper-japanese-pansy-painted","wallpaper-japanese-pink-flowers","wallpaper-japanese-pink-geometry","wallpaper-japanese-pink-pansy-painted","wallpaper-japanese-white-and-pink-flowers","wallpaper-japanese-white-and-yellow-flowers","wallpaper-nepalese-beige-dots-over-red","wallpaper-nepalese-red-dots","wallpaper-with-flamingos","wet-mud","white-little-roughcast","white-marble","white-with-border-kitchen-tiles","white_with_stars_wallpaper","wood-paneling","wood-pine","wood","wooden-bathroom-floor","woodenFloor","words_of_world_wallpaper","yellow-and-black-plaid-furniture-fabric","yellow-lemon-and-white-kitchen-tiles","yellow-lemon-kitchen-tiles","yellow-medium-floor-carpeting","yellow-pears-and-white-kitchen-tiles","yellow-pears-kitchen-tiles","yellow_classic_wallpaper","zebra-skin"],Ne={window_2x1_with_sliders:["sweethome3d_opening_on_hinge_1_Window_Pane_wall_1_1_1_28_174","sweethome3d_opening_on_rail_1_handle","sweethome3d_opening_on_rail_1_frame","sweethome3d_opening_on_rail_1_frame","sweethome3d_opening_on_rail_2_handle","sweethome3d_opening_on_rail_2_handle"],doubleFrenchWindow2:["sweethome3d_opening_on_hinge_1_Window_Handle_Button_Cylinder_32",""],frenchWindow2:["sweethome3d_opening_on_hinge_1_Inside_Inner_Frame_top_74_104","sweethome3d_opening_on_rail_1_Roller_Shutter_Foot_back_119_194"],smallWindow2:["sweethome3d_opening_on_hinge_1_Outside_Inner_Frame_top_59_143","sweethome3d_opening_on_rail_1_Roller_Shutter_Foot_back_119_200","sweethome3d_opening_on_hinge_1_Window_Handle_back_86_116","sweethome3d_opening_on_hinge_1_Window_Handle_Button_Cylinder_96","sweethome3d_opening_on_hinge_1_Inside_Inner_Frame_top_77_125"],"turn-window":["sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_handle","sweethome3d_opening_on_hinge_1_frameOut","sweethome3d_opening_on_hinge_1_frameIn"],"window-08":["sweethome3d_opening_on_rail_1_window_gloss_white"],window_2x1_medium_with_large_pane:["sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_frame","sweethome3d_opening_on_hinge_1_handle"],window_2x3_frame_sill:[],window_2x4:["sweethome3d_opening_on_hinge_1_panes","sweethome3d_opening_on_hinge_1_handle","sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_frame"],window_2x6:["sweethome3d_opening_on_hinge_1_frame","sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_panes","sweethome3d_opening_on_hinge_1_handle"],window_3x1:["sweethome3d_opening_on_hinge_1_frame","sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_handle"],window_4x1:["sweethome3d_opening_on_hinge_2_glass","sweethome3d_opening_on_hinge_1_handle","sweethome3d_opening_on_hinge_1_frame","sweethome3d_opening_on_hinge_2_frame","sweethome3d_opening_on_hinge_1_glass"],window_4x5:["sweethome3d_opening_on_hinge_1_panes","sweethome3d_opening_on_hinge_2_panes","sweethome3d_opening_on_hinge_1_handle","sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_frame"],window_deep:["16_16.001","15_15","19_19","7_7","21_21","15_15.001","20_20","16_16","17_17","18_18"],window_double_2x3_frame_sill:["21_21_21_21.000","27_27.004","8_8.006"],window_shop:[],window_stain_glass:[],glassblock:[],craftsmanDoorClosed:[],door:["sweethome3d_opening_on_hinge_1_door","sweethome3d_opening_on_hinge_1_handle"],"exterior-door-05":["sweethome3d_opening_on_hinge_1_Exterior_door_5_PAINT_gloss_black","sweethome3d_opening_on_hinge_1_Exterior_door_5_METAL_brass_polish","sweethome3d_opening_on_hinge_1_Exterior_door_5_METAL_aluminum","sweethome3d_window_pane_on_hinge_1_Exterior_door_5_GLASS"],"exterior-door-07":["sweethome3d_window_pane_on_hinge_1_front_door_GLASS","sweethome3d_opening_on_hinge_1_front_door_gloss_white","sweethome3d_opening_on_hinge_1_front_door_METAL_aluminum"],frontDoor2:["sweethome3d_opening_on_hinge_1_Leaf_Side_B_front_6","sweethome3d_opening_on_hinge_1_Handles_Tuergriff_wall_1_18_wall"],glassDoor2:["sweethome3d_opening_on_hinge_1_door","sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_tieForWindow","sweethome3d_opening_on_hinge_1_handle","frame_Cube.001"],glass_door:["sweethome3d_hinge_1","sweethome3d_opening_on_hinge_1_glass","sweethome3d_opening_on_hinge_1_handle","sweethome3d_opening_on_hinge_1_door"],glass_door_framless:["sweethome3d_opening_on_hinge_1_door_1","sweethome3d_opening_on_hinge_1_clamps_1","sweethome3d_opening_on_hinge_1_handle_1"],puerta:["sweethome3d_opening_on_hinge_1_maneta_puerta","sweethome3d_opening_on_hinge_1_door"],"screen-door":["screen_door_01_screen_door_01_PAINT_gloss_white","sweethome3d_window_pane_screen_door_01_SYNTH_screen","screen_door_01_screen_door_01_PAINT_gloss_black"]},ze={frontDoor2:1,"exterior-door-05":-1,craftsmanDoorClosed:1,door:-1,"exterior-door-07":-1,glassDoor2:-1,glass_door_framless:-1,glass_door:-1,puerta:-1,"screen-door":1},He=[{label:"Edit",infoText:"Allows you to select objects and customize Home Assistant entity bindings and parameters.",title:"Enter edit mode",value:"edit"},{label:"Control",infoText:"Enables you to select specific Home Assistant bound objects to change their state. For other objects, it's view-only.",title:"Enter edit mode",value:"control"}],Ge=["input_boolean","binary_sensor","light","sensor","switch"],qe={doorWindow:["input_boolean","binary_sensor"],lights:["light","switch"],sensors:["sensor"],homeAssistant:["air_quality","alarm_control_panel","binary_sensor","button","calendar","camera","climate","cover","date","datetime","device_tracker","event","fan","humidifier","image","lawn_mower","light","lock","media_player","number","remote","scene","select","sensor","siren","stt","switch","sun","text","time","todo","tts","update","vacuum","valve","wake_word","water_heater","weather","zone"].filter((e=>!Ge.includes(e)))},Ye={doorWindow:{open_state:"on",closed_state:"off"},lights:{switched_on_state:"on",switched_off_state:"off",power:10,color:"#ffffff"},sensors:{sensor_type:"number",background:{background_coloring_type:null,background_fixed_color:"#ffffff",background_range_min_value:"",background_range_min_color:"#0000ff",background_range_max_value:"",background_range_max_color:"#ff0000",background_range_intermediate_colors:[],background_opacity:1,checked:!1},text:{text_coloring_type:"fixed",text_fixed_color:"#000000",text_range_min_value:"",text_range_min_color:"#0000ff",text_range_max_value:"",text_range_max_color:"#ff0000",text_range_intermediate_colors:[],text_opacity:1,text_font_size:20,checked:!0}},homeAssistant:{color:"#000000",opacity:1,font_size:20}},Ue=[{field:"open_state",label:"Open:",keepTextWidth:!0,longText:"Closed:",validate:e=>N.isEmpty(e)},{field:"closed_state",label:"Closed:",validate:e=>N.isEmpty(e)}],Xe=[{field:"switched_on_state",label:"Switched on:",keepTextWidth:!0,longText:"Switched off:",validate:e=>N.isEmpty(e)},{field:"switched_off_state",label:"Switched off:",validate:e=>N.isEmpty(e)},{field:"power",label:"Luminous Power(lm)",min:0,max:500,step:1,placeholder:"Luminous power of lightin lumens",validate:e=>N.isEmpty(e)||N.isNumber(e)},{field:"color",label:"Color",type:"color",validate:e=>N.isEmpty(e)||N.isHexColor(e)}],Ze=e=>[{field:"".concat(e,"_coloring_type"),label:"Coloring",type:"radio",formChoices:!0,choices:[{name:"Fixed",value:"fixed",form:[{label:"Color:",field:"".concat(e,"_fixed_color"),type:"color",validate:e=>N.isEmpty(e)||N.isHexColor(e)}]},{name:"Range",value:"range",form:[{label:"Min value:",field:"".concat(e,"_range_min_value"),validate:e=>N.isEmpty(e)||N.isNumber(e)},{label:"Min color:",field:"".concat(e,"_range_min_color"),validate:e=>N.isEmpty(e)||N.isHexColor(e)},{label:"Max value:",field:"".concat(e,"_range_max_value"),validate:e=>N.isEmpty(e)||N.isNumber(e)},{label:"Max color:",field:"".concat(e,"_range_max_color"),validate:e=>N.isEmpty(e)||N.isHexColor(e)},{label:"Intermediate color",field:"".concat(e,"_range_intermediate_colors"),value:[]}]}]},{field:"".concat(e,"_opacity"),label:"Opacity:",validate:e=>N.isNumber(e),placeholder:"Color opacity",min:0,max:1,step:.01,isNumberInput:!0,keepTextWidth:!0,longText:"Font size:"}],Ke=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return{counter:e,form:[{label:"Value:",field:"range_intermediate_color_value_".concat(e),keepTextWidth:!0,longText:"Max value:",validate:e=>N.isEmpty(e)||N.isNumber(e),value:t},{label:"Color:",field:"range_intermediate_color_color_".concat(e),keepTextWidth:!0,longText:"Max color:",validate:e=>N.isEmpty(e)||N.isHexColor(e),value:i}]}},Je=[{field:"sensor_type",label:"Sensor type",type:"radio",choices:[{name:"Number",value:"number"},{name:"Text",value:"text"}]},{field:"background",label:"Background",type:"checkbox",infoText:(0,l.jsxs)("span",{children:["Select this option to visually represent sensor values by the background color of the room where the sensor is located ",(0,l.jsx)("span",{style:{fontWeight:"bold"},children:"if one exists"})]}),explanationInfoBoxStyles:{left:-160,width:140,zIndex:1},form:[...Ze("background")]},{field:"text",label:"Text",type:"checkbox",infoText:(0,l.jsx)("span",{children:"Select this option to visually represent sensor values by text colors"}),explanationInfoBoxStyles:{left:-160,width:140,zIndex:1},form:[...Ze("text"),{field:"text_font_size",label:"Font size:",validate:e=>N.isNumber(e),min:1,max:100,step:1,isNumberInput:!0}]}],Qe=[{field:"color",label:"Color:",isColorInput:!0,validate:e=>N.isEmpty(e)||N.isHexColor(e)},{field:"opacity",label:"Opacity:",isNumberInput:!0,validate:e=>N.isNumber(e),placeholder:"Color opacity",min:0,max:1,step:.01,keepTextWidth:!0,longText:"Font size:"},{field:"font_size",label:"Font size:",validate:e=>N.isNumber(e),min:1,max:100,step:1,isNumberInput:!0}],$e={other:!1,sensor:!1,doorWindow:!0,lights:!0},et={input_boolean:"off",binary_sensor:"off",light:"off"};var tt=i(6773),it=i(3044),ot=i.n(it),st=i(1317);const nt=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"block",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];0!==t?requestAnimationFrame((()=>{e.style.display=o,s?(e=e.firstChild).style.transitionDuration="".concat(t,"ms"):e.style.transitionDuration="".concat(t,"ms"),i&&e.addEventListener("transitionend",i,{once:!0}),0!==t?requestAnimationFrame((()=>{st.log("Callback"),s?e.classList.add("indoor-modal-fade-in"):e.classList.add("fade-in")})):i&&i()})):e.style.display=o},at=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];0!==t?requestAnimationFrame((()=>{let n;o?(n=e.firstChild,n.style.transitionDuration="".concat(t,"ms")):(n=e,n.style.transitionDuration="".concat(t,"ms"));const a=t=>{t.target===n&&(s||(e.style.display="none"),i&&i(),n.removeEventListener("transitionend",a))};n.addEventListener("transitionend",a),requestAnimationFrame((()=>{o?n.classList.remove("indoor-modal-fade-in"):n.classList.remove("fade-in")}))})):e.style.display="none"},rt=e=>{let t=[],i=[];for(let o=0;o<e.coords.length;o++)t.push(e.coords[o].x),i.push(e.coords[o].y);return t.sort(((e,t)=>e-t)),i.sort(((e,t)=>e-t)),{minX:t[0],maxX:t[t.length-1],minY:i[0],maxY:i[i.length-1]}},lt=e=>{let t=e.filter((e=>!xt(e.start,e.end)));if(0===t.length)return null;{let e,i,o,s,n;if(1===t.length)n=rt(t[0]),e=n.minX,i=n.maxX,o=n.minY,s=n.maxY;else for(let a=0;a<t.length;a++)n=rt(t[a]),0===a?(e=n.minX,i=n.maxX,o=n.minY,s=n.maxY):(e=n.minX<e?n.minX:e,i=n.maxX>i?n.maxX:i,o=n.minY<o?n.minY:o,s=n.maxY>s?n.maxY:s);return{minX:e,minY:o,maxX:i,maxY:s}}},ht=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e?{x:(e.minX+(e.maxX-e.minX)/2)*t,y:(e.minY+(e.maxY-e.minY)/2)*t}:null},ct=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return"v"===t.A?0===Number((e.x-t.B).toFixed(i)):"h"===t.A?0===Number((e.y-t.B).toFixed(i)):0===Number((e.y-t.A*e.x-t.B).toFixed(i))},dt=function(e,t,i,o,s){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0;const r=T(t,e),l=T(i,e),h=T(o.minX,e),c=T(o.maxX,e),d=T(o.minY,e),p=T(o.maxY,e),m=T(s.minX,e),u=T(s.maxX,e),g=T(s.minY,e),f=T(s.maxY,e);return n?r>=h&&r>=m&&r<=c&&r<=u&&l>=d&&l>=g&&l<=p&&l<=f:n?void 0:"h"===a?r>h&&r>m&&r<c&&r<u&&l>=d&&l>=g&&l<=p&&l<=f:"v"===a?r>=h&&r>=m&&r<=c&&r<=u&&l>d&&l>g&&l<p&&l<f:r>h&&r>m&&r<c&&r<u&&l>d&&l>g&&l<p&&l<f},pt=(e,t)=>{let i={minX:null,maxX:null,minY:null,maxY:null};return e.y>t.y?(i.maxY=e.y,i.minY=t.y):(i.maxY=t.y,i.minY=e.y),e.x>t.x?(i.maxX=e.x,i.minX=t.x):(i.maxX=t.x,i.minX=e.x),i},mt=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},ut=(e,t)=>{let i=["svg","g"];for(let o=0;o<e.children.length;o++){let s=e.children[o];if(-1!==i.indexOf(s.tagName)){ut(s,t.children[o]);continue}let n=t.children[o].currentStyle||window.getComputedStyle(t.children[o]);if("undefined"!==n&&null!=n)for(let e=0;e<n.length;e++)s.style.setProperty(n[e],n.getPropertyValue(n[e]))}},gt=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i&&st.log(i);let o=!0;for(let s in e)if(e[s]!==t[s]){o=!1;break}return o},ft=function(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];o&&st.log(o);let s,n,a=i.x,r=i.y,l=e.A,h=e.B;if("v"===l)s={x:a,y:r-t/2},n={x:a,y:r+t/2};else if("h"===l)s={x:a-t/2,y:r},n={x:a+t/2,y:r};else{let e=1+l*l,i=-2*a+2*l*h+-2*r*l,o=i*i-4*e*(a*a+h*h-2*r*h+r*r-t*t/4),c=(-i-Math.sqrt(o))/(2*e),d=(-i+Math.sqrt(o))/(2*e);s={x:c,y:l*c+h},n={x:d,y:l*d+h}}return[s,n]},bt=()=>document.querySelector(".rightBox.active"),xt=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 0===Number((e.x-t.x).toFixed(i))&&0===Number((e.y-t.y).toFixed(i))},Ct=e=>{let t,i,o=0;for(let s=0;s<e.length-1;s++)t=s,i=s+1,s===e.length-2&&(i=0),st.log(t+" -> "+i),o+=(e[i].x-e[t].x)*(e[i].y+e[t].y);return o<0},wt=e=>e>180?e-360:e,yt=(e,t)=>Math.log2(2*Math.cos(e*Math.PI/180)*Math.PI*6378137/(512*t)),St=function(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const n=ot()([t,e]),a=(0,tt.Z)(n,i/1e3,wt(90+s)),r=(0,tt.Z)(a,o/1e3,wt(180+s)),l=(0,tt.Z)(n,o/1e3,wt(180+s));return[[t,e],a.geometry.coordinates,r.geometry.coordinates,l.geometry.coordinates]},vt=function(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,s=0,n=2;i>90&&i<=180?(s=3,n=1):i>180&&i<=270?(s=2,n=0):i>270&&i<=359&&(s=1,n=3),e.fitBounds([t[n],t[s]],{padding:o})},jt=(e,t)=>{let i=e.x,o=e.y,s=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){let e=t[n].x,r=t[n].y,l=t[a].x,h=t[a].y;r>o!==h>o&&i<(l-e)*(o-r)/(h-r)+e&&(s=!s)}return s},Dt=(e,t)=>{if(jt(e,t))return!0;{let i=!1;for(let o=0;o<t.length-1;o++)if(e.x<=Math.max(t[o].x,t[o+1].x)&&e.x>=Math.min(t[o].x,t[o+1].x)&&e.y<=Math.max(t[o].y,t[o+1].y)&&e.y>=Math.min(t[o].y,t[o+1].y)&&ct(e,Lt(t[o].x,t[o].y,t[o+1].x,t[o+1].y,0),0)){i=!0;break}return i}},Tt=function(e,t){let i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"array";if(e.A===t.A&&(i=!1,o=!1),"v"===e.A&&"h"===t.A&&(i=[e.B,t.B],o={x:e.B,y:t.B}),"h"===e.A&&"v"===t.A&&(i=[t.B,e.B],o={x:t.B,y:e.B}),"h"===e.A&&"v"!==t.A&&"h"!==t.A&&(i=[(e.B-t.B)/t.A,e.B],o={x:(e.B-t.B)/t.A,y:e.B}),"v"===e.A&&"v"!==t.A&&"h"!==t.A&&(i=[e.B,t.A*e.B+t.B],o={x:e.B,y:t.A*e.B+t.B}),"h"===t.A&&"v"!==e.A&&"h"!==e.A&&(i=[(t.B-e.B)/e.A,t.B],o={x:(t.B-e.B)/e.A,y:t.B}),"v"===t.A&&"v"!==e.A&&"h"!==e.A&&(i=[t.B,e.A*t.B+e.B],o={x:t.B,y:e.A*t.B+e.B}),"h"!==e.A&&"v"!==e.A&&"v"!==t.A&&"h"!==t.A){let s=(t.B-e.B)/(e.A-t.A),n=e.A*s+e.B;i=[s,n],o={x:s,y:n}}return"array"===s?i:o},It=function(e,t){let i=[],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?"coordsInsideWithOrphans":"coordsInside";for(let s=0;s<t.length;s++){jt(e,t[s][o])&&i.push(s)}if(i.length>0){let e,o=t[i[0]].realRoomArea;for(let s=0;s<i.length;s++)t[i[s]].realRoomArea<=o&&(o=t[i[s]].realRoomArea,e=t[i[s]]);return e}return!1},_t=function(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{wallNode1:e[t],wallNode2:e[i],wallEquation:o&&Lt(e[t].x,e[t].y,e[i].x,e[i].y)}},Lt=function(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:12;return 0===Number((i-e).toFixed(s))?{A:"v",B:e}:0===Number((o-t).toFixed(s))?{A:"h",B:t}:{A:(o-t)/(i-e),B:o-i*((o-t)/(i-e))}},Mt=(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),kt=(e,t)=>{let i,o,s;"v"===t.A?(i=1,o=0,s=-t.B):"h"===t.A?(i=0,o=1,s=-t.B):(i=t.A,o=-1,s=t.B);const n=e.x,a=e.y,r=(o*(o*n-i*a)-i*s)/(i**2+o**2),l=(i*(i*a-o*n)-o*s)/(i**2+o**2);return{distance:Mt({x:n,y:a},{x:r,y:l}),projectedPoint:{x:r,y:l}}},Ot=(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)),Rt=e=>{for(let t=0;t<e.length;t++)if(!e[t])return!1;return!0},Pt=e=>e.area>0?e.area:Math.sign(e.realArea)>0&&Math.sign(e.outsideArea)>0?Math.min(e.realArea,e.outsideArea):Math.sign(e.realArea)>0?e.realArea:Math.sign(e.outsideArea)>0?e.outsideArea:null,Ft=function(e,t){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return("metric"!==t||arguments.length>7&&void 0!==arguments[7]&&arguments[7])&&(e=O(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"meter",arguments.length>3&&void 0!==arguments[3]?arguments[3]:"feet")),e=T(e,i),o&&(s&&(e+=" "),e+="metric"===t?"m":"ft"),e},At=function(e,t){return("metric"!==t||arguments.length>4&&void 0!==arguments[4]&&arguments[4])&&(e=O(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"feet",arguments.length>3&&void 0!==arguments[3]?arguments[3]:"meter")),e},Wt=function(e,t){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return("metric"!==t||arguments.length>7&&void 0!==arguments[7]&&arguments[7])&&(e=O(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"square meter",arguments.length>3&&void 0!==arguments[3]?arguments[3]:"square foot")),e=T(e,i),o&&(s&&(e+=" "),e+="metric"===t?"m\xb2":"ft\xb2"),e},Bt=(e,t,i)=>{const{arrowHalfLength:o}=Et(i),s=-o,n=o,a=.5*(n+s),r=Math.atan2(0,n-s)-Math.PI/2,l="start"===e?15:-15,h=a+l*Math.cos(r),c=0+l*Math.sin(r),d=new DOMMatrix;d.translateSelf(i.x,i.y),d.rotateSelf(i.angle+90);const p=new DOMPoint(h,c).matrixTransform(d),{translateX:m,translateY:u}=Et(i,t),g=new DOMMatrix;g.translateSelf(m,u),g.rotateSelf(i.angle+90);return{curvePoint1X:s,curvePoint1Y:0,curvePoint2X:n,curvePoint2Y:0,controlPointX:h,controlPointY:c,transformedControlPointOnWallCoordinates:p,transformedArrowControlPointCoordinates:new DOMPoint(h,c).matrixTransform(g)}},Et=(e,t)=>{let i={arrowHalfLength:0,translateX:0,translateY:0};if(i.arrowHalfLength=e.thick/2+5,t){const o=e.angle*(Math.PI/180),s="up"===t?0:Math.PI;i.translateX=e.x+i.arrowHalfLength*Math.sin(o+s),i.translateY=e.y-i.arrowHalfLength*Math.cos(o+s)}return i},Vt=(e,t,i)=>{for(let o=0;o<e.length;o++){const s=e[o].x-t.x,n=e[o].y-t.y;e[o].x=s*Math.cos(i)-n*Math.sin(i),e[o].y=s*Math.sin(i)+n*Math.cos(i),e[o].x+=t.x,e[o].y+=t.y}},Nt=e=>{let t=1/0,i=-1/0,o=1/0,s=-1/0;for(let n=0;n<e.length;n++)e[n].x<t&&(t=e[n].x),e[n].x>i&&(i=e[n].x),e[n].y<o&&(o=e[n].y),e[n].y>s&&(s=e[n].y);return{minX:t,maxX:i,minY:o,maxY:s,width:i-t,height:s-o}},zt=e=>de.includes(e),Ht=e=>pe.includes(e),Gt=e=>me.includes(e),qt=e=>ye.includes(e),Yt=e=>{for(const[t,i]of Object.entries(Ee))if(i.models.includes(e))return t;return""},Ut=e=>{for(const t of Object.values(Ee))if(t.models.includes(e))return t.details[e].itemType;return""},Xt=e=>({...e,objData:e.objData.map((e=>{let{bbox:t,realBbox:i,size:o,thick:s,height:n,width:a,...r}=e;return r}))}),Zt=e=>{let t=e.parent;for(;t;){if(t.isScene)return t;t=t.parent}return null},Kt=(e,t)=>{let i=[],o=[];for(let s=0;s<e.coords.length;s++)ct(e.coords[s],e.equations.up,t)?i.push(e.coords[s]):o.push(e.coords[s]);return{interiorLineCoords:i,exteriorLineCoords:o}};var Jt=i(1317);function Qt(e){return t=>{const i=t&&t.target?t.target.value:t,o=this.state.edit.map((t=>({...t,value:t.field===e.field?i:t.value})));this.setState({edit:o,needsSave:z(o,this.state.originalData)})}}function $t(e){const t=((e,t)=>{let i=0,o=e.map((e=>{let t,o,{value:s,validate:n,...a}=e;return a.isGpsCoord?(V.log("Comma value"+s),o=s.toString()&&s.toString().replace(",","."),V.log("Dotted value"+o),t=n&&n(o),t||(s=o)):t=n&&n(s),t&&i++,{...a,validate:n,value:s,error:t}}));return t(o),!i})(this.state.edit,(e=>{this.setState({edit:e})}));if(t){let t=[...this.props.mainComponentThis.klet3DLastSavedData],i=t.find((e=>e.entity_id===this.props.bindedEntity.entity_id));i&&(this.state.edit.forEach((e=>i.params[e.field]=e.value)),this.callSaveAPI(i,t,e))}}function ei(e,t,i){let o={entitydata:t};this.setState({loading:!0},(()=>{C.post.call(this,"/klet3d/entity/".concat(this.props.mainComponentThis.props.floorplanID,"/").concat(this.props.mainComponentThis.props.licenseKey),o,(o=>{Jt.log("Klet post API response"),Jt.log(o),this.props.mainComponentThis.klet3DLastSavedData=t,this.props.updateBindedEntityState(e),i&&i(),this.setState({loading:!1,originalData:this.state.edit,needsSave:!1})}))}))}const ti=e=>{const t=e.entity_id.split(".")[0];return"sensor"===t?"sensor":"input_boolean"===t||"binary_sensor"===t?"doorWindow":"light"===t||"switch"===t?"lights":"other"},ii=(e,t)=>"sensor"===ti(e)||"other"===ti(e)?{object2D:t.object2D,floorNumber:t.floorNumber}:{},oi=e=>e.attributes&&e.attributes.friendly_name||e.entity_id.split(".")[1],si=e=>{let{children:t,title:i,controls:o,responseError:s,indoorMapping:n=!1,hideLayoutHeader:a=!1}=e;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("main",{className:"layout container ".concat("Map"===i?"fieldmap-container":""," ").concat(n?"layout-indoormapping":""),children:[!a&&(0,l.jsx)(c,{title:i,controls:!y(s)&&o}),y(s)?S(s):t]})})};class ni extends o.PureComponent{render(){const{className:e,onClick:t,children:i,type:o,disabled:s,disabledNative:n,style:a={}}=this.props;return(0,l.jsx)("button",{className:n?"":"button ".concat(o?"button--type-".concat(o):""," ").concat(s?"button-disabled":""," ").concat(e||""),onClick:s||n?null:t,disabled:n,style:a,children:i})}}const ai=ni;var ri=i(5807);class li extends o.Component{render(){const{buttonType:e,ButtonIcon:t,buttonText:i,loading:o,spinnerLoading:s,spinnerColor:n}=this.props;return(0,l.jsxs)(ai,{type:e,disabled:this.props.disabled||!1,style:{position:o?"relative":"static"},onClick:()=>!o&&this.props.onClick&&this.props.onClick(),children:[(0,l.jsxs)("div",{className:"loading-button-content-container",style:{visibility:o?"hidden":"visible"},children:[t,(0,l.jsx)("span",{children:i})]})," ",o?s?(0,l.jsx)("div",{style:{height:"0.875rem",width:"0.875rem",borderColor:n,borderRightColor:"transparent",position:"absolute",top:"0.6rem",left:"calc(50% - 0.4375rem)",boxSizing:"border-box"},className:"spinner"}):(0,l.jsx)(ri.Z,{style:{position:"absolute",top:0,left:0,height:"2.75rem",width:"100%"},animation:"pulse"}):null]})}}const hi=li;class ci extends o.Component{render(){return(0,l.jsx)("div",{className:"button-centered-container edit-button",children:(0,l.jsx)(ai,{type:"primary",style:{paddingLeft:"1.2rem",paddingRight:"1.2rem"},children:(0,l.jsx)("a",{href:"https://app.klet3d.com/floorplan/".concat(this.props.mainComponentThis.getFloorplanID()),target:"_blank",rel:"noreferrer",style:{textDecoration:"none",color:"#fff"},children:"Edit values"})})})}}const di=ci;var pi=i(9150);class mi extends o.Component{render(){return(0,l.jsxs)("div",{className:"screen-centered response-error-container",children:[(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(pi.Z,{className:"popup-alert-icon"})}),(0,l.jsx)("p",{className:"error-message",children:this.props.message})]})}}const ui=mi;class gi extends o.Component{render(){return"403"===this.props.responseError?(0,l.jsx)(ui,{message:"You do not have access to this site."}):"401"===this.props.responseError?(0,l.jsx)(ui,{message:"Session expired, please log in again."}):!this.props.errorMessageCheckDisabled&&y(this.props.responseError)?this.props.contextError?(0,l.jsx)("div",{style:{padding:"1rem"},children:S(this.props.responseError)}):S(this.props.responseError):this.props.customResponseError?(0,l.jsx)(ui,{message:this.props.customResponseError}):(0,l.jsx)(o.Fragment,{children:this.props.children})}}const fi=gi;var bi=i(4827),xi=i(1317);class Ci extends o.Component{constructor(){super(),this.state={displayMessage:!1},this.infoIconRef=o.createRef()}render(){return(0,l.jsxs)("div",{ref:this.infoIconRef,className:"info-icon-container",style:{...this.props.infoContainerStyles},children:[(0,l.jsx)(bi.Z,{className:"info-icon",onMouseOver:()=>{if(!this.state.displayMessage){if(this.props.indoorPanelExplanationBox){let e=this.infoIconRef.current.getBoundingClientRect();xi.log(e),this.props.indoorPanelExplanationBox.current.style.top=e.top+"px",this.props.indoorPanelExplanationBox.current.style.left=e.left+20+"px",this.props.indoorPanelExplanationBox.current.innerHTML=this.props.infoText,this.props.indoorPanelExplanationBox.current.style.display="block"}this.setState({displayMessage:!0})}},onMouseLeave:()=>{this.state.displayMessage&&(this.props.indoorPanelExplanationBox&&(this.props.indoorPanelExplanationBox.current.style.display="none"),this.setState({displayMessage:!1}))}}),this.props.indoorPanelExplanationBox?null:(0,l.jsx)("div",{className:"explanation-info-box ".concat(this.props.persistExplanationBox?"explanation-box-persist":""),style:{display:this.state.displayMessage||this.props.persistExplanationBox?"inline-block":"none",...this.props.explanationInfoBoxStyles},children:this.props.infoText})]})}}const wi=Ci;class yi extends o.Component{constructor(e){super(e),this.setInitialValue=e=>this.initialValue=e,this.setValue=e=>this.inputRef.current.value=e,this.getValue=()=>this.inputRef.current.value,this.setRangeValues=(e,t)=>{this.inputRef.current.setAttribute("min",e),this.inputMin=e,this.inputRef.current.setAttribute("max",t),this.inputMax=t},this.setValueInsideInterval=e=>(this.props.allowEmpty&&""===e||(e>this.inputMax?e=this.inputMax:e<this.inputMin&&(e=this.inputMin)),e),this.onInputChange=e=>{let t=T(e.target.value,this.decimalPrecision),i=e.target.value,o=!1;(!isNaN(t)||this.props.allowEmpty&&""===i)&&(i=this.props.allowEmpty&&""===i?i:t,i===this.setValueInsideInterval(i)&&(o=!0)),this.inputRef.current.value=i,this.setState({isInvalid:!o},(()=>{this.props.callOnlyOnBlur||!o||!this.props.onInputValueChanged||this.props.checkInputValueChangeBeforeCall&&this.inputValueChangedCalledWithValue===i||(this.inputValueChangedCalledWithValue=i,this.props.onInputValueChanged())}))},this.onInputBlur=e=>{let t=T(e.target.value,this.decimalPrecision),i=this.initialValue;(!isNaN(t)||this.props.allowEmpty&&""===e.target.value)&&(i=this.props.allowEmpty&&""===e.target.value?e.target.value:t,i=this.setValueInsideInterval(i)),this.inputRef.current.value=i,this.setState({isInvalid:!1},(()=>{!this.props.onInputValueChanged||this.props.checkInputValueChangeBeforeCall&&this.inputValueChangedCalledWithValue===i||(this.inputValueChangedCalledWithValue=i,this.props.onInputValueChanged())}))},this.state={isInvalid:!1},this.inputMin=e.inputMin,this.inputMax=e.inputMax,this.initialValue=void 0!==e.defaultValue?e.defaultValue:e.inputMin,this.decimalPrecision=-Math.log10(e.inputStep),this.inputValueChangedCalledWithValue=null,this.inputRef=o.createRef(),this.setValue=this.setValue.bind(this),this.getValue=this.getValue.bind(this),this.setRangeValues=this.setRangeValues.bind(this),this.setInitialValue=this.setInitialValue.bind(this),this.setValueInsideInterval=this.setValueInsideInterval.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onInputBlur=this.onInputBlur.bind(this)}componentDidMount(){this.props.defaultValue&&(this.inputRef.current.value=this.props.defaultValue)}render(){return(0,l.jsx)("input",{ref:this.inputRef,type:"number",disabled:this.props.disabled,min:this.inputMin,max:this.inputMax,step:this.props.inputStep,placeholder:this.props.placeholder||"",title:this.props.title||"",style:this.props.inputStyle||{},lang:"en",className:"form-control input ".concat(this.state.isInvalid?"is-invalid":""," ").concat(this.props.hideNumberArrows?"hide-number-arrows":""," ").concat(this.props.disabled?"form-disabled-input":""),onChange:this.props.disabled?void 0:this.onInputChange,onBlur:this.props.disabled?void 0:this.onInputBlur,onKeyDown:e=>!this.props.disabled&&"Enter"===e.key&&this.props.callOnlyOnBlur&&e.target.blur()})}}const Si=yi;var vi=i(1317);class ji extends o.Component{constructor(e){super(e),this.setInitialValue=e=>this.initialValue=e,this.setValue=e=>this.setState({value:e}),this.getValue=()=>this.state.value,this.setRangeValues=(e,t)=>{this.setState({min:e,max:t})},this.setValueInsideInterval=e=>(this.props.allowEmpty&&""===e||(e>this.state.max?e=this.state.max:e<this.state.min&&(e=this.state.min)),e),this.onInputChange=e=>{let t=T(e.target.value,this.decimalPrecision),i=e.target.value,o=!1;(!isNaN(t)||this.props.allowEmpty&&""===i)&&(i=this.props.allowEmpty&&""===i?i:t,i===this.setValueInsideInterval(i)&&(o=!0)),this.setState({value:i,isInvalid:!o},(()=>{!this.props.callOnlyOnBlur&&o&&this.props.onInputValueChanged&&this.inputValueChangedCalledWithValue!==i&&(this.inputValueChangedCalledWithValue=i,this.props.onInputValueChanged(this.state.value))}))},this.onInputBlur=e=>{let t=T(e.target.value,this.decimalPrecision),i=this.initialValue;(!isNaN(t)||this.props.allowEmpty&&""===e.target.value)&&(i=this.props.allowEmpty&&""===e.target.value?e.target.value:t,i=this.setValueInsideInterval(i)),this.setState({value:i,isInvalid:!1},(()=>{(this.props.callOnlyOnBlur||this.props.onInputValueChanged&&this.inputValueChangedCalledWithValue!==i)&&(this.inputValueChangedCalledWithValue=i,this.props.onInputValueChanged(this.state.value))}))},this.state={value:e.value||"",min:e.inputMin,max:e.inputMax,isInvalid:!1},this.decimalPrecision=-Math.log10(e.inputStep),this.initialValue=void 0!==e.value?e.value:e.inputMin,this.inputValueChangedCalledWithValue=null,this.setValue=this.setValue.bind(this),this.getValue=this.getValue.bind(this),this.setRangeValues=this.setRangeValues.bind(this),this.setInitialValue=this.setInitialValue.bind(this),this.setValueInsideInterval=this.setValueInsideInterval.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onInputBlur=this.onInputBlur.bind(this)}render(){vi.log("Is invalid "+this.state.isInvalid);const{value:e,min:t,max:i,isInvalid:o}=this.state;return(0,l.jsx)("input",{type:"number",min:t,max:i,step:this.props.inputStep,placeholder:this.props.placeholder||"",title:this.props.title||"",style:this.props.inputStyle||{},lang:"en",className:"form-control input ".concat(o?"is-invalid":""," ").concat(this.props.hideNumberArrows?"hide-number-arrows":""," ").concat(this.props.inputClasses||""),value:this.props.usePropsValue?this.props.value:e,onChange:this.onInputChange,onBlur:this.onInputBlur,onKeyDown:e=>"Enter"===e.key&&this.props.callOnlyOnBlur&&e.target.blur()})}}const Di=ji;var Ti=i(648);class Ii extends o.Component{render(){return(0,l.jsxs)("div",{className:"screen-centered-tabs-and-close-button-modal ".concat(this.props.className||""),style:this.props.modalStyles||{},children:[(0,l.jsx)("div",{className:"tab-labels-container",children:this.props.modalTabs||(0,l.jsx)("div",{className:"keep-height",children:"Keep height"})}),(0,l.jsx)("div",{className:"close-button-container",onClick:this.props.onCloseModalClick,children:(0,l.jsx)(Ti.Z,{})}),this.props.children]})}}const _i=Ii;class Li extends o.Component{render(){return(0,l.jsxs)(Ai,{containerRef:this.props.formGroupRef||null,containerClasses:this.props.containerClasses,containerStyle:this.props.formGroupStyle,label:this.props.label,labelStyle:this.props.labelStyle,labelClasses:this.props.labelClasses,children:[this.props.inputLoading?(0,l.jsx)("div",{children:(0,l.jsx)(Zi,{center:!0,noMargin:!0,spinnerStyle:{width:20,height:20}})}):(0,l.jsx)(o.Fragment,{children:this.props.selectInput?this.props.selectBoxComboInput?(0,l.jsx)(no,{item:this.props.item,handleChange:this.props.onChange}):(0,l.jsx)(ro,{ref:this.props.selectInputRef||null,fullWidth:this.props.fullWidth,item:this.props.item,handleChange:this.props.onChange}):(0,l.jsx)(Bi,{inputProps:{item:this.props.item,onChange:this.props.onChange,inputRef:this.props.inputRef,inputClasses:this.props.inputClasses,disabled:this.props.disabled,inputStyle:this.props.inputStyle,value:this.props.value,error:this.props.error,type:this.props.type,placeholder:this.props.placeholder,accept:this.props.accept}})}),this.props.error&&(0,l.jsx)("div",{className:"form-control feedback ".concat(this.props.errorClasses||""),children:this.props.error}),this.props.bellowInputElements&&this.props.bellowInputElements]})}}const Mi=Li;class ki extends o.Component{render(){return(0,l.jsxs)("div",{className:"checked-input-container ".concat(this.props.disabled?"disabled":""," ").concat(this.props.containerClasses||""),children:[(0,l.jsx)("input",{ref:this.props.inputRef||null,title:this.props.title,type:"checkbox",onChange:this.props.disabled?void 0:this.props.onChange,defaultChecked:this.props.defaultChecked,disabled:this.props.disabled,checked:this.props.checked}),this.props.label&&(0,l.jsx)("label",{children:this.props.label}),this.props.infoLabel&&(0,l.jsxs)("div",{className:"label-info-box-container",children:[(0,l.jsx)("label",{children:this.props.infoLabelTitle}),(0,l.jsx)(wi,{infoText:this.props.infoText,explanationInfoBoxStyles:this.props.explanationInfoBoxStyles||{}})]})]})}}const Oi=ki;class Ri extends o.Component{render(){return(0,l.jsxs)(Ai,{label:this.props.label,containerStyle:this.props.formGroupContainerStyle||{},children:[(0,l.jsx)("div",{className:"form-radio-group",style:this.props.radioGroupContainerStyle||{},children:this.props.item.choices.map(((e,t)=>(0,l.jsxs)("div",{style:this.props.choiceRowStyle||{},children:[!this.props.rightLabel&&(0,l.jsx)("label",{className:"left-label",children:e.name}),(0,l.jsx)("input",{disabled:this.props.disabled,value:e.value,type:"radio",checked:this.props.item.value===e.value,onChange:this.props.disabled?void 0:this.props.onChange(this.props.item)}),this.props.rightLabel&&(0,l.jsx)("label",{className:"right-label",children:e.name}),e.inputSiblingElement||null]},t)))}),this.props.item.error&&(0,l.jsx)("div",{className:"form-control feedback",children:this.props.item.error})]})}}const Pi=Ri;class Fi extends o.Component{render(){return(0,l.jsxs)("div",{ref:this.props.containerRef||null,className:"form-group ".concat(this.props.containerClasses||""),style:this.props.containerStyle||{},children:[this.props.label&&(0,l.jsx)("label",{style:this.props.labelStyle||{},className:"label form-control ".concat(this.props.labelClasses||""),children:this.props.label}),this.props.children]})}}const Ai=Fi;class Wi extends o.Component{render(){return(0,l.jsx)("input",{ref:this.props.inputProps.inputRef||null,className:"form-control input ".concat(this.props.inputProps.inputClasses||""," ").concat(this.props.inputProps.error?"is-invalid":""," ").concat(this.props.inputProps.disabled?"form-disabled-input":""),style:this.props.inputProps.inputStyle||{},value:this.props.inputProps.value,disabled:this.props.inputProps.disabled,type:this.props.inputProps.type||"text",placeholder:this.props.inputProps.placeholder||"",onChange:this.props.inputProps.onChange&&this.props.inputProps.onChange(this.props.inputProps.item),accept:this.props.inputProps.accept})}}const Bi=Wi;var Ei=i(8735);class Vi extends o.Component{constructor(){super(),this.onColorChange=e=>!this.props.disabled&&this.props.onChange(this.props.item)({target:{value:e}}),this.onOpenColorPickerClick=()=>{this.setState({isColorPickerVisible:!this.state.isColorPickerVisible})},this.colorPickerPopupRaycasting=e=>{this.state.isColorPickerVisible&&(R(e.clientX,e.clientY,this.colorPickerPopupContainerRef.current.getElementsByClassName("react-colorful")[0].getBoundingClientRect())||R(e.clientX,e.clientY,this.colorPickerInputContainerRef.current.getBoundingClientRect())||this.setState({isColorPickerVisible:!1}))},this.state={isColorPickerVisible:!1},this.colorPickerPopupContainerRef=o.createRef(),this.colorPickerInputContainerRef=o.createRef(),this.paddingValue=3,this.onColorChange=this.onColorChange.bind(this),this.onOpenColorPickerClick=this.onOpenColorPickerClick.bind(this),this.colorPickerPopupRaycasting=this.colorPickerPopupRaycasting.bind(this)}componentWillUnmount(){this.props.boxContainer.removeEventListener("click",this.colorPickerPopupRaycasting)}componentDidMount(){const e=this.colorPickerInputContainerRef.current.getElementsByClassName("input");for(let t=0;t<e.length;t++)e[t].style.paddingLeft=this.colorPickerInputContainerRef.current.offsetHeight+this.paddingValue+"px";this.props.boxContainer.addEventListener("click",this.colorPickerPopupRaycasting)}render(){return(0,l.jsxs)("div",{className:"color-picker-container",style:this.props.containerStyle||{},children:[(0,l.jsx)("div",{ref:this.colorPickerPopupContainerRef,className:"color-picker-popup-container",style:{display:this.state.isColorPickerVisible?"block":"none",opacity:this.state.isColorPickerVisible?1:0,pointerEvents:this.state.isColorPickerVisible?"auto":"none"},children:(0,l.jsx)(Ei.gW,{color:this.props.item.value,onChange:this.onColorChange,disabled:this.props.disabled})}),(0,l.jsxs)("div",{ref:this.colorPickerInputContainerRef,className:"color-picker-input-container input-auto-width",children:[(0,l.jsx)("span",{className:"form-control input keep-width-span",style:{paddingRight:this.paddingValue},children:"#000000"}),(0,l.jsx)(Ei.ZE,{className:"form-control input color-picker-input",style:{paddingRight:this.paddingValue},color:this.props.item.value,prefixed:!0,disabled:this.props.disabled,onChange:this.onColorChange}),(0,l.jsx)("div",{className:"color-value-layout",style:{backgroundColor:this.props.item.value},onClick:this.onOpenColorPickerClick})]})]})}}const Ni=Vi;class zi extends o.Component{render(){return(0,l.jsxs)("div",{ref:this.props.containerRef||null,className:"form-group inline ".concat(this.props.autoWidth?"auto-width-container":""," ").concat(this.props.containerClasses||""),style:this.props.containerStyle||{},children:[(0,l.jsx)("div",{className:"label-container",children:(0,l.jsx)("label",{style:this.props.labelStyle||{},className:"label form-control ".concat(this.props.labelClasses||""),children:this.props.label})}),(0,l.jsxs)("div",{className:"input-container ".concat(this.props.autoWidth?"input-auto-width":""),children:[this.props.autoWidth&&(0,l.jsx)("span",{className:"form-control input ".concat(this.props.autoWidthClass),children:this.props.keepWidthValue}),this.props.isColorInput?(0,l.jsx)(Ni,{disabled:this.props.disabled,item:this.props.item,onChange:this.props.onChange,boxContainer:this.props.colorPickerBoxContainer}):this.props.isNumberInput?this.props.controledNumberInput?(0,l.jsx)(Di,{placeholder:this.props.item.placeholder,disabled:this.props.disabled,inputStep:this.props.item.step,inputMin:this.props.item.min,inputMax:this.props.item.max,usePropsValue:this.props.usePropsValue,value:this.props.item.value,onInputValueChanged:this.props.onChange(this.props.item)}):(0,l.jsx)(Si,{ref:this.props.uncontroledNumberInputRef,disabled:this.props.disabled,placeholder:this.props.item.placeholder,inputStep:this.props.item.step,inputMin:this.props.item.min,inputMax:this.props.item.max,onInputValueChanged:this.props.onChange(this.props.item)}):(0,l.jsx)(Bi,{inputProps:{item:this.props.item,onChange:this.props.onChange,inputRef:this.props.inputRef,inputClasses:this.props.inputClasses,disabled:this.props.disabled,inputStyle:this.props.inputStyle,value:this.props.value,error:this.props.error,type:this.props.type,placeholder:this.props.placeholder,accept:this.props.accept}}),this.props.error&&(0,l.jsx)("div",{className:"form-control feedback ".concat(this.props.errorClasses||""),children:this.props.error})]})]})}}const Hi=zi;var Gi=i(2661);class qi extends o.Component{constructor(e){super(),this.setValue=e=>this.setState({value:e}),this.copyInputValue=()=>{if(navigator.clipboard)navigator.clipboard.writeText(this.inputRef.current.textContent).then((()=>{this.setState({showCopyStatus:!0,copyStatusText:"Copied!"},(()=>{setTimeout((()=>{this.setState({showCopyStatus:!1})}),1e3)}))})).catch((()=>{this.setState({showCopyStatus:!0,copyStatusText:"Can't copy!"})}));else{const e=document.createElement("textarea");e.value=this.inputRef.current.textContent,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),this.setState({showCopyStatus:!0,copyStatusText:"Copied!"},(()=>{setTimeout((()=>{this.setState({showCopyStatus:!1})}),1e3)}))}},this.state={showCopyStatus:!1,value:e.value},this.inputRef=o.createRef(),this.setValue=this.setValue.bind(this),this.copyInputValue=this.copyInputValue.bind(this)}render(){const{showCopyStatus:e,copyStatusText:t,value:i}=this.state;return i?(0,l.jsxs)("div",{style:{width:"100%",...this.props.containerStyle},children:[(0,l.jsxs)("div",{className:"copy-alert-and-label-container",children:[(0,l.jsx)("label",{className:"label form-control",children:this.props.label}),(0,l.jsx)("div",{style:{display:e?"block":"none"},children:t})]}),(0,l.jsxs)("div",{className:"clipboard-label",children:[(0,l.jsx)("div",{ref:this.inputRef,style:{wordBreak:"break-all"},className:"form-control input form-disabled-input",children:i}),(0,l.jsx)("div",{className:"clipboard-container copy-input",onClick:this.copyInputValue,children:(0,l.jsx)(Gi.Z,{className:"copy-icon"})})]})]}):null}}const Yi=qi;class Ui extends o.Component{constructor(){super(),this.closeDropdownMenu=()=>this.actionButtonRef.current.nextSibling.classList.remove("show"),this.setValue=e=>{this.actionButtonRef.current.innerHTML=e+' <span class="caret"></span>',this.setState({selectedValue:e}),this.closeDropdownMenu()},this.onActionButtonClick=e=>{!this.props.disabled&&e.target.nextSibling.classList.toggle("show")},this.handleClickOutside=e=>{this.props.disableCloseOnOutsideClick||this.containerRef.current&&!this.containerRef.current.contains(e.target)&&this.closeDropdownMenu()},this.state={selectedValue:null},this.onActionButtonClick=this.onActionButtonClick.bind(this),this.setValue=this.setValue.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.closeDropdownMenu=this.closeDropdownMenu.bind(this),this.actionButtonRef=o.createRef(),this.containerRef=o.createRef()}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}render(){return(0,l.jsxs)("div",{ref:this.containerRef,className:"select-custom-mini-container ".concat(this.props.containerClasses||""),children:[(0,l.jsx)("button",{disabled:this.props.disabled,ref:this.actionButtonRef,className:"btn btn-default form-control input",onClick:this.onActionButtonClick}),(0,l.jsx)("ul",{ref:this.props.dropdownMenuRef||null,className:"list-unstyled select-custom-mini-dropdown-menu",children:this.props.listItems.map(((e,t)=>(0,l.jsx)("li",{className:"".concat(e===this.state.selectedValue?"selected":""),onClick:e=>!this.props.disabled&&this.props.onListItemClick(e,t),children:e},e)))})]})}}const Xi=Ui,Zi=e=>{let{center:t,screenCenter:i,spinnerHolderStyle:o={},spinnerStyle:s={},noMargin:n}=e;return(0,l.jsx)("div",{style:{...o,textAlign:t?"center":"auto"},className:"spinner-holder ".concat(i?"screen-centered":""," ").concat(n?"spinner-holder-no-margin":""),children:(0,l.jsx)("div",{style:s,className:"spinner"})})};var Ki=i(8039),Ji=i(6508),Qi=i(309),$i=i(8364),eo=i(1504),to=i(3702);const io=(0,to.ZP)({overrides:{MuiPopover:{root:{zIndex:"1402!important"}},MuiSelect:{root:{"&:$focus":{border:"2px solid #19ab7f !important"}}},MuiInput:{underline:{"&:after":{borderBottomColor:"#19ab7f !important"},"&:before":{borderBottomColor:"#ffffff !important"}}},MuiFormLabel:{root:{"&$focused":{color:"#19ab7f !important"}},focused:{}},MuiIconButton:{colorSecondary:{"&:hover":{backgroundColor:"rgba(27, 215, 65, 0.04)"}}},MuiCheckbox:{colorSecondary:{color:"#19ab7f !important"}},MuiChecked:{root:{"&:$hover":{backgroundColor:"#transparent !important"}}},MuiTypography:{root:{fontSize:"0.875rem !important"}},MuiListItemText:{root:{margin:"0 !important",textAlign:"center"}},MuiMenu:{paper:{maxHeight:"50vh"}}}});var oo=i(7664);class so extends o.Component{constructor(e){super(e),this.handleSelectChange=e=>{"Other..."===e.target.value?this.state.showInputBox||(this.inputRef.current.focus(),e.target.value="",this.setState({showInputBox:!0,inputValue:"",selectValue:this.props.item.options[this.props.item.options.length-1]},(()=>this.props.handleChange(this.props.item)(e)))):this.setState({showInputBox:!1},(()=>this.handleChangeSelect(e)))},this.onInputChange=()=>e=>this.handleChangeInput(e),this.handleChangeInput=e=>{e.persist(),this.setState({inputValue:e.target.value},(()=>this.props.handleChange(this.props.item)(e)))},this.handleChangeSelect=e=>{e.persist(),this.setState({selectValue:e.target.value},(()=>this.props.handleChange(this.props.item)(e)))},this.state={selectValue:e.item.options.find((t=>t===e.item.value))||""===e.item.value?e.item.value:e.item.options[e.item.options.length-1],inputValue:e.item.options.find((t=>t===e.item.value))||""===e.item.value?"":e.item.value||"",showInputBox:!e.item.options.find((t=>t===e.item.value))&&""!==e.item.value},this.inputRef=o.createRef(),this.handleSelectChange=this.handleSelectChange.bind(this),this.onInputChange=this.onInputChange.bind(this),this.handleChangeInput=this.handleChangeInput.bind(this),this.handleChangeSelect=this.handleChangeSelect.bind(this)}render(){return(0,l.jsx)(oo.Z,{theme:io,children:(0,l.jsxs)("div",{children:[(0,l.jsx)(eo.Z,{style:{width:"50%",border:"1px solid #e2e7f1"},children:(0,l.jsx)(Qi.Z,{MenuProps:{getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"left"}},labelId:"select-device-label",value:this.state.selectValue,renderValue:e=>(0,l.jsx)(Ji.Z,{children:e}),onChange:e=>this.handleSelectChange(e),children:this.props.item.options.map((e=>(0,l.jsxs)($i.Z,{value:e,children:[(0,l.jsx)(Ki.Z,{checked:e===this.state.selectValue,style:{visibility:e===this.state.selectValue?"visible":"hidden"}}),(0,l.jsx)(Ji.Z,{children:e})]},e)))})}),(0,l.jsx)(Mi,{formGroupRef:this.inputRef,formGroupStyle:{width:"50%",display:this.state.showInputBox?"block":"none"},placeholder:"Type name",value:this.state.inputValue,error:this.props.item.error,onChange:this.onInputChange})]})})}}const no=so;class ao extends o.Component{constructor(e){super(e),this.onChange=e=>{e.persist(),this.setState({value:e.target.value},(()=>this.props.handleChange(this.props.item)(e)))},this.resetValue=()=>{this.setState({value:""})},this.state={value:e.item.value},this.onChange=this.onChange.bind(this),this.resetValue=this.resetValue.bind(this)}render(){return(0,l.jsx)(oo.Z,{theme:io,children:(0,l.jsx)("div",{children:(0,l.jsx)(eo.Z,{style:{width:this.props.fullWidth?"100%":"50%",border:"1px solid #e2e7f1"},children:(0,l.jsx)(Qi.Z,{MenuProps:{getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"left"}},labelId:"select-device-label",defaultValue:"",value:this.state.value,renderValue:e=>(0,l.jsx)(Ji.Z,{children:e.name||e}),onChange:e=>this.onChange(e),children:this.props.item.options.map((e=>(0,l.jsxs)($i.Z,{value:e,children:[(0,l.jsx)(Ki.Z,{checked:(e.value||e)===(this.state.value.value||this.state.value),style:{visibility:(e.value||e)===(this.state.value.value||this.state.value)?"visible":"hidden"}}),(0,l.jsx)(Ji.Z,{children:e.name||e})]},e.value||e)))})})})})}}const ro=ao;var lo=i(4312);const ho=(0,to.ZP)({overrides:{MuiSwitch:{switchBase:{color:"#fff","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)!important"}},colorSecondary:{"&$checked":{color:"#19ab7f","&:hover":{backgroundColor:"rgba(27, 215, 65, 0.04)!important"}}},track:{"$checked$checked + &":{opacity:.7,backgroundColor:"#19ab7f"}}},MuiSlider:{root:{color:"#19ab7f"}}}});class co extends o.Component{render(){return(0,l.jsxs)("div",{className:"map-onhover-dropdown-list-options-container",children:[(0,l.jsx)("div",{className:"bolded-title",children:"STYLES"}),this.props.mapStyles.map((e=>(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{children:e.name}),(0,l.jsx)("div",{children:(0,l.jsx)(oo.Z,{theme:ho,children:(0,l.jsx)(lo.Z,{checked:this.props.selectedMapStyle===e.value,onChange:this.props.switchLayer(e.value)})})})]},e.value)))]})}}const po=co;var mo=i(9675);class uo extends o.PureComponent{constructor(){super(),this.state={mapConstructed:!1},this.reactMapboxGlMap=null}componentDidMount(){this.reactMapboxGlMap=(0,mo.ZP)({accessToken:"pk.eyJ1Ijoic2xhdmVuZGFtIiwiYSI6ImNrZ3pudHFxZzE1ZHoycnIxOXEzMndidTEifQ.sKPryHAJXxnH32c2W0HPsQ",preserveDrawingBuffer:this.props.preserveDrawingBuffer}),this.setState({mapConstructed:!0})}render(){if(this.state.mapConstructed){const e=this.reactMapboxGlMap;return(0,l.jsx)(e,{style:this.props.mapStyle,center:this.props.center,zoom:this.props.zoom,minZoom:this.props.minZoom,maxZoom:this.props.maxZoom,onClick:this.props.onClick,onZoom:this.props.onZoom,onZoomStart:this.props.onZoomStart,onZoomEnd:this.props.onZoomEnd,onPitchStart:this.props.onPitchStart,onPitchEnd:this.props.onPitchEnd,children:this.props.children})}return null}}const go=uo;var fo=i(3693);class bo extends o.Component{constructor(){super(),this.handleYesClick=()=>{const e=this.props.statePropertyName;this.props.setChoice({[e]:!0},(()=>{this.props.userChoice()}))},this.handleOkClick=()=>{const e=this.props.statePropertyName;this.props.setChoice({[e]:!1},(()=>{this.props.userChoice&&this.props.userChoice()}))},this.handleNoClick=()=>{const e=this.props.statePropertyName;this.props.setChoice({[e]:!1},(()=>{this.props.userChoice&&this.props.userChoice()}))},this.handleYesClick=this.handleYesClick.bind(this),this.handleNoClick=this.handleNoClick.bind(this),this.handleOkClick=this.handleOkClick.bind(this)}render(){const{message:e,visible:t,loading:i,loadingText:s,singleButton:n,type:a,error:r,buttonGreenText:h,buttonCancelText:c}=this.props;return t?(0,l.jsx)("div",{className:"popup-disable-background",children:(0,l.jsx)("div",{className:"popup-container",style:this.props.containerStyle||{},children:this.props.children?this.props.children:(0,l.jsxs)(o.Fragment,{children:[r?(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(pi.Z,{className:"popup-alert-icon"})}):1===a?n&&!i?(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(fo.Z,{className:"popup-success-icon"})}):n?null:(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(pi.Z,{className:"popup-alert-icon"})}):2===a?(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(pi.Z,{className:"popup-alert-icon"})}):3===a?(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(bi.Z,{className:"popup-alert-icon"})}):void 0,i?(0,l.jsxs)(o.Fragment,{children:[s?(0,l.jsx)("div",{className:"popup-message",children:s}):null,(0,l.jsx)(Zi,{center:!0})]}):(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{className:"popup-message",children:r||e}),(0,l.jsx)("div",{className:"popup-button-container",children:(()=>n?(0,l.jsx)(ai,{type:"primary",onClick:this.handleOkClick,children:"OK"}):n||1!==a?n||2!==a?null:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(ai,{type:"popup-delete",onClick:this.handleYesClick,children:"Delete"}),(0,l.jsx)(ai,{type:"popup-cancel",onClick:this.handleNoClick,children:"Cancel"})]}):(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(ai,{type:"primary",style:{borderRadius:"0.75rem"},onClick:this.handleYesClick,children:h||"Confirm"}),(0,l.jsx)(ai,{type:"popup-cancel",onClick:this.handleNoClick,children:c||"Cancel"})]}))()})]})]})})}):null}}class xo extends o.Component{render(){return(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsx)("span",{style:{visibility:"hidden"},children:this.props.longText}),(0,l.jsx)("div",{style:{position:"absolute",left:0,top:0},children:(0,l.jsx)("span",{children:this.props.shortText})})]})}}const Co=xo;class wo extends o.Component{render(){return(0,l.jsxs)("div",{className:"label form-control info-label",children:[(0,l.jsx)("span",{children:this.props.labelText}),(0,l.jsx)(wi,{infoText:this.props.infoText,explanationInfoBoxStyles:{top:20,left:0,width:150,zIndex:2}})]})}}const yo=wo;var So=i(4006);class vo extends o.Component{constructor(){super(),this.setTimeoutCallback=e=>{this.state.setVisibleCounter===e&&this.mounted&&this.setState({visible:!1,setVisibleCounter:this.state.setVisibleCounter+1})},this.showAlert=(e,t)=>{const i=this.state.setVisibleCounter+1;this.setState({visible:!0,alertMessage:e,alertType:t,setVisibleCounter:i},(()=>{void 0!==this.props.delay?this.containerRef.current.animate([{opacity:0,offset:0},{opacity:1,offset:.1},{opacity:1,offset:.9},{opacity:0,offset:.91}],this.props.delay):this.containerRef.current.style.opacity=1})),void 0!==this.props.delay&&setTimeout(this.setTimeoutCallback.bind(this,i),this.props.delay)},this.state={visible:!1,setVisibleCounter:0,alertType:null,alertMessage:null},this.containerRef=o.createRef(),this.showAlert=this.showAlert.bind(this),this.setTimeoutCallback=this.setTimeoutCallback.bind(this),this.mounted=!1}componentWillUnmount(){this.mounted=!1}componentDidMount(){this.mounted=!0}render(){return this.state.visible?(0,l.jsxs)("div",{ref:this.containerRef,className:"alert ".concat("error"===this.state.alertType?"alert-error":""," ").concat("success"===this.state.alertType?"alert-success":""," ").concat("warning"===this.state.alertType?"alert-warning":""),style:this.props.style?{...this.props.style,animationDuration:void 0!==this.props.delay?this.props.delay+"ms":"auto"}:{animationDuration:void 0!==this.props.delay?this.props.delay+"ms":"auto"},children:[(0,l.jsx)("p",{children:this.state.alertMessage}),(0,l.jsx)("div",{className:"svg-center-inside-container alert-close",onClick:()=>this.setState({visible:!1,setVisibleCounter:this.state.setVisibleCounter+1}),children:(0,l.jsx)(So.Z,{})})]}):null}}const jo=vo;var Do=i(1317);class To extends o.Component{constructor(){super(),this.callErrorLogAPI=e=>{let t,i;if(t=window._env_.floorplanID,i=window._env_.licenseKey,Do.log("callErrorLogAPI",e,t,i),t&&i){!0&&C.post.call(this,"/klet3d/error/".concat(t,"/").concat(i),{error:e},(e=>{Do.log("Error logged succesfully",e)}))}},this.windowErrorEventHandler=(e,t,i,o,s)=>{this.callErrorLogAPI(JSON.stringify({message:e.message,source:t,lineno:i,colno:o,error:JSON.stringify(s)}))},this.windowUnhandledRejectionEventHandler=e=>{this.callErrorLogAPI(JSON.stringify({message:e.reason.message,stack:e.reason.stack}))},this.state={responseError:null},this.mounted=!1,this.callErrorLogAPI=this.callErrorLogAPI.bind(this),this.windowErrorEventHandler=this.windowErrorEventHandler.bind(this),this.windowUnhandledRejectionEventHandler=this.windowUnhandledRejectionEventHandler.bind(this)}componentDidCatch(e,t){this.callErrorLogAPI(JSON.stringify({error:JSON.stringify(e),errorInfo:t}))}componentDidMount(){this.mounted=!0,window.addEventListener("error",this.windowErrorEventHandler),window.addEventListener("unhandledrejection",this.windowUnhandledRejectionEventHandler)}componentWillUnmount(){this.mounted=!1,window.removeEventListener("error",this.windowErrorEventHandler),window.removeEventListener("unhandledrejection",this.windowUnhandledRejectionEventHandler)}render(){return(0,l.jsx)(fi,{responseError:this.state.responseError,children:this.props.children})}}const Io=To;var _o=i(9325),Lo=i(3284),Mo=i(6433),ko=i(8847),Oo=i(1317);const Ro=class{constructor(e){this.rectangleDimensionsFromPoints=e=>{let t=[];for(let i=0;i<e.length;i++)for(let o=i+1;o<e.length;o++){let s=T(Mt(e[i],e[o]),8);t.includes(s)||t.push(s)}return t.sort(((e,t)=>t-e)),{a:t[t.length-2],b:t[t.length-1]}},this.mainComponentThis=e}create(e,t,i){let o=document.createElementNS("http://www.w3.org/2000/svg",t);for(let s in i)o.setAttribute(s,i[s]);return"none"!==e&&e.current.appendChild(o),o}angleDeg(e,t,i,o){let s=o-t,n=i-e,a=Math.atan2(s,n);return a*=180/Math.PI,a<0&&(a=360+a),a}angleBetweenLines(e,t,i,o){const s=e*i+t*o,n=e*o-t*i;return-Math.atan2(n,s)}angle(e,t,i,o,s,n){let a,r,l=parseInt(e),h=parseInt(t),c=parseInt(i),d=parseInt(o);if(s){let e=parseInt(s),t=parseInt(n),i=Math.sqrt(Math.pow(Math.abs(c-l),2)+Math.pow(Math.abs(d-h),2)),o=Math.sqrt(Math.pow(Math.abs(c-e),2)+Math.pow(Math.abs(d-t),2)),p=Math.sqrt(Math.pow(Math.abs(e-l),2)+Math.pow(Math.abs(t-h),2));a=0===i||0===o?Math.PI/2:Math.acos((Math.pow(i,2)+Math.pow(o,2)-Math.pow(p,2))/(2*i*o)),r=360*a/(2*Math.PI)}else a=l-c===0?Math.PI/2:Math.atan((h-d)/(l-c)),r=180*a/Math.PI;return{rad:a,deg:r}}getAngle(e,t){return{rad:Math.atan2(t.y-e.y,t.x-e.x),deg:180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}}middle(e,t,i,o){let s=parseInt(e),n=parseInt(t);return{x:(s+parseInt(i))/2,y:(n+parseInt(o))/2}}triangleArea(e,t,i){let o=0,s=0,n=0,a=0;return o=Mt(e,t),s=Mt(t,i),n=Mt(i,e),a=(o+s+n)/2,Math.sqrt(a*(a-o)*(a-s)*(a-n))}gap(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)}pDistance(e,t,i){let o,s,n=e.x,a=e.y,r=t.x,l=t.y,h=i.x,c=i.y,d=h-r,p=c-l,m=d*d+p*p,u=-1;0!==m&&(u=((n-r)*d+(a-l)*p)/m),u<0?(o=r,s=l):u>1?(o=h,s=c):(o=r+u*d,s=l+u*p);let g=n-o,f=a-s;return{x:o,y:s,distance:Math.sqrt(g*g+f*f)}}nearPointOnEquation(e,t){let i={},o={};return"h"===e.A?{x:t.x,y:e.B,distance:Math.abs(e.B-t.y)}:"v"===e.A?{x:e.B,y:t.y,distance:Math.abs(e.B-t.x)}:(i.x=t.x,i.y=e.A*t.x+e.B,o.x=(t.y-e.B)/e.A,o.y=t.y,this.pDistance(t,i,o))}circlePath(e,t,i){return"M "+e+" "+t+" m -"+i+", 0 a "+i+","+i+" 0 1,0 "+2*i+",0 a "+i+","+i+" 0 1,0 -"+2*i+",0"}perpendicularEquation(e,t,i){return"string"!=typeof e.A?{A:-1/e.A,B:i- -1/e.A*t}:"h"===e.A?{A:"v",B:t}:"v"===e.A?{A:"h",B:i}:void 0}angleBetweenEquations(e,t){return"h"===e&&(e=0),"h"===t&&(t=0),"v"===e&&(e=1e4),"v"===t&&(t=1e4),360*Math.atan(Math.abs((t-e)/(1+e*t)))/(2*Math.PI)}vectorXY(e,t){return{x:t.x-e.x,y:t.y-e.y}}vectorDeter(e,t){return e.x*t.y-e.y*t.x}btwn(e,t,i){return arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&(e=Math.round(e),t=Math.round(t),i=Math.round(i)),e>=t&&e<=i||e>=i&&e<=t}getNodeFromPath(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],o=e.getPathData(),s=[],n=0;for(let a=0;a<o.length;a++)o[a].values[0]===t.x&&o[a].values[1]===t.y&&"Z"!==o[a].type&&-1===i.indexOf(a)&&(n++,s.push(a));return 0!==n&&s}polygonIntoWalls(e,t){let i=t,o=[],s=[];for(let r=0;r<i.length;r++)s.push({x:e[i[r]].x,y:e[i[r]].y});for(let r=0;r<i.length-1;r++)for(let t=0;t<e[i[r+1]].segment.length;t++)for(let s=0;s<e[i[r]].segment.length;s++)e[i[r+1]].segment[t]===e[i[r]].segment[s]&&o.push({x1:e[i[r]].x,y1:e[i[r]].y,x2:e[i[r+1]].x,y2:e[i[r+1]].y,segment:e[i[r+1]].segment[t]});o=o.filter(((e,t,i)=>i.findIndex((t=>e.segment===t.segment))===t));let n=[],a=[];for(let r=0;r<o.length;r++){let e,t=[],i=o[r];e=r<o.length-1?o[r+1]:o[0];let l=Math.atan2(i.y2-i.y1,i.x2-i.x1),h=Math.atan2(e.y2-e.y1,e.x2-e.x1),c=this.mainComponentThis.WALLS[i.segment].thick/2*Math.sin(l),d=this.mainComponentThis.WALLS[i.segment].thick/2*Math.cos(l),p=this.mainComponentThis.WALLS[e.segment].thick/2*Math.sin(h),m=this.mainComponentThis.WALLS[e.segment].thick/2*Math.cos(h),u=Lt(i.x1+c,i.y1-d,i.x2+c,i.y2-d),g=Lt(i.x1-c,i.y1+d,i.x2-c,i.y2+d),f=Lt(e.x1+p,e.y1-m,e.x2+p,e.y2-m),b=Lt(e.x1-p,e.y1+m,e.x2-p,e.y2+m);l*=180/Math.PI,h*=180/Math.PI,u.A!==f.A?(t.push(Tt(u,f,"object")),t.push(Tt(g,b,"object"))):(t.push({x:i.x2+c,y:i.y2-d}),t.push({x:i.x2-c,y:i.y2+d}));for(let o=0;o<t.length;o++)jt(t[o],s)?n.push(t[o]):a.push(t[o])}return n.push(n[0]),a.push(a[0]),{inside:n,outside:a}}area(e){if(e.length<2)return!1;let t=0,i=e.length-1;for(let o=0;o<e.length;o++)t+=(e[i].x+e[o].x)*(e[i].y-e[o].y),i=o;return t/=2,Math.abs(t.toFixed(2))}areaRoom(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,o=t,s=0,n=o.length-2;for(let a=0;a<o.length-1;a++)s+=(e[o[n]].x+e[o[a]].x)*(e[o[n]].y-e[o[a]].y),n=a;return s/=2,Math.abs(s.toFixed(i))}junctionList(e){let t=[],i=[];for(let s=0;s<e.length;s++){let o=Lt(e[s].start.x,e[s].start.y,e[s].end.x,e[s].end.y);for(let n=0;n<e.length;n++)if(n!==s){let a,r=Lt(e[n].start.x,e[n].start.y,e[n].end.x,e[n].end.y);(a=Tt(o,r,"object"))&&(xt(e[s].end,e[n].start)||xt(e[s].start,e[n].end)?(xt(e[s].end,e[n].start)&&t.push({segment:s,child:n,values:[e[n].start.x,e[n].start.y],type:"natural"}),xt(e[s].start,e[n].end)&&t.push({segment:s,child:n,values:[e[s].start.x,e[s].start.y],type:"natural"})):this.btwn(a.x,e[s].start.x,e[s].end.x,"round")&&this.btwn(a.y,e[s].start.y,e[s].end.y,"round")&&this.btwn(a.x,e[n].start.x,e[n].end.x,"round")&&this.btwn(a.y,e[n].start.y,e[n].end.y,"round")&&t.push({segment:s,child:n,values:[a.x,a.y],type:"intersection"})),Math.abs(o.A)!==Math.abs(r.A)&&o.A!==r.A||o.B!==r.B||(xt(e[s].end,e[n].start)&&t.push({segment:s,child:n,values:[e[n].start.x,e[n].start.y],type:"natural"}),xt(e[s].start,e[n].end)&&t.push({segment:s,child:n,values:[e[s].start.x,e[s].start.y],type:"natural"}),xt(e[s].start,e[n].start)&&xt(e[s].end,e[n].end)||(xt(e[s].start,e[n].start)?i.push({segment:s,child:n,values:[e[s].start.x,e[s].start.y],type:"natural"}):xt(e[s].end,e[n].end)&&i.push({segment:s,child:n,values:[e[s].end.x,e[s].end.y],type:"natural"})))}}let o=i.filter((e=>!t.find((t=>xt({x:e.values[0],y:e.values[1]},{x:t.values[0],y:t.values[1]})))));for(let s=0;s<o.length;s++)t.push(o[s]);return t}vertexList(e){let t,i=[];for(let o=0;o<e.length;o++){t=!0;for(let s=0;s<i.length;s++){if(Math.round(e[o].values[0])===Math.round(i[s].x)&&Math.round(e[o].values[1])===Math.round(i[s].y)){t=!1,i[s].segment.push(e[o].segment);break}t=!0}t&&i.push({x:Math.round(e[o].values[0]),y:Math.round(e[o].values[1]),realX:e[o].values[0],realY:e[o].values[1],segment:[e[o].segment],bypass:0,type:e[o].type})}for(let o=0;o<i.length;o++){i[o].child=[],i[o].removed=[];for(let e=0;e<i[o].segment.length;e++)for(let t=0;t<i.length;t++)if(t!==o)for(let s=0;s<i[t].segment.length;s++)i[t].segment[s]===i[o].segment[e]&&i[o].child.push({id:t,angle:Math.floor(this.getAngle(i[o],i[t]).deg)})}return i}arrayCompare(e,t,i){let o=0,s=0;"pop"===i&&(o=1),"shift"===i&&(s=1);let n=e.length-o-s;for(let a=s;a<e.length-o;a++)for(let i=s;i<t.length-o;i++)e[a]===t[i]&&n--;return 0===n}vectorVertex(e,t,i){let o=this.vectorXY(e,t),s=this.vectorXY(t,i),n=Math.sqrt(o.x*o.x+o.y*o.y),a=Math.sqrt(s.x*s.x+s.y*s.y),r=(o.x*s.x+o.y*s.y)/(n*a),l=o.x*s.y-o.y*s.x;return Math.sign(l)*Math.acos(r)*(180/Math.PI)}segmentTree(e,t){let i=[e],o=[],s=t.length,n=e;return this.tree(i,n,s,t,o),o}tree(e,t,i,o,s){if(0===e.length)return;let n=[];i--;for(let a=0;a<e.length;a++){let r=!0,l=e[a],h=l.toString().split("-"),c=parseInt(h[h.length-1]);for(let e=0;e<o[c].child.length;e++)if(o[c].child[e].id===t&&i<o.length-1&&h.length>2){s.push(l+"-"+t),r=!1;break}if(r){let e=-1,s=1/0,a=0,r=0;if(1===o[c].child.length)c===t&&i===o.length-1&&n.push(l+"-"+o[c].child[0].id),c!==t&&i<o.length-1&&n.push(l+"-"+o[c].child[0].id);else{for(let n=0;n<o[c].child.length&&o[c].child.length>0;n++){if(c===t&&i===o.length-1){let t=this.vectorVertex({x:0,y:-1},o[c],o[o[c].child[n].id]);t>=a&&(r=1,a=t,e=o[c].child[n].id),-1===Math.sign(t)&&0===r&&(t<s&&Math.sign(s)>-1&&(s=t,e=o[c].child[n].id),t>s&&-1===Math.sign(s)&&(s=t,e=o[c].child[n].id))}if(c!==t&&h[h.length-2]!==o[c].child[n].id.toString()&&i<o.length-1){let t=this.vectorVertex(o[h[h.length-2]],o[c],o[o[c].child[n].id]);t<s&&0===r&&(s=t,e=o[c].child[n].id),-1===Math.sign(t)&&(r=1,t<=s&&(s=t,e=o[c].child[n].id))}}-1!==e&&n.push(l+"-"+e)}}}i>0&&this.tree(n,t,i,o,s)}polygonize(e){let t=this.junctionList(e),i=this.vertexList(t,e),o=[];for(let g=0;g<i.length;g++)for(let e=0;e<i[g].child.length;e++)o.push([g,i[g].child[e].id]);let s,n,a=[];for(let g=0;g<o.length;g++){let e=0,t=1/0;for(let o=0;o<i.length;o++)i[o].x<t&&i[o].child.length>1&&0===i[o].bypass&&(t=i[o].x,e=o),i[o].x===t&&i[o].child.length>1&&0===i[o].bypass&&i[o].y>i[e].y&&(t=i[o].x,e=o);if(s=this.segmentTree(e,i),0===s.length&&(i[e].bypass=1),s.length>0){let t=s[0].split("-"),o=this.areaRoom(i,t),l=parseInt(o);n=!0;for(let s=0;s<a.length;s++)if(this.arrayCompare(a[s].way,t,"pop")){n=!1,i[e].bypass=1;break}if(l<360&&(i[e].bypass=1),0===i[e].bypass){let o=this.polygonIntoWalls(i,t),s=this.area(o.inside),n=this.area(o.outside),h=[];for(let e=0;e<t.length;e++)h.push({x:i[t[e]].x,y:i[t[e]].y,realX:i[t[e]].realX,realY:i[t[e]].realY});o.inside.length!==o.outside.length?a.push({way:t,coords:h,coordsOutside:o.outside,coordsInside:o.inside,coordsInsideWithOrphans:o.inside,area:s,outsideArea:n,realArea:l}):a.push({way:t,coords:o.inside,coordsOutside:o.outside,coordsInside:o.inside,coordsInsideWithOrphans:o.inside,area:s,outsideArea:n,realArea:l});for(let a=0;a<i[e].child.length;a++)i[e].child[a].id===t[1]&&i[e].child.splice(a,1);for(let a=0;a<i[t[1]].child.length;a++)i[t[1]].child[a].id===e&&i[t[1]].child.splice(a,1);do{Oo.log("Do while loop");var r=0;for(let e=0;e<i.length;e++)if(1===i[e].child.length){r=1,i[e].child=[];for(let t=0;t<i.length;t++)for(let o=0;o<i[t].child.length;o++)i[t].child[o].id===e&&i[t].child.splice(o,1)}}while(1===r)}}}Oo.log(a);let l=[];for(let g=0;g<a.length;g++){let e=[],t=[];for(let i=0;i<a.length;i++)if(g!==i){let o=a[i].coordsInsideWithOrphans,s=o.length;n=!0;for(let e=0;e<s&&(n=Dt(o[e],a[g].coordsInsideWithOrphans),n);e++);n&&(e.push(i),t.push(a[i]),a[g].area=a[g].area-a[i].outsideArea)}a[g].inside=e,a[g].insidePolygonsObjects=t,e.length>0&&l.push({polygon:a[g],polygonIndex:g})}let h={};Oo.log("insidePolygons "+l.length),Oo.log(l);for(let g=0;g<l.length;g++)if(void 0===h[l[g].polygonIndex]){let e=!1,t=[];for(let i=0;i<l.length;i++)g!==i&&0===this.diffObjIntoArray(l[g].polygon.coordsInsideWithOrphans,l[i].polygon.coordsInsideWithOrphans)&&(e=!0,h[l[i].polygonIndex]=i,t.push(l[i].polygonIndex));if(e){let e;for(let i=0;i<t.length;i++)(e=l[g].polygon.inside.findIndex((e=>e===t[i])))&&(l[g].polygon.inside.splice(e,1),l[g].polygon.insidePolygonsObjects.splice(e,1))}}const c=Object.keys(h);let d=[],p=[];for(let g=0;g<c.length;g++)d.push(c[g]),p.push(h[c[g]]);p.sort(((e,t)=>t-e));for(let g=0;g<p.length;g++)Oo.log("Delete duplicate inside polygon index "+p[g]),l.splice(p[g],1);let m=[],u={};for(let g=0;g<l.length;g++)if(l[g].polygon.inside.length>0){let e=!1,t={};l[g].polygon.coordsInsideWithOrphans.forEach((e=>t["".concat(e.x,"|").concat(e.y)]=!0));for(let i=0;i<l[g].polygon.inside.length;i++){if(0!==a[l[g].polygon.inside[i]].coordsInsideWithOrphans.filter((e=>t["".concat(e.x,"|").concat(e.y)])).length){Oo.log("Pronadene zajednicke koordinate s inside poligonom"+g),e=!0;break}{let t=!1;for(let e=0;e<a[l[g].polygon.inside[i]].coordsInsideWithOrphans.length;e++)if(!jt(a[l[g].polygon.inside[i]].coordsInsideWithOrphans[e],l[g].polygon.coordsInsideWithOrphans)){t=!0;break}if(t){Oo.log("Pronadene tocke inside poligona koje nisu unutar glavnoga"+g),e=!0;break}}}e||(Oo.log("Nemoj brisati poligon "+g),m.push(l[g].polygon))}d.sort(((e,t)=>t-e));for(let g=0;g<d.length;g++)a.splice(d[g],1);if(d.length>0)for(let g=0;g<m.length;g++){for(let e=0;e<m[g].inside.length;e++)m[g].inside[e]=a.findIndex((t=>t===m[g].insidePolygonsObjects[e]));delete m[g].insidePolygonsObjects}for(let g=0;g<m.length;g++)u[a.findIndex((e=>e===m[g]))]=!0;return{polygons:a,vertex:i,roomsWithInsideRoomsNoDeleteIndexes:u}}diffArray(e,t){return e.concat(t).filter((i=>e.includes(i)&&t.includes(i)?void 0:i))}diffObjIntoArray(e,t){let i=0;for(let s=0;s<e.length-1;s++)for(let o=0;o<t.length-1;o++)gt(e[s],t[o])&&i++;let o=e.length-1;return o<t.length-1&&(o=t.length),o-i}polygonVisualCenter(e){let t,i,o,s,n=e.coordsInsideWithOrphans,a=e.inside,r=[];for(let u=0;u<n.length;u++){let e=n[u];(!u||e.x<t)&&(t=e.x),(!u||e.y<i)&&(i=e.y),(!u||e.x>o)&&(o=e.x),(!u||e.y>s)&&(s=e.y)}let l=o-t,h=s-i,c=Math.floor(l/10),d=Math.floor(h/10);for(let u=0;u<10;u++)for(let e=0;e<10;e++){let o=t+e*c,s=i+u*d;if(jt({x:o,y:s},n)){let e=!0;for(let t=0;t<a.length;t++)if(jt({x:o,y:s},this.mainComponentThis.ROOM[a[t]].coordsOutside)){e=!1;break}e&&r.push({x:o,y:s})}}let p,m=0;for(let u=0;u<r.length;u++){let e=1/0;for(let t=0;t<n.length-1;t++){let i=this.pDistance(r[u],n[t],n[t+1]);i.distance<e&&(e=i.distance)}e>m&&(p=u,m=e)}return r[p]}textOnDiv(e,t,i,o){if("undefined"!=typeof t){let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttributeNS(null,"x",t.x),s.setAttributeNS(null,"y",t.y),s.setAttribute("style","fill:"+i.color+";font-weight:"+i.fontWeight+";font-size:"+i.fontSize),s.setAttributeNS(null,"text-anchor","middle"),s.textContent=e,Oo.log("Text ond div"),o.appendChild(s)}}mirrorPointAroundLine(e,t,i){let o,s;if("v"===i.A)o=2*i.B-e,s=t;else if("h"===i.A)o=e,s=2*i.B-t;else{const n=i.A,a=i.B,r=n*n+1;o=(e+n*(t-a))/r,s=(n*e+n*n*t/r+a)/r}return{x:o,y:s}}polygonPolygonIntersect(e,t){for(var i=0;i<e.length;i++){var o,s=e[i];if(o=i==e.length-1?e[0]:e[i+1],!xt(s,o)&&this.linePolygonIntersect(s.x,s.y,o.x,o.y,t))return!0}return!1}linePolygonIntersect(e,t,i,o,s){for(var n=0;n<s.length;n++){var a,r=s[n];if(a=n==s.length-1?s[0]:s[n+1],this.lineLineIntersect(e,t,i,o,r.x,r.y,a.x,a.y))return!0}return!1}lineLineIntersect(e,t,i,o,s,n,a,r){const l=(e,t,i)=>{var o=e.x,s=e.y,n=t.x,a=t.y,r=i.x;return(i.y-s)*(n-o)>(a-s)*(r-o)};var h={x:e,y:t},c={x:i,y:o},d={x:s,y:n},p={x:a,y:r};return l(h,d,p)!=l(c,d,p)&&l(h,c,d)!=l(h,c,p)}};var Po=i(4916);const Fo=class{constructor(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Unknown",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.wallId=(0,Po.v4)(),this.thick=o,this.start=e,this.end=t,this.type=i,this.parent=null,this.child=null,this.angle=0,this.equations={},this.coords=[],this.backUp=!1,this.material=n?n.material:s,this.interiorPlaneMaterial=n?n.interiorPlaneMaterial:"Color"===s?se[0].defaultColorValue:s,this.exteriorPlaneMaterial=n?n.exteriorPlaneMaterial:"Color"===s?se[1].defaultColorValue:s}};var Ao=i(1317);const Wo=class{constructor(e,t,i,o,s,n,a,r,l){var h=this;this.createAndShowBoxMeasures=function(e,t,i,o,s){let n,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},r=t-e,l=o-i,c=(t-e)/h.mainComponentThis.meter,d=(o-i)/h.mainComponentThis.meter,p="m"+(t+40)+","+i;p+=" l60,0 m-40,10 l10,-10 l10,10 m-10,-10",p=p+" l0,"+l,p+=" m-30,0 l60,0 m-40,-10 l10,10 l10,-10",p=p+"M"+e+","+(i-40),p+=" l0,-60 m10,40 l-10,-10 l10,-10 m-10,10",p=p+" l"+r+",0",p+=" m0,30 l0,-60 m-10,40 l10,-10 l-10,-10",mt(s.current),h.mainComponentThis.qSVG.create(s,"path",{d:p,stroke:a.color||"#555",fill:"none","stroke-width":a.strokeWidth||.5,"stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":4,"fill-rule":"nonzero"}),n=document.createElementNS("http://www.w3.org/2000/svg","text"),n.setAttributeNS(null,"x",t+70),n.setAttributeNS(null,"y",(o+i)/2+35),n.setAttributeNS(null,"fill",a.color||"#555"),n.setAttributeNS(null,"text-anchor","middle"),n.textContent=Ft(d,h.mainComponentThis.measureSystemContext.userUnit,"meter","feet",2,!0,!0),n.setAttribute("transform","rotate(270 "+(t+70)+","+(o+i)/2+")"),s.current.appendChild(n),n=document.createElementNS("http://www.w3.org/2000/svg","text"),n.setAttributeNS(null,"x",(t+e)/2),n.setAttributeNS(null,"y",i-95),n.setAttributeNS(null,"fill",a.color||"#555"),n.setAttributeNS(null,"text-anchor","middle"),n.textContent=Ft(c,h.mainComponentThis.measureSystemContext.userUnit,"meter","feet",2,!0,!0),s.current.appendChild(n)},this.isStartStopWallPoint=(e,t)=>{const i=T(e.x,0),o=T(e.y,0),s=T(t.start.x,0),n=T(t.start.y,0),a=T(t.end.x,0),r=T(t.end.y,0);return i===s&&o===n||i===a&&o===r},this.sliceWall=(e,t)=>{let i=new Fo(t.start,e,"normal",t.thick,t.material,t);i.equations.base=t.equations.base;let o=new Fo(e,t.end,"normal",t.thick,t.material,t);return o.equations.base=t.equations.base,[i,o]},this.onWallAddedSlicing=e=>{let t=[e],i=[],o={};if(e.equations.base){for(let e=0;e<t.length;e++){let s=!1;for(let n=0;n<this.mainComponentThis.WALLS.length-1;n++)if(o[n])Ao.log("Zid vec presijecen");else if(this.mainComponentThis.WALLS[n].equations.base){const a=Tt(t[e].equations.base,this.mainComponentThis.WALLS[n].equations.base,"object");if(a&&this.mainComponentThis.qSVG.btwn(a.x,t[e].start.x,t[e].end.x,"round")&&this.mainComponentThis.qSVG.btwn(a.y,t[e].start.y,t[e].end.y,"round")&&this.mainComponentThis.qSVG.btwn(a.x,this.mainComponentThis.WALLS[n].start.x,this.mainComponentThis.WALLS[n].end.x,"round")&&this.mainComponentThis.qSVG.btwn(a.y,this.mainComponentThis.WALLS[n].start.y,this.mainComponentThis.WALLS[n].end.y,"round")){if(o[n]=!0,!this.isStartStopWallPoint(a,t[e])){Ao.log("Sijeci zid koji se obraduje");const o=this.sliceWall(a,t[e],null);if(t.push(o[0],o[1]),this.isStartStopWallPoint(a,this.mainComponentThis.WALLS[n]))i.push(this.mainComponentThis.WALLS[n]);else{Ao.log("SIjeci postojeci 2"),i=i.filter((e=>e!==this.mainComponentThis.WALLS[n]));const e=this.sliceWall(a,this.mainComponentThis.WALLS[n]);i.push(e[0],e[1])}s=!0;break}if(this.isStartStopWallPoint(a,this.mainComponentThis.WALLS[n]))Ao.log("Ne sijeci postojeci"),i.push(this.mainComponentThis.WALLS[n]);else{Ao.log("Sijeci postojeci"),i=i.filter((e=>e!==this.mainComponentThis.WALLS[n]));const e=this.sliceWall(a,this.mainComponentThis.WALLS[n]);i.push(e[0],e[1])}Ao.log(i)}else Ao.log("Ne sijeku se"),i.push(this.mainComponentThis.WALLS[n])}else Ao.log("Nema equation"),i.push(this.mainComponentThis.WALLS[n]);!s&&i.push(t[e])}i=i.filter(((e,t,i)=>i.findIndex((t=>e===t))===t))}else i=this.mainComponentThis.WALLS;Ao.log("Final wals after slicing"),Ao.log(i),this.mainComponentThis.WALLS=i},this.removeZeroLengthWallsAndSliceExistingWalls=()=>{Ao.log("Walls count before filtering zero length "+this.mainComponentThis.WALLS.length);let e=this.mainComponentThis.WALLS.filter((e=>!xt(e.start,e.end)));this.mainComponentThis.WALLS=[],Ao.log("Walls count before slicing "+e.length);for(let t=0;t<e.length;t++)this.mainComponentThis.WALLS.push(e[t]),this.onWallAddedSlicing(e[t]);Ao.log("Walls count befotre filtering duplicates"+this.mainComponentThis.WALLS.length),this.mainComponentThis.WALLS=this.mainComponentThis.WALLS.filter(((e,t,i)=>i.findIndex((t=>xt(e.start,t.start)&&xt(e.end,t.end)))===t)),Ao.log("Walls count after filtering duplicates"+this.mainComponentThis.WALLS.length)},this.boxWall=e,this.boxArea=t,this.panel=i,this.boxRoom=o,this.boxSurface=s,this.boxRib=n,this.areaValue=a,this.boxScale=r,this.mainComponentThis=l}getWallNode(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];for(let o in this.mainComponentThis.WALLS)gt(this.mainComponentThis.WALLS[o],t)||(gt(this.mainComponentThis.WALLS[o].start,e)&&i.push({wall:this.mainComponentThis.WALLS[o],type:"start"}),gt(this.mainComponentThis.WALLS[o].end,e)&&i.push({wall:this.mainComponentThis.WALLS[o],type:"end"}));return 0!==i.length&&i}wallsComputing(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];mt(this.boxWall.current),mt(this.boxWall.current);for(let o=0;o<e.length;o++)t=e[o],null!=t.parent&&(gt(t.parent.start,t.start)||gt(t.parent.end,t.start)||(t.parent=null)),null!=t.child&&(gt(t.child.start,t.end)||gt(t.child.end,t.end)||(t.child=null));for(let o=0;o<e.length;o++){let s,n,a,r,l,h;if(t=e[o],null!=t.parent)gt(t.parent.start,t.start)&&(s=t.parent,n=s.end,a=s.start),gt(t.parent.end,t.start)&&(s=t.parent,n=s.start,a=s.end);else{let e=this.getWallNode(t.start,t);for(let o in e){let r=this.createEquationFromWall(e[o].wall),l=90;"move"===i&&(l=this.mainComponentThis.qSVG.angleBetweenEquations(r.A,this.mainComponentThis.equation2.A)),"start"===e[o].type&&null==e[o].wall.parent&&l>20&&l<160&&(t.parent=e[o].wall,e[o].wall.parent=t,s=t.parent,n=s.end,a=s.start),"end"===e[o].type&&null==e[o].wall.child&&l>20&&l<160&&(t.parent=e[o].wall,e[o].wall.child=t,s=t.parent,n=s.start,a=s.end)}}if(null!=t.child)gt(t.child.end,t.end)?(r=t.child,l=r.end,h=r.start):(r=t.child,l=r.start,h=r.end);else{let e=this.getWallNode(t.end,t);for(let o in e){let s=this.createEquationFromWall(e[o].wall),n=90;"move"===i&&(n=this.mainComponentThis.qSVG.angleBetweenEquations(s.A,this.mainComponentThis.equation2.A)),"end"===e[o].type&&null==e[o].wall.child&&n>20&&n<160&&(t.child=e[o].wall,e[o].wall.child=t,r=t.child,l=r.end,h=r.start),"start"===e[o].type&&null==e[o].wall.parent&&n>20&&n<160&&(t.child=e[o].wall,e[o].wall.parent=t,r=t.child,l=r.start,h=r.end)}}let c=Math.atan2(t.end.y-t.start.y,t.end.x-t.start.x);t.angle=c;let d,p,m,u,g=t.thick/2*Math.sin(c),f=t.thick/2*Math.cos(c),b=Lt(t.start.x+g,t.start.y-f,t.end.x+g,t.end.y-f),x=Lt(t.start.x-g,t.start.y+f,t.end.x-g,t.end.y+f),C=Lt(t.start.x,t.start.y,t.end.x,t.end.y);if(t.equations={up:b,down:x,base:C},null==t.parent)p=this.mainComponentThis.qSVG.perpendicularEquation(b,t.start.x,t.start.y),m=Tt(b,p,"object"),u=Tt(x,p,"object"),t.coords=[m,u],d="M"+m.x+","+m.y+" L"+u.x+","+u.y+" ";else{let e=this.mainComponentThis.qSVG.perpendicularEquation(b,t.start.x,t.start.y),i=Math.atan2(a.y-n.y,a.x-n.x),o=s.thick/2*Math.sin(i),r=s.thick/2*Math.cos(i),l=Lt(n.x+o,n.y-r,a.x+o,a.y-r),h=Lt(n.x-o,n.y+r,a.x-o,a.y+r);if(Math.abs(i-c)>.09){m=Tt(b,l,"object"),u=Tt(x,h,"object"),b.A===l.A&&(m={x:t.start.x+g,y:t.start.y-f},u={x:t.start.x-g,y:t.start.y+f}),this.mainComponentThis.qSVG.gap(m,{x:a.x,y:a.y})>1e3&&(m=Tt(e,b,"object"),u=Tt(e,x,"object"))}Math.abs(i-c)<=.09&&(m=Tt(e,b,"object"),u=Tt(e,x,"object")),t.coords=[m,u],d="M"+m.x+","+m.y+" L"+u.x+","+u.y+" "}if(null==t.child)p=this.mainComponentThis.qSVG.perpendicularEquation(b,t.end.x,t.end.y),m=Tt(b,p,"object"),u=Tt(x,p,"object"),t.coords.push(u,m),d=d+"L"+u.x+","+u.y+" L"+m.x+","+m.y+" Z";else{let e=this.mainComponentThis.qSVG.perpendicularEquation(b,t.end.x,t.end.y),i=Math.atan2(h.y-l.y,h.x-l.x),o=r.thick/2*Math.sin(i),s=r.thick/2*Math.cos(i),n=Lt(l.x+o,l.y-s,h.x+o,h.y-s),a=Lt(l.x-o,l.y+s,h.x-o,h.y+s);if(Math.abs(i-c)>.09){m=Tt(b,n,"object"),u=Tt(x,a,"object"),b.A===n.A&&(m={x:t.end.x+g,y:t.end.y-f},u={x:t.end.x-g,y:t.end.y+f}),this.mainComponentThis.qSVG.gap(m,{x:l.x,y:l.y})>1e3&&(m=Tt(b,e,"object"),u=Tt(x,e,"object"))}Math.abs(i-c)<=.09&&(m=Tt(b,e,"object"),u=Tt(x,e,"object")),t.coords.push(u,m),d=d+"L"+u.x+","+u.y+" L"+m.x+","+m.y+" Z"}t.graph=this.makeWall(d,t.material),this.boxWall.current.appendChild(t.graph)}}makeWall(e){return this.mainComponentThis.qSVG.create("none","path",{d:e,stroke:"none",fill:"#666666","stroke-width":1,"stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":4,"fill-rule":"nonzero"})}architect(e){return this.wallsComputing(e),this.mainComponentThis.Rooms=this.mainComponentThis.qSVG.polygonize(e),mt(this.boxRoom.current),mt(this.boxSurface.current),this.roomMaker(this.mainComponentThis.Rooms),!0}nearWallNode(e){let t,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],n=1/0;for(let a=0;a<this.mainComponentThis.WALLS.length;a++)if(-1===s.indexOf(this.mainComponentThis.WALLS[a])){let o=this.mainComponentThis.WALLS[a].start,s=this.mainComponentThis.WALLS[a].end,r=Mt(o,e);r<n&&(t=o,n=r,i=a),r=Mt(s,e),r<n&&(t=s,n=r,i=a)}return n<=o&&{x:t.x,y:t.y,bestWall:i}}rayCastingWall(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];for(let o=0;o<this.mainComponentThis.WALLS.length;o++)if(4===this.mainComponentThis.WALLS[o].coords.length){let t=[];for(let e=0;e<4;e++)t.push({x:this.mainComponentThis.WALLS[o].coords[e].x,y:this.mainComponentThis.WALLS[o].coords[e].y});jt(e,t)&&i.push(this.mainComponentThis.WALLS[o])}return 0!==i.length&&(t||1===i.length?i[0]:i)}stickOnWall(e){if(0===this.mainComponentThis.WALLS.length)return!1;let t=1/0,i={};if(0===this.mainComponentThis.WALLS.length)return!1;for(let s=0;s<this.mainComponentThis.WALLS.length;s++){let o=Lt(this.mainComponentThis.WALLS[s].coords[0].x,this.mainComponentThis.WALLS[s].coords[0].y,this.mainComponentThis.WALLS[s].coords[3].x,this.mainComponentThis.WALLS[s].coords[3].y),n=this.mainComponentThis.qSVG.nearPointOnEquation(o,e),a=Lt(this.mainComponentThis.WALLS[s].coords[1].x,this.mainComponentThis.WALLS[s].coords[1].y,this.mainComponentThis.WALLS[s].coords[2].x,this.mainComponentThis.WALLS[s].coords[2].y),r=this.mainComponentThis.qSVG.nearPointOnEquation(a,e);n.distance<t&&this.mainComponentThis.qSVG.btwn(n.x,this.mainComponentThis.WALLS[s].coords[0].x,this.mainComponentThis.WALLS[s].coords[3].x)&&this.mainComponentThis.qSVG.btwn(n.y,this.mainComponentThis.WALLS[s].coords[0].y,this.mainComponentThis.WALLS[s].coords[3].y)&&(t=n.distance,i={wall:this.mainComponentThis.WALLS[s],x:n.x,y:n.y,distance:n.distance}),r.distance<t&&this.mainComponentThis.qSVG.btwn(r.x,this.mainComponentThis.WALLS[s].coords[1].x,this.mainComponentThis.WALLS[s].coords[2].x)&&this.mainComponentThis.qSVG.btwn(r.y,this.mainComponentThis.WALLS[s].coords[1].y,this.mainComponentThis.WALLS[s].coords[2].y)&&(t=r.distance,i={wall:this.mainComponentThis.WALLS[s],x:r.x,y:r.y,distance:r.distance})}let o=this.nearVertice(e);if(o.distance<t){let e=Lt(o.number.coords[0].x,o.number.coords[0].y,o.number.coords[3].x,o.number.coords[3].y),s=this.mainComponentThis.qSVG.nearPointOnEquation(e,o),n=Lt(o.number.coords[1].x,o.number.coords[1].y,o.number.coords[2].x,o.number.coords[2].y),a=this.mainComponentThis.qSVG.nearPointOnEquation(n,o);s.distance<t&&this.mainComponentThis.qSVG.btwn(s.x,o.number.coords[0].x,o.number.coords[3].x)&&this.mainComponentThis.qSVG.btwn(s.y,o.number.coords[0].y,o.number.coords[3].y)&&(t=s.distance,i={wall:o.number,x:s.x,y:s.y,distance:s.distance}),a.distance<t&&this.mainComponentThis.qSVG.btwn(a.x,o.number.coords[1].x,o.number.coords[2].x)&&this.mainComponentThis.qSVG.btwn(a.y,o.number.coords[1].y,o.number.coords[2].y)&&(t=a.distance,i={wall:o.number,x:a.x,y:a.y,distance:a.distance})}return i}objFromWall(e){let t=[];for(let i=0;i<this.mainComponentThis.OBJDATA.length;i++){let o;if("inWall"===this.mainComponentThis.OBJDATA[i].family||"onWall"===this.mainComponentThis.OBJDATA[i].family){let s=Lt(e.start.x,e.start.y,e.end.x,e.end.y);o=this.mainComponentThis.qSVG.nearPointOnEquation(s,this.mainComponentThis.OBJDATA[i]),o.distance<.01&&this.mainComponentThis.qSVG.btwn(this.mainComponentThis.OBJDATA[i].x,e.start.x,e.end.x)&&this.mainComponentThis.qSVG.btwn(this.mainComponentThis.OBJDATA[i].y,e.start.y,e.end.y)&&t.push(this.mainComponentThis.OBJDATA[i])}}return t}createEquationFromWall(e){return Lt(e.start.x,e.start.y,e.end.x,e.end.y)}rayCastingWalls(e){let t=[];for(let i=0;i<this.mainComponentThis.WALLS.length;i++)if(4===this.mainComponentThis.WALLS[i].coords.length){let o=[];for(let e=0;e<4;e++)o.push({x:this.mainComponentThis.WALLS[i].coords[e].x,y:this.mainComponentThis.WALLS[i].coords[e].y});jt(e,o)&&t.push(this.mainComponentThis.WALLS[i])}return 0!==t.length&&(1===t.length?t[0]:t)}inWallRib2(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Ao.log("In wall rib2 pozvan"),t||mt(this.boxRib.current);let i,o=[],s=[];o.push(s),o.push(s);let n=e.angle*(180/Math.PI),a=this.objFromWall(e);o[0].push({wall:e,crossObj:!1,side:"up",coords:e.coords[0],distance:0}),o[1].push({wall:e,crossObj:!1,side:"down",coords:e.coords[1],distance:0});for(let r in a){let t=a[r];t.up=[this.mainComponentThis.qSVG.nearPointOnEquation(e.equations.up,t.limit[0]),this.mainComponentThis.qSVG.nearPointOnEquation(e.equations.up,t.limit[1])],t.down=[this.mainComponentThis.qSVG.nearPointOnEquation(e.equations.down,t.limit[0]),this.mainComponentThis.qSVG.nearPointOnEquation(e.equations.down,t.limit[1])],i=Mt(e.coords[0],t.up[0])/this.mainComponentThis.meter,o[0].push({wall:e,crossObj:r,side:"up",coords:t.up[0],distance:i.toFixed(2)}),i=Mt(e.coords[0],t.up[1])/this.mainComponentThis.meter,o[0].push({wall:e,crossObj:r,side:"up",coords:t.up[1],distance:i.toFixed(2)}),i=Mt(e.coords[1],t.down[0])/this.mainComponentThis.meter,o[1].push({wall:e,crossObj:r,side:"down",coords:t.down[0],distance:i.toFixed(2)}),i=Mt(e.coords[1],t.down[1])/this.mainComponentThis.meter,o[1].push({wall:e,crossObj:r,side:"down",coords:t.down[1],distance:i.toFixed(2)})}i=Mt(e.coords[0],e.coords[3])/this.mainComponentThis.meter,o[0].push({wall:e,crossObj:!1,side:"up",coords:e.coords[3],distance:i}),i=Mt(e.coords[1],e.coords[2])/this.mainComponentThis.meter,o[1].push({wall:e,crossObj:!1,side:"down",coords:e.coords[2],distance:i}),o[0].sort((function(e,t){return(e.distance-t.distance).toFixed(2)})),o[1].sort((function(e,t){return(e.distance-t.distance).toFixed(2)}));for(let r in o)for(let e=1;e<o[r].length;e++){let t=!0,i=-5,s=Math.abs(o[r][e-1].distance-o[r][e].distance),a=n;if(t){"down"===o[r][e-1].side&&(i=10-i),(a>89||a<-89)&&(a-=180,i="down"===o[r][e-1].side?-5:10-i),this.mainComponentThis.sizeText[e]=document.createElementNS("http://www.w3.org/2000/svg","text");let t=this.mainComponentThis.qSVG.middle(o[r][e-1].coords.x,o[r][e-1].coords.y,o[r][e].coords.x,o[r][e].coords.y);this.mainComponentThis.sizeText[e].setAttributeNS(null,"x",t.x),this.mainComponentThis.sizeText[e].setAttributeNS(null,"y",t.y+i),this.mainComponentThis.sizeText[e].setAttributeNS(null,"text-anchor","middle"),this.mainComponentThis.sizeText[e].setAttributeNS(null,"font-family","roboto"),this.mainComponentThis.sizeText[e].setAttributeNS(null,"stroke","#ffffff"),this.mainComponentThis.sizeText[e].textContent=Ft(s,this.mainComponentThis.measureSystemContext.userUnit),this.mainComponentThis.sizeText[e].textContent<1?(this.mainComponentThis.sizeText[e].setAttributeNS(null,"font-size","0.8em"),this.mainComponentThis.sizeText[e].textContent=this.mainComponentThis.sizeText[e].textContent.substring(1,this.mainComponentThis.sizeText[e].textContent.length)):this.mainComponentThis.sizeText[e].setAttributeNS(null,"font-size","15px"),this.mainComponentThis.sizeText[e].setAttributeNS(null,"stroke-width","0.4px"),this.mainComponentThis.sizeText[e].setAttributeNS(null,"fill","#666666"),this.mainComponentThis.sizeText[e].setAttribute("transform","rotate("+a+" "+t.x+","+t.y+")"),this.boxRib.current.appendChild(this.mainComponentThis.sizeText[e])}}}areSamePolygons(e,t){let i=this.mainComponentThis.qSVG.diffObjIntoArray(e.coordsInsideWithOrphans||e.coordsInside,t.coordsInsideWithOrphans||t.coordsInside);if(e.way.length===t.way.length||0===i){if(0===this.mainComponentThis.qSVG.diffArray(e.way,t.way).length||0===i)return!0}else if(e.way.length===t.way.length+1){if(1===this.mainComponentThis.qSVG.diffArray(e.way,t.way).length||2===i)return!0}else if(e.way.length===t.way.length-1&&1===this.mainComponentThis.qSVG.diffArray(e.way,t.way).length)return!0;return!1}roomMaker(e){this.mainComponentThis.globalArea=0,0===e.polygons.length&&(this.mainComponentThis.ROOM=[]);for(let s=0;s<e.polygons.length;s++){let t=!1;for(let i=0;i<this.mainComponentThis.ROOM.length;i++)if(this.areSamePolygons(e.polygons[s],this.mainComponentThis.ROOM[i])){t=!0,this.mainComponentThis.ROOM[i].area=e.polygons[s].area,this.mainComponentThis.ROOM[i].realRoomArea=Pt(e.polygons[s]),this.mainComponentThis.ROOM[i].inside=e.polygons[s].inside,this.mainComponentThis.ROOM[i].insideNoDelete=e.roomsWithInsideRoomsNoDeleteIndexes[s],this.mainComponentThis.ROOM[i].coords=e.polygons[s].coords,this.mainComponentThis.ROOM[i].coordsOutside=e.polygons[s].coordsOutside,this.mainComponentThis.ROOM[i].way=e.polygons[s].way,this.mainComponentThis.ROOM[i].coordsInside=e.polygons[s].coordsInside,this.mainComponentThis.ROOM[i].coordsInsideWithOrphans=e.polygons[s].coordsInsideWithOrphans;break}t||(this.mainComponentThis.ROOM.push({id:this.mainComponentThis.roomIdCounter,coords:e.polygons[s].coords,coordsOutside:e.polygons[s].coordsOutside,coordsInside:e.polygons[s].coordsInside,coordsInsideWithOrphans:e.polygons[s].coordsInside,inside:e.polygons[s].inside,insideNoDelete:e.roomsWithInsideRoomsNoDeleteIndexes[s],way:e.polygons[s].way,area:e.polygons[s].area,realRoomArea:Pt(e.polygons[s]),surface:"",name:"",floorTexture:"none",showSurface:!1,action:"add"}),this.mainComponentThis.roomIdCounter++)}let t=[];for(let s=0;s<this.mainComponentThis.ROOM.length;s++)if(this.mainComponentThis.ROOM[s].inside.length>0&&!this.mainComponentThis.ROOM[s].insideNoDelete)t.push(s);else{let i=!1;for(let t=0;t<e.polygons.length;t++)if(this.areSamePolygons(e.polygons[t],this.mainComponentThis.ROOM[s])){i=!0;break}i||t.push(s)}t.sort((function(e,t){return t-e}));for(let s=0;s<t.length;s++)this.mainComponentThis.ROOM.splice(t[s],1);let i={};for(let s=0;s<this.mainComponentThis.ROOM.length;s++)if(!i[s])for(let e=0;e<this.mainComponentThis.ROOM.length;e++)s!==e&&this.areSamePolygons(this.mainComponentThis.ROOM[s],this.mainComponentThis.ROOM[e])&&(i[e]=!0);Ao.log("Duplicates to splice "+JSON.stringify(i));const o=Object.keys(i).sort(((e,t)=>t-e));for(let s=0;s<o.length;s++)this.mainComponentThis.ROOM.splice(o[s],1);Ao.log("EMpty elememts"),mt(this.boxRoom.current),mt(this.boxSurface.current),mt(this.boxArea.current);for(let s=0;s<this.mainComponentThis.ROOM.length;s++){"add"===this.mainComponentThis.ROOM[s].action&&(this.mainComponentThis.globalArea=this.mainComponentThis.globalArea+this.mainComponentThis.ROOM[s].realRoomArea);let e=this.mainComponentThis.ROOM[s].coords,t="M"+e[0].x+","+e[0].y;for(let s=1;s<e.length;s++)t=t+" L"+e[s].x+","+e[s].y;this.mainComponentThis.qSVG.create(this.boxRoom,"path",{d:t,fill:"none"!==this.mainComponentThis.ROOM[s].floorTexture?"url(#".concat(this.mainComponentThis.ROOM[s].floorTexture,")"):"none","fill-opacity":1,stroke:"none","fill-rule":"evenodd",class:"room"}),this.mainComponentThis.qSVG.create(this.boxSurface,"path",{d:t,fill:"none","fill-opacity":1,stroke:"none","fill-rule":"evenodd",class:"room"});let i,o=this.mainComponentThis.qSVG.polygonVisualCenter(this.mainComponentThis.ROOM[s]);""!==this.mainComponentThis.ROOM[s].name&&o&&(i={color:"#343938"},this.mainComponentThis.qSVG.textOnDiv(this.mainComponentThis.ROOM[s].name,o,i,this.mainComponentThis.boxArea.current)),""!==this.mainComponentThis.ROOM[s].name&&o&&(o.y=o.y+20),Ao.log("Area of room"),Ao.log(this.mainComponentThis.ROOM[s].realRoomArea),this.mainComponentThis.ROOM[s].realRoomArea<0&&Ao.log("Negative room surface"),i={color:"#343938",fontSize:"12.5px",fontWeight:"normal"},this.mainComponentThis.ROOM[s].surface&&(i.fontWeight="bold")}if(this.mainComponentThis.globalArea<=0)this.mainComponentThis.globalArea=0,this.areaValue.current.innerHTML="";else{const e=this.mainComponentThis.globalArea/(this.mainComponentThis.meter*this.mainComponentThis.meter);this.areaValue.current.innerHTML=Wt(e,this.mainComponentThis.measureSystemContext.userUnit,"square meter","square foot",2,!0,!1)}this.roomWallsClockwiseOrder(),Ao.log("Roomss"+this.mainComponentThis.ROOM.length),Ao.log(this.mainComponentThis.ROOM)}roomWallsClockwiseOrder(){let e=[];for(let i=0;i<this.mainComponentThis.ROOM.length;i++){Ao.log("Room"),Ao.log(this.mainComponentThis.ROOM[i]),Ao.log(this.mainComponentThis.WALLS);let t={x:this.mainComponentThis.ROOM[i].coords[0].realX,y:this.mainComponentThis.ROOM[i].coords[0].realY};const o=Ct(this.mainComponentThis.ROOM[i].coords);if(Ao.log("Is clockwise "+o),o){let o,s;Ao.log("Nastavi obilazak sobe u dosadasnjem smjeru");for(let n=0;n<this.mainComponentThis.ROOM[i].coords.length-1;n++)o=n,s=o===this.mainComponentThis.ROOM[i].coords.length-2?0:o+1,Ao.log("Wall "+o+" -> "+s),Ao.log("Cwstop before "+JSON.stringify(t)),t=this.roomWallsClockwiseOrderProcessWall(this.mainComponentThis.ROOM[i],o,s,e,t),Ao.log("Cwstop after "+JSON.stringify(t))}else{let o,s;Ao.log("Obrni smjer obilaska sobe");for(let n=0;n>=0&&(o=n,0===n?(s=this.mainComponentThis.ROOM[i].coords.length-2,n=this.mainComponentThis.ROOM[i].coords.length-1):s=o-1,Ao.log("Wall "+o+" -> "+s),Ao.log("Cwstop before "+JSON.stringify(t)),t=this.roomWallsClockwiseOrderProcessWall(this.mainComponentThis.ROOM[i],o,s,e,t),Ao.log("Cwstop after "+JSON.stringify(t)),1!==n);n--);}}this.mainComponentThis.ORPHANWALLS=[];let t=[];for(let i=0;i<this.mainComponentThis.WALLS.length;i++)if(!e.find((e=>e===this.mainComponentThis.WALLS[i]))){const e=It(this.mainComponentThis.WALLS[i].start,this.mainComponentThis.ROOM,!1),o=It(this.mainComponentThis.WALLS[i].end,this.mainComponentThis.ROOM,!1);let s;if(this.mainComponentThis.ORPHANWALLS.push({wall:this.mainComponentThis.WALLS[i],startRoom:e,endRoom:o}),e&&!o?s=e:!e&&o&&(s=o),s){let e=t.find((e=>e.room===s));e?e.orphanWalls.push(this.mainComponentThis.ORPHANWALLS[this.mainComponentThis.ORPHANWALLS.length-1]):t.push({room:s,orphanWalls:[this.mainComponentThis.ORPHANWALLS[this.mainComponentThis.ORPHANWALLS.length-1]]})}}Ao.log("Orphan walls count "+this.mainComponentThis.ORPHANWALLS.length),Ao.log("roomsWithSingleOrphanWalls count"+t.length),Ao.log(t),this.interpolateRoomCoordsInsideWithOrphanWalls(t)}interpolateRoomCoordsInsideWithOrphanWalls(e){for(let s=0;s<e.length;s++){let n=[];for(let r=0;r<e[s].room.coordsInside.length-1;r++)t=r,i=e[s].room.coordsInside,o=n,t===i.length-2?xt(i[t],i[0])||o.push(_t(i,t,0,!0)):xt(i[t],i[t+1])||o.push(_t(i,t,t+1,!0));let a=[...e[s].room.coordsInside];for(let t=0;t<e[s].orphanWalls.length;t++){Ao.log("Current orphan wall");let i=[],o=[];for(let n=0;n<e[s].orphanWalls[t].wall.coords.length;n++)ct(e[s].orphanWalls[t].wall.coords[n],e[s].orphanWalls[t].wall.equations.up,this.mainComponentThis.isPointOnWallDecimalPrecision)?i.push(e[s].orphanWalls[t].wall.coords[n]):o.push(e[s].orphanWalls[t].wall.coords[n]);Ao.log("Room coords before "+JSON.stringify(a)),Ao.log("Room coords up point"+JSON.stringify(i)),Ao.log("Room coords down point"+JSON.stringify(o));let r=[],l={intersectedRoomCoordsInsideWalls:[],upEquationWallNode1SpliceIndex:null,upEquationWallNode2SpliceIndex:null};if(this.orphanWallLineProcessing(e[s].orphanWalls[t].wall.equations.up,i,n,e[s].room.coordsInside,a,r,l,!0),this.orphanWallLineProcessing(e[s].orphanWalls[t].wall.equations.down,o,n,e[s].room.coordsInside,a,r,l,!1),null!==l.upEquationWallNode1SpliceIndex&&null!==l.upEquationWallNode2SpliceIndex&&4===r.length){let e=null;l.intersectedRoomCoordsInsideWalls.length>1?(Ao.log("Orphan izmedu 2 zida"),-1!==l.upEquationWallNode2SpliceIndex?(Ao.log("Interpoliraj wallNode2"),e=l.upEquationWallNode2SpliceIndex):Ao.log("Exception, nema wallNode2 indexa")):(Ao.log("Orphan na rubu"),xt(r[0],l.intersectedRoomCoordsInsideWalls[0].wallNode1,0)?-1!==l.upEquationWallNode1SpliceIndex?(Ao.log("Interpoliraj wallNode1"),e=l.upEquationWallNode1SpliceIndex):Ao.log("Exception, nema wallNode1 indexa"):xt(r[3],l.intersectedRoomCoordsInsideWalls[0].wallNode2,0)?-1!==l.upEquationWallNode2SpliceIndex?(Ao.log("Interpoliraj wallNode2"),e=l.upEquationWallNode2SpliceIndex):Ao.log("Exception, nema wallNode2 indexa"):Ao.log("Orphan na rubu interpolation exception")),null!==e&&a.splice(e,1,r[0],r[1],r[2],r[3]),Ao.log("Room coords after "+JSON.stringify(a))}else Ao.log("Orphan walls interpolation exception "+JSON.stringify(e[s].orphanWalls[t].wall.coords));Ao.log(l)}e[s].room.coordsInsideWithOrphans=a}var t,i,o}orphanWallLineProcessing(e,t,i,o,s,n,a,r){let l=t[0];jt(t[1],o)||(l=t[1]);let h=t.find((e=>e!==l));const c=pt(t[0],t[1]);for(let d=0;d<i.length;d++){const t=Tt(i[d].wallEquation,e,"object");if(t){Ao.log("Equation intersection "+JSON.stringify(t));const e=pt(i[d].wallNode1,i[d].wallNode2);if(dt(0,t.x,t.y,c,e)){a.intersectedRoomCoordsInsideWalls.find((e=>e===i[d]))||a.intersectedRoomCoordsInsideWalls.push(i[d]),Ao.log("Intersection coords inside wall"),Ao.log(i[d]),Ao.log("Pomjeri tocku orphan zida "+JSON.stringify(l)),l.x=t.x,l.y=t.y,Ao.log("Tocka orphan zida nakom pomjeranja "+JSON.stringify(l)),r?(n.push(l,h),a.upEquationWallNode1SpliceIndex=s.findIndex((e=>xt(e,i[d].wallNode1,0))),a.upEquationWallNode2SpliceIndex=s.findIndex((e=>xt(e,i[d].wallNode2,0)))):n.push(h,l);break}}}}roomWallsClockwiseOrderProcessWall(e,t,i,o,s){const n=_t(e.coords,t,i);Ao.log(n);let a=this.mainComponentThis.WALLS.find((e=>T(e.start.x,0)===T(n.wallNode1.realX,0)&&T(e.start.y,0)===T(n.wallNode1.realY,0)&&T(e.end.x,0)===T(n.wallNode2.realX,0)&&T(e.end.y,0)===T(n.wallNode2.realY,0)||T(e.start.x,0)===T(n.wallNode2.realX,0)&&T(e.start.y,0)===T(n.wallNode2.realY,0)&&T(e.end.x,0)===T(n.wallNode1.realX,0)&&T(e.end.y,0)===T(n.wallNode1.realY,0)));Ao.log(a);let r=s;return a?(Ao.log("Wall start "+JSON.stringify(a.start)+"wall end: "+JSON.stringify(a.end)),Ao.log(JSON.stringify(r)),Ao.log("Wall needs switch "+!xt(a.start,r,0)),Ao.log(o),Ao.log(!o.find((e=>e===a))),xt(a.start,r,0)?(!o.find((e=>e===a))&&o.push(a),r=a.end):o.find((e=>e===a))?r=a.start:(Ao.log(JSON.stringify(r)),Ao.log(JSON.stringify(a.start)),Ao.log("Obrnioo"),this.switchWallStartEnd(a),o.push(a),r=a.end)):(r={x:n.wallNode2.realX,y:n.wallNode2.realY},Ao.log("Nema target walla u roomWallsClockwiseOrderProcessWall"+JSON.stringify(n))),r}switchWallStartEnd(e){const t={...e.start};e.start={...e.end},e.end=t}findCorrespondingWall(e){return this.mainComponentThis.WALLS.find((t=>t.start.x===e.wallNode1.realX&&t.start.y===e.wallNode1.realY&&t.end.x===e.wallNode2.realX&&t.end.y===e.wallNode2.realY||t.start.x===e.wallNode2.realX&&t.start.y===e.wallNode2.realY&&t.end.x===e.wallNode1.realX&&t.end.y===e.wallNode1.realY))}nearVertice(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mainComponentThis.WALLS,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,s=1/0;for(let n=0;n<i.length;n++){let o=this.mainComponentThis.qSVG.gap(e,{x:i[n].start.x,y:i[n].start.y}),a=this.mainComponentThis.qSVG.gap(e,{x:i[n].end.x,y:i[n].end.y});o<a&&o<s&&(s=o,t={number:i[n],x:i[n].start.x,y:i[n].start.y,distance:Math.sqrt(s)}),a<o&&a<s&&(s=a,t={number:i[n],x:i[n].end.x,y:i[n].end.y,distance:Math.sqrt(s)})}return s<o*o&&t}nearWall(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mainComponentThis.WALLS,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,s=1/0,n={};if(0===i.length)return!1;for(let r=0;r<i.length;r++){let o=Lt(i[r].start.x,i[r].start.y,i[r].end.x,i[r].end.y);t=this.mainComponentThis.qSVG.nearPointOnEquation(o,e),t.distance<s&&this.mainComponentThis.qSVG.btwn(t.x,i[r].start.x,i[r].end.x)&&this.mainComponentThis.qSVG.btwn(t.y,i[r].start.y,i[r].end.y)&&(s=t.distance,n={wall:i[r],x:t.x,y:t.y,distance:t.distance})}let a=this.nearVertice(e,i);return a.distance<s&&(s=a.distance,n={wall:a.number,x:a.x,y:a.y,distance:a.distance}),s<=o&&n}showScaleBox(){const e=lt(this.mainComponentThis.WALLS);if(!e)return mt(this.boxScale.current),void(this.mainComponentThis.boxWallCoordinates={minX:0,maxX:0,minY:0,maxY:0,width:0,height:0});this.createAndShowBoxMeasures(e.minX,e.maxX,e.minY,e.maxY,this.boxScale),this.mainComponentThis.boxWallCoordinates={},this.mainComponentThis.boxWallCoordinates.maxX=T(e.maxX,0),this.mainComponentThis.boxWallCoordinates.minX=T(e.minX,0),this.mainComponentThis.boxWallCoordinates.minY=T(e.minY,0),this.mainComponentThis.boxWallCoordinates.maxY=T(e.maxY,0),this.mainComponentThis.boxWallCoordinates.width=this.mainComponentThis.boxWallCoordinates.maxX-this.mainComponentThis.boxWallCoordinates.minX,this.mainComponentThis.boxWallCoordinates.height=this.mainComponentThis.boxWallCoordinates.maxY-this.mainComponentThis.boxWallCoordinates.minY}};const Bo=class{constructor(e,t,i,o,s,n,a){let r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"normal",l=arguments.length>8?arguments[8]:void 0,h=arguments.length>9?arguments[9]:void 0,c=arguments.length>10?arguments[10]:void 0,d=arguments.length>11?arguments[11]:void 0;if(this.family=e,this.class=t,this.type=i,this.x=o.x,this.y=o.y,this.angle=s,this.angleSign=n,this.limit=[],this.hinge=r,this.graph=d.qSVG.create("none","g",{"data-object-class":this.class,"data-object-type":this.type}),this.additionalParams=c||{},this.actionGraph=this.graph,"onWall"===this.family||this.additionalParams.onWallObjectBBox){const e=d.qSVG.create("none","g");this.graph.appendChild(e),this.actionGraph=e}this.scale={x:1,y:1},this.value=h,this.size=a,this.thick=l,this.width=(this.size/d.meter).toFixed(2),this.height=(this.thick/d.meter).toFixed(2);let p,m=d.carpentryCalc(e,t,i,a,l,h);for(let g=0;g<m.length;g++)m[g].path&&(p=d.qSVG.create("none","path",{d:m[g].path,"stroke-width":1,fill:m[g].fill,stroke:m[g].stroke,"stroke-dasharray":m[g].strokeDashArray})),m[g].text&&(p=d.qSVG.create("none","text",{x:m[g].x,y:m[g].y,"font-size":"1em",stroke:m[g].stroke,"stroke-width":m[g].strokeWidth,"font-family":"roboto","text-anchor":"middle",fill:m[g].fill}),p.textContent=m[g].text),this.actionGraph.appendChild(p);let u=this.actionGraph.getBoundingClientRect();u.x=u.x*d.zoomFactor-d.offset.left*d.zoomFactor+d.originX_viewbox,u.y=u.y*d.zoomFactor-d.offset.top*d.zoomFactor+d.originY_viewbox,u.origin={x:this.x,y:this.y},this.bbox=u,this.realBbox=[{x:-this.size/2,y:-this.thick/2},{x:this.size/2,y:-this.thick/2},{x:this.size/2,y:this.thick/2},{x:-this.size/2,y:this.thick/2}],"byObject"===e&&(this.family=m.family),this.params=m.params,"doorWindow"===this.class&&zt(this.type)&&c&&(Object.hasOwn(this.additionalParams,"rotationDirection")&&Object.hasOwn(this.additionalParams,"rotationAxis")&&Object.hasOwn(this.additionalParams,"curvePoints")&&Object.hasOwn(this.additionalParams,"controlPointOnWall")&&Object.hasOwn(this.additionalParams,"arrowControlPoint")&&Object.hasOwn(this.additionalParams,"arrowControlPointAngleSign")||d.setWindowObjectRotationProperties(this)),"inWall"!==this.family&&"onWall"!==this.family||Object.hasOwn(this.additionalParams,"hideWithWall")||(this.additionalParams.hideWithWall=!0),m.params.width?this.size=m.params.width:this.size=a,m.params.height?this.thick=m.params.height:this.thick=l,this.setObject3DDimensions(d)}update(e){this.width=(this.size/e.meter).toFixed(2),this.height=(this.thick/e.meter).toFixed(2),this.setObject3DDimensions(e);let t,i=e.carpentryCalc(this.family,this.class,this.type,this.size,this.thick,this.value);for(let l=0;l<i.length;l++)if(i[l].path)this.actionGraph.querySelectorAll("path")[l].setAttribute("d",i[l].path);else if(i[l].text){let e=this.actionGraph.querySelectorAll("text");for(let t of e)t.setAttribute("font-size",i[l].fontSize),t.setAttribute("fill",i[l].fill);e[0].textContent=i[l].text}if("text"===this.class){let t=e.qSVG.create("none","text",{x:0,y:0,"font-size":i[0].fontSize,stroke:i[0].stroke,"stroke-width":i[0].strokeWidth,"font-family":"roboto","text-anchor":"middle",fill:i[0].fill});t.textContent=i[0].text,t.style.visibility="hidden",this.actionGraph.appendChild(t);const o=t.getBBox();this.size=o.width,this.thick=o.height,t.remove()}t="normal"===this.hinge?1:-1;let o=this.y;this.actionGraph.setAttribute("transform","translate("+this.x+","+o+") rotate("+this.angle+",0,0) scale("+t+", 1)");let s=this.actionGraph.getBoundingClientRect();s.x=s.x*e.zoomFactor-e.offset.left*e.zoomFactor+e.originX_viewbox,s.y=s.y*e.zoomFactor-e.offset.top*e.zoomFactor+e.originY_viewbox,s.origin={x:this.x,y:this.y},this.bbox=s;let n=this.angle*(Math.PI/180),a=[{x:-this.size/2,y:-this.thick/2},{x:this.size/2,y:-this.thick/2},{x:this.size/2,y:this.thick/2},{x:-this.size/2,y:this.thick/2}],r={x:0,y:0};if("text"===this.class&&(a=[{x:this.bbox.x,y:this.bbox.y},{x:this.bbox.x+this.bbox.width*e.zoomFactor,y:this.bbox.y},{x:this.bbox.x+this.bbox.width*e.zoomFactor,y:this.bbox.y+this.bbox.height*e.zoomFactor},{x:this.bbox.x,y:this.bbox.y+this.bbox.height*e.zoomFactor}],r.x=this.bbox.x+this.bbox.width*e.zoomFactor/2,r.y=this.bbox.y+this.bbox.height*e.zoomFactor/2),Vt(a,r,n),"text"!==this.class)for(let l=0;l<a.length;l++)a[l].x+=this.x,a[l].y+=this.y;if(this.realBbox=a,("onWall"===this.family||this.additionalParams.onWallObjectBBox)&&Object.hasOwn(this.additionalParams,"onWallAngle")&&Object.hasOwn(this.additionalParams,"onWallThick")){const e=1===this.angleSign?-1:1,t=90===this.params.onWallOffsetAngle?this.size:this.thick,i=e*(this.additionalParams.onWallThick/2+t/2)*Math.sin(this.additionalParams.onWallAngle),o=-e*(this.additionalParams.onWallThick/2+t/2)*Math.cos(this.additionalParams.onWallAngle);this.graph.setAttribute("transform","translate(".concat(i,", ").concat(o,")")),new Array(...this.realBbox,this.bbox.origin).forEach((e=>{e.x+=i,e.y+=o}))}return zt(this.type)&&e.setWindowObjectRotationProperties(this),!0}setObject3DDimensions(e){if("lights"===this.class)this.additionalParams.height3D=this.additionalParams.height3D||_e[this.type].dimensions.height3D*(e.meter/100),"onWall"===this.family?(this.additionalParams.width3D=parseFloat(this.thick),this.additionalParams.depth3D=parseFloat(this.size)):(this.additionalParams.width3D=parseFloat(this.size),this.additionalParams.depth3D=parseFloat(this.thick));else if("doorWindow"===this.class)this.additionalParams.width3D=parseFloat(this.size),this.additionalParams.height3D=this.additionalParams.height3D||(zt(this.type)?Te[this.type].dimensions.height3D*(e.meter/100):Ie[this.type].dimensions.height3D*(e.meter/100)),this.additionalParams.depth3D=parseFloat(this.thick);else if("furniture"===this.class){this.additionalParams.width3D=parseFloat(this.size);let t=this.additionalParams.height3D;this.additionalParams.height3D||(t=qt(this.type)?e.wallHeight:Be[this.type].dimensions.height3D*(e.meter/100)),this.additionalParams.height3D=t,this.additionalParams.depth3D=parseFloat(this.thick)}if(!re.includes(Ut(this.type))){const t=ce.includes(this.type);this.additionalParams.positionY=k(this.additionalParams.positionY)?t?e.wallHeight-this.additionalParams.height3D:Gt(this.type)?3*e.wallHeight/4:e.wallHeight/2-this.additionalParams.height3D/2:this.additionalParams.positionY}}};var Eo=i(1317);function Vo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("floorplan_image_scaling"===this.mode||"floorplan_image_translation"===this.mode){if(this.snap=this.calcul_snap(e,this.grid_snap),this.cursor("pointer"),this.binder?t&&(this.binder.setAttribute("cx",this.snap.x),this.binder.setAttribute("cy",this.snap.y)):(this.binder=this.qSVG.create("none","circle",{cx:this.snap.x,cy:this.snap.y,r:this.meter/6,fill:"url('#uploadFloorplanCursorCircleGradient')"}),this.boxBind.current.appendChild(this.binder)),t&&"floorplan_image_scaling"===this.mode){let e;if((e=this.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group"))&&!this.boxFloorplanImage.current.querySelector("#endCircle")){let t=e.querySelector("line");t.setAttribute("x2",this.snap.x),t.setAttribute("y2",this.snap.y)}}}else"upload_floorplan_image_mode"===this.mode&&this.removeBinder()}function No(e){if("room_mode"===this.mode){let t;this.snap=this.calcul_snap(e,this.grid_snap),(t=It(this.snap,this.ROOM))?(this.cursor("pointer"),(!this.selectedBinder||this.selectedBinder&&parseInt(this.selectedBinder.id)!==this.ROOM.indexOf(t))&&(this.removeBinder(),this.binder=this.createRoomBinderPath(t))):this.removeBinder()}}function zo(e){if("select_mode"===this.mode&&"off"===this.drag){this.snap=this.calcul_snap(e,"off");let t,i,o=!1,s=[];for(let e=0;e<this.OBJDATA.length;e++){let t=this.OBJDATA[e].realBbox;jt(this.snap,t)&&s.push(this.OBJDATA[e])}if(s.length>0&&(o=s[0],s.length>1)){let e,t=Mt(this.snap,{x:s[0].x,y:s[0].y});for(let i=1;i<s.length;i++)e=Mt(this.snap,{x:s[i].x,y:s[i].y}),e<t&&(t=e,o=s[i])}if(!1!==o){if(this.binder&&"segment"===this.binder.type&&(this.removeBinder(),this.cursor("default")),!this.selectedBinder||this.selectedBinder&&this.selectedBinder.obj!==o)if(o.params.bindBox)(!this.binder||this.binder&&this.binder.obj!==o)&&(this.binder&&this.binder.obj!==o&&this.removeBinder(),this.binder=new Bo("free","boundingBox","",o.bbox.origin,o.angle,0,o.size,"normal",o.thick,o.realBbox,{onWallObjectBBox:"onWall"===o.family},this),this.binder.update(this),this.binder.obj=o,this.binder.type="boundingBox",this.binder.oldX=this.binder.x,this.binder.oldY=this.binder.y,this.boxBind.current.appendChild(this.binder.graph),o.params.move?this.cursor("move"):this.cursor("pointer"));else if(!this.binder||this.binder.obj&&this.binder.obj!==o){let e;if(this.binder&&this.binder.obj!==o&&this.removeBinder(),e=this.editor.rayCastingWall(o)){e.length>1&&(e=e[0]),this.inWallRib(e);let t=e.thick,i=o.size;this.binder=new Bo("inWall","socle","",o,o.angle,0,i,"normal",t,null,void 0,this),this.binder.update(this),this.binder.type="obj",this.binder.obj=o,this.binder.oldXY={x:o.x,y:o.y},this.boxBind.current.appendChild(this.binder.graph)}}else this.binder.graph&&(Eo.log("Error binder"),Eo.log(this.binder),e.target===this.binder.graph.firstChild?(this.cursor("move"),this.binder.graph.firstChild.setAttribute("class","circle_css_2"),this.binder.type="obj",this.binder.obj=o):(this.cursor("default"),this.binder.graph.firstChild.setAttribute("class","circle_css_1"),this.binder.type=!1))}else this.binder&&(this.removeBinder(),this.cursor("default"),this.rib());if(t=this.editor.nearWallNode(this.snap,this.nearWallNodeRange)){if(!this.binder||"segment"===this.binder.type)if(this.selectedBinder)if(this.selectedBinder.obj){let e=[];for(let o=this.WALLS.length-1;o>-1;o--)(gt(this.WALLS[o].start,t)||gt(this.WALLS[o].end,t))&&e.push(this.WALLS[o]);let i=!1;Eo.log(e);for(let t=0;t<e.length;t++)if(-1!==this.editor.objFromWall(e[t]).indexOf(this.selectedBinder.obj)){i=!0;break}i||(Eo.log("Create node binder"),this.binder=this.qSVG.create(this.boxBind,"circle",{id:"circlebinder",class:"circle_css_2",cx:t.x,cy:t.y,r:this.Rcircle}),this.binder.data=t,this.binder.type="node")}else this.selectedBinder.wall&&(!this.selectedBinder.wall||gt(this.selectedBinder.wall.start,t)||gt(this.selectedBinder.wall.end,t))||(this.binder=this.qSVG.create(this.boxBind,"circle",{id:"circlebinder",class:"circle_css_2",cx:t.x,cy:t.y,r:this.Rcircle}),this.binder.data=t,this.binder.type="node");else this.binder=this.qSVG.create(this.boxBind,"circle",{id:"circlebinder",class:"circle_css_2",cx:t.x,cy:t.y,r:this.Rcircle}),this.binder.data=t,this.binder.type="node";this.cursor("move")}else this.binder&&"node"===this.binder.type&&(this.removeBinder(),this.cursor("default"),this.rib());if(i=this.editor.rayCastingWalls(this.snap,this.WALLS)){if((!this.selectedBinder||!this.selectedBinder.obj||this.selectedBinder.obj&&!Array.isArray(i)&&-1===this.editor.objFromWall(i).indexOf(this.selectedBinder.obj)||0===(this.selectedBinder.obj&&Array.isArray(i)&&i.filter((e=>-1!==this.editor.objFromWall(e).indexOf(this.selectedBinder.obj)))).length)&&(!this.selectedBinder||!this.selectedBinder.wall||this.selectedBinder.wall&&this.selectedBinder.wall!==i)&&(i.length>1&&(i=i[i.length-1]),i&&!this.binder)){this.editor.objFromWall(i).length>0&&this.editor.inWallRib2(i),this.binder={},this.binder.wall=i,this.inWallRib(this.binder.wall);let e=this.qSVG.create("none","line",{x1:this.binder.wall.start.x,y1:this.binder.wall.start.y,x2:this.binder.wall.end.x,y2:this.binder.wall.end.y,"stroke-width":this.wallSize,stroke:"#19ab7f"}),t=this.qSVG.create("none","circle",{class:"circle_css",cx:this.binder.wall.start.x,cy:this.binder.wall.start.y,r:this.wallBinderBallsRadius}),o=this.qSVG.create("none","circle",{class:"circle_css",cx:this.binder.wall.end.x,cy:this.binder.wall.end.y,r:this.wallBinderBallsRadius});this.binder.graph=this.qSVG.create("none","g"),this.binder.graph.append(e),this.binder.graph.append(t),this.binder.graph.append(o),this.boxBind.current.appendChild(this.binder.graph),this.binder.type="segment",this.cursor("pointer")}}else if(i=this.editor.nearWall(this.snap,this.WALLS,this.nearWallBinderRadius)){if((!this.selectedBinder||!this.selectedBinder.obj||this.selectedBinder.obj&&-1===this.editor.objFromWall(i.wall).indexOf(this.selectedBinder.obj))&&(!this.selectedBinder||!this.selectedBinder.wall||this.selectedBinder.wall&&this.selectedBinder.wall!==i.wall)&&i&&!this.binder){Eo.log("Wall objects"),Eo.log(this.editor.objFromWall(i.wall)),this.selectedBinder&&this.editor.objFromWall(i.wall).length>0&&Eo.log(this.editor.objFromWall(i.wall).indexOf(this.selectedBinder.obj)),i=i.wall,this.editor.objFromWall(i).length>0&&this.editor.inWallRib2(i),this.binder={},this.binder.wall=i,this.inWallRib(this.binder.wall);let e=this.qSVG.create("none","line",{x1:this.binder.wall.start.x,y1:this.binder.wall.start.y,x2:this.binder.wall.end.x,y2:this.binder.wall.end.y,"stroke-width":this.wallSize,stroke:"#19ab7f"}),t=this.qSVG.create("none","circle",{class:"circle_css",cx:this.binder.wall.start.x,cy:this.binder.wall.start.y,r:this.wallBinderBallsRadius}),o=this.qSVG.create("none","circle",{class:"circle_css",cx:this.binder.wall.end.x,cy:this.binder.wall.end.y,r:this.wallBinderBallsRadius});this.binder.graph=this.qSVG.create("none","g"),this.binder.graph.append(e),this.binder.graph.append(t),this.binder.graph.append(o),this.boxBind.current.appendChild(this.binder.graph),this.binder.type="segment",this.cursor("pointer")}}else this.binder&&"segment"===this.binder.type&&(this.removeBinder(),this.cursor("default"),this.rib())}}function Ho(e){Eo.log("Angle",e.angle),Eo.log("Angle sign",e.angleSign),this.windowRotationAxisDirectionGraph&&this.windowRotationAxisDirectionGraph.remove();const t=this.createWindowRotationSvg(e,e.additionalParams.curvePoints,e.additionalParams.rotationDirection);this.windowRotationAxisDirectionGraph=t.svgGroupElement,this.boxBind.current.appendChild(this.windowRotationAxisDirectionGraph),this.windowRotationAxisDirectionGraph.appendChild(t.curveArrowPath)}var Go=i(1317);let qo=!1;function Yo(e){"layer_mode"!==this.mode&&!qo&&e.shiftKey&&(this.snap=this.calcul_snap(e,this.grid_snap),this.pox=this.snap.xMouse,this.poy=this.snap.yMouse),Go.log("Mouse move mode"+this.mode),qo=e.shiftKey,this.textAndUploadFloorplanImageBinderCreation(e,!0),this.roomModeBinderCreation(e),this.selectModeObj2DWallNodeWallSegmentBinderCreation(e);"bind_mode"!==this.mode&&!e.touches&&("select_mode"===this.mode&&"on"===this.drag||"layer_mode"!==this.mode&&e.shiftKey)&&(this.snap=this.calcul_snap(e,this.grid_snap),this.cursor("move"),this.distX=(this.snap.xMouse-this.pox)*this.zoomFactor,this.distY=(this.snap.yMouse-this.poy)*this.zoomFactor,this.pox=this.snap.xMouse-this.distX,this.poy=this.snap.yMouse-this.distY,this.zoom_maker("zoomdrag",this.distX,this.distY))}var Uo=i(1317);function Xo(){if(Uo.log("Mouse up mode"+this.mode),this.showRib&&nt(this.boxScale.current,0,null,"inline",!1),this.drag="off",this.cursor("default"),"select_mode"===this.mode&&this.binder&&this.removeBinder(),"room_mode"===this.mode){if(!this.binder)return!1;this.removeSelectedBinder(),this.selectedBinder=this.binder,this.selectedBinder.binderType="room",this.binder=null,this.setRoomToolsValues(),Uo.log("Room mode"),this.translateRightBox(this.roomTools.current,-this.rightBoxWidth,!0),this.cursor("default")}if("bind_mode"===this.mode&&(this.action=0,this.construc=0,this.binder)){if(this.foncButton("select_mode","dont_save"),"node"===this.binder.type&&(Uo.log("Mouse up bind mode NODE"),this.editor.removeZeroLengthWallsAndSliceExistingWalls(),this.editor.architect(this.WALLS)),"segment"===this.binder.type){let e=!1;if(this.binder.wall.start===this.binder.before&&(e=!0),e){this.boxInfo.current.innerHTML="Modify the wall",Uo.log("mainComponentThis.binder wall:"),Uo.log(this.binder),this.hideActiveRightBox(),this.translateRightBox(this.wallTools.current,-this.rightBoxWidth,!0),this.setWallToolsValues(this.binder.wall),this.removeSelectedBinder(),this.selectedBinder=this.binder,this.selectedBinder.binderType="wall",this.binder=null;for(let e=0;e<this.selectedBinder.graph.children.length;e++)this.selectedBinder.graph.children[e].setAttribute("stroke","#0cacf2"),this.selectedBinder.graph.children[e].setAttribute("fill","#0cacf2"),this.selectedBinder.graph.children[e].style.stroke="#0cacf2",this.selectedBinder.graph.children[e].style.fill="#0cacf2"}else Uo.log("Mouse up bind mode pomican cijeli zid"),this.editor.removeZeroLengthWallsAndSliceExistingWalls(),this.editor.architect(this.WALLS);this.equation1=null,this.equation2=null,this.equation3=null}else if("obj"===this.binder.type&&"inWall"===this.binder.family){if(Math.abs(this.binder.oldXY.x-this.binder.x)+Math.abs(this.binder.oldXY.y-this.binder.y)<1){Ht(this.binder.obj.type)?this.boxInfo.current.innerHTML="Config door":this.boxInfo.current.innerHTML="Config window",this.openWallItemToolsRightBox(this.binder.obj),this.cursor("default"),this.removeSelectedBinder(),this.selectedBinder=this.binder,this.selectedBinder.graph.querySelector(".circle_css_2")&&this.selectedBinder.graph.querySelector(".circle_css_2").classList.remove("circle_css_2"),this.selectedBinder.binderType="wallItem",this.binder=null;for(let e=0;e<this.selectedBinder.graph.children.length;e++)this.selectedBinder.graph.children[e].setAttribute("stroke","#0cacf2"),this.selectedBinder.graph.children[e].setAttribute("fill","#0cacf2"),this.selectedBinder.graph.children[e].style.stroke="#0cacf2",this.selectedBinder.graph.children[e].style.fill="#0cacf2"}else this.mode="select_mode",this.action=0,this.removeBinder()}else if("boundingBox"===this.binder.type){let e=Math.abs(this.binder.oldX-this.binder.x)+Math.abs(this.binder.oldY-this.binder.y),t=this.binder.obj;if(Uo.log("target object: "),Uo.log(t),e<1)if(this.binder.additionalParams.onWallObjectBBox||t.params.move){let e="";if(this.binder.additionalParams.onWallObjectBBox)e="wallItem",this.boxInfo.current.innerHTML="lights"===t.class?"Modify light":"Modify furniture",this.openWallItemToolsRightBox(t);else if("homeAssistant"===t.class||"sensors"===t.class)this.boxInfo.current.innerHTML="sensor"===t.type?"Modify sensor":"Modify entity",this.openHomeAssistantBindingsToolsRightBox(t);else{e="freeItem";let i="";"text"===t.class?(nt(this.freeItemTextToolsRef.current,0),i="Modify text"):(at(this.freeItemTextToolsRef.current,0),("lights"===t.class&&"free"===t.family||"furniture"===t.class)&&(i="lights"===t.class&&"free"===t.family?"Modify light":"Modify furniture item")),this.boxInfo.current.innerHTML=i,this.openFreeItemToolsRightBox(t)}this.cursor("default"),this.removeSelectedBinder(),this.selectedBinder=this.binder,this.binder=null,this.selectedBinder.binderType=e}else this.mode="select_mode",this.action=0,this.removeBinder()}"bind_mode"===this.mode&&this.binder&&(Uo.log("Makni mainComponentThis.binder"),this.removeBinder())}"edit_room_mode"!==this.mode&&(this.editor.showScaleBox(),this.rib())}var Zo=i(1317);function Ko(e){if("floorplan_image_scaling"!==this.mode&&"floorplan_image_translation"!==this.mode||(this.snap=this.calcul_snap(e,this.grid_snap),this.uploadFloorplanImageToolsRef.current.handleMouseDownAction(this.snap)),"select_mode"===this.mode)if(Zo.log("Inside select mode"),Zo.log(this.binder),!this.binder||"segment"!==this.binder.type&&"node"!==this.binder.type&&"obj"!==this.binder.type&&"boundingBox"!==this.binder.type)this.action=0,this.drag="on",this.snap=this.calcul_snap(e,this.grid_snap),this.pox=this.snap.xMouse,this.poy=this.snap.yMouse,this.selectModeRightClickDraggOn=2===e.button;else{if(Zo.log("Set bind mode"),this.mode="bind_mode","obj"===this.binder.type&&(this.action=1),"boundingBox"===this.binder.type&&(this.action=1),"node"===this.binder.type){at(this.boxScale.current,0,null,!1);let e=this.binder.data;this.pox=e.x,this.poy=e.y;let t,i={x:this.pox,y:this.poy};this.wallListObj=[],this.wallListRun=[];for(let o=this.WALLS.length-1;o>-1;o--)if(gt(this.WALLS[o].start,i)||gt(this.WALLS[o].end,i)){this.wallListRun.push(this.WALLS[o]);break}null!=this.wallListRun[0].child&&(gt(this.wallListRun[0].child.start,i)||gt(this.wallListRun[0].child.end,i))&&this.wallListRun.push(this.wallListRun[0].child),null!=this.wallListRun[0].parent&&(gt(this.wallListRun[0].parent.start,i)||gt(this.wallListRun[0].parent.end,i))&&this.wallListRun.push(this.wallListRun[0].parent);for(let o in this.wallListRun)if(gt(this.wallListRun[o].start,i)||gt(this.wallListRun[o].end,i)){let e=this.wallListRun[o].start;gt(this.wallListRun[o].start,i)&&(e=this.wallListRun[o].end),t=this.editor.objFromWall(this.wallListRun[o]);let s=this.wallListRun[o];for(let i=0;i<t.length;i++){let o=t[i],n=Mt(o,e);this.wallListObj.push({wall:s,from:e,distance:n,obj:o,indexObj:i})}}this.magnetic=0,this.action=1}if("segment"===this.binder.type){at(this.boxScale.current,0,null,!1);let e=this.binder.wall;if(this.binder.before=this.binder.wall.start,this.equation2=this.editor.createEquationFromWall(e),null!=e.parent){this.equation1=this.editor.createEquationFromWall(e.parent);let t=this.qSVG.angleBetweenEquations(this.equation1.A,this.equation2.A);if(t<20||t>160){let t=!0;for(let i in this.WALLS)if(jt(e.start,this.WALLS[i].coords)&&!gt(this.WALLS[i],e.parent)&&!gt(this.WALLS[i],e)){null!=e.parent.parent&&gt(e,e.parent.parent)&&(e.parent.parent=null),null!=e.parent.child&&gt(e,e.parent.child)&&(e.parent.child=null),e.parent=null,t=!1;break}if(t){let t;gt(e.parent.end,e.start,"1")?(t=new Fo(e.parent.end,e.start,"normal",e.thick,e.material,e),Zo.log("Push new wall "+JSON.stringify(t)),this.WALLS.push(t),t.parent=e.parent,t.child=e,e.parent.child=t,e.parent=t,this.equation1=this.qSVG.perpendicularEquation(this.equation2,e.start.x,e.start.y)):gt(e.parent.start,e.start,"2")&&(t=new Fo(e.parent.start,e.start,"normal",e.thick,e.material,e),Zo.log("Push new wall "+JSON.stringify(t)),this.WALLS.push(t),t.parent=e.parent,t.child=e,e.parent.parent=t,e.parent=t,this.equation1=this.qSVG.perpendicularEquation(this.equation2,e.start.x,e.start.y))}}}if(null==e.parent){let t=!1;for(let i in this.WALLS)if(jt(e.start,this.WALLS[i].coords)&&!gt(this.WALLS[i].coords,e.coords)){let e=this.qSVG.angleBetweenEquations(this.WALLS[i].equations.base.A,this.equation2.A);if(e<20||e>160)break;this.equation1=this.editor.createEquationFromWall(this.WALLS[i]),this.equation1.follow=this.WALLS[i],this.equation1.backUp={coords:this.WALLS[i].coords,start:this.WALLS[i].start,end:this.WALLS[i].end,child:this.WALLS[i].child,parent:this.WALLS[i].parent},t=!0;break}t||(this.equation1=this.qSVG.perpendicularEquation(this.equation2,e.start.x,e.start.y))}if(null!=e.child){this.equation3=this.editor.createEquationFromWall(e.child);let t=this.qSVG.angleBetweenEquations(this.equation3.A,this.equation2.A);if(t<20||t>160){let t=!0;for(let i in this.WALLS)if(jt(e.end,this.WALLS[i].coords)&&!gt(this.WALLS[i],e.child)&&!gt(this.WALLS[i],e)){null!=e.child.parent&&gt(e,e.child.parent)&&(e.child.parent=null),null!=e.child.child&&gt(e,e.child.child)&&(e.child.child=null),e.child=null,t=!1;break}if(t)if(gt(e.child.start,e.end)){let t=new Fo(e.end,e.child.start,"new",e.thick,e.material,e);Zo.log("Push new wall "+JSON.stringify(t)),this.WALLS.push(t),t.parent=e,t.child=e.child,e.child.parent=t,e.child=t,this.equation3=this.qSVG.perpendicularEquation(this.equation2,e.end.x,e.end.y)}else if(gt(e.child.end,e.end)){let t=new Fo(e.end,e.child.end,"normal",e.thick,e.material,e);Zo.log("Push new wall "+JSON.stringify(t)),this.WALLS.push(t),t.parent=e,t.child=e.child,e.child.child=t,e.child=t,this.equation3=this.qSVG.perpendicularEquation(this.equation2,e.end.x,e.end.y)}}}if(null==e.child){let t=!1;for(let i in this.WALLS)if(jt(e.end,this.WALLS[i].coords)&&!gt(this.WALLS[i].coords,e.coords,"4")){let e=this.qSVG.angleBetweenEquations(this.WALLS[i].equations.base.A,this.equation2.A);if(e<20||e>160)break;this.equation3=this.editor.createEquationFromWall(this.WALLS[i]),this.equation3.follow=this.WALLS[i],this.equation3.backUp={coords:this.WALLS[i].coords,start:this.WALLS[i].start,end:this.WALLS[i].end,child:this.WALLS[i].child,parent:this.WALLS[i].parent},t=!0;break}t||(this.equation3=this.qSVG.perpendicularEquation(this.equation2,e.end.x,e.end.y))}this.equationFollowers=[];for(let i in this.WALLS)null==this.WALLS[i].child&&jt(this.WALLS[i].end,e.coords)&&!gt(e,this.WALLS[i])&&this.equationFollowers.push({wall:this.WALLS[i],eq:this.editor.createEquationFromWall(this.WALLS[i]),type:"end"}),null==this.WALLS[i].parent&&jt(this.WALLS[i].start,e.coords)&&!gt(e,this.WALLS[i])&&this.equationFollowers.push({wall:this.WALLS[i],eq:this.editor.createEquationFromWall(this.WALLS[i]),type:"start"});this.equationsObj=[];let t=this.editor.objFromWall(e);for(let i=0;i<t.length;i++){let o=t[i];this.equationsObj.push({obj:o,wall:e,eq:this.qSVG.perpendicularEquation(this.equation2,o.x,o.y)})}this.action=1}}}function Jo(e){I(e,(e=>{const{xMouse:t,yMouse:i}=this.calcul_snap(e);if(this.showMapLayer2DInputRef.current.getCheckedStatus())var o=this.calcul_snap({pageX:this.offset.left,pageY:this.offset.top+this.offset.scrollY});if(this.setZoomParameters(e.deltaY<0?"zoomin":"zoomout",this.zoomXMove,!0)){const{xMouse:s,yMouse:n}=this.calcul_snap(e);this.originX_viewbox=this.originX_viewbox-(s-t),this.originY_viewbox=this.originY_viewbox-(n-i),this.showMapLayer2DInputRef.current.getCheckedStatus()&&this.handleMapZoomChange(o),this.drawingAreaPopupActive&&this.drawingAreaPopupZoomTranslateControl(),this.setSvgViewBoxes()}}),100)()}function Qo(e){if(1===e.touches.length)this.touchStartPageCoordinates={pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY},this.textAndUploadFloorplanImageBinderCreation(e),this.roomModeBinderCreation(e),this.selectModeObj2DWallNodeWallSegmentBinderCreation(e),this.handleMouseDown(e);else if(2===e.touches.length){this.drag="off",this.touchZoomTouches=[],this.touchZoomTouches.push({identifier:e.touches[0].identifier,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY}),this.touchZoomTouches.push({identifier:e.touches[1].identifier,pageX:e.touches[1].pageX,pageY:e.touches[1].pageY}),this.zoomTouchFocusPoint={pageX:(e.touches[0].pageX+e.touches[1].pageX)/2,pageY:(e.touches[0].pageY+e.touches[1].pageY)/2};const t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;this.touchZoomDollyStartDistance=Math.sqrt(t*t+i*i)}}var $o=i(1317);function es(e){if(e.touches[0].pageX!==this.touchStartPageCoordinates.pageX||e.touches[0].pageY!==this.touchStartPageCoordinates.pageY)if(1===e.touches.length&&"on"===this.drag)$o.log("Drag"),this.snap=this.calcul_snap(e,this.grid_snap),this.distX=(this.snap.xMouse-this.pox)*this.zoomFactor,this.distY=(this.snap.yMouse-this.poy)*this.zoomFactor,this.pox=this.snap.xMouse-this.distX,this.poy=this.snap.yMouse-this.distY,this.zoom_maker("zoomdrag",this.distX,this.distY);else if(2===e.touches.length){$o.log("Zoom 2 fingers"),this.binder&&(this.removeBinder(),this.mode="select_mode");const i=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;this.touchZoomDollyEndDistance=Math.sqrt(i*i+o*o);const s=this.touchZoomDollyEndDistance-this.touchZoomDollyStartDistance;if($o.log("Distance "+s),0!==s){const{xMouse:e,yMouse:i}=this.calcul_snap(this.zoomTouchFocusPoint);if(this.showMapLayer2DInputRef.current.getCheckedStatus())var t=this.calcul_snap({pageX:this.offset.left,pageY:this.offset.top+this.offset.scrollY});const o=s>0?.95*this.zoomFactor:this.zoomFactor/.95,n=1/o,a=o*this.taille_w;if(s>0){if(this.isOverMaxZoomIn(a,0))return}else if(this.isOverMaxZoomOut(a,0))return;const r=a-this.width_viewbox;$o.log("Zoom out Width viewbox delta "+r),this.width_viewbox+=r,this.height_viewbox=this.width_viewbox*this.ratio_viewbox,this.originX_viewbox=this.originX_viewbox-r/2,this.originY_viewbox=this.originY_viewbox-r/2*this.ratio_viewbox,this.zoomFactor=this.width_viewbox/this.taille_w;const{xMouse:l,yMouse:h}=this.calcul_snap(this.zoomTouchFocusPoint);this.originX_viewbox=this.originX_viewbox-(l-e),this.originY_viewbox=this.originY_viewbox-(h-i),this.setScaleValueWidth(n),this.showMapLayer2DInputRef.current.getCheckedStatus()&&this.handleMapZoomChange(t),this.drawingAreaPopupActive&&this.drawingAreaPopupZoomTranslateControl(),this.setSvgViewBoxes(),this.touchZoomDollyStartDistance=this.touchZoomDollyEndDistance}}else this.handleMouseMove(e)}function ts(e){this.drag="off",this.handleMouseUp(e)}function is(e){(this.lineModeDraggOn||this.selectModeRightClickDraggOn)&&e.preventDefault(),this.lineModeDraggOn=!1,this.selectModeRightClickDraggOn=!1}var os=i(3308),ss=i(1051),ns=i(8393),as=i(2317),rs=i(6788),ls=i(2550),hs=i(1015);class cs extends o.Component{render(){return(0,l.jsx)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"20px",height:"20px",viewBox:"0 0 95.098 95.098",style:{enableBackground:"new 0 0 95.098 95.098",marginRight:5},xmlSpace:"preserve",children:(0,l.jsxs)("g",{children:[(0,l.jsx)("path",{d:"M47.549,0C21.288,0,0,21.288,0,47.549s21.288,47.549,47.549,47.549c26.262,0,47.549-21.288,47.549-47.549\r S73.811,0,47.549,0z M47.549,85.098C26.844,85.098,10,68.253,10,47.549S26.844,10,47.549,10s37.549,16.845,37.549,37.549\r S68.254,85.098,47.549,85.098z"}),(0,l.jsx)("path",{d:"M77.665,29.911c-0.25-0.428-0.755-0.633-1.231-0.503l-33.783,9.213c-0.186,0.052-0.355,0.151-0.492,0.288L17.596,63.865\r c-0.346,0.354-0.414,0.895-0.164,1.32c0.25,0.428,0.755,0.635,1.232,0.504l33.783-9.214c0.093-0.024,0.182-0.062,0.265-0.11\r c0.083-0.049,0.159-0.108,0.228-0.178l24.562-24.957C77.848,30.879,77.915,30.337,77.665,29.911z M26.705,59.756l16.46-16.725\r l6.179,10.551L26.705,59.756z"})]})})}}const ds=cs;class ps extends o.Component{render(){return(0,l.jsx)("svg",{width:"20px",height:"20px",style:{marginRight:5},viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"m22 6-3-4-3 4h2v4h-2l3 4 3-4h-2V6zM9.307 4l-6 16h2.137l1.875-5h6.363l1.875 5h2.137l-6-16H9.307zm-1.239 9L10.5 6.515 12.932 13H8.068z"})})}}const ms=ps;class us extends o.Component{render(){return(0,l.jsx)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"25px",height:"25px",viewBox:"0 0 477.381 477.382",style:{marginRight:5,enableBackground:"new 0 0 477.381 477.382"},xmlSpace:"preserve",children:(0,l.jsxs)("g",{children:[(0,l.jsx)("path",{d:"M477.381,103.373c0-54.988-44.577-99.564-99.565-99.564c-53.146,0-96.562,41.64-99.413,94.074\r c-13.35-2.513-27.168-3.838-41.322-3.838c-113.595,0-205.681,84.96-205.681,189.764c0,28.472,6.81,55.472,18.986,79.71\r L1.735,451.491c-2.703,4.889-2.215,10.917,1.239,15.308c2.673,3.397,6.721,5.3,10.911,5.3c1.223,0,2.457-0.163,3.674-0.498\r l106.506-29.233c32.435,19.721,71.269,31.206,113.016,31.206c113.594,0,205.681-84.96,205.681-189.764\r c0-32.378-8.8-62.854-24.3-89.521C453.186,178.737,477.381,143.881,477.381,103.373z M377.816,177.937\r c-41.115,0-74.565-33.449-74.565-74.564c0-41.115,33.45-74.564,74.565-74.564s74.565,33.449,74.565,74.564\r C452.381,144.487,418.931,177.937,377.816,177.937z"}),(0,l.jsx)("path",{d:"M419.955,92.871h-31.636V61.233c0-5.801-4.703-10.503-10.503-10.503c-5.799,0-10.502,4.702-10.502,10.503V92.87h-31.636\r c-5.802,0-10.503,4.702-10.503,10.503c0,5.8,4.701,10.502,10.503,10.502h31.636v31.636c0,5.801,4.703,10.503,10.502,10.503\r c5.801,0,10.503-4.702,10.503-10.503v-31.636h31.636c5.802,0,10.503-4.702,10.503-10.502\r C430.458,97.572,425.755,92.871,419.955,92.871z"})]})})}}const gs=us;class fs extends o.Component{render(){return(0,l.jsx)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"20px",height:"20px",viewBox:"0 0 347.523 347.523",style:{marginRight:5,enableBackground:"new 0 0 347.523 347.523"},xmlSpace:"preserve",children:(0,l.jsxs)("g",{children:[(0,l.jsx)("path",{d:"M108.674,196.125c-2.857-0.402-5.777-0.592-8.746-0.534c-14.267,0.278-36.342,6.092-60.493,32.207\r c-19.171,20.729-19.954,42.635-20.644,61.961c-0.66,18.474-1.181,33.065-16.507,43.727c-1.506,1.049-2.318,2.837-2.113,4.661\r c0.128,1.147,0.645,2.191,1.434,2.98c0.466,0.466,1.026,0.843,1.658,1.099c28.523,11.553,77.316,5.895,117.044-33.833\r c18.043-18.044,28.812-37.145,31.14-55.233c0.607-4.719,0.618-9.323,0.091-13.763L108.674,196.125z M100.915,229.382\r c-1.553,2.174-3.859,3.612-6.494,4.052c-19.209,3.202-25.884,15.953-26.159,16.494c-1.627,3.387-5.167,5.611-8.989,5.611\r c-0.337,0-0.676-0.017-1.015-0.052c-1.149-0.117-2.264-0.432-3.313-0.936c-4.97-2.391-7.069-8.376-4.681-13.347\r c0.442-0.918,11.153-22.546,40.869-27.5c0.546-0.09,1.1-0.136,1.647-0.136c4.908,0,9.055,3.516,9.861,8.357\r C103.08,224.559,102.467,227.207,100.915,229.382z"}),(0,l.jsx)("path",{d:"M340.587,6.796c-8.615-8.614-22.425-9.1-31.624-1.112c-5.782,5.021-141.818,123.166-160.166,141.513\r c-9.175,9.175-20.946,24.898-31.124,39.428l42.864,43.271c14.546-10.18,30.345-22.003,39.65-31.308\r C218.749,180.024,336.69,44.193,341.703,38.42C349.688,29.22,349.201,15.41,340.587,6.796z"})]})})}}const bs=fs;class xs extends o.Component{render(){return(0,l.jsx)("svg",{version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"22px",height:"22px",viewBox:"0 0 360.39 360.389",style:{enableBackground:"new 0 0 360.39 360.389"},xmlSpace:"preserve",children:(0,l.jsx)("g",{children:(0,l.jsx)("path",{d:"M301.123,173.306L118.995,3.265c-3.242-3.038-7.891-4.049-12.105-2.639c-4.211,1.404-7.317,5.006-8.086,9.389\r L55.602,255.404c-0.854,4.847,1.306,9.717,5.464,12.341c4.152,2.625,9.49,2.465,13.491-0.378l59.968-42.699l47.219,127.448\r c2.127,6.336,8.984,9.765,15.332,7.648l62.087-20.771c6.342-2.116,9.771-8.984,7.648-15.327l-47.228-127.43l73.596-1.975\r c4.905-0.13,9.262-3.215,11.006-7.802C305.929,181.85,304.717,176.654,301.123,173.306z M202.591,172.455\r c-3.842,0.109-7.4,2.004-9.599,5.163c-2.205,3.147-2.778,7.146-1.561,10.781l48.557,131.467l-39.111,13.075l-48.56-131.455\r c-1.224-3.647-4.093-6.502-7.743-7.679c-3.656-1.188-7.643-0.585-10.772,1.649l-49.216,35.027l34.206-194.281l144.19,134.636\r L202.591,172.455z"})})})}}const Cs=xs;class ws extends o.Component{render(){return(0,l.jsx)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 60 60",style:{enableBackground:"new 0 0 60 60",width:22,height:22},xmlSpace:"preserve",children:(0,l.jsxs)("g",{children:[(0,l.jsx)("path",{d:"M58,37.104V4c0-0.553-0.448-1-1-1H1C0.448,3,0,3.447,0,4v44c0,0.553,0.448,1,1,1h34.003c1.963,4.693,6.6,8,11.997,8\r c7.168,0,13-5.832,13-13C60,41.465,59.26,39.105,58,37.104z M34.359,47H2V5h54v29.622c-0.17-0.164-0.354-0.311-0.532-0.465\r c-0.088-0.075-0.171-0.155-0.261-0.228c-0.235-0.192-0.48-0.37-0.728-0.545c-0.092-0.065-0.181-0.135-0.275-0.198\r c-0.245-0.163-0.498-0.312-0.754-0.458c-0.109-0.063-0.214-0.13-0.325-0.189c-0.077-0.041-0.154-0.083-0.232-0.123\r c0.179-0.385,0.112-0.852-0.218-1.154l-12-11c-0.196-0.179-0.45-0.277-0.72-0.262c-0.265,0.012-0.515,0.129-0.694,0.325\r l-9.794,10.727l-4.743-4.743c-0.374-0.373-0.972-0.391-1.368-0.044L6.339,41.249c-0.415,0.365-0.455,0.997-0.09,1.412\r C6.447,42.886,6.723,43,7,43c0.234,0,0.47-0.082,0.66-0.249l16.313-14.362l10.302,10.301c0.203,0.203,0.47,0.295,0.736,0.287\r C34.361,40.523,34,42.22,34,44c0,0.493,0.033,0.977,0.087,1.456c0.009,0.075,0.024,0.149,0.034,0.224\r c0.056,0.428,0.131,0.849,0.227,1.262C34.353,46.961,34.354,46.981,34.359,47z M48.779,31.136\r c-0.162-0.022-0.321-0.055-0.485-0.071C47.867,31.023,47.435,31,47,31c-4.773,0-8.942,2.593-11.203,6.437\r c-0.036-0.054-0.06-0.114-0.107-0.162l-4.807-4.807l9.181-10.054l9.694,8.887c-0.067-0.015-0.133-0.032-0.2-0.045\r C49.301,31.204,49.039,31.172,48.779,31.136z M47,55c-4.787,0-8.859-3.08-10.367-7.358c-0.094-0.267-0.176-0.536-0.249-0.806\r c-0.015-0.058-0.03-0.115-0.045-0.173c-0.06-0.238-0.112-0.476-0.156-0.716c-0.024-0.133-0.042-0.267-0.061-0.401\r c-0.026-0.18-0.054-0.36-0.071-0.54C36.021,44.674,36,44.339,36,44c0-6.065,4.935-11,11-11c0.426,0,0.848,0.031,1.265,0.079\r c0.127,0.015,0.25,0.039,0.375,0.057c0.291,0.044,0.579,0.096,0.863,0.162c0.141,0.033,0.281,0.07,0.421,0.108\r c0.268,0.074,0.531,0.159,0.792,0.253c0.134,0.048,0.269,0.094,0.4,0.147c0.295,0.119,0.583,0.255,0.866,0.399\r c0.083,0.042,0.17,0.077,0.252,0.121c0.342,0.185,0.671,0.393,0.992,0.614c0.131,0.09,0.255,0.19,0.382,0.286\r c0.199,0.15,0.395,0.305,0.584,0.469c0.127,0.11,0.251,0.224,0.373,0.339c0.193,0.184,0.379,0.377,0.559,0.575\r c0.094,0.103,0.191,0.202,0.281,0.309c0.261,0.311,0.51,0.634,0.739,0.976C57.315,39.643,58,41.743,58,44\r C58,50.065,53.065,55,47,55z"}),(0,l.jsx)("path",{d:"M53,43h-5v-5c0-0.553-0.448-1-1-1s-1,0.447-1,1v5h-5c-0.552,0-1,0.447-1,1s0.448,1,1,1h5v5c0,0.553,0.448,1,1,1\r s1-0.447,1-1v-5h5c0.552,0,1-0.447,1-1S53.552,43,53,43z"}),(0,l.jsx)("path",{d:"M16,25.138c3.071,0,5.569-2.498,5.569-5.568C21.569,16.498,19.071,14,16,14s-5.569,2.498-5.569,5.569\r C10.431,22.64,12.929,25.138,16,25.138z M16,16c1.968,0,3.569,1.602,3.569,3.569S17.968,23.138,16,23.138s-3.569-1.601-3.569-3.568\r S14.032,16,16,16z"})]})})}}const ys=ws;class Ss extends o.Component{render(){return(0,l.jsx)("svg",{fill:"#000000",height:"800px",width:"800px",version:"1.1",id:"Capa_1",viewBox:"0 0 297 297",children:(0,l.jsx)("path",{d:"M148.5,0C66.653,0,0.067,66.616,0.067,148.499C0.067,230.383,66.653,297,148.5,297s148.433-66.617,148.433-148.501\r C296.933,66.616,230.347,0,148.5,0z M158.597,276.411v-61.274c0-5.575-4.521-10.097-10.097-10.097s-10.097,4.521-10.097,10.097\r v61.274c-62.68-4.908-112.845-55.102-117.747-117.814h61.207c5.575,0,10.097-4.521,10.097-10.097s-4.522-10.097-10.097-10.097\r H20.656C25.558,75.69,75.723,25.497,138.403,20.589v61.274c0,5.575,4.521,10.097,10.097,10.097s10.097-4.521,10.097-10.097V20.589\r c62.681,4.908,112.846,55.102,117.747,117.814h-61.207c-5.575,0-10.097,4.521-10.097,10.097s4.521,10.097,10.097,10.097h61.207\r C271.441,221.31,221.276,271.503,158.597,276.411z"})})}}const vs=Ss;class js extends o.Component{render(){return(0,l.jsx)("svg",{fill:"#000000",width:"22px",height:"22px",viewBox:"0 0 75.000000 75.000000",preserveAspectRatio:"xMidYMid meet",children:(0,l.jsx)("g",{transform:"translate(0.000000,75.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none",children:(0,l.jsx)("path",{d:"M337 583 c-4 -3 -7 -46 -7 -95 l0 -88 -100 0 -100 0 0 -140 0 -140\r 240 0 240 0 0 235 0 235 -133 0 c-74 0 -137 -3 -140 -7z m243 -103 l0 -80 -55\r 0 c-42 0 -55 -3 -55 -15 0 -12 13 -15 55 -15 l55 0 0 -110 0 -110 -105 0 -105\r 0 0 50 c0 38 -4 50 -15 50 -11 0 -15 -12 -15 -50 l0 -50 -90 0 -90 0 0 110 0\r 110 100 0 100 0 0 95 0 95 110 0 110 0 0 -80z"})})})}}const Ds=js;class Ts extends o.Component{render(){return(0,l.jsx)("svg",{fill:"#000000",width:"22px",height:"22px",viewBox:"0 0 75.000000 75.000000",preserveAspectRatio:"xMidYMid meet",children:(0,l.jsxs)("g",{transform:"translate(0.000000,75.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none",children:[(0,l.jsx)("path",{d:"M375 654 c-16 -17 -12 -53 9 -66 30 -20 66 0 66 37 0 42 -44 59 -75\r 29z"}),(0,l.jsx)("path",{d:"M311 516 c-44 -34 -70 -87 -71 -143 0 -41 28 -26 35 18 6 37 40 87\r 51 76 7 -7 -23 -150 -45 -208 -12 -30 -32 -70 -46 -89 -27 -36 -31 -55 -15\r -65 25 -15 50 11 96 100 l48 94 40 -36 c55 -49 56 -50 56 -111 0 -50 2 -53 23\r -50 18 2 23 10 25 47 5 65 -3 86 -58 146 -28 30 -50 61 -50 68 0 6 7 32 14 57\r 12 40 15 43 22 23 5 -12 26 -33 47 -47 66 -45 94 -28 32 20 -19 14 -47 49 -63\r 78 -24 45 -31 51 -62 54 -27 1 -45 -6 -79 -32z"})]})})}}const Is=Ts;class _s extends o.Component{render(){return(0,l.jsx)("svg",{fill:"#000000",width:"22px",height:"22px",viewBox:"0 0 75.000000 75.000000",preserveAspectRatio:"xMidYMid meet",children:(0,l.jsx)("g",{transform:"translate(0.000000,75.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none",children:(0,l.jsx)("path",{d:"M299 595 l-84 -52 -5 -49 c-5 -47 -6 -49 -67 -84 l-62 -35 -3 -88\r c-2 -49 0 -97 4 -107 3 -9 49 -39 100 -66 l94 -47 195 114 194 114 3 87 3 87\r -43 27 c-24 15 -88 55 -144 90 l-100 62 -85 -53z m214 -55 c58 -36 107 -67\r 107 -70 0 -3 -31 -23 -70 -44 l-70 -37 -45 32 -45 32 0 80 c0 43 4 77 8 75 4\r -1 56 -32 115 -68z m-143 -15 c0 -63 -3 -76 -19 -85 -28 -15 -31 -13 -31 18 0\r 18 -10 35 -32 53 l-32 27 49 31 c27 17 53 31 57 31 4 0 8 -34 8 -75z m-100\r -35 c0 -4 -7 -10 -15 -14 -10 -4 -15 1 -15 14 0 13 5 18 15 14 8 -4 15 -10 15\r -14z m28 -77 c-3 -45 -6 -49 -46 -71 l-43 -24 -41 27 -41 27 74 44 c41 24 80\r 44 87 44 9 0 12 -13 10 -47z m352 -31 c0 -44 -5 -63 -17 -74 -27 -22 -331\r -198 -343 -198 -7 0 -10 26 -8 73 l3 72 170 92 c94 51 176 92 183 93 8 0 12\r -18 12 -58z m-231 19 l34 -28 -88 -46 c-97 -52 -96 -52 -113 -35 -9 9 -2 17\r 28 35 27 17 40 31 40 46 0 13 11 29 28 39 35 21 32 22 71 -11z m-233 -97 l74\r -46 0 -74 c0 -41 -3 -74 -7 -74 -5 0 -41 17 -80 37 l-73 38 0 83 c0 45 3 82 6\r 82 4 0 40 -21 80 -46z"})})})}}const Ls=_s;class Ms extends o.Component{constructor(e){super(e),this.smallGridSize="metric"===e.measureSystemContext.userUnit?e.svgMeterUnits:O(e.imperialSystemSquareFeetSize,"feet","meter")*e.svgMeterUnits,this.bigGridSizeSmallGridCount=6,this.bigGridSize=this.bigGridSizeSmallGridCount*this.smallGridSize}render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("pattern",{id:"smallGrid",width:this.smallGridSize,height:this.smallGridSize,patternUnits:"userSpaceOnUse",children:(0,l.jsx)("path",{d:"M 30 0 L 0 0 0 30",fill:"none",stroke:"#777",strokeWidth:"0.25"})}),(0,l.jsxs)("pattern",{id:"grid",width:this.bigGridSize,height:this.bigGridSize,patternUnits:"userSpaceOnUse",children:[(0,l.jsx)("rect",{width:this.bigGridSize,height:this.bigGridSize,fill:"url(#smallGrid)"}),(0,l.jsx)("path",{d:"M 200 10 L 200 0 L 190 0 M 0 10 L 0 0 L 10 0 M 0 190 L 0 200 L 10 200 M 190 200 L 200 200 L 200 190",fill:"none",stroke:"#999",strokeWidth:"0.8"})]})]})}}const ks=Ms;class Os extends o.Component{render(){return(0,l.jsx)("div",{className:"indoor-modal",ref:this.props.modalRef,style:this.props.indoorModalContainerStyle||{},children:(0,l.jsx)("div",{className:"indoor-modal-dialog ".concat(this.props.indoorModalDialogClasses||""),style:this.props.indoorModalDialogStyle||{},children:(0,l.jsxs)("div",{className:"indoor-modal-content",children:[(0,l.jsx)("div",{className:"indoor-modal-header",children:(0,l.jsx)("h3",{className:"indoor-modal-title",children:"GLAMOS Indoor Mapping"})}),this.props.modalBody?(0,l.jsx)("div",{className:"indoor-modal-body",children:this.props.modalBody}):null,this.props.modalFooter?(0,l.jsx)("div",{className:"indoor-modal-footer",children:this.props.modalFooter}):null]})})})}}const Rs=Os;var Ps=i(1618);class Fs extends o.Component{render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{ref:this.props.panelRef,className:"panel panel-transition",onMouseMove:()=>this.props.onPanelMouseMove&&this.props.onPanelMouseMove(),style:{width:this.props.panelWidth||200,left:this.props.panelWidth?-this.props.panelWidth:-200},children:(0,l.jsx)("ul",{className:"list-unstyled",children:this.props.children})}),this.props.panelControlRef&&(0,l.jsx)("div",{ref:this.props.panelControlRef,title:"Hide panel",className:"panel-control-container panel-transition svg-center-inside-container",style:this.props.panelControlStyles||{},onClick:()=>this.props.onPanelControlClick(),children:(0,l.jsx)(Ps.Z,{className:"panel-transition"})})]})}}const As=Fs;class Ws extends o.Component{render(){return(0,l.jsxs)("defs",{children:[(0,l.jsxs)("linearGradient",{id:"gradientRed",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#e65d5e",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#e33b3c",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientYellow",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#FDEB71",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#F8D800",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientGreen",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#c0f7d9",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#6ce8a3",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientSky",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#c4e0f4",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#87c8f7",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientOrange",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#f9ad67",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#f97f00",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientWhite",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#f0f0f0",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientGrey",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#666",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#aaa",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientBlue",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#4f72a6",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#365987",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientPurple",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#E2B0FF",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#9F44D3",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientPink",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#f6c4dd",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#f699c7",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientBlack",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#3c3b3b",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#000000",stopOpacity:1})]}),(0,l.jsxs)("linearGradient",{id:"gradientNeutral",x1:"0%",y1:"0%",x2:"100%",y2:"100%",spreadMethod:"pad",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#dbc6a0",stopOpacity:1}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#c69d56",stopOpacity:1})]}),(0,l.jsxs)("radialGradient",{id:"uploadFloorplanCursorCircleGradient",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"#CD0404"}),(0,l.jsx)("stop",{offset:"100%",stopColor:"#FF5D5D"})]}),(0,l.jsx)(ks,{measureSystemContext:this.props.measureSystemContext,svgMeterUnits:this.props.svgMeterUnits,imperialSystemSquareFeetSize:this.props.imperialSystemSquareFeetSize}),(0,l.jsx)("pattern",{id:"floorplan_image_pattern",ref:this.props.floorplanImagePattern,width:0,height:0,patternUnits:"userSpaceOnUse",children:(0,l.jsx)("image",{ref:this.props.floorplanImage,href:"#",x:0,y:0,width:0,height:0,alt:"Floorplan image",preserveAspectRatio:"none"})}),(0,l.jsx)("defs",{ref:this.props.wallMaterialsDefsContainerRef}),(0,l.jsx)("defs",{ref:this.props.roomTexturesDefsContainerRef}),(0,l.jsx)("defs",{children:(0,l.jsx)("marker",{id:"window-rotation-direction-arrow-triangle",viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"strokeWidth",markerWidth:"4",markerHeight:"4",orient:"auto",children:(0,l.jsx)("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#f00"})})})]})}}const Bs=Ws;var Es=i(7483),Vs=i(5542),Ns=i(7579),zs=i(2966),Hs=i(273),Gs=i(7017),qs=i(1332);class Ys extends o.Component{render(){return(0,l.jsxs)("div",{ref:this.props.mainComponentThis.rightControlsBox,className:"right-controls-box right-box-transition",children:[(0,l.jsx)("div",{className:"moveBox move-box-container",children:(0,l.jsxs)("div",{className:"pull-right move-box",children:[(0,l.jsx)("p",{style:{margin:0},children:(0,l.jsx)("button",{title:"Move up",className:"shadow btn btn-default zoom",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoomtop"),children:(0,l.jsx)("div",{className:"svg-center-inside-container",children:(0,l.jsx)(Ns.Z,{})})})}),(0,l.jsxs)("p",{style:{margin:0},children:[(0,l.jsx)("button",{title:"Move left",className:"shadow btn btn-default zoom",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoomleft"),children:(0,l.jsx)("div",{className:"svg-center-inside-container",children:(0,l.jsx)(Vs.Z,{})})}),(0,l.jsx)("button",{title:"Center",className:"btn btn-default zoom",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoomreset"),children:(0,l.jsx)("div",{className:"svg-center-inside-container",children:(0,l.jsx)(Es.Z,{style:{width:18,height:18}})})}),(0,l.jsx)("button",{title:"Move right",className:"shadow btn btn-default zoom",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoomright"),children:(0,l.jsx)("div",{className:"svg-center-inside-container",children:(0,l.jsx)(zs.Z,{})})})]}),(0,l.jsx)("p",{style:{margin:0},children:(0,l.jsx)("button",{title:"Move down",className:"shadow btn btn-default zoom",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoombottom"),children:(0,l.jsx)("div",{className:"svg-center-inside-container",children:(0,l.jsx)(Hs.Z,{})})})})]})}),(0,l.jsx)("div",{ref:this.props.mainComponentThis.mapStylesChangeRef,className:"map-styles-change-container"}),(0,l.jsxs)("div",{className:"zoomBox zoom-box-container",children:[(0,l.jsxs)("div",{className:"pull-right zoom-box",children:[(0,l.jsx)("button",{title:"Zoom in",className:"shadow btn btn btn-default zoom svg-center-inside-container",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoomin"),style:{display:"inline-flex"},children:(0,l.jsx)(Gs.Z,{})}),(0,l.jsx)("button",{title:"Zoom out",className:"shadow btn btn btn-default zoom",onClick:()=>this.props.mainComponentThis.onZoomButonClick("zoomout"),style:{display:"inline-flex"},children:(0,l.jsx)(qs.Z,{})})]}),(0,l.jsx)("div",{style:{clear:"both"}}),(0,l.jsx)("div",{ref:this.props.mainComponentThis.scaleVal,className:"pull-right scale-box",children:"metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"1m":"".concat(this.props.mainComponentThis.imperialSystemSquareFeetSize,"ft")}),(0,l.jsx)("div",{style:{clear:"both"}})]})]})}}const Us=Ys;class Xs extends o.Component{render(){return(0,l.jsxs)("div",{ref:this.props.containerRef,style:this.props.containerStyle||{},className:"rightBox right-box-transition ".concat(this.props.containerClasses||""),children:[(0,l.jsx)("div",{title:this.props.closeButtonTitle||"Close",className:"close-rightBox",onClick:this.props.onCloseRightBox,children:(0,l.jsx)(So.Z,{})}),this.props.children]})}}const Zs=Xs;var Ks=i(2105);class Js extends o.Component{render(){return(0,l.jsx)("svg",{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"22px",height:"20px",viewBox:"-10 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet",style:this.props.style||{},children:(0,l.jsxs)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",stroke:"none",children:[(0,l.jsx)("path",{d:"M2061 5100 c-195 -52 -330 -195 -387 -412 -14 -54 -15 -175 -16 -996\r\nl0 -934 25 -37 c64 -96 207 -92 268 6 l24 38 5 935 5 935 22 41 c28 53 83 100\r\n130 113 26 7 431 11 1235 11 1169 0 1199 0 1250 -20 68 -26 133 -90 158 -158\r\n20 -52 20 -79 20 -1230 0 -770 -4 -1190 -10 -1214 -17 -59 -71 -130 -124 -163\r\nl-49 -30 -926 -5 c-699 -4 -931 -8 -947 -17 -37 -22 -83 -82 -90 -119 -9 -51\r\n9 -104 51 -144 l36 -35 932 -3 c647 -2 948 1 985 9 95 19 209 85 287 163 81\r\n82 127 163 155 272 19 75 20 115 20 1278 0 1302 1 1272 -55 1390 -59 126 -156\r\n223 -283 286 -125 62 -79 60 -1422 59 -1179 0 -1228 -1 -1299 -19z"}),(0,l.jsx)("path",{d:"M3300 4448 c-107 -30 -152 -167 -83 -249 49 -58 55 -59 383 -59 165\r\n0 300 -3 300 -8 0 -4 -720 -727 -1601 -1607 -880 -880 -1607 -1612 -1615\r\n-1627 -20 -39 -18 -117 6 -155 36 -60 107 -90 174 -72 36 9 232 201 1651 1620\r\n886 885 1613 1609 1618 1609 4 0 7 -133 7 -296 0 -331 2 -344 69 -390 71 -48\r\n169 -27 225 49 21 28 21 39 24 520 2 271 0 511 -3 535 -9 60 -60 116 -120 131\r\n-56 14 -984 14 -1035 -1z"}),(0,l.jsx)("path",{d:"M373 2456 c-178 -44 -325 -195 -362 -374 -15 -74 -15 -1630 0 -1704\r\n27 -130 119 -254 235 -315 121 -65 96 -63 986 -63 550 0 824 4 860 11 167 35\r\n303 156 357 317 20 59 21 81 21 590 l0 529 -22 33 c-32 47 -68 71 -116 77 -55\r\n7 -123 -26 -154 -75 l-23 -37 -5 -515 c-5 -495 -6 -516 -25 -542 -11 -15 -38\r\n-37 -61 -48 -40 -20 -54 -20 -842 -18 -791 3 -801 3 -828 24 -15 11 -37 33\r\n-48 48 -21 27 -21 37 -24 825 l-2 797 23 44 c16 30 37 51 67 67 l43 23 495 0\r\n495 0 42 25 c100 58 101 196 2 269 -28 21 -38 21 -545 23 -388 1 -530 -2 -569\r\n-11z"})]})})}}const Qs=Js;class $s extends o.Component{render(){return(0,l.jsxs)("svg",{width:"20px",height:"20px",viewBox:"0 0 24 24",strokeWidth:"2px",stroke:"#19ab7f",xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("path",{d:"M10.57,5.8l2.71-2.72a5.4,5.4,0,0,1,7.64,7.64L18.2,13.43"}),(0,l.jsx)("path",{d:"M5.8,10.57,3.08,13.28a5.4,5.4,0,0,0,7.64,7.64l2.71-2.72"}),(0,l.jsx)("line",{x1:"16.77",y1:"7.23",x2:"7.23",y2:"16.77"})]})}}const en=$s;class tn extends o.Component{render(){return(0,l.jsxs)("svg",{width:"20px",height:"20px",viewBox:"0 0 24 24",strokeWidth:"2px",stroke:"#4b4b5a",children:[(0,l.jsx)("path",{d:"M10.56,5.77l2.72-2.72a5.43,5.43,0,0,1,3.84-1.59,5.43,5.43,0,0,1,5.42,5.42A5.43,5.43,0,0,1,21,10.72l-2.72,2.72"}),(0,l.jsx)("path",{d:"M5.77,10.56,3.05,13.28A5.42,5.42,0,1,0,10.72,21l2.72-2.72"}),(0,l.jsx)("line",{x1:"16.79",y1:"7.21",x2:"7.21",y2:"16.79"}),(0,l.jsx)("line",{x1:"20.63",y1:"15.83",x2:"23.5",y2:"15.83"}),(0,l.jsx)("line",{x1:"15.83",y1:"20.63",x2:"15.83",y2:"23.5"}),(0,l.jsx)("line",{x1:"19.19",y1:"19.19",x2:"21.1",y2:"21.1"}),(0,l.jsx)("line",{x1:"3.38",y1:"8.17",x2:"0.5",y2:"8.17"}),(0,l.jsx)("line",{x1:"8.17",y1:"3.38",x2:"8.17",y2:"0.5"}),(0,l.jsx)("line",{x1:"4.81",y1:"4.81",x2:"2.9",y2:"2.9"})]})}}const on=tn;var sn=i(1317);class nn extends o.Component{constructor(e){var t;super(e),t=this,this.onInsertFlorplanImageClose=function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.props.mainComponentThis.translateRightBox(t.props.floorplanImageTools.current,250,!1),t.resetUploadFloorplanImageTools(),i||(t.props.mainComponentThis.foncButton("select_mode"),t.props.mainComponentThis.boxInfo.current.innerHTML="Select mode")},this.resetUploadFloorplanImageTools=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.setState({scaleButtonClicked:!1,floorplanScalingFirstClick:!1,showWallLengthInput:!1,translateButtonClicked:!1,floorplanTranslationFirstClick:!1,floorplanImageUploaded:!e&&t.state.floorplanImageUploaded})},this.onInsertFloorplanImageDeleteButtonClick=()=>{this.props.mainComponentThis.foncButton("select_mode"),this.props.mainComponentThis.boxInfo.current.innerHTML="Select mode",this.props.mainComponentThis.translateRightBox(this.props.floorplanImageTools.current,250,!1),mt(this.props.boxFloorplanImage.current),this.resetLayoutState(),this.props.mainComponentThis.zoom_maker("zoomreset",this.props.mainComponentThis.zoomXMove,this.props.mainComponentThis.zoomXView)},this.resetLayoutState=()=>{this.state.floorplanImageUploaded&&(at(this.props.uploadImageFloorplanSettingsIconRef.current,this.props.mainComponentThis.othersTimeout,null,!1),sn.log("Hide hide icon"),at(this.props.uploadFloorplanImageStatusContainerRef.current,this.props.mainComponentThis.othersTimeout,null,!1),at(this.props.uploadImageFloorplanHideRef.current,0,null,!1),at(this.props.uploadImageFloorplanShowRef.current,0,null,!1),!this.props.boxFloorplanImage.current.classList.contains("fade-in")&&nt(this.props.boxFloorplanImage.current,this.props.mainComponentThis.othersTimeout,null,"inline",!1),this.floorplanLength.current.setValue(""),this.floorplanLength.current.setInitialValue(""),this.floorplanWidth.current.setValue(""),this.floorplanWidth.current.setInitialValue(""),this.floorplanImageInput.current.value="",at(this.floorplanImageToolsDeleteButtonRef.current,this.props.mainComponentThis.othersTimeout,(()=>this.setState({floorplanImageUploaded:!1})),!1))},this.onUploadFloorplanImageInputChange=()=>e=>{this.uploadedFloorplanImage=e.target.files[0],this.resetUploadFloorplanImageTools(!0),nt(this.explanationBox.current,this.props.mainComponentThis.othersTimeout,null,"flex",!1)},this.getFloorplanImageBoundingBox=()=>({minX:this.floorplanBoundingBoxCurrentParams.originX,maxX:this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width,minY:this.floorplanBoundingBoxCurrentParams.originY,maxY:this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length}),this.centerAndShowWholeFloorplanImage=()=>{const e={x:this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width/2,y:this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length/2};this.props.mainComponentThis.centerAndShowWholeBoxOperations(e,this.getFloorplanImageBoundingBox(),!1)},this.onExplanationConfirmedCallback=()=>{this.setState({floorplanImageUploaded:!0,preserveAspectRatio:!0},(()=>{let e=new Image,t=window.URL||window.webkitURL||window,i=t.createObjectURL(this.uploadedFloorplanImage);e.onload=()=>{this.floorplanAspectRatio=e.width/e.height,this.floorplanInitialWidth=this.floorplanImageInitialSvgWidth,this.floorplanInitialLength=this.floorplanInitialWidth/this.floorplanAspectRatio,t.revokeObjectURL(i),this.floorplanBoundingBoxCurrentParams.originX=200-this.props.mainComponentThis.offset.left,this.floorplanBoundingBoxCurrentParams.originY=24,this.floorplanBoundingBoxCurrentParams.width=this.floorplanInitialWidth,this.floorplanBoundingBoxCurrentParams.length=this.floorplanInitialLength,this.drawUploadedFloorplanImage(),this.props.mainComponentThis.zoom_maker("zoomreset",this.props.mainComponentThis.zoomXMove,this.props.mainComponentThis.zoomXView),nt(this.props.uploadFloorplanImageStatusContainerRef.current,this.props.mainComponentThis.othersTimeout,null,"block",!1),"none"===this.props.uploadImageFloorplanHideRef.current.style.display&&"none"===this.props.uploadImageFloorplanShowRef.current.style.display&&(nt(this.props.uploadImageFloorplanHideRef.current,0,null,"inline",!1),this.props.uploadFloorplanImageStatusContainerRef.current.title="Hide floorplan image"),nt(this.props.uploadImageFloorplanSettingsIconRef.current,this.props.mainComponentThis.othersTimeout,null,"inline",!1),nt(this.floorplanImageToolsDeleteButtonRef.current,this.props.mainComponentThis.othersTimeout,null,"block",!1),L()||(this.props.mainComponentThis.boxInfo.current.innerHTML="Hold <b>SHIFT</b> to drag around floorplan.")},e.src=i}))},this.drawUploadedFloorplanImage=()=>{mt(this.props.boxFloorplanImage.current);const e=this.floorplanImageInput.current.files[0];this.props.mainComponentThis.editor.createAndShowBoxMeasures(this.floorplanBoundingBoxCurrentParams.originX,this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width,this.floorplanBoundingBoxCurrentParams.originY,this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length,this.props.boxFloorplanImage,{color:"#ffcc00",strokeWidth:1}),this.props.floorplanImagePattern.current.setAttribute("x",this.floorplanBoundingBoxCurrentParams.originX),this.props.floorplanImagePattern.current.setAttribute("y",this.floorplanBoundingBoxCurrentParams.originY),this.props.floorplanImagePattern.current.setAttribute("height",this.floorplanBoundingBoxCurrentParams.length),this.props.floorplanImagePattern.current.setAttribute("width",this.floorplanBoundingBoxCurrentParams.width),this.props.floorplanImage.current.setAttribute("height",this.floorplanBoundingBoxCurrentParams.length),this.props.floorplanImage.current.setAttribute("width",this.floorplanBoundingBoxCurrentParams.width);let t=new FileReader;t.onload=e=>{this.props.floorplanImage.current.setAttribute("href",e.target.result),sn.log("Atrribute setted")},t.onerror=()=>{this.props.mainComponentThis.boxInfo.current.innerHTML="Ooops. An error happened. Cannot load image."},t.readAsDataURL(e);let i="M".concat(this.floorplanBoundingBoxCurrentParams.originX,",").concat(this.floorplanBoundingBoxCurrentParams.originY,"\n            L").concat(this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width,",").concat(this.floorplanBoundingBoxCurrentParams.originY,"\n            L").concat(this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width,",").concat(this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length,"\n            L").concat(this.floorplanBoundingBoxCurrentParams.originX,",").concat(this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length,"\n            L").concat(this.floorplanBoundingBoxCurrentParams.originX,",").concat(this.floorplanBoundingBoxCurrentParams.originY);this.props.mainComponentThis.qSVG.create(this.props.boxFloorplanImage,"path",{id:"floorplan-image-path",d:i,fill:"url(#floorplan_image_pattern)","fill-opacity":1,stroke:"none"});const o=Ft(this.floorplanBoundingBoxCurrentParams.width/this.props.mainComponentThis.meter,this.props.mainComponentThis.measureSystemContext.userUnit,"meter","feet",this.floorplanDimensionsDecimalPrecision),s=Ft(this.floorplanBoundingBoxCurrentParams.length/this.props.mainComponentThis.meter,this.props.mainComponentThis.measureSystemContext.userUnit,"meter","feet",this.floorplanDimensionsDecimalPrecision);this.floorplanWidth.current.setValue(o),this.floorplanWidth.current.setInitialValue(o),this.floorplanLength.current.setValue(s),this.floorplanLength.current.setInitialValue(s),this.setState({originX:T(this.floorplanBoundingBoxCurrentParams.originX,this.originTranslateDecimalPrecision),originY:T(this.floorplanBoundingBoxCurrentParams.originY,this.originTranslateDecimalPrecision),width:o,length:s})},this.translateFloorplan=(e,t)=>{const i=this.wallTranslateGroup.querySelector("#originCircle").getAttribute("cx"),o=this.wallTranslateGroup.querySelector("#originCircle").getAttribute("cy"),s=(e.x-i)*t,n=(e.y-o)*t;this.floorplanBoundingBoxCurrentParams.originX=this.floorplanBoundingBoxCurrentParams.originX+s,this.floorplanBoundingBoxCurrentParams.originY=this.floorplanBoundingBoxCurrentParams.originY+n,this.drawUploadedFloorplanImage(),mt(this.wallTranslateGroup)},this.handleMouseDownAction=e=>{const t=[{x:this.floorplanBoundingBoxCurrentParams.originX,y:this.floorplanBoundingBoxCurrentParams.originY},{x:this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width,y:this.floorplanBoundingBoxCurrentParams.originY},{x:this.floorplanBoundingBoxCurrentParams.originX+this.floorplanBoundingBoxCurrentParams.width,y:this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length},{x:this.floorplanBoundingBoxCurrentParams.originX,y:this.floorplanBoundingBoxCurrentParams.originY+this.floorplanBoundingBoxCurrentParams.length}];if("floorplan_image_translation"===this.props.mainComponentThis.mode)if(this.state.floorplanTranslationFirstClick)if(this.state.floorplanTranslationIsOutsideClick)if(jt(e,t))this.translateFloorplan(e,-1),this.setState({floorplanTranslationFirstClick:!1,floorplanTranslationIsOutsideClick:!1});else{const t=this.wallTranslateGroup.querySelector("#originCircle");t.setAttribute("cx",e.x),t.setAttribute("cy",e.y)}else this.translateFloorplan(e,1),this.setState({floorplanTranslationFirstClick:!1});else{this.wallTranslateGroup?mt(this.wallTranslateGroup):this.wallTranslateGroup=this.props.mainComponentThis.qSVG.create("none","g",{class:"floorplan-image-translate-group"});const i=this.props.mainComponentThis.qSVG.create("none","circle",{id:"originCircle",cx:e.x,cy:e.y,r:this.circleRadius,fill:"#ff0000"});this.wallTranslateGroup.appendChild(i),this.props.boxFloorplanImage.current.appendChild(this.wallTranslateGroup),this.setState({floorplanTranslationFirstClick:!0,floorplanTranslationIsOutsideClick:!jt(e,t)})}else if(jt(e,t))if(this.state.floorplanScalingFirstClick){const t=this.props.mainComponentThis.qSVG.create("none","circle",{id:"endCircle",cx:e.x,cy:e.y,r:this.circleRadius,fill:"#ff0000"});this.wallLineGroup.appendChild(t),this.props.mainComponentThis.boxInfo.current.innerHTML="Insert selected line length in ".concat("metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"meters(m)":"feet(ft)"),this.setState({floorplanScalingFirstClick:!1,showWallLengthInput:!0},(()=>{this.selectedWallLengthInput.current.setValue(""),this.selectedWallLengthInput.current.setInitialValue("")}))}else{this.wallLineGroup?mt(this.wallLineGroup):this.wallLineGroup=this.props.mainComponentThis.qSVG.create("none","g",{class:"floorplan-image-scaling-group"});const t=this.props.mainComponentThis.qSVG.create("none","line",{x1:e.x,y1:e.y,x2:e.x,y2:e.y,"stroke-width":this.lineThick,stroke:"#4b4b5a"});this.wallLineGroup.appendChild(t);const i=this.props.mainComponentThis.qSVG.create("none","circle",{id:"startCircle",cx:e.x,cy:e.y,r:this.circleRadius,fill:"#ff0000"});this.wallLineGroup.appendChild(i),this.props.boxFloorplanImage.current.appendChild(this.wallLineGroup),this.setState({floorplanScalingFirstClick:!0,showWallLengthInput:!1})}},this.onWallLengthConfirmClick=()=>{const e=At(parseFloat(this.selectedWallLengthInput.current.getValue()),this.props.mainComponentThis.measureSystemContext.userUnit)*this.props.mainComponentThis.meter;let t=this.wallLineGroup.querySelector("#startCircle"),i=this.wallLineGroup.querySelector("#endCircle");const o=Mt({x:t.getAttribute("cx"),y:t.getAttribute("cy")},{x:i.getAttribute("cx"),y:i.getAttribute("cy")}),s=T(e/o*this.state.scalingFactor,this.scaleFactorDecimalPrecision);this.floorplanBoundingBoxCurrentParams.width=this.floorplanInitialWidth*s,this.floorplanBoundingBoxCurrentParams.length=this.floorplanInitialLength*s,this.drawUploadedFloorplanImage(),this.setState({showWallLengthInput:!1,scalingFactor:s})},this.onScaleButtonClick=()=>{this.state.scaleButtonClicked?(this.props.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group")&&this.props.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group").remove(),this.props.mainComponentThis.mode="upload_floorplan_image_mode"):(this.props.boxFloorplanImage.current.querySelector(".floorplan-image-translate-group")&&this.props.boxFloorplanImage.current.querySelector(".floorplan-image-translate-group").remove(),this.props.mainComponentThis.mode="floorplan_image_scaling"),this.setState({scaleButtonClicked:!this.state.scaleButtonClicked,floorplanScalingFirstClick:!1,translateButtonClicked:!1,floorplanTranslationFirstClick:!1,showWallLengthInput:!this.state.scaleButtonClicked&&this.state.showWallLengthInput})},this.onTranslateButtonClick=()=>{this.state.translateButtonClicked?(this.props.mainComponentThis.mode="upload_floorplan_image_mode",this.props.boxFloorplanImage.current.querySelector(".floorplan-image-translate-group")&&this.props.boxFloorplanImage.current.querySelector(".floorplan-image-translate-group").remove()):(this.props.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group")&&this.props.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group").remove(),this.props.mainComponentThis.mode="floorplan_image_translation"),this.setState({translateButtonClicked:!this.state.translateButtonClicked,floorplanTranslationFirstClick:!1,scaleButtonClicked:!1,floorplanScalingFirstClick:!1,showWallLengthInput:!1})},this.handleAspectRatioButtonClick=()=>{this.setState({preserveAspectRatio:!this.state.preserveAspectRatio})},this.onFloorplanInputWidthChanged=()=>{const e=this.floorplanWidth.current.getValue();e!==this.state.width&&(this.floorplanBoundingBoxCurrentParams.width=At(parseFloat(e),this.props.mainComponentThis.measureSystemContext.userUnit)*this.props.mainComponentThis.meter,this.state.preserveAspectRatio&&(this.floorplanBoundingBoxCurrentParams.length=this.floorplanBoundingBoxCurrentParams.width/this.floorplanAspectRatio),this.drawUploadedFloorplanImage())},this.onFloorplanInputLengthChanged=()=>{const e=this.floorplanLength.current.getValue();e!==this.state.length&&(this.floorplanBoundingBoxCurrentParams.length=At(parseFloat(e),this.props.mainComponentThis.measureSystemContext.userUnit)*this.props.mainComponentThis.meter,this.state.preserveAspectRatio&&(this.floorplanBoundingBoxCurrentParams.width=this.floorplanAspectRatio*this.floorplanBoundingBoxCurrentParams.length),this.drawUploadedFloorplanImage())},this.onScaleFactorInputChange=e=>{this.state.scalingFactor!==e&&(this.floorplanBoundingBoxCurrentParams.width=this.floorplanInitialWidth*e,this.floorplanBoundingBoxCurrentParams.length=this.floorplanInitialLength*e,this.drawUploadedFloorplanImage(),this.setState({scalingFactor:e,floorplanScalingFirstClick:!1,showWallLengthInput:!1}))},this.onFloorplanOriginXInputChange=e=>{e!==this.state.originX&&(this.floorplanBoundingBoxCurrentParams.originX=e,this.drawUploadedFloorplanImage(),this.setState({originX:e}))},this.onFloorplanOriginYInputChange=e=>{this.state.originY!==e&&(this.floorplanBoundingBoxCurrentParams.originY=e,this.drawUploadedFloorplanImage(),this.setState({originY:e}))},this.state={floorplanImageUploaded:!1,floorplanScalingFirstClick:!1,showWallLengthInput:!1,floorplanTranslationFirstClick:!1,floorplanTranslationIsOutsideClick:!1,scaleButtonClicked:!1,translateButtonClicked:!1,preserveAspectRatio:!0,scalingFactor:1,originX:0,originY:0,width:0,length:0},this.floorplanDimensionsInputStep=(e.mainComponentThis.measureSystemContext.userUnit,.1),this.floorplanDimensionsDecimalPrecision=-Math.log10(this.floorplanDimensionsInputStep),this.lineLengthInputStep="metric"===e.mainComponentThis.measureSystemContext.userUnit?.01:.1,this.lineLengthDecimalPrecision=-Math.log10(this.lineLengthInputStep),this.scaleFactorInputStep=.01,this.scaleFactorDecimalPrecision=-Math.log10(this.scaleFactorInputStep),this.originTranslateInputStep=1,this.originTranslateDecimalPrecision=-Math.log10(this.originTranslateInputStep),this.wallTranslateGroup=null,this.wallLineGroup=null,this.circleRadius=e.mainComponentThis.meter/6,this.lineThick=e.mainComponentThis.meter/8,this.floorplanAspectRatio=0,this.uploadedImagePixelToSvgUnitRatio=1,this.floorplanImageInitialSvgWidth=20*e.mainComponentThis.meter,this.floorplanBoundingBoxCurrentParams={originX:0,originY:0,width:0,length:0},this.floorplanInitialWidth=null,this.floorplanInitialLength=null,this.uploadedFloorplanImage=null,this.floorplanLength=o.createRef(),this.floorplanWidth=o.createRef(),this.floorplanImageInput=o.createRef(),this.floorplanImageToolsDeleteButtonRef=o.createRef(),this.selectedWallLengthInput=o.createRef(),this.scaleFactorInput=o.createRef(),this.explanationBox=o.createRef(),this.onInsertFloorplanImageDeleteButtonClick=this.onInsertFloorplanImageDeleteButtonClick.bind(this),this.onInsertFlorplanImageClose=this.onInsertFlorplanImageClose.bind(this),this.resetUploadFloorplanImageTools=this.resetUploadFloorplanImageTools.bind(this),this.handleMouseDownAction=this.handleMouseDownAction.bind(this),this.translateFloorplan=this.translateFloorplan.bind(this),this.onWallLengthConfirmClick=this.onWallLengthConfirmClick.bind(this),this.drawUploadedFloorplanImage=this.drawUploadedFloorplanImage.bind(this),this.onScaleButtonClick=this.onScaleButtonClick.bind(this),this.onTranslateButtonClick=this.onTranslateButtonClick.bind(this),this.onUploadFloorplanImageInputChange=this.onUploadFloorplanImageInputChange.bind(this),this.onExplanationConfirmedCallback=this.onExplanationConfirmedCallback.bind(this),this.handleAspectRatioButtonClick=this.handleAspectRatioButtonClick.bind(this),this.onFloorplanInputWidthChanged=this.onFloorplanInputWidthChanged.bind(this),this.onFloorplanInputLengthChanged=this.onFloorplanInputLengthChanged.bind(this),this.onScaleFactorInputChange=this.onScaleFactorInputChange.bind(this),this.onFloorplanOriginXInputChange=this.onFloorplanOriginXInputChange.bind(this),this.onFloorplanOriginYInputChange=this.onFloorplanOriginYInputChange.bind(this),this.getFloorplanImageBoundingBox=this.getFloorplanImageBoundingBox.bind(this),this.centerAndShowWholeFloorplanImage=this.centerAndShowWholeFloorplanImage.bind(this),this.resetLayoutState=this.resetLayoutState.bind(this)}render(){return sn.log(this.state),(0,l.jsxs)(Zs,{containerStyle:{width:250,right:-250},containerRef:this.props.floorplanImageTools,onCloseRightBox:this.onInsertFlorplanImageClose,children:[(0,l.jsxs)("div",{ref:this.explanationBox,className:"upload-floorplan-image-explanation-box hidden",children:[(0,l.jsxs)("h3",{children:["Floorplan dimensions are set to ",(0,l.jsx)("b",{children:"fixed values"}),"."," "]}),(0,l.jsxs)("h3",{children:["You can change them to the actual values either by ",(0,l.jsx)("b",{children:"direct input"})," or using our ",(0,l.jsx)("b",{children:"Click&Scale"})," ","feature."]})," ",(0,l.jsxs)("h3",{children:["For floorplan translation on drawing area use ",(0,l.jsx)("b",{children:"Click&Translate"}),"."]}),(0,l.jsx)("h3",{children:(0,l.jsx)("b",{children:"NOTE: 1 grid square equals ".concat("metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"1 meter":"".concat(this.props.mainComponentThis.imperialSystemSquareFeetSize," feet"))})}),(0,l.jsx)(ai,{type:"primary",onClick:()=>at(this.explanationBox.current,this.props.mainComponentThis.othersTimeout,this.onExplanationConfirmedCallback,!1),children:"Got it"})]}),(0,l.jsx)(Mi,{label:"Upload floorplan image from your local device",labelStyle:{display:"block",fontSize:"1.17em",margin:"1em 0",fontWeight:"bold"},inputRef:this.floorplanImageInput,type:"file",accept:"image/png, image/jpeg",onChange:this.onUploadFloorplanImageInputChange}),this.state.floorplanImageUploaded?(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{ref:this.floorplanImageToolsDeleteButtonRef,className:"button-centered-container hidden form-group",children:(0,l.jsx)(ai,{type:"delete",onClick:this.onInsertFloorplanImageDeleteButtonClick,children:"Delete uploaded image"})}),(0,l.jsx)(Ai,{label:"Floorplan width(".concat("metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"m":"ft",")"),children:(0,l.jsx)(Si,{ref:this.floorplanWidth,placeholder:"Floorplan width",inputStep:this.floorplanDimensionsInputStep,inputMin:this.floorplanDimensionsInputStep,inputMax:1/0,inputStyle:{textAlign:"left"},callOnlyOnBlur:!0,hideNumberArrows:!0,onInputValueChanged:this.onFloorplanInputWidthChanged,defaultValue:"",checkInputValueChangeBeforeCall:!0})}),(0,l.jsxs)("div",{className:"preserve-aspect-ratio-container",children:[(0,l.jsx)("div",{className:"svg-action-icon-container button-with-icon svg-center-inside-container",onClick:this.handleAspectRatioButtonClick,title:this.state.preserveAspectRatio?"Preserve aspect ratio":"No aspect ratio",children:this.state.preserveAspectRatio?(0,l.jsx)(en,{}):(0,l.jsx)(on,{})}),(0,l.jsx)("label",{className:"label form-control",children:"Floorplan aspect ratio"})]}),(0,l.jsx)(Ai,{label:"Floorplan length(".concat("metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"m":"ft",")"),children:(0,l.jsx)(Si,{ref:this.floorplanLength,placeholder:"Floorplan length",inputStep:this.floorplanDimensionsInputStep,inputMin:this.floorplanDimensionsInputStep,inputMax:1/0,inputStyle:{textAlign:"left"},callOnlyOnBlur:!0,hideNumberArrows:!0,onInputValueChanged:this.onFloorplanInputLengthChanged,defaultValue:"",checkInputValueChangeBeforeCall:!0})}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsxs)(ai,{type:this.state.scaleButtonClicked?"primary":"dull",className:"button-with-icon",onClick:this.onScaleButtonClick,children:[(0,l.jsx)(Qs,{style:{fill:this.state.scaleButtonClicked?"#ffffff":"#4b4b5a"}}),"Click&Scale"]})}),this.state.scaleButtonClicked&&(0,l.jsxs)(o.Fragment,{children:[(0,l.jsxs)("div",{className:"upload-floorplan-info-container",children:[(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(bi.Z,{})}),(0,l.jsx)("p",{children:this.state.showWallLengthInput?(0,l.jsx)("span",{children:(0,l.jsx)("b",{children:"Insert selected line length in ".concat("metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"meters(m)":"feet(ft)")})}):(0,l.jsxs)("span",{children:[(0,l.jsx)("b",{children:"Select 2 points"})," on floorplan image for which you know the exact length"]})}),(0,l.jsx)("p",{children:"Click button to exit scaling mode"}),this.state.showWallLengthInput&&(0,l.jsxs)(Ai,{containerStyle:{marginTop:"0.5rem"},children:[(0,l.jsx)(Si,{ref:this.selectedWallLengthInput,placeholder:"Insert line length(".concat("metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"m":"ft",")"),inputStyle:{marginBottom:"0.5rem",border:"1px solid #19ab7f"},inputStep:this.lineLengthInputStep,inputMin:this.lineLengthInputStep,inputMax:1/0,defaultValue:"",checkInputValueChangeBeforeCall:!0}),(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsx)(ai,{type:"primary",onClick:this.onWallLengthConfirmClick,children:"Confirm"})})]}),(0,l.jsxs)("div",{className:"line-divider-container",children:[(0,l.jsx)("hr",{}),(0,l.jsx)("b",{children:"OR"}),(0,l.jsx)("hr",{})]}),(0,l.jsx)("p",{children:"Insert scale factor value directly"})]}),(0,l.jsx)(Ai,{containerStyle:{marginBottom:0},label:"Scale factor",children:(0,l.jsx)(Di,{ref:this.scaleFactorInput,placeholder:"Scale factor",inputStep:this.scaleFactorInputStep,inputMin:this.scaleFactorInputStep,inputMax:1/0,usePropsValue:!0,value:this.state.scalingFactor,onInputValueChanged:this.onScaleFactorInputChange})})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsxs)(ai,{type:this.state.translateButtonClicked?"primary":"dull",className:"button-with-icon",onClick:this.onTranslateButtonClick,children:[(0,l.jsx)(Ks.Z,{style:{width:20,height:20,fill:this.state.translateButtonClicked?"#ffffff":"#4b4b5a"}}),"Click&Translate"]})}),this.state.translateButtonClicked&&(0,l.jsxs)(o.Fragment,{children:[(0,l.jsxs)("div",{className:"upload-floorplan-info-container",children:[(0,l.jsx)("div",{className:"popup-icon-container",children:(0,l.jsx)(bi.Z,{})}),(0,l.jsx)("p",{children:this.state.floorplanTranslationFirstClick?(0,l.jsx)("span",{children:this.state.floorplanTranslationIsOutsideClick?(0,l.jsxs)("span",{children:[(0,l.jsx)("b",{children:"Select floorplan point"})," which you want to translate to the origin point"]}):(0,l.jsxs)("span",{children:[(0,l.jsx)("b",{children:"Select location"})," to which you want to translate the selected floorplan point"]})}):(0,l.jsxs)("span",{children:[(0,l.jsx)("b",{children:"Select origin point"})," of translation"]})}),(0,l.jsx)("p",{children:"Click button to exit translation mode"}),(0,l.jsxs)("div",{className:"line-divider-container",children:[(0,l.jsx)("hr",{}),(0,l.jsx)("b",{children:"OR"}),(0,l.jsx)("hr",{})]}),(0,l.jsx)("p",{children:"Insert offset values directly"})]}),(0,l.jsx)(Ai,{label:"Horizontal offset",children:(0,l.jsx)(Di,{placeholder:"Horizontal offset",inputStep:this.originTranslateInputStep,inputMin:-1/0,inputMax:1/0,usePropsValue:!0,value:this.state.originX,onInputValueChanged:this.onFloorplanOriginXInputChange})}),(0,l.jsx)(Ai,{label:"Vertical offset",containerStyle:{marginBottom:0},children:(0,l.jsx)(Di,{placeholder:"Vertical offset",inputStep:this.originTranslateInputStep,inputMin:-1/0,inputMax:1/0,usePropsValue:!0,value:this.state.originY,onInputValueChanged:this.onFloorplanOriginYInputChange})})]})]})]}):null]})}}const an=nn;class rn extends o.Component{render(){return(0,l.jsx)(Ai,{containerStyle:{marginBottom:this.props.sizePoliceComponent?0:"0.5rem"},label:!this.props.sizePoliceComponent&&this.props.valueLabelText,children:(0,l.jsx)("input",{ref:this.props.sliderInputRef,type:"range",disabled:this.props.disabled,step:this.props.sliderStep,min:this.props.minValue,max:this.props.maxValue,className:"range ".concat(this.props.disabled?"disabled":""),onChange:this.props.disabled?void 0:this.props.onSliderChange,onMouseUp:()=>!this.props.disabled&&this.props.onSliderChangeFinished&&this.props.onSliderChangeFinished()})})}}const ln=rn;class hn extends o.Component{render(){return(0,l.jsx)("div",{children:(0,l.jsx)(Si,{ref:this.props.inputNumberComponentRef,inputStep:this.props.sliderStep,disabled:this.props.disabled,inputMin:this.props.minValue,inputMax:this.props.maxValue,onInputValueChanged:this.props.onInputChange,checkInputValueChangeBeforeCall:!1})})}}const cn=hn;class dn extends o.Component{constructor(){super(),this.onSliderChange=e=>{this.props.onSliderValueChanged(e.target.value),this.inputNumberComponentRef.current.setValue(this.props.sliderInputRef.current.value)},this.onInputChange=()=>{this.props.sliderInputRef.current.value=this.inputNumberComponentRef.current.getValue(),this.props.onSliderValueChanged(this.props.sliderInputRef.current.value),this.props.onSliderChangeFinished&&this.props.onSliderChangeFinished()},this.setNumberInputInitialValues=e=>{this.inputNumberComponentRef.current.setInitialValue(e),this.inputNumberComponentRef.current.setValue(e)},this.setMaxMinRangeValues=(e,t)=>{this.props.sliderInputRef.current.setAttribute("min",e),this.props.sliderInputRef.current.setAttribute("max",t),this.inputNumberComponentRef.current.setRangeValues(e,t)},this.containerRef=o.createRef(),this.inputNumberComponentRef=o.createRef(),this.setMaxMinRangeValues=this.setMaxMinRangeValues.bind(this),this.setNumberInputInitialValues=this.setNumberInputInitialValues.bind(this),this.onSliderChange=this.onSliderChange.bind(this),this.onInputChange=this.onInputChange.bind(this)}componentDidMount(){this.props.defaultValue&&(this.props.sliderInputRef.current.value=this.props.defaultValue,this.inputNumberComponentRef.current.setValue(this.props.defaultValue),this.inputNumberComponentRef.current.setInitialValue(this.props.defaultValue))}render(){return(0,l.jsxs)("div",{ref:this.containerRef,className:"form-group",children:[this.props.sizePoliceComponent&&this.props.sizePoliceComponent,this.props.sizePoliceComponent?(0,l.jsxs)("div",{className:"modify-size-police-container",children:[(0,l.jsx)(ln,{disabled:this.props.disabled,valueLabelText:this.props.valueLabelText,sizePoliceComponent:this.props.sizePoliceComponent,sliderInputRef:this.props.sliderInputRef,sliderStep:this.props.sliderStep,minValue:this.props.minValue,maxValue:this.props.maxValue,onSliderChange:this.onSliderChange,onSliderChangeFinished:this.props.onSliderChangeFinished}),(0,l.jsx)(cn,{disabled:this.props.disabled,inputNumberComponentRef:this.inputNumberComponentRef,sliderStep:this.props.sliderStep,minValue:this.props.minValue,maxValue:this.props.maxValue,onInputChange:this.onInputChange})]}):(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(ln,{disabled:this.props.disabled,valueLabelText:this.props.valueLabelText,sliderInputRef:this.props.sliderInputRef,sliderStep:this.props.sliderStep,minValue:this.props.minValue,maxValue:this.props.maxValue,onSliderChange:this.onSliderChange,onSliderChangeFinished:this.props.onSliderChangeFinished}),(0,l.jsx)(cn,{disabled:this.props.disabled,inputNumberComponentRef:this.inputNumberComponentRef,sliderStep:this.props.sliderStep,minValue:this.props.minValue,maxValue:this.props.maxValue,onInputChange:this.onInputChange})]})]})}}const pn=dn;class mn extends o.Component{constructor(){var e;super(),e=this,this.setCheckedStatus=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.setState({checked:t},(()=>!!i&&i()))},this.getCheckedStatus=()=>this.state.checked,this.state={checked:!1},this.setCheckedStatus=this.setCheckedStatus.bind(this),this.getCheckedStatus=this.getCheckedStatus.bind(this)}render(){return(0,l.jsxs)("div",{className:"show-map-switch-container ".concat(this.props.containerClasses||""),children:[(0,l.jsx)("label",{children:"SHOW MAP"}),(0,l.jsx)(oo.Z,{theme:ho,children:(0,l.jsx)(lo.Z,{checked:this.state.checked,title:"Show on map",onChange:this.props.onChangeCallback})})]})}}const un=mn;class gn extends o.Component{render(){return(0,l.jsx)("div",{className:"popup-disable-background",children:(0,l.jsx)(Zi,{spinnerHolderStyle:this.props.whiteSpinnerBackground?{borderRadius:"50%",backgroundColor:"#ffffff"}:{},screenCenter:!0})})}}const fn=gn;var bn=i(2178),xn=i.n(bn),Cn=i(9192),wn=i.n(Cn),yn=i(7701),Sn=i.n(yn),vn=i(1221),jn=i(825),Dn=i(4329),Tn=i(6325),In=i(2894),_n=i(8986),Ln=i(1317);const Mn=function(e,t,i){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Y.Pa4,this.movementRestrictionPivotPoint=i,this.objectTest=e.clone(),this.targetTest=this.target.clone(),this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=3e4,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=40,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.needsUpdate=!0;var o=this,s=1e-6,n=new Y.FM8,a=new Y.FM8,r=new Y.FM8,l=new Y.FM8,h=new Y.FM8,c=new Y.FM8,d=new Y.FM8,p=new Y.FM8,m=new Y.FM8,u=0,g=0,f=1,b=new Y.Pa4,x={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},C=x.NONE;function w(){return 2*Math.PI/60/60*o.autoRotateSpeed}function y(){return Math.pow(.95,o.zoomSpeed)}function S(e){if(!1!==o.enabled){if(e.preventDefault(),0===e.button){if(!0===o.noRotate)return;C=x.ROTATE,n.set(e.clientX,e.clientY)}else if(1===e.button){if(!0===o.noZoom)return;C=x.DOLLY,d.set(e.clientX,e.clientY)}else if(2===e.button){if(!0===o.noPan)return;C=x.PAN,l.set(e.clientX,e.clientY)}o.domElement.addEventListener("mousemove",v,!1),o.domElement.addEventListener("mouseup",j,!1)}}function v(e){if(!1!==o.enabled){e.preventDefault();var t=o.domElement===document?o.domElement.body:o.domElement;if(C===x.ROTATE){if(!0===o.noRotate)return;a.set(e.clientX,e.clientY),r.subVectors(a,n),o.rotateLeft(2*Math.PI*r.x/t.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*r.y/t.clientHeight*o.rotateSpeed),n.copy(a)}else if(C===x.DOLLY){if(!0===o.noZoom)return;p.set(e.clientX,e.clientY),m.subVectors(p,d),m.y>0?o.dollyIn():o.dollyOut(),d.copy(p)}else if(C===x.PAN){if(!0===o.noPan)return;h.set(e.clientX,e.clientY),c.subVectors(h,l),o.pan(c),l.copy(h)}o.update()}}function j(){!1!==o.enabled&&(o.domElement.removeEventListener("mousemove",v,!1),o.domElement.removeEventListener("mouseup",j,!1),C=x.NONE)}function D(e){if(!1!==o.enabled&&!0!==o.noZoom){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?o.dollyOut():o.dollyIn(),o.update()}}function T(e){if(!1!==o.enabled&&!0!==o.noKeys&&!0!==o.noPan)switch(e.keyCode){case o.keys.UP:o.pan(new Y.FM8(0,o.keyPanSpeed));break;case o.keys.BOTTOM:o.pan(new Y.FM8(0,-o.keyPanSpeed));break;case o.keys.LEFT:o.pan(new Y.FM8(o.keyPanSpeed,0));break;case o.keys.RIGHT:o.pan(new Y.FM8(-o.keyPanSpeed,0))}}function I(e){if(!1!==o.enabled)switch(e.touches.length){case 1:if(!0===o.noRotate)return;C=x.TOUCH_ROTATE,n.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===o.noZoom)return;C=x.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+i*i);d.set(0,s);break;case 3:if(!0===o.noPan)return;C=x.TOUCH_PAN,l.set(e.touches[0].pageX,e.touches[0].pageY);break;default:C=x.NONE}}function _(e){if(!1!==o.enabled){e.preventDefault(),e.stopPropagation();var t=o.domElement===document?o.domElement.body:o.domElement;switch(e.touches.length){case 1:if(!0===o.noRotate)return;if(C!==x.TOUCH_ROTATE)return;a.set(e.touches[0].pageX,e.touches[0].pageY),r.subVectors(a,n),o.rotateLeft(2*Math.PI*r.x/t.clientWidth*o.rotateSpeed),o.rotateUp(2*Math.PI*r.y/t.clientHeight*o.rotateSpeed),n.copy(a);break;case 2:if(!0===o.noZoom)return;if(C!==x.TOUCH_DOLLY)return;var i=e.touches[0].pageX-e.touches[1].pageX,s=e.touches[0].pageY-e.touches[1].pageY,u=Math.sqrt(i*i+s*s);p.set(0,u),m.subVectors(p,d),0!==m.y&&(m.y>0?o.dollyOut():o.dollyIn()),d.copy(p);break;case 3:if(!0===o.noPan)return;if(C!==x.TOUCH_PAN)return;h.set(e.touches[0].pageX,e.touches[0].pageY),c.subVectors(h,l),o.pan(c),l.copy(h);break;default:C=x.NONE}o.update()}}function L(){!1!==o.enabled&&(C=x.NONE)}function M(e){e.preventDefault()}this.controlsActive=function(){return C===x.NONE},this.setPan=function(e){b=e},this.panTo=function(e){var t=new Y.Pa4(e.x,o.target.y,e.z),i=o.target.clone().sub(t);b.sub(i),o.update()},this.rotateLeft=function(e){void 0===e&&(e=w()),g-=e},this.rotateUp=function(e){void 0===e&&(e=w()),u-=e},this.panLeft=function(e){var t=new Y.Pa4,i=this.object.matrix.elements;t.set(i[0],0,i[2]),t.normalize(),t.multiplyScalar(-e),b.add(t)},this.panUp=function(e){var t=new Y.Pa4;t.setFromMatrixColumn(this.object.matrix,1),t.multiplyScalar(e);var i=b.clone(),o=this.target.clone();i.add(t),o.add(i),o.y>0&&b.add(t)},this.pan=function(e){var t=o.domElement===document?o.domElement.body:o.domElement;if(void 0!==o.object.fov){var i=o.object.position.clone().sub(o.target).length();i*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*e.x*i/t.clientHeight),o.panUp(2*e.y*i/t.clientHeight)}else void 0!==o.object.top?(o.panLeft(e.x*(o.object.right-o.object.left)/t.clientWidth),o.panUp(e.y*(o.object.top-o.object.bottom)/t.clientHeight)):Ln.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");o.update()},this.panXY=function(e,t){o.pan(new Y.FM8(e,t))},this.dollyIn=function(e){void 0===e&&(e=y()),f/=e},this.dollyOut=function(e){void 0===e&&(e=y()),f*=e},this.update=function(){this.objectTest=this.object.clone(),this.targetTest=this.target.clone();const e=this.movementRestrictionPivotPoint?this.objectTest:this.object,t=this.movementRestrictionPivotPoint?this.targetTest:this.target;var i=e.position,n=i.clone().sub(this.target),a=Math.atan2(n.x,n.z),r=Math.atan2(Math.sqrt(n.x*n.x+n.z*n.z),n.y);this.autoRotate&&this.rotateLeft(w()),a+=g,r+=u,r=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,r)),r=Math.max(s,Math.min(Math.PI-s,r));var l=n.length()*f;l=Math.max(this.minDistance,Math.min(this.maxDistance,l)),t.add(b),n.x=l*Math.sin(r)*Math.sin(a),n.y=l*Math.cos(r),n.z=l*Math.sin(r)*Math.cos(a),i.copy(t).add(n),e.lookAt(t),this.movementRestrictionPivotPoint&&Ot(e.position,this.movementRestrictionPivotPoint)<this.maxDistance&&(this.object.position.copy(e.position),this.object.rotation.copy(e.rotation),this.object.scale.copy(e.scale),this.object.projectionMatrix.copy(e.projectionMatrix),this.object.isPerspectiveCamera&&e.isPerspectiveCamera&&this.object.matrixWorldInverse.copy(e.matrixWorldInverse),this.object.isOrthographicCamera&&e.isOrthographicCamera&&(this.object.matrixWorld.copy(e.matrixWorld),this.object.matrixWorldInverse.copy(e.matrixWorldInverse)),this.object.isPerspectiveCamera&&e.isPerspectiveCamera?(this.object.fov=e.fov,this.object.near=e.near,this.object.far=e.far):this.object.isOrthographicCamera&&e.isOrthographicCamera&&(this.object.left=e.left,this.object.right=e.right,this.object.top=e.top,this.object.bottom=e.bottom,this.object.near=e.near,this.object.far=e.far),this.object.updateProjectionMatrix(),this.object.updateMatrixWorld(),this.target=t.clone(),o.domElement.dispatchEvent(new Event("cameraMoved")),this.needsUpdate=!0),g=0,u=0,f=1,b.set(0,0,0),this.movementRestrictionPivotPoint||(o.domElement.dispatchEvent(new Event("cameraMoved")),this.needsUpdate=!0)},this.onMouseUp=j,this.touchend=L,this.domElement.addEventListener("contextmenu",M,!1),this.domElement.addEventListener("mousedown",S,!1),this.domElement.addEventListener("mousewheel",D,!1),this.domElement.addEventListener("DOMMouseScroll",D,!1),this.domElement.addEventListener("touchstart",I,!1),this.domElement.addEventListener("touchend",L,!1),this.domElement.addEventListener("touchmove",_,!1),window.document.addEventListener("keydown",T,!1),this.dispose=function(){this.domElement.removeEventListener("contextmenu",M),this.domElement.removeEventListener("mousedown",S),this.domElement.removeEventListener("mousewheel",D),this.domElement.removeEventListener("DOMMouseScroll",D),this.domElement.removeEventListener("touchstart",I),this.domElement.removeEventListener("touchend",L),this.domElement.removeEventListener("touchmove",_),window.document.removeEventListener("keydown",T)}};var kn=i(1317);const On=-1,Rn=0,Pn=3,Fn=1e-6;function An(e){this.enabled&&(this.mouseMoved=!0,this.state===Rn&&(this.rotateEnd.set(e.clientX,e.clientY),this.makeRotation()))}function Wn(e){this.enabled&&0===e.button&&(this.mouseMoved=!1,this.state=Rn,this.rotateStart.set(e.clientX,e.clientY))}function Bn(){this.enabled&&(this.state=On,this.mouseMoved||this.moveToCircleNavigatorPosition())}function En(e){if(this.enabled)if(e.preventDefault(),e.stopPropagation(),this.touchMoved=!0,1===e.touches.length){if(this.state!==Pn)return;this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),this.makeRotation()}else this.state=On}function Vn(e){if(this.enabled)if(this.touchMoved=!1,1===e.touches.length)this.state=Pn,this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY);else this.state=On}function Nn(){this.enabled&&(this.touchMoved||this.moveToCircleNavigatorPosition(),this.state=On)}function zn(e){if(this.enabled)switch(e.code){case"ArrowUp":case"KeyW":this.shouldMoveForward=!0;break;case"ArrowLeft":case"KeyA":this.shouldMoveLeft=!0;break;case"ArrowDown":case"KeyS":this.shouldMoveBackward=!0;break;case"ArrowRight":case"KeyD":this.shouldMoveRight=!0}}function Hn(e){if(this.enabled)switch(e.code){case"ArrowUp":case"KeyW":this.shouldMoveForward=!1;break;case"ArrowLeft":case"KeyA":this.shouldMoveLeft=!1;break;case"ArrowDown":case"KeyS":this.shouldMoveBackward=!1;break;case"ArrowRight":case"KeyD":this.shouldMoveRight=!1}}const Gn=class{constructor(e,t,i,o,s){this.camera=e,this.object=e,this.domElement=t,this.scene=i,this.movementRestrictionPivotPoint=o,this.floorplan3DThis=s,this.enabled=!0,this.maxDistance=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this._vector=new Y.Pa4,this.pointerSpeed=1,this._onMouseMove=An.bind(this),this._onMouseDown=Wn.bind(this),this._onMouseUp=Bn.bind(this),this._onTouchStart=Vn.bind(this),this._onTouchEnd=Nn.bind(this),this._onTouchMove=En.bind(this),this._onKeyDown=zn.bind(this),this._onKeyUp=Hn.bind(this),this.shouldMoveForward=!1,this.shouldMoveBackward=!1,this.shouldMoveLeft=!1,this.shouldMoveRight=!1,this.clock=new Y.SUY,this.movementSpeed=100,this.previousMouseMoveEventCoords=null,this.state=On,this.rotateStart=new Y.FM8,this.rotateEnd=new Y.FM8,this.rotateDelta=new Y.FM8,this.rotateSpeed=1,this.thetaDelta=0,this.phiDelta=0,this.rotationScale=1,this.mouseMoved=!1,this.touchMoved=!1,this.circleNavigator=null,this.cameraPositionAnimationDurationMs=500,this.domElement.addEventListener("mousemove",this._onMouseMove),this.domElement.addEventListener("mousedown",this._onMouseDown),this.domElement.addEventListener("mouseup",this._onMouseUp),this.domElement.addEventListener("touchstart",this._onTouchStart),this.domElement.addEventListener("touchend",this._onTouchEnd),this.domElement.addEventListener("touchmove",this._onTouchMove),document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp)}resetState(){this.state=On}dispose(){this.domElement.removeEventListener("mousemove",this._onMouseMove),this.domElement.removeEventListener("mousedown",this._onMouseDown),this.domElement.removeEventListener("mouseup",this._onMouseUp),this.domElement.removeEventListener("touchstart",this._onTouchStart),this.domElement.removeEventListener("touchend",this._onTouchEnd),this.domElement.removeEventListener("touchmove",this._onTouchMove),document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp)}getObject(){return this.camera}getDirection(e){return e.set(0,0,-1).applyQuaternion(this.camera.quaternion)}createCircleNavigator(e){if(!this.circleNavigator){this.circleNavigator=new Y.ZAu;const t=this.floorplan3DThis.props.mainComponentThis.meter/2,i=.9*t,o=32;this.circleNavigator.add(new Y.Kj0(new Y.zf8(i,o),new Y.vBJ({color:16777215,transparent:!0,opacity:.2}))),this.circleNavigator.add(new Y.blk(new Y.o8S(i,t,o),new Y.nls({color:16777215}))),this.circleNavigator.children.forEach((e=>{e.isMesh=!0,e.rotation.x=-Math.PI/2})),this.moveCircleNavigatorToPosition(e),this.scene.add(this.circleNavigator)}}disposeCircleNavigator(){this.circleNavigator&&(this.circleNavigator.children.forEach((e=>{this.scene.remove(this.circleNavigator),this.floorplan3DThis.disposeObject(e)})),this.circleNavigator=null)}moveCircleNavigatorToPosition(e){this.circleNavigator.children.forEach((t=>t.position.set(e.x,1,e.z)))}updateCircleNavigator(e,t){this.state===On&&(!e&&t&&t[0]?(t=t[0],this.circleNavigator?this.moveCircleNavigatorToPosition(t.point):this.createCircleNavigator(t.point)):this.disposeCircleNavigator())}isCameraPositionValid(e){return!this.movementRestrictionPivotPoint||Ot(e,this.movementRestrictionPivotPoint)<this.maxDistance}moveToCircleNavigatorPosition(){if(!this.circleNavigator)return;const e=this.circleNavigator.children[0].position,t=this.camera.position.clone(),i=new Y.Pa4(e.x,this.camera.position.y,e.z);if(!this.isCameraPositionValid(i))return;let o=null;const s=e=>{kn.log("updateCameraPosition"),o||(o=e);const n=e-o;if(n>=this.cameraPositionAnimationDurationMs)this.camera.position.copy(i),this.domElement.dispatchEvent(new Event("cameraMoved"));else{const e=n/this.cameraPositionAnimationDurationMs;this.camera.position.lerpVectors(t,i,e),requestAnimationFrame(s)}};requestAnimationFrame(s)}isCameraPositionDistanceShiftValid(e,t){e.applyQuaternion(this.camera.quaternion);const i=this.camera.position.clone().add(e.multiplyScalar(t));return this.isCameraPositionValid(i)}moveForwardBackward(e){this.isCameraPositionDistanceShiftValid(new Y.Pa4(0,0,1),e)&&(this.camera.translateZ(e),this.domElement.dispatchEvent(new Event("cameraMoved")))}moveLeftRight(e){this.isCameraPositionDistanceShiftValid(new Y.Pa4(1,0,0),e)&&(this.camera.translateX(e),this.domElement.dispatchEvent(new Event("cameraMoved")))}makeRotation(){this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.thetaDelta+=2*Math.PI*this.rotateDelta.x/this.domElement.clientWidth*this.rotateSpeed,this.phiDelta+=2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight*this.rotateSpeed,this.rotateStart.copy(this.rotateEnd);const e=new Y.Pa4;this.camera.getWorldDirection(e);const t=new Y.Pa4;t.copy(this.camera.position).add(e);let i=this.camera.position.clone().sub(t);var o=Math.atan2(i.x,i.z),s=Math.atan2(Math.sqrt(i.x*i.x+i.z*i.z),i.y);o+=this.thetaDelta,s+=this.phiDelta,s=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s)),s=Math.max(Fn,Math.min(Math.PI-Fn,s));const n=i.length()*this.rotationScale;i.x=n*Math.sin(s)*Math.sin(o),i.y=n*Math.cos(s),i.z=n*Math.sin(s)*Math.cos(o),this.camera.position.copy(t).add(i),this.camera.lookAt(t),this.thetaDelta=0,this.phiDelta=0,this.domElement.dispatchEvent(new Event("cameraMoved"))}animate(){if(!0===this.enabled){const e=this.clock.getDelta();this.shouldMoveForward&&this.moveForwardBackward(-e*this.movementSpeed),this.shouldMoveBackward&&this.moveForwardBackward(e*this.movementSpeed),this.shouldMoveLeft&&this.moveLeftRight(-e*this.movementSpeed),this.shouldMoveRight&&this.moveLeftRight(e*this.movementSpeed)}}};var qn=i(1317);const Yn=class{constructor(e,t,i,o,s){var n=this;this.setWallPlaneShadow=e=>{e.castShadow=!0,e.receiveShadow=!0},this.drawWall=()=>{let e=new Y.ZAu;this.drawWallExteriorAndInteriorPlanes(e),this.variableVisiblityPlanes.push(this.drawTopBottomWallPlanes([this.exteriorLineCoords[0],this.exteriorLineCoords[1],this.interiorLineCoords[1],this.interiorLineCoords[0]],this.wallStartHeight+this.wallHeight,this.floorplan3DThis.wallTopPlaneMaterial,e)),this.drawTopBottomWallPlanes([this.exteriorLineCoords[0],this.exteriorLineCoords[1],this.interiorLineCoords[1],this.interiorLineCoords[0]],this.wallStartHeight+1,this.floorplan3DThis.wallBottomPlaneMaterial,e),this.variableVisiblityPlanes.push(this.drawStartEndWallPlanes(this.interiorLineCoords[0],this.exteriorLineCoords[0],e)),this.variableVisiblityPlanes.push(this.drawStartEndWallPlanes(this.interiorLineCoords[1],this.exteriorLineCoords[1],e)),this.wall3D=e,this.sceneObject.add(e),this.updateFrontWallVisibility()},this.drawExteriorInteriorPlane=(e,t,i,o,s,n,a)=>{let r=new Y.Pa4(e.x,this.wallStartHeight,e.y),l=new Y.Pa4(t.x,this.wallStartHeight,t.y),h=l.clone();h.y=this.wallStartHeight+this.wallHeight;let c=r.clone();c.y=this.wallStartHeight+this.wallHeight;let d=[r,l,h,c],p=Mt({x:r.x,y:r.z},{x:l.x,y:l.z});const{transform3Dto2DMatrix:m,transform2Dto3DMatrix:u}=this.calculateWallPlaneTransformMatrices(e,t);d.forEach((e=>e.applyMatrix4(m)));let g=new Y.bnF(d.map((e=>new Y.FM8(e.x,e.y))));d.forEach((e=>e.applyMatrix4(u)));for(let S=0;S<s.length;S++)if("doorWindow"===s[S].class){let e,t,o=[];if(s[S].realBbox.forEach((e=>o.push(kt(e,i)))),o.sort(((e,t)=>t.distance-e.distance)),o=o.slice(0,2).map((e=>e.projectedPoint)),Ht(s[S].type)){const i=s[S].additionalParams.height3D*this.floorplan3DThis.scaleFactor;let n=new Y.Pa4(o[0].x,this.wallStartHeight,o[0].y),a=new Y.Pa4(o[1].x,this.wallStartHeight,o[1].y),r=a.clone();r.y=this.wallStartHeight+i;let l=n.clone();l.y=this.wallStartHeight+i,e=[n,a,r,l],e.forEach((e=>e.applyMatrix4(m))),t=e.map((e=>new Y.FM8(e.x,e.y)))}else{const i=s[S].additionalParams.height3D*this.floorplan3DThis.scaleFactor,n=(s[S].additionalParams.positionY+s[S].additionalParams.height3D/2)*this.floorplan3DThis.scaleFactor;let a=new Y.Pa4(o[0].x,this.wallStartHeight+n-i/2,o[0].y),r=new Y.Pa4(o[1].x,this.wallStartHeight+n-i/2,o[1].y),l=r.clone();l.y=this.wallStartHeight+n+i/2;let h=a.clone();h.y=this.wallStartHeight+n+i/2,e=[a,r,l,h],e.forEach((e=>e.applyMatrix4(m))),t=e.map((e=>new Y.FM8(e.x,e.y)))}g.holes.push(new Y.y$t(t))}let f,b=new Y.oa8(g),x=b.getAttribute("position"),C=new Y.Pa4;for(let S=0;S<x.count;S++)C.fromBufferAttribute(x,S),C.applyMatrix4(u),x.setXYZ(S,C.x,C.y,C.z);x.needsUpdate=!0,b.computeVertexNormals(),b.scale(this.floorplan3DThis.scaleFactor,1,this.floorplan3DThis.scaleFactor);const w=this.wall2D[i===this.interiorLineEquation?"interiorPlaneMaterial":"exteriorPlaneMaterial"];if("Glass"!==w&&"Unknown"!==w&&N.isHexColor(w)){let e=r.clone();e.multiplyScalar(this.floorplan3DThis.scaleFactor);const t=t=>{const i=Mt({x:e.x,y:e.z},{x:t.x,y:t.z})/(p*this.floorplan3DThis.scaleFactor),o=t.y/this.wallHeight;return new Y.FM8(i,o)};this.floorplan3DThis.calculateShapeGeometryUVMappings(b,t);const i=oe.find((e=>e.title===w));f=this.floorplan3DThis.createTextureMaterial(this.floorplan3DThis.floorplanWallMaterials.find((e=>e.name===w)).textureData,o,i.scale?{scaleValue:i.scale,width:p*this.floorplan3DThis.scaleFactor,height:this.wallHeight}:null)}else if("Glass"===w)f=new Y.EJi,f.side=o,f.color=new Y.Ilk(1,1,1),f.transmission=1,f.roughness=0,f.ior=1.7,f.thickness=.5,f.specularIntensity=1,f.clearcoat=1;else{let e;e="Unknown"===w?"#f9f3e4":w,f=new Y.xoR({color:e,flatShading:!0,side:o})}let y=new Y.Kj0(b,f);return n.planeObject=y,n.planeObject.wall3D=this,this.setWallPlaneShadow(y),a.add(y),y},this.drawTopBottomWallPlanes=(e,t,i,o)=>{let s=[new Y.FM8(e[0].x*this.floorplan3DThis.scaleFactor,e[0].y*this.floorplan3DThis.scaleFactor),new Y.FM8(e[1].x*this.floorplan3DThis.scaleFactor,e[1].y*this.floorplan3DThis.scaleFactor),new Y.FM8(e[2].x*this.floorplan3DThis.scaleFactor,e[2].y*this.floorplan3DThis.scaleFactor),new Y.FM8(e[3].x*this.floorplan3DThis.scaleFactor,e[3].y*this.floorplan3DThis.scaleFactor)],n=new Y.bnF(s),a=new Y.oa8(n),r=new Y.Kj0(a,i);return r.rotation.set(Math.PI/2,0,0),r.position.y=t,this.setWallPlaneShadow(r),o.add(r),r},this.drawStartEndWallPlanes=(e,t,i)=>{let o=new Float32Array([e.x,this.wallStartHeight,e.y,t.x,this.wallStartHeight,t.y,t.x,this.wallStartHeight+this.wallHeight,t.y,e.x,this.wallStartHeight+this.wallHeight,e.y]),s=new Y.u9r;s.setAttribute("position",new Y.TlE(o,3));s.setIndex([0,1,2,0,2,3]);let n=new Y.Kj0(s,this.floorplan3DThis.wallStartEndPlanesMaterial);return this.setWallPlaneShadow(n),n.scale.set(this.floorplan3DThis.scaleFactor,1,this.floorplan3DThis.scaleFactor),i.add(n),n},this.drawWallObjects=()=>{let e=this.wall2DObjects.filter((e=>"doorWindow"===e.class&&Ht(e.type))),t=this.wall2DObjects.filter((e=>"doorWindow"===e.class&&zt(e.type))),i=this.wall2DObjects.filter((e=>"lights"===e.class&&"onWall"===e.family)),o=this.wall2DObjects.filter((e=>"furniture"===e.class&&("onWall"===e.family||"inWall"===e.family)));for(let s=0;s<e.length;s++)this.drawDoorWindowObjects(e[s]);for(let s=0;s<t.length;s++)this.drawDoorWindowObjects(t[s]);for(let s=0;s<i.length;s++)this.drawWallLightsObjects(i[s]);for(let s=0;s<o.length;s++)this.drawWallFurnitureObjects(o[s])},this.drawDoorWindowObjects=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=n.floorplan3DThis.createFloorplanItem(n.sceneObject,Ht(e.type)?n.floorplan3DThis.doorObjects3D:n.floorplan3DThis.windowObjects3D,e.type,e,n.floorNumber,t);n.onWallObjectDrawed(i)},this.drawWallLightsObjects=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=n.floorplan3DThis.createFloorplanItem(n.sceneObject,n.floorplan3DThis.lightObjects3D,e.type,e,n.floorNumber,t);n.onWallObjectDrawed(i)},this.drawWallFurnitureObjects=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=n.floorplan3DThis.createFloorplanItem(n.sceneObject,n.floorplan3DThis.furnitureObjects3D,e.type,e,n.floorNumber,t);n.onWallObjectDrawed(i)},this.updateFrontWallVisibility=()=>{if(this.callUpdateFrontWallVisibility&&!this.hideWall){const e=new Y.FM8(this.wallStart.x,this.wallStart.y).multiplyScalar(this.floorplan3DThis.scaleFactor),t=new Y.FM8(this.wallEnd.x,this.wallEnd.y).multiplyScalar(this.floorplan3DThis.scaleFactor),i=t.x-e.x,o=t.y-e.y;let s=new Y.Pa4(-o,0,i);s.normalize();const n=new Y.Pa4;this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()?(n.copy(this.floorplan3DThis.floorplan3DOnMapCameraPosition),this.floorplan3DThis.processSceneVec3(n)):n.copy(this.floorplan3DThis.currentControls.object.position);let a=new Y.Pa4((e.x+t.x)/2,this.wallStartHeight,(e.y+t.y)/2).clone().sub(n).clone(),r=s.dot(a)<=0;this.setWallPlanesObjectsVisibility(r)}},this.drawWallExteriorAndInteriorPlanes=e=>{new Array({planeLineCoords:this.interiorLineCoords,planeLineEquation:this.interiorLineEquation,planeAttributeObject:this.interiorWallPlane},{planeLineCoords:this.exteriorLineCoords,planeLineEquation:this.exteriorLineEquation,planeAttributeObject:this.exteriorWallPlane}).forEach((t=>this.variableVisiblityPlanes.push(this.drawExteriorInteriorPlane(t.planeLineCoords[0],t.planeLineCoords[1],t.planeLineEquation,Y.ehD,this.wall2DObjects.filter((e=>"inWall"===e.family)),t.planeAttributeObject,e))))},this.calculateWallPlaneTransformMatrices=(e,t)=>{const i=this.floorplan3DThis.calculateAngleBetween2DVectors(1,0,t.x-e.x,t.y-e.y);let o=new Y.yGw,s=new Y.yGw,n=new Y.yGw,a=new Y.yGw;return a.makeRotationY(-i),n.makeTranslation(-e.x,0,-e.y),o.multiplyMatrices(a,n),s=o.clone().invert(),{transform3Dto2DMatrix:o,transform2Dto3DMatrix:s}},this.setWallPlanesObjectsVisibility=e=>{for(let i=0;i<this.variableVisiblityPlanes.length;i++)this.variableVisiblityPlanes[i].visible=e;const t=[...this.inWallItemObjects,...this.onWallItemObjects];for(let i=0;i<t.length;i++)t[i].object2D.additionalParams.hideWithWall?t[i].mesh.visible=e:t[i].mesh.visible=!0},this.setExteriorInteriorPlanesOpacity=e=>{new Array(this.interiorWallPlane.planeObject,this.exteriorWallPlane.planeObject).forEach((t=>{t.material.opacity=e,t.material.transparent=100!==e,t.material.needsUpdate=!0}))},this.interiorLineCoords=[],this.exteriorLineCoords=[],this.interiorLineEquation=i.equations.up,this.exteriorLineEquation=i.equations.down,this.wallStart=i.start,this.wallEnd=i.end,this.wall2D=i,this.wall2DObjects=o,this.wall3D=null,this.inWallItemObjects=[],this.onWallItemObjects=[],this.variableVisiblityPlanes=[],this.interiorWallPlane={},this.exteriorWallPlane={},this.sceneObject=t,this.callUpdateFrontWallVisibility=!0,this.hideWall=!1,this.floorNumber=s,this.wallHeight=e.wallHeight,this.wallStartHeight=s*e.wallHeight,this.floorplan3DThis=e;const a=Kt(i,this.floorplan3DThis.isPointOnWallDecimalPrecision);this.interiorLineCoords=a.interiorLineCoords,this.exteriorLineCoords=a.exteriorLineCoords,2===this.interiorLineCoords.length&&2===this.exteriorLineCoords.length&&this.drawWall()}onWallObjectDrawed(e){("inWall"===e.object2D.family?this.inWallItemObjects:this.onWallItemObjects).push(e),this.hideWall?e.mesh.visible=!1:this.updateFrontWallVisibility()}addWallObject(e,t){if(!this.wall2DObjects.find((t=>t.id===e.object2D.id))){qn.log("addWallObject",e),this.wall2DObjects.push(e.object2D);("inWall"===t?this.inWallItemObjects:this.onWallItemObjects).push(e)}}removeWallObject(e,t){qn.log("removeWallObject"),this.wall2DObjects=this.wall2DObjects.filter((t=>t.id!==e.object2D.id));const i="inWall"===t?this.inWallItemObjects:this.onWallItemObjects,o=i.findIndex((t=>t.object2D.id===e.object2D.id));-1!==o&&i.splice(o,1)}redrawWallExteriorInteriorPlanes(){qn.log("redrawWallExteriorInteriorPlanes"),this.variableVisiblityPlanes=this.variableVisiblityPlanes.filter((e=>e.uuid!==this.interiorWallPlane.planeObject.uuid||e.uuid!==this.exteriorWallPlane.planeObject.uuid)),new Array(this.interiorWallPlane.planeObject,this.exteriorWallPlane.planeObject).forEach((e=>{this.wall3D.remove(e),this.floorplan3DThis.disposeObject(e)})),this.drawWallExteriorAndInteriorPlanes(this.wall3D),100!==this.floorplan3DThis.wallsOpacityRef.current.getWallsOpacityValue()&&this.setExteriorInteriorPlanesOpacity(this.floorplan3DThis.wallsOpacityRef.current.getWallsOpacityValue()/100),this.updateFrontWallVisibility()}removeWall(){this.sceneObject.remove(this.wall3D),this.floorplan3DThis.disposeObject(this.wall3D);[...this.inWallItemObjects,...this.onWallItemObjects].forEach((e=>this.floorplan3DThis.removeFloorplanItem(e)))}};class Un extends o.Component{constructor(){super(),this.getShowWallSwitchState=()=>this.state.wallsVisible,this.getFrontWallsSwitchState=()=>this.state.frontWallsVisible,this.showFloorplanWalls=e=>{for(let t=0;t<e.length;t++)e[t].hideWall=!1,this.state.frontWallsVisible?e[t].setWallPlanesObjectsVisibility(!0):e[t].updateFrontWallVisibility()},this.hideFloorplanWalls=e=>{for(let t=0;t<e.length;t++)e[t].hideWall=!0,e[t].setWallPlanesObjectsVisibility(!1)},this.onWallVisibilityChange=()=>{const e=this.props.mainComponentThis.showMapLayer3DInputRef.current.getCheckedStatus();this.state.wallsVisible?(this.hideFloorplanWalls(this.props.mainComponentThis.currentWalls3D),e&&this.hideFloorplanWalls(this.props.mainComponentThis.floorplanViewWalls3D)):(this.showFloorplanWalls(this.props.mainComponentThis.currentWalls3D),e&&this.showFloorplanWalls(this.props.mainComponentThis.floorplanViewWalls3D)),this.setState({wallsVisible:!this.state.wallsVisible})},this.showFrontFloorplanWalls=e=>{for(let t=0;t<e.length;t++)e[t].callUpdateFrontWallVisibility=!1,this.state.wallsVisible&&e[t].setWallPlanesObjectsVisibility(!0)},this.hideFrontFloorplanWalls=e=>{for(let t=0;t<e.length;t++)e[t].callUpdateFrontWallVisibility=!0,e[t].updateFrontWallVisibility()},this.onFrontWallVisibilityChange=()=>{const e=this.props.mainComponentThis.showMapLayer3DInputRef.current.getCheckedStatus();this.state.frontWallsVisible?(this.hideFrontFloorplanWalls(this.props.mainComponentThis.currentWalls3D),e&&this.hideFrontFloorplanWalls(this.props.mainComponentThis.floorplanViewWalls3D)):(this.showFrontFloorplanWalls(this.props.mainComponentThis.currentWalls3D),e&&this.showFrontFloorplanWalls(this.props.mainComponentThis.floorplanViewWalls3D)),this.setState({frontWallsVisible:!this.state.frontWallsVisible})},this.state={frontWallsVisible:!0,wallsVisible:!0},this.onWallVisibilityChange=this.onWallVisibilityChange.bind(this),this.onFrontWallVisibilityChange=this.onFrontWallVisibilityChange.bind(this),this.getShowWallSwitchState=this.getShowWallSwitchState.bind(this),this.getFrontWallsSwitchState=this.getFrontWallsSwitchState.bind(this),this.showFloorplanWalls=this.showFloorplanWalls.bind(this),this.hideFloorplanWalls=this.hideFloorplanWalls.bind(this),this.showFrontFloorplanWalls=this.showFrontFloorplanWalls.bind(this),this.hideFrontFloorplanWalls=this.hideFrontFloorplanWalls.bind(this)}render(){return(0,l.jsxs)("li",{children:[(0,l.jsxs)("div",{className:"panel-option-container",children:[(0,l.jsxs)("div",{className:"option-name-note-container",children:[(0,l.jsx)("div",{children:"SHOW WALLS"}),(0,l.jsx)("div",{children:(0,l.jsx)(wi,{indoorPanelExplanationBox:this.props.panelInfoExplanationBox,infoText:"Show floorplan walls"})})]}),(0,l.jsx)("div",{children:(0,l.jsx)(lo.Z,{checked:this.state.wallsVisible,onChange:this.onWallVisibilityChange})})]}),(0,l.jsxs)("div",{className:"panel-option-container",children:[(0,l.jsxs)("div",{className:"option-name-note-container",children:[(0,l.jsx)("div",{children:"FRONT WALLS"}),(0,l.jsx)("div",{children:(0,l.jsx)(wi,{indoorPanelExplanationBox:this.props.panelInfoExplanationBox,infoText:"Show or hide front walls on camera movement"})})]}),(0,l.jsx)("div",{children:(0,l.jsx)(lo.Z,{checked:this.state.frontWallsVisible,onChange:this.onFrontWallVisibilityChange})})]})]})}}const Xn=Un;var Zn=i(3649);class Kn extends o.Component{constructor(){super(),this.getWallsOpacityValue=()=>this.state.wallsOpacity,this.onWallsOpacitySliderChange=(e,t)=>{this.setState({wallsOpacity:t})},this.onWallsOpacitySliderMouseUp=()=>{this.props.mainComponentThis.changeWallMaterialOpacity(this.props.mainComponentThis.currentWalls3D,this.state.wallsOpacity),this.props.mainComponentThis.showMapLayer3DInputRef.current.getCheckedStatus()&&this.props.mainComponentThis.changeWallMaterialOpacity(this.props.mainComponentThis.floorplanViewWalls3D,this.state.wallsOpacity)},this.state={wallsOpacity:100,isVisible:!1},this.getWallsOpacityValue=this.getWallsOpacityValue.bind(this),this.onWallsOpacitySliderChange=this.onWallsOpacitySliderChange.bind(this),this.onWallsOpacitySliderMouseUp=this.onWallsOpacitySliderMouseUp.bind(this)}render(){return(0,l.jsx)(Ai,{containerClasses:"slider-form-group",containerStyle:{textAlign:"center",marginBottom:0},label:"Walls opacity",labelStyle:{margin:0},children:(0,l.jsx)(Zn.Z,{getAriaLabel:()=>"Walls opacity",getAriaValueText:e=>"".concat(e,"%"),valueLabelFormat:e=>"".concat(e,"%"),value:this.state.wallsOpacity,onChange:this.onWallsOpacitySliderChange,onChangeCommitted:this.onWallsOpacitySliderMouseUp,valueLabelDisplay:"auto",min:0,max:100,step:1})})}}const Jn=Kn;var Qn=i(3835),$n=i(1411),ea=i(2656),ta=i(7119),ia=i(6627),oa=i(1317);function sa(e,t,i){const o=i.xMouse-t.xMouse,s=i.yMouse-t.yMouse,n=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=180*Math.atan2(t,e)/Math.PI+90;return e<0&&t<0&&(o+=360),i&&(o=wt(o)),o}(o,s),a=Math.sqrt(Math.pow(o/this.meter,2)+Math.pow(s/this.meter,2));let r=e;return 0===o&&0===s||(r=(0,tt.Z)(ot()(e),a/1e3,n).geometry.coordinates),r}function na(e){if("setCenter"===e.name){this._map.off("moveend",this.alignFloorplanTopLeftCornerOnMap);const e=this.calcul_snap_inverse(this.floorplanLastSavedTopLeftSvgCoords?this.floorplanLastSavedTopLeftSvgCoords.x:this.boxWallCoordinates.minX,this.floorplanLastSavedTopLeftSvgCoords?this.floorplanLastSavedTopLeftSvgCoords.y:this.boxWallCoordinates.minY),t=this._map.unproject([e.screenX-this.offset.left,e.screenY-(this.offset.top+this.offset.scrollY)]),i=ot()([t.lng,t.lat]),o=ot()([this.getFloorplanGpsLongitude(this.floorplanGeneral),this.getFloorplanGpsLatitude(this.floorplanGeneral)]),s=(0,ta.Z)(i,o),n=(0,ia.Z)(i,o),a=this._map.getCenter(),r=(0,tt.Z)(ot()([a.lng,a.lat]),n,s).geometry.coordinates;this._map.setCenter(r);const l=(0,$n.Z)({type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,this.mapCornersGpsCoords[0]]]},properties:{}},n,s);this.mapCornersGpsCoords=l.geometry.coordinates[0].slice(0,-1),this.mapCornerCoordsDebug&&this._map.getSource("mapCornersAfterSource").setData({type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,this.mapCornersGpsCoords[0]]]}})}}function aa(e){const t=St(e[1],e[0],this.width_viewbox/this.meter,this.height_viewbox/this.meter,this.floorplanGeneral.floorplan_bearing||0);return{topRightCorner:t[1],bottomRightCorner:t[2],bottomLeftCorner:t[3]}}function ra(e){const t=this.calcul_snap({pageX:this.offset.left,pageY:this.offset.top+this.offset.scrollY});if(this.mapCornerCoordsDebug){const e={type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,this.mapCornersGpsCoords[0]]]}};this._map.getSource("mapCornersBeforeSource").setData(e)}const i=this.calculateGpsCoordinatesForNewSvgPoint(this.mapCornersGpsCoords[0],e,t),{topRightCorner:o,bottomRightCorner:s,bottomLeftCorner:n}=this.calculateMapCornersCoordinatesFromTopLeftPoint(i);this.mapCornersGpsCoords=[i,o,s,n];const a={type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,i]]},properties:{}},r=(0,Qn.Z)(a).geometry.coordinates;this._map.on("moveend",this.alignFloorplanTopLeftCornerOnMap),this._map.setCenter(r,{name:"setCenter"})}function la(e){const t=this.calcul_snap({pageX:this.offset.left,pageY:this.offset.top+this.offset.scrollY});if(this.mapCornerCoordsDebug){const e={type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,this.mapCornersGpsCoords[0]]]}};this._map.getSource("mapCornersBeforeSource").setData(e)}const i=this.calculateGpsCoordinatesForNewSvgPoint(this.mapCornersGpsCoords[0],e,t),{topRightCorner:o,bottomRightCorner:s,bottomLeftCorner:n}=this.calculateMapCornersCoordinatesFromTopLeftPoint(i),a={type:"Feature",geometry:{type:"Polygon",coordinates:[[i,o,s,n,i]]},properties:{}};if(this.mapCornersGpsCoords=a.geometry.coordinates[0].slice(0,-1),this.mapCornerCoordsDebug){const e={type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,this.mapCornersGpsCoords[0]]]}};this._map.getSource("mapCornersAfterSource").setData(e)}oa.log("Zoom before "+this._map.getZoom());const r=(0,Qn.Z)(a).geometry.coordinates,l=yt(r[1],this.zoomFactor/this.meter);oa.log("New zoom "+l),this._map.setZoom(l),this._map.on("moveend",this.alignFloorplanTopLeftCornerOnMap),this._map.setCenter(r,{name:"setCenter"})}function ha(e){this._map=e,this._map.setMinZoom(0),this._map.setMaxZoom(22),this._map.on("resize",this.handleMapLayerWindowResize);const t={type:"Feature",geometry:{type:"Polygon",coordinates:[[...St(this.getFloorplanGpsLatitude(this.floorplanGeneral),this.getFloorplanGpsLongitude(this.floorplanGeneral),this.boxWallCoordinates.width/this.meter,this.boxWallCoordinates.height/this.meter),[this.getFloorplanGpsLongitude(this.floorplanGeneral),this.getFloorplanGpsLatitude(this.floorplanGeneral)]]]},properties:{}},i={pivot:[this.getFloorplanGpsLongitude(this.floorplanGeneral),this.getFloorplanGpsLatitude(this.floorplanGeneral)]},o=(0,ea.Z)(t,this.floorplanGeneral.floorplan_bearing||0,i),s=(0,Qn.Z)(o).geometry.coordinates;this.coordinateFloorplanSvgZoomWithMap(s[1]);const n=yt(s[1],this.zoomFactor/this.meter),a=e=>{"setZoom"===e.name?(this._map.setCenter([this.getFloorplanGpsLongitude(this.floorplanGeneral),this.getFloorplanGpsLatitude(this.floorplanGeneral)],{name:"setCenter1"}),this._map.setBearing(this.floorplanGeneral.floorplan_bearing||0,{name:"setBearing"}),this._map.setCenter(s,{name:"setCenter2"})):this.onMapCameraOptionsSetFinishCallback(e,a)};this._map.on("moveend",a),this._map.setZoom(n,{name:"setZoom"})}function ca(e,t){oa.log("Moveend event"),oa.log(e.name),"setCenter2"===e.name&&(oa.log("Map set bearing and center finished"),this._map.off("moveend",t),this.getCurrentMapCornersGpsCoords(),oa.log(this.mapCornersGpsCoords),this.mapCornerCoordsDebug&&(this._map.addSource("mapCornersBeforeSource",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[]}}}),this._map.addLayer({id:"mapCornersBeforeLayer",type:"line",source:"mapCornersBeforeSource",layout:{},paint:{"line-color":"#000","line-width":3}}),this._map.addSource("mapCornersAfterSource",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[]}}}),this._map.addLayer({id:"outlineafter",type:"line",source:"mapCornersAfterSource",layout:{},paint:{"line-color":"#ff0000","line-width":3}})),this.alignFloorplanTopLeftCornerOnMap({name:"setCenter"}))}function da(){let e=this._map.unproject([0,0]);e=[e.lng,e.lat];const{topRightCorner:t,bottomRightCorner:i,bottomLeftCorner:o}=this.calculateMapCornersCoordinatesFromTopLeftPoint(e);this.mapCornersGpsCoords=[e,t,i,o]}function pa(){this.getCurrentMapCornersGpsCoords();const e={type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.mapCornersGpsCoords,this.mapCornersGpsCoords[0]]]},properties:{}},t=(0,Qn.Z)(e),i=yt(t.geometry.coordinates[1],this.zoomFactor/this.meter);this._map.setZoom(i),this._map.on("moveend",this.alignFloorplanTopLeftCornerOnMap),this._map.setCenter(t.geometry.coordinates,{name:"setCenter"})}function ma(e){let t=yt(e,this.zoomFactor/this.meter);if(t>22||t<0){let i,o=0,s=this.zoomFactor*this.taille_w;if(t>22){for(i="zoomout";t>22;)o++,s+=this.zoomXMove,t=yt(e,s/this.taille_w/this.meter);oa.log("Zoom out levels needed "+o)}else if(t<0){for(i="zoomin";t<0;)o++,s-=this.zoomXMove,t=yt(e,s/this.taille_w/this.meter);oa.log("Zoom in levels needed "+o)}this.zoomToSpecificLevel(i,o),this.setSvgViewBoxes()}}function ua(e){return()=>{if(this.state.mapStyleLoaded){const t=this._map&&this._map.getStyle();this._map&&t&&t.layers&&(!this.props.isStyleChangeAllowed||this.props.isStyleChangeAllowed())&&this.state.selectedMapStyle!==e&&this.mounted&&this.setState({selectedMapStyle:e,mapStyleLoaded:!1},(()=>{t.layers.forEach((e=>this._map.removeLayer(e.id))),this._map.setStyle("mapbox://styles/mapbox/"+e,{diff:!1}),this._map.once("idle",(()=>{this.props.onSwitchLayerFinishedCallback&&this.props.onSwitchLayerFinishedCallback(this._map),this.mounted&&this.setState({mapStyleLoaded:!0})}))}))}}}class ga extends o.Component{constructor(e){super(e),this.setMapContext=e=>this._map=e,this.getMapStyleLoadedStatus=()=>this.state.mapStyleLoaded,this.state={selectedMapStyle:"light-v8",mapStyleLoaded:!0},this.mounted=!1,this._map=null,this.switchLayer=ua.bind(this),this.setMapContext=this.setMapContext.bind(this),this.getMapStyleLoadedStatus=this.getMapStyleLoadedStatus.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{className:"layer-change map-feature-icon svg-center-inside-container"}),(0,l.jsx)("div",{className:"layer-dropdown",children:(0,l.jsx)(po,{mapStyles:ne,switchLayer:this.switchLayer,selectedMapStyle:this.state.selectedMapStyle})})]})}}const fa=ga;var ba=i(1317);class xa extends o.Component{constructor(){super(),this.onSwitchLayerFinishedCallback=()=>{this.props.is3D&&this.props.onMapContextLoadedCallback(this._map,!1)},this.onMapZoom=()=>{this._map&&(this._zoom=this._map.getZoom())},this.isStyleChangeAllowed=()=>{if(this.showMapLayerStyleChange3DRef.current?this.showMapLayerStyleChange3DRef.current.getMapStyleLoadedStatus():this.showMapLayerStyleChange2DRef.current.getMapStyleLoadedStatus()){const e=this._map.getStyle();return e&&e.layers?this.props.is3D&&!this._map.getLayer("floorplan-3d-model")?(ba.log("False. Nema floorplan3D layera"),!1):(ba.log("Omogucena promjena stila"),!0):(ba.log("Nema layera"),!1)}return ba.log("Vanjski if. Nije loadan stil"),!1},this.state={error:null,tooltip:null},this.showMapLayerStyleChange2DRef=o.createRef(),this.showMapLayerStyleChange3DRef=o.createRef(),this._map=null,this.zoomRange=4,this._zoom=9,this.onMapMountCallbackCalled=!1,this.mounted=!1,this.onMapZoom=this.onMapZoom.bind(this),this.onSwitchLayerFinishedCallback=this.onSwitchLayerFinishedCallback.bind(this),this.isStyleChangeAllowed=this.isStyleChangeAllowed.bind(this)}componentDidMount(){this.mounted=!0,!this.props.is3D&&s.render((0,l.jsx)(fa,{ref:this.showMapLayerStyleChange2DRef,is3D:this.props.is3D,onMapContextLoadedCallback:this.props.onMapContextLoadedCallback,onSwitchLayerFinishedCallback:this.onSwitchLayerFinishedCallback,isStyleChangeAllowed:this.isStyleChangeAllowed}),this.props.mapStylesChangeRef.current)}componentWillUnmount(){this.mounted=!1,!this.props.is3D&&s.unmountComponentAtNode(this.props.mapStylesChangeRef.current)}render(){return(0,l.jsxs)(o.Fragment,{children:[this.props.is3D&&(0,l.jsx)(fa,{ref:this.showMapLayerStyleChange3DRef,is3D:this.props.is3D,onMapContextLoadedCallback:this.props.onMapContextLoadedCallback,onSwitchLayerFinishedCallback:this.onSwitchLayerFinishedCallback,isStyleChangeAllowed:this.isStyleChangeAllowed}),(0,l.jsxs)(go,{mapStyle:"mapbox://styles/mapbox/light-v8",center:this.props.center,zoom:[this._zoom],onZoom:this.onMapZoom,preserveDrawingBuffer:this.props.preserveDrawingBuffer,children:[this.props.is3D&&(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(mo.Ly,{className:"zoom-control",style:{right:20}}),(0,l.jsx)(mo.AI,{className:"rotation-control",style:{right:20}})]}),(0,l.jsx)(mo.jf,{className:"scale-control",measurement:"metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"km":"mi"}),(0,l.jsx)(mo.X$.Consumer,{children:e=>{this._map=e,this.onMapMountCallbackCalled||(this.onMapMountCallbackCalled=!0,this.showMapLayerStyleChange3DRef.current?this.showMapLayerStyleChange3DRef.current.setMapContext(e):this.showMapLayerStyleChange2DRef.current.setMapContext(e),this.props.onMapContextLoadedCallback(e))}})]})]})}}const Ca=xa;var wa=i(1317);const ya=class{constructor(e,t,i){this.mouseMoveEvent=e=>{if(this.enabled){e.preventDefault(),this.mouseDownItemSelected=!1,this.mouseMoved=!0,this.mouse.x=e.clientX,this.mouse.y=e.clientY;const t=this.floorplan3DThis.getSelectedDrawingOption();if(this.floorplan3DThis.selectedFloorplanItemType&&t&&"select"!==t.value&&!this.itemBinder){let e,i;if(le.includes(Ut(this.floorplan3DThis.selectedFloorplanItemType))&&(e=[],this.floorplan3DThis.currentWalls3D.forEach((t=>{e.push(t.interiorWallPlane.planeObject),e.push(t.exteriorWallPlane.planeObject)})),this.previousItemBinder&&e.push(this.previousItemBinder.mesh),i=this.getIntersections(new Y.FM8(this.mouse.x,this.mouse.y),e,!0,!0)[0]),i||(i=this.getIntersections(new Y.FM8(this.mouse.x,this.mouse.y),this.intersectionGround,!1,!1),i&&(i=i[0])),!i)return;this.floorplan3DThis.processSceneVec3(i.point);const o=this.floorplan3DThis.props.mainComponentThis.calcul_snap_inverse(i.point.x/this.floorplan3DThis.scaleFactor,i.point.z/this.floorplan3DThis.scaleFactor);t.createBinderMethod({pageX:o.screenX,pageY:o.screenY}),this.floorplan3DThis.props.mainComponentThis.binder&&(this.itemBinder=this.floorplan3DThis.createFloorplanItem(this.scene,t.objects3DArray,this.floorplan3DThis.selectedFloorplanItemType,this.floorplan3DThis.props.mainComponentThis.binder,0,!0),this.itemBinder.setItemPosition(new Y.Pa4(this.floorplan3DThis.props.mainComponentThis.binder.x,0,this.floorplan3DThis.props.mainComponentThis.binder.y).multiplyScalar(this.floorplan3DThis.scaleFactor)),this.itemLoaded(this.itemBinder))}switch(this.mouseDown||(this.updateIntersections(),!this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&this.floorplan3DThis.currentControls===this.floorplan3DThis.firstPersonControls&&this.floorplan3DThis.firstPersonControls.updateCircleNavigator(this.rotateMouseOver||this.intersectedObject,this.getIntersections(this.mouse,this.intersectionGround,!1,!1))),this.state){case this.states.UNSELECTED:case this.states.SELECTED:this.updateMouseover();break;case this.states.DRAGGING:case this.states.ROTATING:case this.states.ROTATING_FREE:this.clickDragged(),this.floorplan3DThis.floorplanItemCurrentHUDObject.update(),this.needsUpdate=!0}}},this.isRotating=()=>this.state==this.states.ROTATING||this.state==this.states.ROTATING_FREE,this.mouseDownEvent=e=>{if(this.enabled&&0===e.button)switch(e.preventDefault(),this.mouseMoved=!1,this.mouseDown=!0,this.state){case this.states.SELECTED:this.rotateMouseOver?this.switchState(this.states.ROTATING):null!=this.intersectedObject&&(this.intersectedObject!==this.selectedObject&&this.floorplan3DThis.onFloorplanItemUnselect(),this.setSelectedObject(this.intersectedObject),this.mouseDownItemSelected=!0,this.intersectedObject.fixed||this.switchState(this.states.DRAGGING));break;case this.states.UNSELECTED:null!=this.intersectedObject&&(this.setSelectedObject(this.intersectedObject),this.mouseDownItemSelected=!0,this.intersectedObject.fixed||this.switchState(this.states.DRAGGING));break;case this.states.DRAGGING:case this.states.ROTATING:break;case this.states.ROTATING_FREE:this.switchState(this.states.SELECTED)}},this.mouseUpEvent=async e=>{if(this.enabled&&0===e.button){this.mouseDown=!1;const t=this.floorplan3DThis.getSelectedDrawingOption();if(this.itemBinder&&t&&"select"!==t.value)this.floorplan3DThis.props.mainComponentThis.handleMouseUp(e),this.itemBinder.isWallItem?this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&this.floorplan3DThis.createFloorplanItem(this.floorplan3DThis.floorplan3DViewScene,t.objects3DArray,this.itemBinder.objectType,this.itemBinder.object2D,this.itemBinder.floorNumber):(t.currentViewArray.push(this.itemBinder),this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&t.floorplanViewArray.push(this.floorplan3DThis.createFloorplanItem(this.floorplan3DThis.floorplan3DViewScene,t.objects3DArray,this.itemBinder.objectType,this.itemBinder.object2D,this.itemBinder.floorNumber))),this.switchState(this.states.UNSELECTED),this.previousItemBinder=this.itemBinder,this.itemBinder=null;else switch(this.mouseDownItemSelected&&(this.floorplan3DThis.selectedUserMode!==this.floorplan3DThis.editModeValue?this.selectedObject&&await this.selectedObject.mesh.changeStateOnClick(this.selectedObject.mesh.entity):this.floorplan3DThis.onFloorplanItemSelect(this.selectedObject)),this.state){case this.states.DRAGGING:if(this.selectedObject.clickReleased(),this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&!this.selectedObject.isWallItem){const e=this.floorplan3DThis.getFloorplanViewSceneItem(this.selectedObject.object2D);e&&e.moveToPosition(this.selectedObject.getItemCenter())}this.switchState(this.states.SELECTED);break;case this.states.ROTATING:if(this.mouseMoved){if(this.selectedObject.clickReleased(),this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()){const e=this.floorplan3DThis.getFloorplanViewSceneItem(this.selectedObject.object2D);e&&e.rotateItem(P(this.selectedObject.object2D.angle),-1)}this.switchState(this.states.SELECTED)}else this.switchState(this.states.ROTATING_FREE);break;case this.states.UNSELECTED:this.mouseMoved||this.checkWallsAndFloors();break;case this.states.SELECTED:null!=this.intersectedObject||this.mouseMoved||(this.switchState(this.states.UNSELECTED),this.checkWallsAndFloors());case this.states.ROTATING_FREE:}}},this.enabled=!0,this.scene=e,this.container=t,this.raycaster=new Y.iMs,this.floorplan3DThis=i,this.itemBinder=null,this.previousItemBinder=null,this.mouse=new Y.FM8,this.intersectedObject=null,this.mouseoverObject=null,this.selectedObject=null,this.mouseDown=!1,this.mouseDownItemSelected=!1,this.mouseMoved=!1,this.rotateMouseOver=!1,this.states={UNSELECTED:0,SELECTED:1,DRAGGING:2,ROTATING:3,ROTATING_FREE:4,PANNING:5},this.state=this.states.UNSELECTED,this.needsUpdate=!0,this.container.addEventListener("mousemove",this.mouseMoveEvent,!1),this.container.addEventListener("mousedown",this.mouseDownEvent,!1),this.container.addEventListener("mouseup",this.mouseUpEvent,!1),this.intersectionGround=new Y.Kj0(new Y._12(2*this.floorplan3DThis.floorplanEnvironmentRadius,2*this.floorplan3DThis.floorplanEnvironmentRadius),new Y.vBJ({color:16711680})),this.intersectionGround.rotation.x=-Math.PI/2,this.intersectionGround.translateX(this.floorplan3DThis.floorplanCenterVector.x),this.intersectionGround.translateY(-this.floorplan3DThis.floorplanCenterVector.z),this.intersectionGround.visible=!1,this.scene.add(this.intersectionGround)}removeItemBinder(){this.itemBinder&&(this.itemBinder.remove(),this.itemBinder.clickReleased(),this.itemRemoved(this.itemBinder),this.itemBinder=null,this.previousItemBinder=null,this.floorplan3DThis.props.mainComponentThis.removeBinder())}setCursorStyle(e){this.container.style.cursor=e}itemLoaded(e){this.setSelectedObject(e),this.switchState(this.states.DRAGGING),this.clickPressed()}itemRemoved(e){e===this.selectedObject&&(this.selectedObject.setUnselected(),this.selectedObject.mouseOff(),this.switchState(this.states.UNSELECTED))}clickPressed(e){e=e||this.mouse;var t=this.itemIntersection(e,this.selectedObject);t&&this.selectedObject.clickPressed(t)}clickDragged(e){e=e||this.mouse;var t=this.itemIntersection(e,this.selectedObject);t&&(this.isRotating()?this.selectedObject.rotate(t):this.selectedObject.clickDragged(t,this.mouseDown))}getWallsIntersections(e){var t=[];return(this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()?this.floorplan3DThis.currentWalls3D:this.floorplan3DThis.floorplanViewWalls3D).forEach((e=>{t.push(e.interiorWallPlane.planeObject),t.push(e.exteriorWallPlane.planeObject)})),this.getIntersections(e,t,!0,!1)}checkWallsAndFloors(){if(this.state==this.states.UNSELECTED&&null==this.mouseoverObject){var e=this.getWallsIntersections(this.mouse);if(e.length>0){var t=e[0].object.wall3D;return void wa.log("Wall clickedd",t)}var i=this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()?this.floorplan3DThis.currentRoomFloors:this.floorplan3DThis.floorplanViewRoomFloors,o=this.getIntersections(this.mouse,i,!0,!1);if(o.length>0){var s=o[0].object;return void wa.log("Room clicked",s)}this.floorplan3DThis.userInteractionControlerNothingClickedReset()}}switchState(e){e!=this.state&&(this.onExit(this.state),this.onEntry(e)),this.state=e,this.floorplan3DThis.floorplanItemCurrentHUDObject.setRotating(this.isRotating())}onEntry(e){switch(e){case this.states.UNSELECTED:this.setSelectedObject(null);break;case this.states.SELECTED:this.setSceneControlsState(!0);break;case this.states.ROTATING:case this.states.ROTATING_FREE:this.setSceneControlsState(!1);break;case this.states.DRAGGING:this.setCursorStyle("move"),this.clickPressed(),this.setSceneControlsState(!this.mouseDown)}}onExit(e){switch(e){case this.states.UNSELECTED:case this.states.SELECTED:break;case this.states.DRAGGING:this.mouseoverObject?this.setCursorStyle("pointer"):this.setCursorStyle("auto");case this.states.ROTATING:case this.states.ROTATING_FREE:}}updateIntersections(){var e=this.floorplan3DThis.floorplanItemCurrentHUDObject.getObject();if(null!=e&&this.floorplan3DThis.selectedUserMode===this.floorplan3DThis.editModeValue&&this.getIntersections(this.mouse,e,!0,!0).length>0)return this.rotateMouseOver=!0,this.floorplan3DThis.floorplanItemCurrentHUDObject.setMouseover(!0),void(this.intersectedObject=null);this.rotateMouseOver=!1,this.floorplan3DThis.floorplanItemCurrentHUDObject.setMouseover(!1);var t=this.scene.getObjectsByProperty("isFloorplanItem",!0),i=this.getIntersections(this.mouse,t,!0,!0);if(i.length>0)this.intersectedObject=this.resolveIntersectedItemObject(this.getIntersectionFloorplanItemObject(i[0].object),i[0]);else if(t=[],this.scene.getObjectsByProperty("isUnfixedItem",!0).forEach((e=>t.push(...e.itemObject.getUnfixedItemIntersections()))),(i=this.getIntersections(this.mouse,t,!0,!0)).length>0){const e=(e=>{let t,i;for(let o=0;o<e.length;o++)"background_mesh"===e[o].object.type?t=e[o]:"room_mesh"===e[o].object.type&&(i=e[o]);return t&&i&&("background_mesh"===e[0].object.type||"room_mesh"===e[0].object.type)?i:e[0]})(i);this.intersectedObject=this.resolveIntersectedItemObject(this.getIntersectionUnfixedItemObject(e.object),e),this.intersectedObject&&(this.intersectedObject.raycastedObject=e.object)}else this.intersectedObject=null}getIntersectionFloorplanItemObject(e){if(e.isFloorplanItem)return e.itemObject;let t=e.parent;for(;!t.isFloorplanItem;)t=t.parent;return t.itemObject}getIntersectionUnfixedItemObject(e){if(e.itemObject)return e.itemObject}resolveIntersectedItemObject(e,t){const i=this.getWallsIntersections(this.mouse);if(i.length>0&&i[0].distance<t.distance)return null;let o=e;return this.floorplan3DThis.selectedUserMode!==this.floorplan3DThis.editModeValue&&(e.mesh.entity&&e.mesh.changeStateOnClick||(o=null)),o}itemIntersection(e,t){var i=t.customIntersectionPlanes(),o=[];return(o=i&&i.length>0?this.getIntersections(e,i,!0,!1):this.getIntersections(e,this.intersectionGround,!1,!1)).length>0?(this.floorplan3DThis.processSceneVec3(o[0].point),o[0]):null}normalizeVector2(e){const t=this.container.getBoundingClientRect();let i=new Y.FM8;return i.x=(e.x-t.left)/t.width*2-1,i.y=-(e.y-t.top)/t.height*2+1,i}getIntersections(e,t,i,o){if(i=i||!1,o=o||!1,this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()){const t=this.normalizeVector2(e),i=this.floorplan3DThis.floorplan3DOnMapCamera.projectionMatrix.clone().invert(),o=(new Y.Pa4).applyMatrix4(i),s=new Y.Pa4(t.x,t.y,1).applyMatrix4(i).clone().sub(o).normalize();this.raycaster.set(o,s)}else this.raycaster.setFromCamera(this.normalizeVector2(e),this.floorplan3DThis.floorplan3DViewCamera);var s=[];if(t instanceof Array)i&&(t=t.filter((e=>e.visible&&this.scene.getObjectByProperty("uuid",e.uuid)))),s=this.raycaster.intersectObjects(t,o);else{if(i&&!t.visible)return[];s=this.raycaster.intersectObject(t,o)}return s}setSelectedObject(e){this.state===this.states.UNSELECTED&&this.switchState(this.states.SELECTED),null!=this.selectedObject&&this.selectedObject.setUnselected(),null!=e?(this.selectedObject=e,this.selectedObject.setSelected()):(this.selectedObject=null,this.floorplan3DThis.onFloorplanItemUnselect()),this.needsUpdate=!0}updateMouseover(){null!=this.intersectedObject?null!=this.mouseoverObject?this.mouseoverObject!==this.intersectedObject&&(this.mouseoverObject.mouseOff(),this.mouseoverObject=this.intersectedObject,this.mouseoverObject.mouseOver(),this.needsUpdate=!0):(this.mouseoverObject=this.intersectedObject,this.mouseoverObject.mouseOver(),this.setCursorStyle("pointer"),this.needsUpdate=!0):null!=this.mouseoverObject&&(this.mouseoverObject.mouseOff(),this.setCursorStyle("auto"),this.mouseoverObject=null,this.needsUpdate=!0)}setSceneControlsState(e){this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()?e?this.floorplan3DThis._map.dragPan.enable():this.floorplan3DThis._map.dragPan.disable():this.floorplan3DThis.currentControls.enabled=e}};const Sa=class{constructor(e){this.scene=e,this.selectedItem=null,this.rotating=!1,this.mouseover=!1,this.height=5,this.distance=20,this.color="#000000",this.hoverColor="#f1c40f",this.activeObject=null}getScene(){return this.scene}getObject(){return this.activeObject}resetSelectedItem(){this.selectedItem=null,this.activeObject&&(this.scene.remove(this.activeObject),this.activeObject=null)}itemSelected(e){this.selectedItem!=e&&(this.resetSelectedItem(),e.allowRotate&&!e.fixed&&(this.selectedItem=e,this.activeObject=this.makeObject(this.selectedItem),this.scene.add(this.activeObject)))}itemUnselected(){this.resetSelectedItem()}setRotating(e){this.rotating=e,this.setColor()}setMouseover(e){this.mouseover=e,this.setColor()}setColor(){this.activeObject&&this.activeObject.children.forEach((e=>{e.material.color.set(this.getColor())}))}getColor(){return this.mouseover||this.rotating?this.hoverColor:this.color}update(){if(this.activeObject){this.activeObject.rotation.y=this.selectedItem.rotation;const e=this.selectedItem.getItemCenter();this.activeObject.position.x=e.x,this.activeObject.position.z=e.z}}makeLineGeometry(e){const t=new Y.u9r,i=this.rotateVector(e),o=new Float32Array([0,0,0,i.x,i.y,i.z]),s=new Y.TlE(o,3);return t.setAttribute("position",s),t}rotateVector(e){return new Y.Pa4(0,0,Math.max(e.halfSize.x,e.halfSize.z)+1.4+this.distance)}makeLineMaterial(){return new Y.nls({color:this.getColor(),linewidth:3})}makeCone(e){var t=new Y.fHI(5,0,10),i=new Y.vBJ({color:this.getColor()}),o=new Y.Kj0(t,i);return o.position.copy(this.rotateVector(e)),o.rotation.x=-Math.PI/2,o}makeSphere(){var e=new Y.xo$(4,16,16),t=new Y.vBJ({color:this.getColor()});return new Y.Kj0(e,t)}makeObject(e){var t=new Y.Tme,i=new Y.ejS(this.makeLineGeometry(e),this.makeLineMaterial(this.rotating)),o=this.makeCone(e),s=this.makeSphere(e);t.add(i),t.add(o),t.add(s),t.rotation.y=e.rotation;const n=e.getItemCenter();return t.position.x=n.x,t.position.z=n.z,t.position.y=e.floorNumber*e.floorplan3DThis.wallHeight+this.height,t}},va="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbcAAABgCAYAAACe2zzIAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAZgElEQVR42u2dW2wc13nH/2dm9jYURS11oWinlkWqSF0XLly6BQr3kQLcPCSOG6qxrSCBm1BoKj+4TkA9BEgC+EFC7OZFNSomNRLEsVzRVY2+NID4WL3UZgMLUaogIhU51oWUyBFNieJtZ/owe8Tds2d2Z2bncmb5/QBCEkXunpmdc/7f7XyHOY6DuDmz8KtXZp3l725n+fPdLPf158qP34j9TQmCIIgtC4tT3P7duvjMbfv+yU+d9UH+PYOx1T5mvvVC7xPfTPviCYIgiM4kFnE7a13sX3LWfzxn3/+c188Umb7Yz7qOfqn38bfTvgkEQRBEZxG5uL2zcOHNWWf5pQ3HKfj5+e0sN92nmSPPlv/4l2nfDIIgCKIziEzc3lu4ePiGc+/kilPpCfP7ezXzdBczXqV8HEEQBNEubYvb+9avn5y1lydq82phMRhb3cvM15/vfeI7ad8YgiAIIruEFrez1sX+e87GGzft5eejHpTJjJt9zPw25eMIgiCIMIQSt9MLF1676Sx/y29eLSw7teL5XlZ4mfJxBEEQRBACidt7CxcPzzrLP1h2NvYmNUCDsdVdrHSW8nEEQRCEX3yJ2/vWr5+8Za/85I6z+kRaAy0yfXEXK56kfBxBEATRiqbixvNqt537z8UdgvTLdpab3qWVjv5N+fFfpD0WgiAIQk08xe30woXXbjsrR8OW9sfNTq14fgfLj1CokiAIghBpEDdZyyxV4fm4r/T+6Qtpj4UgCIJQhwfidta62H/HWZuYt1eeTntQQSkyfbGPmd8/1PsnP0x7LARBEET6MMdx8LOFj95RKa8WFmrlRRAEQQAAG7899VGaVZBRs7icw771vg92a4UvPLt/D+XjCIIgtiCaDbsr7UFEwfKajt/Pm5hdLGJ2xf7zqysbV96dnn0z7XERBEEQyaOlPYB2qdgMN+8U8cm8iftr+ub3HRSur1b+/p8v3bhz9src4bTHSRAEQSQH+5fbH1zOQmWkjPmlAqx7OdgOq/v+Pq0bJsvVfW+HoV3Ylde+9vlH92yFfNxYzd+Pt/jZKQAT1b9bAMZjGtMAgGnhe4MAZhK/O2pxCsBozb8tuPfFSnFM4mc1CeBgiuOJijKAD6vXp8J18XlaRv2clXECm8/EiRTHHIRhAEPVv4/U/F1G7To0Wf13W2RS3O6uGJj7tIiNCpP+v0zcOH15/XSXzl7tsHzcCNwJ20rI/DIDV+QmEJ34kLg1IrsnAHAM6S5gsnEdhLvoZJkx1M+RpMVtCO6CPwZX0NrBgvuMRCIEETJavcaRCF5rvHptoQzuTIUl1ysafj9v4rpV8hS2VsyuVZ6/urJx5d+mZ19L+3rahFt7CwDOIDphAzaFchqupTva3ssRHowG/H6anEp7AG0SpfEXlFG48+jD6hjaFTZUX+N49TWn0drzixu+Fp1CNMIGuPftFACneq0DQX45E55bxWaYv5vHnXt5Xz/fzHOrpVvXpnfmte89t39Plo7W4aIW9GGuDWsA7oMSZBGdqb5G2LAleW71lOHeD6+F7gjiCxG3QlWPsh3OoHHRjdtzG0GwRZl7Y7UE8fIsuJ9Rks/NMFwB8nuNk6iPAARdh8ar96jluqG8uFn38phfyjfk1ZrhV9w4O3Pa+XJOezkD+ThuyTSDPzxTCBZG4iGTITS3vCbhTqCgoRASt3rEEJnIFICnUhqbl7ipkA8MwzCAc5LvxyVuA3Dn6XCTn5lE/Vz1g985OgXXOIo7XNnsGeZCHTSPP1bzZzNRb2n8KStuy2s6bt4JF34MKm4AoDOs7srpZxXNx7WaLDwZG6VVPQp3Anm9Z1DPgsStngXUT94jaAxZpZXn8hI3wP3Mj6Qwpnb4EPJihjjErZkBynPZUc3Tser7eXlNcXraxyGPHk1iM1/fLgPY9H5lNP38lMu5rVc0XLNK+GTeDJ1XC0PFQWF2rfL8tdXK/703M/dK2vehhmG4k1MmMvzDfQrRP8Tj1df2WmBPIb0cRtYZRb2I1Rbw1JJ2HsVr7ENtv0pnjvcM5MI2A+AQXGMuynl6ovqahyA3Eo9D7rG2i1da5Ajc9SIKYQM2UyEMrlBbkv/3RBlxq9gM80sFXJnrwr0VI7VxrNpOz8crG//0o9/cvPwfV+aeSfm2jMF9OEX3nE+WJCx7LqAya30M2S80SANxYTgh/MmpLaVWiawYNbzoIgnOQR4qPAZXgKJa8GVMVN/jmOT/uHEcRREL4D6P4j2dgWtgx5nrOwGgF/VzpKmhoIS4LS7ncGWuC/N3/RWMJMFSxR68cn/jv37625v//f6Vuf4UhuAVzx5H/JNFBn/f2jg+t6wI//BtG5zanMQMGhcIFSsnoyr1jhsxbxNHrpDvnRMjKzxnmuT8OFF9T9GjGYLcSA6DuCZZcA3tpLYjHKte4zGo7Lktr+m4eqsLs4vFQAUjSTK/bj99dWXjys8vz76T4Nt6CdshpJvv4BbaJNyH+iC2bs4sLKJYiYufTNwClUDHhDgu1b23AXh7yFFyBo3e9STceZLG/jMuqmJEhwtcOwyjUcTDFJdFcY0tP8tUxG29oj1ombW6oYTz2BSej0uolZcsgcqFJGlvzQue5yNhC4a4OMgqyWRVrirk3mRbSVQYlxdiuJxvCI6S42hc7HmuOk34eiETuDNtvK54rbx4REkSVRaeV7t6y8Sn94NVM6rAqu30/O7+xs9+9Jubl//zd3NPxvAWvCpSRMXuECRswRG9tnHIQ2WiVTqC6HImYZGFoMeghlcpIlb5yvaPRfEeorhPQK1KUtm6IRu3X8TnVxVjW0pi4vbJuokr89swfzfYnjUVWarYg5eXN/43hlDlGTQuYknGs4n44GXNtXhZveLepzLUyL2Jm2f99ERMAzHy4WvTbwBkRugU3LmqGrL1I4xRMoDGtWlri9syDFxyenDF7sbV4jYsFtQpGmn72irOX0T4cmNojN0fg+IPEOEbUQTG0XzBHZf8ftreG9DomfBegqogLtxxFD3JClVUFDavsZURvMpZFEMLim/mj03cKmCYcbpx0d6BJccNQdqM4U6+gGvburCi622+Q0chs4B9JU2JTCDzvFoZLaL4laFGheKkZOyqFJfI5lHUYcJhNH6WLSv3UmYGjdsEZMUhzRANK6WFDYhJ3K45Jj6yezHvFKT/v8E0zJomZs0SNjT1C0oSQNzUC6hrCRLBERdDsb+eFzLvTQXEhXIIaoRNxQ4vE4g+Vy1+BkoXVdRwAvLwpF+UFzORSJVlCTl8ZPfiumOigtZ5tRXdwLWuLliFAmyW7TxcG8iszVYhKyI7yD5fvx65WHAStMlsXMg8gbTDpjKBPRbmhZog83ayFF1p13urRYUQeVMiEbdV6Ljk9OCS3YO1EC/5aT6Pa11dWMp3Tj4uADKvLepJSaSHrNWWX29CVuWnQmgSaDTA0hZeMTQaR6hQdqqAalXMzZCN1+9nJt7LMtTsnvOAtsStAoaPnS5csMsP8mphsRnDQqGAG13mVsvH+S0PJ7JJq03brRBDXu1Y21EiE97AZ25FhFjUIuv00i6ynGeWvDaOeF/8bjOZQeO6pMJz6ElocZt1SvjI7sWsU4p0QGuajlnTxK3SlsjHDaFxMchC/J7wh9hdJMyiK9vorUrubRyNnkAaxSWysG/UBuIwwnvgKjGBxnvj13uTNfZWNjwZWD2WkMOvnDI+drp85dXCsmy4+bjFQr6T83GyfnS0p61zkOVSwyBrqKzK5mkxhN7smKQ4EEv/4yrwEL22LG/REe+P3/CieM1hthQkhm9xW4WO3zrbccnuwX0nubDhnbwbqryby15HEx/IetIRnYEoQEEPbaxF5vGp4r1NScaW1IInawEWV75a1noqq4gGtF9jRJazG0F7Lb1io6W4VcBwzTFxwS7jjpNOwccG0zBfLGLWLHVaPk7muRGdQdShMtFqVqWhMtB41lZSxSViWCyO/pGovocYfsvyXBUFqgz/z9IRND7HI3BPRlDleQTQQtxuO8UHpf0qsKIbmDVNzBeLnZCPk7WzybI1SGwiK/poN4zlZTWrgIVGj0nccxY14mZq2RiifK9appDtoi8LjeLsNzQ5A3lj6CG4p7ersqFfLm5LyLkts5xtsebVwnI3l8MN08x6Ky/xYVK+nQ3hG1kPySjK0mWNi1VJ6IteU9x9J2X9I+OaP6JHkmWvjSM+j0G8Ln6sjux+jwFw4IamUzW+6sRtFTpmnG5csnvaLu2Pm9pWXstGeid3t4HsdG0i+8hCclGVjE+isSWXCpu6ObKN3XGEqkZRbxwmfWhuJ8xV2b61IHidG8cZhZuLc+AaIonniB+I2zXHxEV7h2fLLFXZYBpulUqYNUtY0zMVqiRx60xk7Zmi/GzFRVwlcZNVKkZdXJJE/0gRpXJJESF6XWEiADxEeQTNn3F++LIDN3Q5hgS8Om0BxR1BWmapyopu4IbZhfliEZVsXgaFJLNPEht9VesMIiKGB4cR7UImFtLE0T+yFZ0wV6O8hnEAg3BFrlVueQCu0HGv7kPEJHbaOnrhsEyG9aSs5Quo6GqHVDPOENyHkX+pUtSgAmKrrbjaM6m6LQCQhwijKjLgC2Mt1KouGqLI3Y7DbfjO4P+4riHUi90ZRPQ8a9tY8c4BbQd2aSVoGd4sbTAN21keXcgle7z41oM/jPxL6RY8CSILl8W10VfWUFklI0M8HFS2Hy0MSfSP3KpE7Y2ewKbQHYL/z2oEmyFM7tWF4oEO7GYlDGg96GHZyrlpALYxA93IQc9wWBXqVL0R4RB79MXR35Aj6+uoUmgSiP7UADG8Gef9bUUnzNUkr2EC7vM6CFfsjsB9PlpVnXJDmldfBsp91jk5OWh4SOvCPm07TKZ2aI8BKDIdPayAHDK5sVu0lDoxab2VCHusTVhUbajMmUC951pGe+FJsTAlztJ/kU70DtM8fHQc7uf3FOrFrtkYRrFZjOILaQTPZAb2ad14SOtSMlSZr4YgS8h0rpDErXMQixwsxN97UNbOS3XvTSzh94t4f9M+ILQT5qp4DWkWyXCx64Xr3TULYR6Hz24oTdNTPawAno9TAYNp6Ga5al5NPdENiOiSy1r8ENlAViGZxGIhO+tNpYVXdqhpUO9N5vElXUQiLrRKn2PmE/E5UcU75QVJg3C3GcgKsoYAnEOLZ71l7YUOht2shAP6Dmxj6XQE0QB0VfNqRueUi2TufCRCihgObKdBclBmID+GRCXErQti26xWxNk/0q8hIC6wWRc32UGjKnZdmYQrcAch76hyDk0cAt9KkYOGP9C2YZ+2HYUEtw4UmY7tLI98NvNqrei0SbMVkVVIJp2/qEV2snuayIpf/BaXiFWWcfaPbHUNnWSIimO3oI7nJmMS8m4oA2jSJCCwG2QyAwPadvRpZqz5uBzT0FPNq7HshyC9EK0llcq5idYMoHGhSPp0ZtleOtVyb+Khpn43nqdZRCIi3uMsi1sWj9qy4HpwsjVT+lmEdsF6WRE9rIDb9n0sOCuRXYHOGEwYnRR+bIbMEhlGNh42otFrm0E6Boq44I+hcS9c2hyDWwjAOQ7Xy/XyGMRFawrJGw61TKD+sx1BdjeQi4aFiiFJLw7CrZqs9fxHIVkz24ov6mDo00z0oojr9j0sO+uhX4sBKDEDhc4MP3oxBXdy18b+R0DilgVk3oesg0Ya8IbKaYqBCD/UtPaejcG7L2TaRSQik3CNBb6oZtUQFfdjAulWngaFh7lrnw+p5xaJe5SDhn1aN/Zp25FjwV/S3a+W32rCxpHlTFSqeCPkqBb6y8L4xL1Mo5AvTOJpAmJYMw1k2ztUK97xg/hcJJ0jjgLxc5AVyEQb+zOZgSCtvIytkVdrhSx8lMVJs5VQ7agZGao1VAbkxSWihya2MZP9TlqIi6pqG+dbIRtvlrw2jqzSvMEhiCWxtZuVcEDb4dnKSwPQzXLo7oz9au3i1UopS5NmqyFWJM7Ajayn/aX6pm7AfdZrczxDwjjFE7zFPpVpIiveyZIhKhoScTX2TgLZPuE6Yqva0MHwkNaF/XrPg1ZetS2ztkjBiF9k3lvU52AR0SEuaKpYv6KRNAQ1jSTZxm4eWqoVuqQPIfWDOJ6g+/bSYgyNoTvV7m2kxK4wRehuKy+jiJ16Iests+owdfY/Eb2UzHtTpTiBqEf02pLctN2KGWTDsxDbZ/FQpGpFJH7Gjuq4Vc6Ty05lyLLXBvjojZmY+9RnFDBQymFXXoOW8Uhkt65NHzCNP3vxQN8LEb6sGK4BNs9MI9RB1iBZpYS8zLNQsTmAeN/GUO9lTiL+/pxRjb0M9xwyFeFjEw2yuE8vj5uW7cMSjQ3qDNiV17G/ZKAnl72wZEFji4+WjK9847N7D3z+0T2/jOEtDqFxoTwO2tytCrLejaotwFnY1A20DjmqvPjOSMY3BDUF7gzk4UhV8phhGEajWDfs1UtFYXIaQ39BxyMlA4UMuHE6w2pfXj/9D3/Uv+O5/XvejvGtZJMGcB9QErj0EUVC7JuoCqLgqrq9xGuRzcLiy88oq2UEauXKz6Ex5yobtx8GoE4EQFwLpeHVVN0nU2fYbxroL+rKhip35rTz+4rG/ohDkM2YgDzXENnx60QoslRGLRNdVZ8d8VlXqfTfz9hlXvK5lMdVhlzYpuBGh8LAj5pJu0BJLDoCPKInSsQGewwNg6abj1OFbl2b3l8y/vqrf7j3r57dv+dGwm9/AnKBO47G+HmSlLF1PUhxQk1C7bZFMq9CpYbKnAnUC0SrQytV4xAan4NhuEKQhqfDj4ORCdvBkK85gs15fw7pFbrJcpuykzEAKCJuwGY+btA0sM1Iz40raGzxkaLxj9/47N4DX9y/5xcp3hIvgRuB21st6TwKf9+0Lbc0GID8zDaVETtPqLzxnJ/EfAzqesNe8Ia+shM+PkSyHvMY5KLKhS2s0SA++2NIfi3gR9yI4XXP3Kwy4sbJaQyfKRp4pGQgyZoTnld7uKA/9qWBPT9M+z5UOQF5GKEMN7afRJiAW4Iyj3EKapZrR424QE1B/TLqdo6aSRpeXKK6weAFFziZB3EcrhDEGfHghqfMo5qAe1xMO97wIcm1cbE5F/O18euTibYsLPwA5cSNY+oMg2YOfYX483E7c9r5/SXjL1880PdCCiHIVkzAPZVWFgLjwhOHhchzB14COo72J00WkHk8WfEuxOYAWzmsnASHIPckBuAah9OIdp5yD+oM5AVDxxA+xya7NpkhOyxcW5TG0zC8DetxtDCG2Bvz85cXHWcwwgFFTsUBbq9VYK3bvn7+sRUb2yutf65b16Z35rXvxVwBGSWjaF2NxUvBg3oXvJvFEJovgDNwH/KgJfADcCdALYNQvypO3Fw8Ux13VjiFxq4frcYv+6wULfkKBF8sg9yLMPBDNJtFVSZRP1f94HeOTsEV2ThywkNw50Oza5vBpgEY1Bsfq/nTSyiP+XndTIgbZ912cGO1guWK0/TnWombzrC6N6+//reDfd9J+5pCwLs5BLUAxY2nYRrr+nqoPJAtmCpsgG52PWU0nh3Vzj1IA9l9P4Lm3ieJWzSMIFj3knZDyfyk8iQiCyOQt/RqxhQajeKRAK/Bt0r5MtozJW6cpQ0bc2sVeDlyzcStL6+f7tLZqwqGH4PCw2VxVy7xB7LdBV22YKZNq8VN9Nqs6s+nLchBEb23STSvnCNxi5bR6ldc1ZPcU0rD6BpBfTWlMteXyUaP3YaGbkPD7bUKFtZt2E7r39lhaBd25bWvxdRZJA24lXcCm50zohI6LmjNTkreCshybVkTNsD9HGuvhe/ZU70oplMYr37xsGIUuSk+/9MubuLrBLDpyUUldPwcv1BdgDIpbpxdeR3lnI65tQoWPdy4gsYW+wv60Qzl1cLAP3xu2fCQpXg2lozaUIHnnpEtiHhgJpCdQhIRntupzZMch1sQRCTHVPUrzDytDeGrGhavHVftiRR+BG8CmznCSPaQZjIsKWO54uD2mpuPe2zFRtnGal9ef+vLg33fTHtsBEEQRLIYOnAv7UFEgakzPFIysLhhY6/NPtgL9oUOyKsRBEEQIWCO42B8YeGdWcd5bgMotP+S6dHD2PRDjI18uVzulLwaQRAEEQLmOG41xjuW1b/gOBO3HOfptAcVlBKw2K9p3/9quaxKZxGCIAgiRR6IG+fnlvXMrOOczEIezgBW+xg7O9rbm1THfoIgCCIDNIgb5y3Lem3Oto/eB3rSHqSM3Yyd72Vs5IVymfJqBEEQRB2e4ga4ocq7jvOGSvm4Hsam+xg7+mK5nGbHfoIgCEJhmoob513LenLWcX6y4DhPpDXQErC4R9NOvlQuZ7FlFkEQBJEgvsSN87ZlHb7hOD+46zh7kxogz6ttY+xVCkESBEEQfggkbpy3LOu1a7b9rbhDlbsZO7+LsZeptJ8gCIIIQihxAzbzcdcc5/moB7WNsZv9jH37cLncyS2zCIIgiJgILW6cdy3ryeuOMxHF1gEDWH1Y016nvBpBEATRDm2LG+dtyzr8iW2fDLt14GHGTlNejSAIgoiCyMSN86+W9eZ1237Jbz6OWmYRBEEQURO5uAFuPm7RcX5803E+5/UzJWDxM5p2lPJqBEEQRNTEIm4cWSsvA1h9SNPe+rtymY6iIQiCIGIhVnHj/NSyXrlh29/tYex8D2Nfp7waQRAEESeJiBtBEARBJImW9gAIgiAIImpI3AiCIIiOg8SNIAiC6Dj+H70JmpUCX4E6AAAAEnRFWHRFWElGOk9yaWVudGF0aW9uADGEWOzvAAAAAElFTkSuQmCC";var ja=i(1317);const Da=class{constructor(e,t,i){this.floorplan3DThis=e,this.entity={...t},this.entity_id=this.entity.entity_id,this.domain=this.entity_id.split(".")[0],this.class=ti(t),this.additionalParameters=e.getHAEntityAdditionalParameters(t),this.bindedObjects=i||[],this.bindWithFixed2DObjects=$e[this.class]}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.entity,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(ja.log(e),"sensor"===this.class||"other"===this.class){const e=[...this.bindedObjects];this.bindedObjects=[];for(let i=0;i<e.length;i++)this.addBindedObject(e[i],t)}else if("input_boolean"===this.domain||"binary_sensor"===this.domain){if("doorWindow"===this.class)return}else if(("light"==this.domain||"switch"===this.domain)&&"lights"===this.class)return}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.entity;if(this.entity={...e},this.bindedObjects)if("sensor"===this.class||"other"===this.class){const e=this.bindedObjects.map((e=>ii(this.entity,e)));for(let t=0;t<this.bindedObjects.length;t++)this.removeBindedObject(this.bindedObjects[t],!1);this.bindedObjects=[];for(let t=0;t<e.length;t++)this.addBindedObject(e[t]);this.floorplan3DThis.HAControlPanelRef.current.updateBindedUnfixedObjectState(this.entity)}else"input_boolean"===this.domain||"binary_sensor"===this.domain?"doorWindow"===this.class&&this.floorplan3DThis.HAControlPanelRef.current.updateFixedBindedObjects(this.entity,this.bindedObjects):"light"!==this.domain&&"switch"!==this.domain||"lights"===this.class&&this.floorplan3DThis.HAControlPanelRef.current.updateFixedBindedObjects(this.entity,this.bindedObjects);else this.create(e)}removeBindedObject(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.bindedObjects.findIndex((t=>t.object2D.id===e.object2D.id));if(-1!==i){t&&this.bindedObjects.splice(i,1);let o=[this.floorplan3DThis.floorplan3DViewScene];this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&o.push(this.floorplan3DThis.floorplan3DOnMapScene),this.bindWithFixed2DObjects?o.forEach((t=>{const i=t.getObjectsByProperty("entity_id",this.entity.entity_id);ja.log("Remove binded object Target object",i);for(let o=0;o<i.length;o++)if(i[o].object2D.id===e.object2D.id){ja.log("Remove target object entity"),i[o].entity=null,i[o].entity_id=null,i[o].changeStateMethod(i[o],{...this.entity,state:this.floorplan3DThis.getHAEntityUserSpecificedStateValue(this.entity,et[this.domain])});break}})):(this.floorplan3DThis[this.additionalParameters.floorplanViewArrayName]=this.floorplan3DThis[this.additionalParameters.floorplanViewArrayName].filter((t=>!(t.mesh.entity_id===this.entity_id&&t.mesh.object2D.id===e.object2D.id))),this.floorplan3DThis[this.additionalParameters.currentViewArrayName]=this.floorplan3DThis[this.additionalParameters.currentViewArrayName].filter((t=>!(t.mesh.entity_id===this.entity_id&&t.mesh.object2D.id===e.object2D.id))),o.forEach((t=>{const i=t.getObjectsByProperty("entity_id",this.entity.entity_id);for(let o=0;o<i.length;o++)if(i[o].object2D.id===e.object2D.id){this.floorplan3DThis.removeUnfixedItem(i[o]);break}})))}}addBindedObject(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.bindedObjects.push(e),this.bindWithFixed2DObjects){let t=[this.floorplan3DThis.floorplan3DViewScene];this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&t.push(this.floorplan3DThis.floorplan3DOnMapScene),t.forEach((t=>{const i=t.getObjectsByProperty("type",e.type);for(let o=0;o<i.length;o++)if(i[o].object2D.id===e.object2D.id){i[o].entity=this.entity,i[o].entity_id=this.entity_id,i[o].changeStateMethod(i[o],this.entity);break}})),this.floorplan3DThis.userInteractionCurrentController.selectedObject&&this.floorplan3DThis.userInteractionCurrentController.selectedObject.mesh.entity&&this.floorplan3DThis.userInteractionCurrentController.selectedObject.mesh.entity.entity_id===this.entity_id&&this.floorplan3DThis.props.mainComponentThis.HAEntitiesBindingRightBoxComponentRef.current&&this.floorplan3DThis.props.mainComponentThis.HAEntitiesBindingRightBoxComponentRef.current.updateBindedEntityState(this.floorplan3DThis.props.mainComponentThis.klet3DLastSavedData.find((t=>t.objID.includes(e.object2D.id))))}else{if("sensor"===this.domain&&"sensor"===this.class){const t=this.floorplan3DThis.createSensorMesh(this.entity,e);if(!t)return void this.bindedObjects.splice(this.bindedObjects.length-1,1);this.bindedObjects[this.bindedObjects.length-1]=t}if("other"===this.class){const t=this.floorplan3DThis.createOtherMesh(this.entity,e);if(!t)return void this.bindedObjects.splice(this.bindedObjects.length-1,1);this.bindedObjects[this.bindedObjects.length-1]=t}if(t){const e=this.floorplan3DThis.createUnfixedItem(this.floorplan3DThis.floorplan3DViewScene,this.bindedObjects[this.bindedObjects.length-1]);if(this.floorplan3DThis[this.additionalParameters.floorplanViewArrayName].push(e),this.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()){const e=this.floorplan3DThis.cloneUnfixedBindedObject3D(this.bindedObjects[this.bindedObjects.length-1]),t=this.floorplan3DThis.createUnfixedItem(this.floorplan3DThis.floorplan3DOnMapScene,e);this.floorplan3DThis[this.additionalParameters.currentViewArrayName].push(t)}else this.floorplan3DThis[this.additionalParameters.currentViewArrayName].push(e)}}}remove(){ja.log("HA entity remove");const e=this.floorplan3DThis.userInteractionCurrentController.selectedObject&&this.floorplan3DThis.userInteractionCurrentController.selectedObject.mesh.entity&&this.floorplan3DThis.userInteractionCurrentController.selectedObject.mesh.entity.entity_id===this.entity_id;for(let t=0;t<this.bindedObjects.length;t++)this.removeBindedObject(this.bindedObjects[t],!1);this.bindedObjects=[],e&&(this.bindWithFixed2DObjects?this.floorplan3DThis.props.mainComponentThis.HAEntitiesBindingRightBoxComponentRef.current&&this.floorplan3DThis.props.mainComponentThis.HAEntitiesBindingRightBoxComponentRef.current.updateBindedEntityState(null):this.floorplan3DThis.userInteractionCurrentController.setSelectedObject(null))}};class Ta extends o.Component{constructor(){super(),this.setBindedFixedObjectsPanelItems=(e,t,i)=>{this.panelItems=this.panelItems.filter((e=>!i.includes(e.type)));const o=this.props.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()?t:e;for(let s=0;s<o.length;s++)if(o[s].mesh.entity){this.panelItems.push({type:o[s].mesh.type,object3D:o[s].mesh,object2D:o[s].mesh.object2D,value:o[s].mesh.entity.state===this.props.floorplan3DThis.getHAEntityUserSpecificedStateValue(o[s].mesh.entity,"on"),entity:o[s].mesh.entity});let e=this.props.floorplan3DThis.HAEntityObjects.find((e=>e.entity_id===o[s].mesh.entity.entity_id));e?!e.bindedObjects.find((e=>e.object2D.id===o[s].mesh.object2D.id))&&e.addBindedObject(o[s].mesh):this.props.floorplan3DThis.HAEntityObjects.push(new Da(this.props.floorplan3DThis,o[s].mesh.entity,[o[s].mesh]))}this.forceUpdate()},this.setBindedUnfixedObjectsPanelItems=(e,t,i,o)=>{const s=this.props.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()?t:e;this.panelItems=this.panelItems.filter((e=>!i.includes(e.type)));for(let n=0;n<s.length;n++)if(s[n].mesh.entity){let e=!1;o&&(e=o(s[n].mesh)),this.panelItems.push({type:s[n].mesh.type,object3D:s[n].mesh,object2D:s[n].mesh.object2D,value:e?T(s[n].mesh.entity.state,this.props.floorplan3DThis.sensorValueDecimalPrecision):s[n].mesh.entity.state,entity:s[n].mesh.entity})}this.forceUpdate()},this.setDoorsWindowsSwitches=()=>this.setBindedFixedObjectsPanelItems(this.props.floorplan3DThis.floorplanViewWalls3D.reduce(((e,t)=>(e.push(...t.inWallItemObjects),e)),[]),this.props.floorplan3DThis.currentWalls3D.reduce(((e,t)=>(e.push(...t.inWallItemObjects),e)),[]),["door","window"]),this.setLightsSwitches=()=>{this.setBindedFixedObjectsPanelItems(this.props.floorplan3DThis.floorplanViewLights,this.props.floorplan3DThis.currentViewLights,["light"])},this.setSensorValues=()=>this.setBindedUnfixedObjectsPanelItems(this.props.floorplan3DThis.floorplanViewSensors,this.props.floorplan3DThis.currentViewSensors,["sensor"],(e=>"number"===this.props.mainComponentThis.klet3DLastSavedData.find((t=>t.entity_id===e.entity.entity_id)).params.sensor_type&&!N.isNumber(e.entity.state))),this.setOthersValues=()=>this.setBindedUnfixedObjectsPanelItems(this.props.floorplan3DThis.floorplanViewOthers,this.props.floorplan3DThis.currentViewOthers,["other"],!1),this.updateFixedBindedObjects=(e,t)=>{this.panelItems.filter((t=>t.entity.entity_id===e.entity_id)).forEach((t=>t.value=e.state===this.props.floorplan3DThis.getHAEntityUserSpecificedStateValue(e,"on")));let i=[{targetObjects:this.props.floorplan3DThis.floorplan3DViewScene.getObjectsByProperty("entity_id",e.entity_id)}];this.props.floorplan3DThis.showMapLayer3DInputRef.current.getCheckedStatus()&&i.push({targetObjects:this.props.floorplan3DThis.floorplan3DOnMapScene.getObjectsByProperty("entity_id",e.entity_id)});for(let o=0;o<t.length;o++)i.forEach((i=>{const s=i.targetObjects.find((e=>e.object2D.id===t[o].object2D.id));s&&s.changeStateMethod(s,e)}));this.forceUpdate()},this.updateBindedUnfixedObjectState=e=>{this.panelItems.filter((t=>t.entity.entity_id===e.entity_id)).forEach((t=>{t.value=e.state,this.forceUpdate()}))},this.onDoorWindowSwitchChange=async e=>{const t=this.props.mainComponentThis.homeAssistantEntities.find((t=>t.entity_id===e.entity.entity_id));if(t){if(t.services.find((e=>"toggle"===e.name))){await this.props.mainComponentThis.callHomeAssistantService(e.entity.entity_id.split(".")[0],"toggle",e.entity.entity_id,{})||this.props.floorplan3DThis.alertRef.current.showAlert("Error while trying to toggle ".concat(e.type,". Please check your connection and try again."),"error")}}},this.panelItems=[],this.setDoorsWindowsSwitches=this.setDoorsWindowsSwitches.bind(this),this.setLightsSwitches=this.setLightsSwitches.bind(this),this.setSensorValues=this.setSensorValues.bind(this),this.setOthersValues=this.setOthersValues.bind(this),this.setBindedFixedObjectsPanelItems=this.setBindedFixedObjectsPanelItems.bind(this),this.setBindedUnfixedObjectsPanelItems=this.setBindedUnfixedObjectsPanelItems.bind(this),this.updateFixedBindedObjects=this.updateFixedBindedObjects.bind(this),this.updateBindedUnfixedObjectState=this.updateBindedUnfixedObjectState.bind(this),this.onDoorWindowSwitchChange=this.onDoorWindowSwitchChange.bind(this)}render(){this.panelItems.filter((e=>"door"===e.type)),this.panelItems.filter((e=>"window"===e.type)),this.panelItems.filter((e=>"light"===e.type)),this.panelItems.filter((e=>"sensor"===e.type)),this.panelItems.filter((e=>"other"===e.type));return null}}const Ia=Ta;class _a extends o.Component{constructor(e){super(),this.onModeChangeClick=(e,t)=>()=>{e.value!==this.state.selectedMode&&(this.state.selectedMode===this.props.floorplan3DThis.editModeValue&&this.props.floorplan3DThis.userInteractionCurrentController.setSelectedObject(null),this.props.floorplan3DThis.selectedUserMode=e.value,this.setState({selectedMode:e.value},(()=>{this.modeSelectorRef.current.style.left=1===t?"50%":"".concat(this.modeControlContainerPaddingLeftRight,"px"),this.props.floorplan3DThis.alertRef.current.showAlert("Switched to ".concat(e.label," Mode."),"success")})))},this.state={selectedMode:e.floorplan3DThis.defaultUserMode},this.modeControlContainerPaddingLeftRight=2,this.modeOptionInfoExplanationBox=o.createRef(),this.modeSelectorRef=o.createRef(),this.onModeChangeClick=this.onModeChangeClick.bind(this)}render(){return(0,l.jsxs)("div",{className:"mode-control-container",children:[He.map(((e,t)=>(0,l.jsxs)("div",{title:e.title,className:"mode-option ".concat(this.state.selectedMode===e.value?"active":""),onClick:this.onModeChangeClick(e,t),children:[(0,l.jsx)("div",{className:"label",children:(0,l.jsx)("span",{children:e.label})}),(0,l.jsx)(wi,{infoText:e.infoText,infoContainerStyles:{marginLeft:2},indoorPanelExplanationBox:this.modeOptionInfoExplanationBox})]},e.label))),(0,l.jsx)("div",{ref:this.modeSelectorRef,className:"mode-selector"}),(0,l.jsx)("div",{ref:this.modeOptionInfoExplanationBox,className:"mode-option-info-explanation-box"})]})}}const La=_a;var Ma=i(1317);const ka=new Y.Pa4,Oa=new Y.V1s;class Ra extends Y.ejS{constructor(e,t){const i=new Y.u9r,o=new Y.nls({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],n=[],a={};function r(e,t){l(e),l(t)}function l(e){s.push(0,0,0),n.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(s.length/3-1)}r("n1","n2"),r("n2","n4"),r("n4","n3"),r("n3","n1"),r("f1","f2"),r("f2","f4"),r("f4","f3"),r("f3","f1"),r("n1","f1"),r("n2","f2"),r("n3","f3"),r("n4","f4"),r("p","n1"),r("p","n2"),r("p","n3"),r("p","n4"),r("u1","u2"),r("u2","u3"),r("u3","u1"),r("c","t"),r("p","c"),r("cn1","cn2"),r("cn3","cn4"),r("cf1","cf2"),r("cf3","cf4"),i.setAttribute("position",new Y.a$l(s,3)),i.setAttribute("color",new Y.a$l(n,3)),super(i,o),this.isDisposed=!1,this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.onGeometryCoordinatesSetCallback=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const h=new Y.Ilk(16755200),c=new Y.Ilk(16711680),d=new Y.Ilk(43775),p=new Y.Ilk(16777215),m=new Y.Ilk(3355443);this.setColors(h,c,d,p,m)}setColors(e,t,i,o,s){const n=this.geometry.getAttribute("color");n.setXYZ(0,e.r,e.g,e.b),n.setXYZ(1,e.r,e.g,e.b),n.setXYZ(2,e.r,e.g,e.b),n.setXYZ(3,e.r,e.g,e.b),n.setXYZ(4,e.r,e.g,e.b),n.setXYZ(5,e.r,e.g,e.b),n.setXYZ(6,e.r,e.g,e.b),n.setXYZ(7,e.r,e.g,e.b),n.setXYZ(8,e.r,e.g,e.b),n.setXYZ(9,e.r,e.g,e.b),n.setXYZ(10,e.r,e.g,e.b),n.setXYZ(11,e.r,e.g,e.b),n.setXYZ(12,e.r,e.g,e.b),n.setXYZ(13,e.r,e.g,e.b),n.setXYZ(14,e.r,e.g,e.b),n.setXYZ(15,e.r,e.g,e.b),n.setXYZ(16,e.r,e.g,e.b),n.setXYZ(17,e.r,e.g,e.b),n.setXYZ(18,e.r,e.g,e.b),n.setXYZ(19,e.r,e.g,e.b),n.setXYZ(20,e.r,e.g,e.b),n.setXYZ(21,e.r,e.g,e.b),n.setXYZ(22,e.r,e.g,e.b),n.setXYZ(23,e.r,e.g,e.b),n.setXYZ(24,t.r,t.g,t.b),n.setXYZ(25,t.r,t.g,t.b),n.setXYZ(26,t.r,t.g,t.b),n.setXYZ(27,t.r,t.g,t.b),n.setXYZ(28,t.r,t.g,t.b),n.setXYZ(29,t.r,t.g,t.b),n.setXYZ(30,t.r,t.g,t.b),n.setXYZ(31,t.r,t.g,t.b),n.setXYZ(32,i.r,i.g,i.b),n.setXYZ(33,i.r,i.g,i.b),n.setXYZ(34,i.r,i.g,i.b),n.setXYZ(35,i.r,i.g,i.b),n.setXYZ(36,i.r,i.g,i.b),n.setXYZ(37,i.r,i.g,i.b),n.setXYZ(38,o.r,o.g,o.b),n.setXYZ(39,o.r,o.g,o.b),n.setXYZ(40,s.r,s.g,s.b),n.setXYZ(41,s.r,s.g,s.b),n.setXYZ(42,s.r,s.g,s.b,!0),n.setXYZ(43,s.r,s.g,s.b,!0),n.setXYZ(44,s.r,s.g,s.b,!0),n.setXYZ(45,s.r,s.g,s.b,!0),n.setXYZ(46,s.r,s.g,s.b),n.setXYZ(47,s.r,s.g,s.b),n.setXYZ(48,s.r,s.g,s.b),n.setXYZ(49,s.r,s.g,s.b),n.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;Oa.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Pa("c",t,e,Oa,0,0,-1),Pa("t",t,e,Oa,0,0,1),Pa("n1",t,e,Oa,-1,-1,-1),Pa("n2",t,e,Oa,1,-1,-1),Pa("n3",t,e,Oa,-1,1,-1),Pa("n4",t,e,Oa,1,1,-1),Pa("f1",t,e,Oa,-1,-1,1),Pa("f2",t,e,Oa,1,-1,1),Pa("f3",t,e,Oa,-1,1,1),Pa("f4",t,e,Oa,1,1,1),Pa("u1",t,e,Oa,.7,1.1,-1),Pa("u2",t,e,Oa,-.7,1.1,-1),Pa("u3",t,e,Oa,0,2,-1),Pa("cf1",t,e,Oa,-1,0,1),Pa("cf2",t,e,Oa,1,0,1),Pa("cf3",t,e,Oa,0,-1,1),Pa("cf4",t,e,Oa,0,1,1);let i=[{propertyName:"cn2",index:43},{propertyName:"cn3",index:44}];if(Pa("cn1",t,e,Oa,-1,0,-1),Pa("cn2",t,e,Oa,1,0,-1),i[0].beforeCoords=new Y.Pa4(e.getAttribute("position").getX(i[0].index),e.getAttribute("position").getY(i[0].index),e.getAttribute("position").getZ(i[0].index)),Pa("cn3",t,e,Oa,0,-1,-1),i[1].beforeCoords=new Y.Pa4(e.getAttribute("position").getX(i[1].index),e.getAttribute("position").getY(i[1].index),e.getAttribute("position").getZ(i[1].index)),Pa("cn4",t,e,Oa,0,1,-1),e.getAttribute("position").needsUpdate=!0,this.onGeometryCoordinatesSetCallback){const t=setInterval((()=>{if(Ma.log("Set interval call"),this.isDisposed)clearInterval(t);else{const o=e.getAttribute("position");if(i.forEach((e=>{const t=new Y.Pa4(o.getX(e.index),o.getY(e.index),o.getZ(e.index));t.applyMatrix4(this.matrix),e.newCoords=t})),Ma.log("targetIndexes",i),0===i.filter((e=>e.beforeCoords.x===e.newCoords.x&&e.beforeCoords.y===e.newCoords.y&&e.beforeCoords.z===e.newCoords.z)).length){clearInterval(t);let e={};for(let t=0;t<i.length;t++)e[i[t].propertyName]=i[t].newCoords;this.onGeometryCoordinatesSetCallback(e)}}}),1)}}dispose(){this.isDisposed=!0,this.geometry.dispose(),this.material.dispose()}}function Pa(e,t,i,o,s,n,a){ka.set(s,n,a).unproject(o);const r=t[e];if(void 0!==r){const e=i.getAttribute("position");for(let t=0,i=r.length;t<i;t++)e.setXYZ(r[t],ka.x,ka.y,ka.z)}}const Fa=Ra;const Aa=class extends U{constructor(e,t,i,o){super(),this.scene=e,this.floorplan3DThis=i,this.fixed=o.fixed||!1,this.resizable=o.resizable||!1,this.mesh=t,this.mesh.isUnfixedItem=!0,this.mesh.itemObject=this,this.raycastedObject=null}initObject(){this.scene.add(this.mesh),"sensor"===this.mesh.type?(this.mesh.backgroundMesh&&(this.mesh.backgroundMesh.itemObject=this,this.scene.add(this.mesh.backgroundMesh)),this.mesh.roomMesh&&(this.mesh.roomMesh.itemObject=this,this.scene.add(this.mesh.roomMesh))):"other"===this.mesh.type&&this.mesh.backgroundMesh&&(this.mesh.backgroundMesh.itemObject=this,this.scene.add(this.mesh.backgroundMesh))}remove(){"sensor"===this.mesh.type?(this.mesh.backgroundMesh&&(this.scene.remove(this.mesh.backgroundMesh),this.floorplan3DThis.disposeObject(this.mesh.backgroundMesh)),this.mesh.roomMesh&&(this.scene.remove(this.mesh.roomMesh),this.floorplan3DThis.disposeObject(this.mesh.roomMesh))):"other"===this.mesh.type&&this.mesh.backgroundMesh&&(this.scene.remove(this.mesh.backgroundMesh),this.floorplan3DThis.disposeObject(this.mesh.backgroundMesh)),this.scene.remove(this.mesh),this.floorplan3DThis.disposeObject(this.mesh)}getUnfixedItemIntersections(){let e=[];return"other"===this.mesh.type?e.push(this.mesh.backgroundMesh):"sensor"===this.mesh.type?(this.mesh.backgroundMesh&&e.push(this.mesh.backgroundMesh),this.mesh.roomMesh&&e.push(this.mesh.roomMesh)):e.push(this.mesh),e}};class Wa extends o.Component{render(){return(0,l.jsx)("svg",{fill:"#000000",viewBox:"0 0 492.589 492.589",children:(0,l.jsxs)("g",{children:[(0,l.jsx)("path",{d:"M468.467,222.168h-28.329c-9.712-89.679-80.46-161.18-169.71-172.258V24.135c0-13.338-10.791-24.134-24.134-24.134\r\nc-13.311,0-24.117,10.796-24.117,24.134V49.91C132.924,60.988,62.177,132.488,52.482,222.168H24.153\r\nC10.806,222.168,0,232.964,0,246.286c0,13.336,10.806,24.132,24.153,24.132h29.228c12.192,86.816,81.551,155.4,168.797,166.229\r\nv31.804c0,13.336,10.806,24.135,24.117,24.135c13.343,0,24.134-10.799,24.134-24.135v-31.804\r\nc87.228-10.829,156.607-79.413,168.775-166.229h29.264c13.33,0,24.122-10.796,24.122-24.132\r\nC492.589,232.964,481.797,222.168,468.467,222.168z M246.294,398.093c-85.345,0-154.804-69.453-154.804-154.813\r\nc0-85.363,69.459-154.813,154.804-154.813c85.376,0,154.823,69.45,154.823,154.813\r\nC401.117,328.639,331.671,398.093,246.294,398.093z"}),(0,l.jsx)("path",{d:"M246.294,176.93c-36.628,0-66.34,29.704-66.34,66.349c0,36.635,29.711,66.349,66.34,66.349\r\nc36.66,0,66.34-29.713,66.34-66.349C312.634,206.635,282.955,176.93,246.294,176.93z"})]})})}}const Ba=Wa;class Ea extends o.Component{constructor(){super(),this.setIsMapActiveState=e=>{this.setState({isMapActive:e})},this.setCurrentControlsType=e=>{this.setState({currentControlsType:e})},this.state={isMapActive:!1,currentControlsType:"orbit"},this.containerRef=o.createRef(),this.setIsMapActiveState=this.setIsMapActiveState.bind(this),this.setCurrentControlsType=this.setCurrentControlsType.bind(this)}render(){return(0,l.jsxs)("div",{ref:this.containerRef,className:"camera-controls-container panel-transition",children:[(0,l.jsx)("button",{title:"orbit"===this.state.currentControlsType?"First person view":"Dollhouse view",className:"btn btn-default panel-icon-button-container ".concat(this.state.isMapActive?"disabled":""),onClick:()=>!this.state.isMapActive&&this.props.floorplan3DThis.onSwitchControlsClick(),children:"orbit"===this.state.currentControlsType?(0,l.jsx)(Is,{}):(0,l.jsx)(Ls,{})}),(0,l.jsx)("button",{title:"View floorplan",className:"btn btn-default panel-icon-button-container ".concat(this.state.isMapActive||"orbit"===this.state.currentControlsType?"":"disabled"),onClick:()=>!(!this.state.isMapActive&&"orbit"!==this.state.currentControlsType)&&this.props.floorplan3DThis.onBirdPerspectiveViewButtonClick(),children:(0,l.jsx)(Ds,{})}),(0,l.jsx)("button",{title:"Reset view",className:"btn btn-default panel-icon-button-container",onClick:()=>this.props.floorplan3DThis.onResetCameraViewButtonClick(),children:(0,l.jsx)(Ba,{})})]})}}const Va=Ea;var Na=i(1317);class za extends o.Component{constructor(e){var t;super(),t=this,this.addHAEntityObject=(e,t)=>{let i=[];if($e[ti(t)])for(let s=0;s<this.floorplan3DViewScene.children.length;s++)this.floorplan3DViewScene.children[s].object2D&&e.objID.includes(this.floorplan3DViewScene.children[s].object2D.id)&&i.push(this.floorplan3DViewScene.children[s]);else{for(let t=0;t<e.objID.length;t++){let o;for(let s=0;s<this.floorplanFloors.length;s++)if(o=this.floorplanFloors[s].objData.find((i=>i.id===e.objID[t])),o){i.push({obj2D:o,floorNumber:this.floorplanFloors[s].floorNumber});break}}i=i.map((e=>ii(t,{object2D:e.obj2D,floorNumber:e.floorNumber})))}const o=new Da(this,t,[]);this.HAEntityObjects.push(o);for(let s=0;s<i.length;s++)Na.log("create ha entity addBindedObject"),o.addBindedObject(i[s])},this.isLightsShadowMapChangeFinished=e=>{for(let t=this.changedLightsShadowMaps.length-1;t>=0;t--)this.changedLightsShadowMaps[t].isMapLight===e&&!Object.hasOwn(this.changedLightsShadowMaps[t],"onLoadingRenderedCallback")&&("off"===this.changedLightsShadowMaps[t].lightObject.state&&!1===this.changedLightsShadowMaps[t].lightObject.castShadow||"on"===this.changedLightsShadowMaps[t].lightObject.state&&!0===this.changedLightsShadowMaps[t].lightObject.castShadow)&&this.changedLightsShadowMaps.splice(t,1);0===this.changedLightsShadowMaps.length&&(s.unmountComponentAtNode(this.props.mainComponentThis.loadingComponentContainer.current),this.changeLightShadowMapsLoadingSet=!1)},this.toggleHALightState=async e=>{const t=this.props.mainComponentThis.homeAssistantEntities.find((t=>t.entity_id===e.entity_id));if(t){if(t.services.find((e=>"toggle"===e.name))){await this.props.mainComponentThis.callHomeAssistantService(e.entity_id.split(".")[0],"toggle",e.entity_id,{})||this.alertRef.current.showAlert("Error while trying to toggle light. Please check your connection and try again.","error")}}},this.onResetCameraViewButtonClick=()=>{this.showMapLayer3DInputRef.current.getCheckedStatus()?this.focusFloorplanOnMap():this.currentControls===this.firstPersonControls?(this.centerFirstPersonControlsCamera(),this.updateWallsVisibility()):(this.centerOrbitControlsCamera(),this.orbitControls.target=this.floorplanCenterVector.clone(),this.orbitControls.update())},this.onSwitchControlsClick=()=>{this.showMapLayer3DInputRef.current.getCheckedStatus()||(this.currentControls===this.orbitControls?(this.orbitControls.enabled=!1,this.floorplan3DViewCamera=this.firstPersonControlsCamera,this.currentControls=this.firstPersonControls,this.cameraControlsRef.current.setCurrentControlsType("first_person")):(this.firstPersonControls.enabled=!1,this.firstPersonControls.disposeCircleNavigator(),this.floorplan3DViewCamera=this.orbitControlsCamera,this.currentControls=this.orbitControls,this.cameraControlsRef.current.setCurrentControlsType("orbit")),this.updateWallsVisibility(),this.currentControls.enabled=!0)},this.onBirdPerspectiveViewButtonClick=()=>{this.showMapLayer3DInputRef.current.getCheckedStatus()?(this._map.setPitch(0),this.focusFloorplanOnMap()):this.currentControls===this.orbitControls&&(this.floorplan3DViewCamera.position.set(this.floorplanCenterVector.x,this.orbitControls.maxDistance-1,this.floorplanCenterVector.z),this.orbitControls.target=this.floorplanCenterVector.clone(),this.orbitControls.update())},this.processSceneVec3=e=>{if(this.showMapLayer3DInputRef.current.getCheckedStatus()){const t=new Y.Pa4(this.props.mainComponentThis.boxWallCoordinates.minX,0,this.props.mainComponentThis.boxWallCoordinates.minY).multiplyScalar(this.scaleFactor),i=this.props.mainComponentThis.floorplanGeneral.floorplan_bearing||0;e.copy(new Y.Pa4(e.x+t.x,e.y,e.z+t.z));const o=[{x:e.x,y:e.z}];Vt(o,{x:t.x,y:t.z},-P(i)),e.x=o[0].x,e.z=o[0].y}},this.getSelectedDrawingOption=()=>null,this.handleKeyDown3D=e=>{"Escape"===e.key&&this.userInteractionCurrentController.setSelectedObject(null)},this.getSensorUnitOfMeasurement=e=>e.attributes&&e.attributes.unit_of_measurement||"",this.getHAEntityUserSpecificedStateValue=(e,t)=>{const i=this.props.mainComponentThis.klet3DLastSavedData.find((t=>t.entity_id===e.entity_id)),o=ti(e);return i?"doorWindow"===o?i.params["on"===t?"open_state":"closed_state"]:"lights"===o?i.params["on"===t?"switched_on_state":"switched_off_state"]:"":""},this.disposeObject=e=>{if(e.isMesh){if(e.geometry.dispose(),e.material.isMaterial)this.disposeObjectMaterial(e.material);else for(const t of e.material)this.disposeObjectMaterial(t);e=null}},this.disposeObjectMaterial=e=>{e.dispose();for(const t of Object.keys(e)){const i=e[t];i&&"object"===typeof i&&"minFilter"in i&&i.dispose()}},this.disposeScene=(e,t)=>{Na.log("disposeScene"),e&&(e.traverse((e=>this.disposeObject(e))),e=null),t&&(t.dispose(),t=null)},this.createPointLight=(e,t)=>{const i=new Y.cek;return i.state="off",i.power=0,i.decay=1,i.distance=1e3,i.shadow.bias=-.01,i.shadow.mapSize.width=1028,i.shadow.mapSize.height=1028,i.shadow.camera.near=1,i.shadow.camera.far=e.y-t*this.wallHeight+2,i.position.set(e.x,e.y,e.z),i},this.onFloorplanItemSelect=e=>{if(this.currentControls===this.firstPersonControls&&this.currentControls.resetState(),this.floorplanItemCurrentHUDObject.itemSelected(e),this.closeActiveRightBox(),e.object2D)"inWall"===e.object2D.family||"onWall"===e.object2D.family?this.props.mainComponentThis.openWallItemToolsRightBox(e.object2D,this):this.props.mainComponentThis.openFreeItemToolsRightBox(e.object2D,this);else{let t;e.raycastedObject&&(e.raycastedObject.sensorMesh&&"sensor"===e.raycastedObject.sensorMesh.type?t=e.raycastedObject.sensorMesh:e.raycastedObject.otherMesh&&"other"===e.raycastedObject.otherMesh.type&&(t=e.raycastedObject.otherMesh)),t&&this.props.mainComponentThis.openHomeAssistantBindingsToolsRightBox(t.object2D,this)}},this.onFloorplanItemUnselect=()=>{this.floorplanItemCurrentHUDObject.itemUnselected(),this.closeActiveRightBox()},this.userInteractionControlerNothingClickedReset=()=>{this.closeActiveRightBox()},this.closeActiveRightBox=()=>{this.props.mainComponentThis.hideActiveRightBox(),this.props.mainComponentThis.removeSelectedBinder()},this.getFloorplanViewSceneItem=e=>{if("inWall"===e.family||"onWall"===e.family){const t="inWall"===e.family?"inWallItemObjects":"onWallItemObjects";let i;for(let o=0;o<this.floorplanViewWalls3D.length;o++)if(i=this.floorplanViewWalls3D[o][t].find((t=>t.object2D.id===e.id)),i)return i}else{let t=[this.floorplanViewFurniture,this.floorplanViewLights];for(let i=0;i<t.length;i++)for(let o=0;o<t[i].length;o++)if(t[i][o].object2D.id===e.id)return t[i][o]}return null},this.createFloorplanItem=function(e,i,o,s,n){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=new(ae[Ut(o)])(e,i,t.panelDrawingOptions.find((e=>e.objects3DArray===i)).object3DProperties,s,o,n,t,{fixed:!0,resizable:!1},a);if(r.initObject(),Gt(o)){let e=t.props.mainComponentThis.klet3DLastSavedData.find((e=>e.objID.includes(s.id)));if(e){const i=t.props.mainComponentThis.homeAssistantEntities.find((t=>t.entity_id===e.entity_id));i&&(r.mesh.entity=i,r.mesh.entity_id=i.entity_id)}r.mesh.object2D=s,r.mesh.changeStateMethod=t.handleLightSwitchClick,r.mesh.changeStateOnClick=t.toggleHALightState,r.mesh.floorNumber=n,r.mesh.entity&&t.handleLightSwitchClick(r.mesh,r.mesh.entity,!0)}else if(Ht(o)||zt(o)){r.mesh.object2D=s;let e=t.props.mainComponentThis.klet3DLastSavedData.find((e=>e.objID.includes(s.id)));if(e){const i=t.props.mainComponentThis.homeAssistantEntities.find((t=>t.entity_id===e.entity_id));i&&(r.mesh.entity=i,r.mesh.entity_id=i.entity_id)}if(Ht(s.type)){r.mesh.rotationAngleSign="reverse"===s.hinge?1:-1;const e=Math.PI*s.angle/180,t=r.getItemCenter();r.mesh.rotationPivotPoint=new Y.Pa4(t.x+r.mesh.rotationAngleSign*r.halfSize.x*Math.cos(e),t.y,t.z+r.mesh.rotationAngleSign*r.halfSize.x*Math.sin(e))}else if(zt(s.type)){const e=Mt(s.limit[0],s.additionalParams.controlPointOnWall)>Mt(s.limit[1],s.additionalParams.controlPointOnWall)?s.limit[0]:s.limit[1],i=r.getItemCenter();r.mesh.rotationPivotPoint=new Y.Pa4(e.x*t.scaleFactor,i.y,e.y*t.scaleFactor);let o=[];o.push(s.additionalParams.arrowControlPoint),o.push(e),o.push({x:s.x,y:s.y}),o.push(s.additionalParams.arrowControlPoint),r.mesh.rotationAngleSign=Ct(o)?1:-1}r.mesh.status="closed",r.mesh.changeStateMethod=t.handleDoorWindowSwitchClick,r.mesh.entity&&t.handleDoorWindowSwitchClick(r.mesh,r.mesh.entity)}return r},this.removeFloorplanItem=e=>{e.remove(),this.userInteractionCurrentController.itemRemoved(e)},this.removeUnfixedItem=e=>{e.itemObject.remove()},this.createUnfixedItem=(e,t)=>{const i=new Aa(e,t,this,{fixed:!0,resizable:!1});return i.initObject(),i},this.cloneUnfixedBindedObject3D=e=>{const t=e.clone();return t.entity=e.entity,t.entity_id=e.entity_id,t.type=e.type,t.object2D=e.object2D,t.floorNumber=e.floorNumber,e.changeStateMethod&&(t.changeStateMethod=e.changeStateMethod),e.changeStateOnClick&&(t.changeStateOnClick=e.changeStateOnClick),"sensor"===e.type?(e.backgroundMesh&&(t.backgroundMesh=e.backgroundMesh.clone(),t.backgroundMesh.type=e.backgroundMesh.type,t.backgroundMesh.sensorMesh=t),e.roomMesh&&(t.roomMesh=e.roomMesh.clone(),t.roomMesh.type=e.roomMesh.type,t.roomMesh.sensorMesh=t)):"other"===e.type&&e.backgroundMesh&&(t.backgroundMesh=e.backgroundMesh.clone(),t.backgroundMesh.type=e.backgroundMesh.type,t.backgroundMesh.otherMesh=t),t},this.updateHAControlPanelState=()=>{this.HAControlPanelRef.current.setSensorValues(),this.HAControlPanelRef.current.setOthersValues(),this.HAControlPanelRef.current.setDoorsWindowsSwitches(),this.HAControlPanelRef.current.setLightsSwitches()},this.getHAEntityAdditionalParameters=e=>"sensor"===ti(e)?{floorplanViewArrayName:"floorplanViewSensors",currentViewArrayName:"currentViewSensors"}:"other"===ti(e)?{floorplanViewArrayName:"floorplanViewOthers",currentViewArrayName:"currentViewOthers"}:{},this.calculateCurrentDate=()=>new Date(this.floorplanStartDate.getTime()+((new Date).getTime()-this.floorplanStartDateSetTimestamp)),this.createFloorplanTimeMesh=(e,t)=>{const i=e.getObjectByName("floorplan_time");i&&(e.remove(i),this.disposeObject(i));const o=this.createTextMesh(t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0"),0,100,new Y.Pa4(this.floorplanCenterVector.x,0,this.floorplanCenterVector.z+.8*this.props.mainComponentThis.boxWallCoordinates.height*this.scaleFactor),1);o.rotation.x=-Math.PI/2,o.name="floorplan_time",e.add(o)},this.getMaxFloorNumber=()=>Math.max(...this.floorplanFloors.map((e=>e.floorNumber))),this.calculateFloorplanXZPlaneBBoxPoints=()=>{let e=[new Y.Pa4(this.props.mainComponentThis.boxWallCoordinates.minX,0,this.props.mainComponentThis.boxWallCoordinates.minY),new Y.Pa4(this.props.mainComponentThis.boxWallCoordinates.minX+this.props.mainComponentThis.boxWallCoordinates.width,0,this.props.mainComponentThis.boxWallCoordinates.minY),new Y.Pa4(this.props.mainComponentThis.boxWallCoordinates.minX,0,this.props.mainComponentThis.boxWallCoordinates.minY+this.props.mainComponentThis.boxWallCoordinates.height),new Y.Pa4(this.props.mainComponentThis.boxWallCoordinates.minX+this.props.mainComponentThis.boxWallCoordinates.width,0,this.props.mainComponentThis.boxWallCoordinates.minY+this.props.mainComponentThis.boxWallCoordinates.height)];return e.forEach((e=>e.multiplyScalar(this.scaleFactor))),e},this.calculateMaxXMaxZOffsetsFromCenterPoint=(e,t)=>{let i=-1/0,o=-1/0;for(let s=0;s<t.length-1;s++){let i=Math.abs(t[s].z-e.z);i>o&&(o=i)}for(let s=0;s<t.length-1;s++){let o=Math.abs(t[s].x-e.x);o>i&&(i=o)}return{maxXDist:i,maxZDist:o}},this.drawGlobalCoordinateSystem=function(e,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.Pa4(0,0,0);Na.log(o),t.drawLine([new Y.Pa4(0,0,0).add(o),new Y.Pa4(1,0,0).multiplyScalar(i).add(o)],e,16711680),t.drawLine([new Y.Pa4(0,0,0).add(o),new Y.Pa4(0,1,0).multiplyScalar(i).add(o)],e,65280),t.drawLine([new Y.Pa4(0,0,0).add(o),new Y.Pa4(0,0,1).multiplyScalar(i).add(o)],e,255)},this.drawLine=(e,t,i)=>{const o=new Y.nls({color:i||16711935}),s=(new Y.u9r).setFromPoints(e),n=new Y.x12(s,o);t.add(n)},this.changeCoordinateSystemBasisForPoints=(e,t,i,o)=>{const s=new Y.Vkp;s.set(t.x,i.x,o.x,t.y,i.y,o.y,t.z,i.z,o.z);let n=[];for(let a=0;a<e.length;a++)n.push(new Y.Pa4(s.elements[0]*e[a].x+s.elements[1]*e[a].y+s.elements[2]*e[a].z,s.elements[3]*e[a].x+s.elements[4]*e[a].y+s.elements[5]*e[a].z,s.elements[6]*e[a].x+s.elements[7]*e[a].y+s.elements[8]*e[a].z));return n},this.onSunLightPositionCoordinateSystemTransformReady=(e,t,i,o,s,n,a)=>r=>{r.cn2=r.cn2.clone().sub(e),r.cn3=r.cn3.clone().sub(e);const l=new Y.Pa4(r.cn2.x,r.cn2.y,r.cn2.z).normalize(),h=t.clone().normalize(),c=new Y.Pa4(r.cn3.x,r.cn3.y,r.cn3.z).normalize(),d=this.changeCoordinateSystemBasisForPoints(i,l,h,c),p=this.changeCoordinateSystemBasisForPoints(o,l,h,c),m=this.changeCoordinateSystemBasisForPoints([e],l,h,c)[0],{maxXDist:u,maxZDist:g}=this.calculateMaxXMaxZOffsetsFromCenterPoint(p[p.length-1],p),f=u,b=g;Na.log("leftRight",f),Na.log("topBottom",b);const x=-f,C=f,w=b,y=-b,S=Math.abs(Math.min(...d.map((e=>Math.abs(m.y-e.y))))),v=Math.abs(Math.max(...d.map((e=>Math.abs(m.y-e.y)))));Na.log("near",S),Na.log("far",v);const j=new Y.Ox3(16777215,.9);j.castShadow=!0,j.shadow.bias=-.002,j.shadow.mapSize.width=2048,j.shadow.mapSize.height=2048,j.target.position.set(a.x,a.y,a.z),j.position.set(e.x,e.y,e.z),j.shadow.camera.left=x,j.shadow.camera.right=C,j.shadow.camera.top=w,j.shadow.camera.bottom=y,j.shadow.camera.near=S,j.shadow.camera.far=v,j.name="sun_light";const D=s.getObjectByName("sun_light");s.add(j),s.add(j.target),D&&(Na.log("Sun light removed"),s.remove(D),this.disposeObject(D)),n.mainCameraHelper&&(n.mainCameraHelper.dispose(),s.remove(n.mainCameraHelper)),n.mainCameraHelper=new Fa(j.shadow.camera),this.textFont&&this.createFloorplanTimeMesh(s,this.calculateCurrentDate())},this.updateSunLightPosition=(e,t)=>{Na.log("updateSunLightPosition call"),Na.log("HAEntityObjects",this.HAEntityObjects);const i=this.calculateCurrentDate();if(this.textFont&&this.createFloorplanTimeMesh(e,i),e)return;const o=new Y.Pa4(this.floorplanCenterVector.x,0,this.floorplanCenterVector.z),s=this.floorplanEnvironmentRadius,n=wn().getPosition(i,this.props.mainComponentThis.getFloorplanGpsLatitude(this.props.mainComponentThis.floorplanGeneral),this.props.mainComponentThis.getFloorplanGpsLongitude(this.props.mainComponentThis.floorplanGeneral));if(this.skyMaterial.uniforms.sunAltitude.value=Math.max(n.altitude,0),this.skyMaterial.needsUpdate=!0,n.altitude<=0){const o=e.getObjectByName("sun_light");o&&(e.remove(o.target),this.disposeObject(o.target),e.remove(o),this.disposeObject(o)),t.auxiliaryCameraHelper&&(t.auxiliaryCameraHelper.dispose(),t.auxiliaryCameraHelper=null),t.mainCameraHelper&&(t.mainCameraHelper.dispose(),e.remove(t.mainCameraHelper),t.mainCameraHelper=null),this.textFont&&this.createFloorplanTimeMesh(e,i)}else{const i=this.props.mainComponentThis.floorplanGeneral.floorplan_bearing||0;n.azimuth=(n.azimuth+Math.PI-i*(Math.PI/180))%(2*Math.PI);const a=Math.sin(n.altitude)*s,r=Math.cos(n.altitude)*s,l=r*Math.cos(Math.PI/2-n.azimuth),h=-r*Math.sin(Math.PI/2-n.azimuth),c=new Y.xo$(20,32,15),d=new Y.vBJ({color:255}),p=new Y.vBJ({color:255});new Y.Kj0(c,d).position.set(l+this.floorplanCenterVector.x,0,h+this.floorplanCenterVector.z);const m=new Y.Kj0(c,p);m.position.set(l+this.floorplanCenterVector.x,a,h+this.floorplanCenterVector.z),this.floorplan3DViewScene.add(m);let u=e.getObjectByName("sun_light_helper");const g=new Y._fP;g.setFromEuler(e.rotation),u||(u=new Y.Ox3(16777215,0),u.castShadow=!0,u.target.position.set(o.x,o.y,o.z),u.target.position.sub(e.position),u.target.position.applyQuaternion(g.clone().invert()),u.name="sun_light_helper",e.add(u),e.add(u.target));const f=new Y.Pa4(l+this.floorplanCenterVector.x,a,h+this.floorplanCenterVector.z);u.position.set(f.x,f.y,f.z),u.position.sub(e.position),u.position.applyQuaternion(g.clone().invert()),u.shadow.camera=new Y.iKG;let b=this.calculateFloorplanXZPlaneBBoxPoints();for(let e=0;e<4;e++)b.push(b[e].clone().add(new Y.Pa4(0,(this.getMaxFloorNumber()+1)*this.wallHeight,0)));b.push(o);const x=f.clone().sub(o);let C=[];for(let e=0;e<b.length;e++){const t=b[e].clone().projectOnPlane(x.clone().normalize());C.push(t);new Y.Kj0(new Y.xo$(40,32,15),new Y.vBJ({color:16711935})).position.set(t.x,t.y,t.z)}t.auxiliaryCameraHelper&&t.auxiliaryCameraHelper.dispose(),t.auxiliaryCameraHelper=new Fa(u.shadow.camera,this.onSunLightPositionCoordinateSystemTransformReady(f,x,b,C,e,t,o))}},this.clearSunLightPositionInterval=(e,t)=>{e&&(clearInterval(e),t?this.sunLightPositionFloorplan3DOnMapInterval=null:this.sunLightPositionFloorplan3DViewInterval=null)},this.initializeSunLightPositionIntervalCalculation=(e,t,i)=>{this.updateSunLightPosition(t,i),e?this.sunLightPositionFloorplan3DOnMapInterval=setInterval((()=>this.updateSunLightPosition(t,i)),this.updateSunLightPositionIntervalDelayMs):this.sunLightPositionFloorplan3DViewInterval=setInterval((()=>this.updateSunLightPosition(t,i)),this.updateSunLightPositionIntervalDelayMs)},this.onHAConfigChange=e=>{const t=JSON.parse(JSON.stringify(this.HAConfigObject));if(this.HAConfigObject=e,e.time_zone!==t.time_zone&&(Na.log("HA time zone change"),this.floorplanStartDate=W(e.time_zone),this.floorplanStartDateSetTimestamp=(new Date).getTime(),this.showMapLayer3DInputRef.current.getCheckedStatus()?(this.clearSunLightPositionInterval(this.sunLightPositionFloorplan3DOnMapInterval,!0),this.initializeSunLightPositionIntervalCalculation(!0,this.floorplan3DOnMapScene,this.sunLightPositionFloorplan3DOnMapCameraHelpers),this.textFont&&this.createFloorplanTimeMesh(this.floorplan3DViewScene,this.floorplanStartDate)):(this.clearSunLightPositionInterval(this.sunLightPositionFloorplan3DViewInterval),this.initializeSunLightPositionIntervalCalculation(!1,this.floorplan3DViewScene,this.sunLightPositionFloorplan3DViewCameraHelpers))),!gt(t.unit_system,e.unit_system)){Na.log("HA unit system change");for(let e=0;e<this.HAEntityObjects.length;e++)"sensor"!==this.HAEntityObjects[e].class&&"other"!==this.HAEntityObjects[e].class||this.HAEntityObjects[e].update()}},this.onHAEntitiesChangeCallback=e=>{let t=[];for(let i=0;i<this.HAEntityObjects.length;i++){let o=e.find((e=>e.entity_id===this.HAEntityObjects[i].entity.entity_id));o?gt(this.HAEntityObjects[i].entity,o)||this.HAEntityObjects[i].update(o):t.push(i)}t.sort(((e,t)=>t-e));for(let i=0;i<t.length;i++)this.HAEntityObjects[t[i]].remove(),this.HAEntityObjects.splice(t[i],1);if(this.isInitialFloorplanDrawingFinished)for(let i=0;i<e.length;i++){const t=this.props.mainComponentThis.klet3DLastSavedData.find((t=>t.entity_id===e[i].entity_id));t&&!this.HAEntityObjects.find((t=>t.entity_id===e[i].entity_id))&&this.addHAEntityObject(t,e[i])}Na.log("HAEntityObjects",this.HAEntityObjects)},this.handleDoorWindowSwitchClick=(e,t)=>{let i;if("open"===e.status)if(t.state===this.getHAEntityUserSpecificedStateValue(t,"off"))i=!1;else{if(t.state===this.getHAEntityUserSpecificedStateValue(t,"on"))return;i=!1}else{if(t.state!==this.getHAEntityUserSpecificedStateValue(t,"on"))return t.state,void this.getHAEntityUserSpecificedStateValue(t,"off");i=!0}e.status=i?"open":"closed";const o=2e3;let s,n=i?-e.rotationAngleSign*Math.PI/2:e.rotationAngleSign*Math.PI/2,a=null,r=0,l=[];Ht(e.object2D.type)&&Ne[e.object2D.type]&&0!==Ne[e.object2D.type].length?(s=this.rotateChildAroundWorldPoint,Ne[e.object2D.type].forEach((t=>l.push(e.getObjectByName(t)))),n*=ze[e.object2D.type]*Math.sign(e.scale.x)):(s=this.rotateAroundPoint,l.push(e));const h=t=>{a||(a=t);const i=t-a;let c;if(i>=o)c=n;else{const e=i/o;c=0*(1-e)+e*n}l.forEach((t=>s(t,e.rotationPivotPoint,new Y.Pa4(0,1,0),c-r))),r=c,i<o&&requestAnimationFrame(h)};requestAnimationFrame(h)},this.createTextMesh=function(e,i,o,s,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;a="number"===typeof a?a:1;const r=new In.M(e,{font:t.textFont,size:o,height:n,curveSegments:5});r.computeBoundingBox();const l=[new Y.vBJ({color:i,transparent:a<1,opacity:a}),new Y.vBJ({color:i,transparent:a<1,opacity:a})],h=new Y.Kj0(r,l);return h.position.set(s.x,s.y,s.z),h},this.createTextBackgroundMesh=(e,t,i)=>{const o=(new Y.ZzF).setFromObject(new Y.Kj0(e.geometry)),s=Math.abs(o.max.x-o.min.x),n=Math.abs(o.max.y-o.min.y),a=new Y._12(s+10,n+10),r=new Y.xoR({transparent:!0,opacity:0,side:Y.Wl3,color:16777215}),l=new Y.Kj0(a,r);return l.position.x=t.x*this.scaleFactor+s/2,l.position.z=t.y*this.scaleFactor-n/2,l.rotation.set(-Math.PI/2,0,0),l.translateZ(i*this.wallHeight+this.HAEntityBindedObjectTextHeight/2),l.type="background_mesh",l},this.initializeSensorColorPaletteImageData=function(e,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.sensorValueDecimalPrecision;const s=i[0].value,n=i[i.length-1].value,a=document.createElement("canvas"),r=T((n-s)*Math.pow(10,o),0);a.width=r,a.height=1;const l=a.getContext("2d"),h=l.createLinearGradient(0,0,r,1);let c={0:i[0].color};for(let t=1;t<i.length-1;t++)c[(i[t].value-s)/(n-s)]=i[t].color;c["1.0"]=i[i.length-1].color,Na.log("sensorGradientColorStops",c);for(let t in c)h.addColorStop(t,c[t]);l.fillStyle=h,l.fillRect(0,0,r,1);return{entity_id:e.entity_id,paletteImageData:l.getImageData(0,0,r,1).data,paletteCanvasWidth:r}},this.calculateSensorRangeColoringColor=(e,t,i,o)=>{let s=[{value:i["".concat(o,"_range_min_value")],color:i["".concat(o,"_range_min_color")]}];s.push(...i["".concat(o,"_range_intermediate_colors")]),s.push({value:i["".concat(o,"_range_max_value")],color:i["".concat(o,"_range_max_color")]});for(let c=0;c<s.length;c++)if(N.isNumber(s[c].value))return Na.log("Invalid range color"),null;const n=s[0].value,a=s[s.length-1].value,r=Math.min(a,Math.max(n,t)),l=this.initializeSensorColorPaletteImageData(e,s),h=4*T((l.paletteCanvasWidth-1)*(r-n)/(a-n),0);return new Y.Ilk("rgb(".concat(l.paletteImageData[h],", ").concat(l.paletteImageData[h+1],", ").concat(l.paletteImageData[h+2],")"))},this.createSensorMesh=(e,t)=>{const i=this.props.mainComponentThis.klet3DLastSavedData.find((t=>t.entity_id===e.entity_id));if(!i)return null;const o={x:t.object2D.x,y:t.object2D.y},s="number"===i.params.sensor_type&&!N.isNumber(e.state),n=s?T(parseFloat(e.state),this.sensorValueDecimalPrecision):e.state;Na.log("Entity parameters",i);const a=i.params.background,r=i.params.text;let l,h;if(a.checked){let t;if(t=It(o,this.props.mainComponentThis.ROOM))if(t=this.floorplan3DViewScene.getObjectByProperty("roomID",t.id),t){let o;if(Na.log("Background parameters",a),"fixed"===a.background_coloring_type?o=new Y.Ilk(a.background_fixed_color):"range"===a.background_coloring_type&&"number"===i.params.sensor_type&&s&&(o=this.calculateSensorRangeColoringColor(e,n,a,"background")),o){const e="number"===typeof a.background_opacity?a.background_opacity:1;h=new Y.Kj0(t.geometry.clone(),new Y.xoR({color:o,flatShading:!0,side:t.material.side,transparent:e<1,opacity:e})),h.type="room_mesh",h.rotation.set(Math.PI/2,0,0),h.translateZ(-this.HAEntityBindedObjectTextHeight/2)}}else Na.log("Ne postoji soba na sceni");else Na.log("Ne postoji soba")}if(r.checked){let h;Na.log("Text parameters",r),"fixed"===r.text_coloring_type?h=new Y.Ilk(r.text_fixed_color):"range"===r.text_coloring_type&&"number"===i.params.sensor_type&&s&&"range"!==a.background_coloring_type&&(h=this.calculateSensorRangeColoringColor(e,n,r,"text")),h&&(Na.log("textColor",h),l=this.createTextMesh(""+n+this.getSensorUnitOfMeasurement(e),h,r.text_font_size,new Y.Pa4(o.x,0,o.y).multiplyScalar(this.scaleFactor),this.HAEntityBindedObjectTextHeight,r.text_opacity),l.textColor=h,l.backgroundMesh=this.createTextBackgroundMesh(l,o,t.floorNumber),l.backgroundMesh.sensorMesh=l)}return l||h?(l?h&&(l.roomMesh=h,h.sensorMesh=l):(l=new Y.Kj0,l.roomMesh=h,h.sensorMesh=l),l.rotation.set(-Math.PI/2,0,0),l.translateZ(t.floorNumber*this.wallHeight),l.name=e.entity_id,l.entity=e,l.entity_id=e.entity_id,l.type="sensor",l.object2D=t.object2D,l.floorNumber=t.floorNumber,Na.log("Created sensorTextMesh",l),l):null},this.createOtherMesh=(e,t)=>{let i=this.props.mainComponentThis.klet3DLastSavedData.find((t=>t.entity_id===e.entity_id));if(!i)return null;const o={x:t.object2D.x,y:t.object2D.y};i=i.params;const s=new Y.Ilk(i.color),n=this.createTextMesh(e.state,s,i.font_size,new Y.Pa4(o.x,0,o.y).multiplyScalar(this.scaleFactor),this.HAEntityBindedObjectTextHeight,i.opacity);return n.textColor=s,n.backgroundMesh=this.createTextBackgroundMesh(n,o,t.floorNumber),n.backgroundMesh.otherMesh=n,n.rotation.set(-Math.PI/2,0,0),n.translateZ(t.floorNumber*this.wallHeight),n.name=e.entity_id,n.entity=e,n.entity_id=e.entity_id,n.type="other",n.object2D=t.object2D,n.floorNumber=t.floorNumber,n},this.drawFloorplanSensors=e=>{this.currentViewSensors=[];for(let t=0;t<this.floorplanFloors.length;t++)this.drawFloorBindedUnfixedObjects(e,this.floorplanFloors[t].objData.filter((e=>"sensor"===e.type)),this.floorplanFloors[t].floorNumber,this.currentViewSensors)},this.drawFloorplanOthers=e=>{this.currentViewOthers=[];for(let t=0;t<this.floorplanFloors.length;t++)this.drawFloorBindedUnfixedObjects(e,this.floorplanFloors[t].objData.filter((e=>"other_entity"===e.type)),this.floorplanFloors[t].floorNumber,this.currentViewOthers)},this.drawFloorBindedUnfixedObjects=(e,t,i,o)=>{for(let s=0;s<t.length;s++){let n=this.props.mainComponentThis.klet3DLastSavedData.find((e=>e.objID.includes(t[s].id)));if(n){const a=this.props.mainComponentThis.homeAssistantEntities.find((e=>e.entity_id===n.entity_id));if(a){let r=this.HAEntityObjects.find((e=>e.entity_id===n.entity_id));if(r){let n=r.bindedObjects.find((e=>e.object2D.id===t[s].id));if(n){const i=e.getObjectsByProperty("entity_id",r.entity_id);let a=!1;for(let e=0;e<i.length;e++)if(i[e].object2D.id===t[s].id){a=!0;break}if(!a){const t=this.cloneUnfixedBindedObject3D(n),i=this.createUnfixedItem(e,t);o.push(i)}}else{const n=r.bindedObjects.length;if(r.addBindedObject(ii(a,{object2D:t[s],floorNumber:i}),!1),r.bindedObjects[n]){const t=this.createUnfixedItem(e,r.bindedObjects[n]);o.push(t)}}}else{const n=new Da(this,a,[ii(a,{object2D:t[s],floorNumber:i})]);if(this.HAEntityObjects.push(n),n.create(a,!1),n.bindedObjects[0]){const t=this.createUnfixedItem(e,n.bindedObjects[0]);o.push(t)}}}}}},this.turnWaitingLightOn=e=>{this.addShadowCastLightToList({lightMeshObject:this.shadowCastingLightsWaitingList[e].lightMeshObject,isMapScene:this.shadowCastingLightsWaitingList[e].isMapScene},this.shadowCastingLightsActive),this.setLightStateParameters(this.shadowCastingLightsWaitingList[e].lightMeshObject,this.shadowCastingLightsWaitingList[e].lightMeshObject.entity,!0,!1),this.shadowCastingLightsWaitingList.splice(e,1)},this.getLightTurnOnState=(e,t)=>{const i=e.light;if(!this.props.mainComponentThis.klet3DLastSavedData.find((e=>e.entity_id===t.entity_id)))return!1;const o=this.props.mainComponentThis.homeAssistantEntities.find((e=>e.entity_id===t.entity_id));return!!o&&("on"===i.state?o.state!==this.getHAEntityUserSpecificedStateValue(o,"off")&&o.state===this.getHAEntityUserSpecificedStateValue(o,"on"):o.state===this.getHAEntityUserSpecificedStateValue(o,"on")||(o.state,this.getHAEntityUserSpecificedStateValue(o,"off"),!1))},this.setLightStateParameters=function(e,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;const a=e.light,r=null!==o?o:t.getLightTurnOnState(e,i),h=t.props.mainComponentThis.klet3DLastSavedData.find((e=>e.entity_id===i.entity_id)),c=Zt(a);a.color=h?new Y.Ilk(h.params.color):new Y.Ilk("#ffffff");if(a.state!==(r?"on":"off")){const e=()=>{a.castShadow=r,a.state=r?"on":"off",a.power=r&&h?h.params.power:0;const e=c===t.floorplan3DOnMapScene?t.floorplan3DOnMapRenderer:t.floorplan3DViewRenderer;e&&(e.shadowMap.needsUpdate=!0)};n?e():0===t.changedLightsShadowMaps.length?(t.changeLightShadowMapsLoadingSet=null,t.changedLightsShadowMaps.push({lightObject:a,isMapLight:c===t.floorplan3DOnMapScene,onLoadingRenderedCallback:e}),s.render((0,l.jsx)(fn,{}),t.props.mainComponentThis.loadingComponentContainer.current,(()=>{setTimeout((()=>{t.changeLightShadowMapsLoadingSet=!0,t.changedLightsShadowMaps.forEach((e=>{e.onLoadingRenderedCallback&&(e.onLoadingRenderedCallback(),delete e.onLoadingRenderedCallback)}))}),100)}))):null===t.changeLightShadowMapsLoadingSet?t.changedLightsShadowMaps.push({lightObject:a,isMapLight:c===t.floorplan3DOnMapScene,onLoadingRenderedCallback:e}):(t.changedLightsShadowMaps.push({lightObject:a,isMapLight:c===t.floorplan3DOnMapScene}),e())}else a.power=r&&h?h.params.power:0},this.addShadowCastLightToList=(e,t)=>{!t.find((t=>t.lightMeshObject===e.lightMeshObject))&&t.push(e)},this.handleLightSwitchClick=function(e,i){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Na.log("handleLightSwitchClick entity",i),t.shadowCastingLightsWaitingList=t.shadowCastingLightsWaitingList.filter((e=>t.getLightTurnOnState(e.lightMeshObject,i)));const s=t.getLightTurnOnState(e,i),n=Zt(e)===t.floorplan3DOnMapScene,a=t.shadowCastingLightsActive.findIndex((t=>t.lightMeshObject===e));if(t.shadowCastingLightsActive.length<t.maxShadowCastingLightsCount){let r;s?-1===a&&(t.showMapLayer3DInputRef.current.getCheckedStatus()&&n||!t.showMapLayer3DInputRef.current.getCheckedStatus()&&!n?(r=!0,t.addShadowCastLightToList({lightMeshObject:e,isMapScene:n},t.shadowCastingLightsActive)):(r=!1,t.addShadowCastLightToList({lightMeshObject:e,isMapScene:n},t.shadowCastingLightsWaitingList))):(r=!1,-1!==a&&t.shadowCastingLightsActive.splice(a,1)),t.setLightStateParameters(e,i,r,o)}else if(s)t.addShadowCastLightToList({lightMeshObject:e,isMapScene:n},t.shadowCastingLightsWaitingList),t.setLightStateParameters(e,i,!1,o);else if(t.setLightStateParameters(e,i,!1,o),-1!==a&&(t.showMapLayer3DInputRef.current.getCheckedStatus()&&n||!t.showMapLayer3DInputRef.current.getCheckedStatus()&&!n)){let e=t.shadowCastingLightsWaitingList.findIndex((e=>e.isMapScene===t.shadowCastingLightsActive[a].isMapScene));t.shadowCastingLightsActive.splice(a,1),-1!==e&&t.turnWaitingLightOn(e)}Na.log("Active",t.shadowCastingLightsActive),Na.log("Waiting",t.shadowCastingLightsWaitingList)},this.onExportPngClick=()=>{const e=this.showMapLayer3DInputRef.current.getCheckedStatus()?this._map.getCanvas():this.canvasRef.current,t=e.toDataURL("image/png");let i=document.createElement("canvas");i.width=e.width*this.exportPngResolutionScale,i.height=e.height*this.exportPngResolutionScale;let o=i.getContext("2d");o.scale(this.exportPngResolutionScale,this.exportPngResolutionScale);let s=new Image;s.onload=()=>{o.drawImage(s,0,0);let t=new Image;t.onload=()=>{o.drawImage(t,e.width-176,e.height-50,166,40);const s=i.toDataURL("image/png"),n=document.createElement("a");n.download="GLAMOS_3DFloorplan_".concat((new Date).getDate().toString().padStart(2,"0"),"_").concat(((new Date).getMonth()+1).toString().padStart(2,"0"),"_").concat((new Date).getFullYear()),n.href=s,n.click()},t.src=a},s.src=t},this.hidePanel=()=>{this.panel.current.style.transform="translateX(0px)",this.cameraControlsRef.current.containerRef.current.style.transform="translateX(0px)",this.panelControl.current.style.transform="translateX(0px)"},this.onPanelControlClick=()=>{this.state.isPanelShowed?this.hidePanel():(this.panel.current.style.transform="translateX(".concat(this.panelWidth,"px)"),this.cameraControlsRef.current.containerRef.current.style.transform="translateX(".concat(this.panelWidth,"px)"),this.panelControl.current.style.transform="translateX(".concat(this.panelWidth,"px)")),this.setState({isPanelShowed:!this.state.isPanelShowed})},this.setFloorplanItemShadow=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.traverse((e=>{e.isMesh&&(e.castShadow=!t,e.receiveShadow=!0)}))},this.rotateAroundPoint=(e,t,i,o)=>{e.position.sub(t),e.position.applyAxisAngle(i,o),e.position.add(t),e.rotateOnAxis(i,o)},this.rotateChildAroundWorldPoint=(e,t,i,o)=>{const s=t.clone();if(this.showMapLayer3DInputRef.current.getCheckedStatus()){const e=t.clone();this.processSceneVec3(e),s.sub(e.sub(t))}e.parent.worldToLocal(s);const n=e.position.clone().sub(s);n.applyAxisAngle(i.normalize(),o),e.position.copy(n).add(s),e.rotateOnAxis(i.normalize(),o)},this.translateObjectInWorld=(e,t,i,o)=>{const s=new Y.Pa4(t,i,o),n=new Y.Pa4;e.getWorldPosition(n),n.add(s),e.position.set(n.x,n.y,n.z)},this.createMeshFromObject=(e,t)=>{let i=[],o=[];for(let a=0;a<e.children.length;a++){let t=e.children[a];"Mesh"===t.type&&(t.material.length?i=i.concat(t.material):i.push(t.material),t.geometry.isBufferGeometry&&o.push(t.geometry))}let s=new Y.u9r;s=_n.qf([...o],!0),s.computeVertexNormals(),s.computeBoundingBox(),s.normalizeNormals();const n=new Y.Kj0(s,i);t.add(n)},this.onCameraMoved=()=>{this.updateWallsVisibility()},this.updateWallsVisibility=()=>{for(let e=0;e<this.currentWalls3D.length;e++)this.currentWalls3D[e].updateFrontWallVisibility()},this.onInitialFloorplanDrawingFinishedCallback=()=>{this.floorplanViewWalls3D=[...this.currentWalls3D],this.floorplanViewRoomFloors=[...this.currentRoomFloors],this.floorplanViewFurniture=[...this.currentFurniture],this.floorplanViewLights=[...this.currentViewLights],this.floorplanViewSensors=[...this.currentViewSensors],this.floorplanViewOthers=[...this.currentViewOthers],this.updateHAControlPanelState(),s.unmountComponentAtNode(this.props.mainComponentThis.loadingComponentContainer.current),requestAnimationFrame((()=>{this.state.isPanelShowed&&(this.props.mainComponentThis.taille_w>=this.props.mainComponentThis.smallScreenPixelSize?(this.panel.current.style.transform="translateX(".concat(this.panelWidth,"px)"),this.cameraControlsRef.current.containerRef.current.style.transform="translateX(".concat(this.panelWidth,"px)"),this.panelControl.current.style.transform="translateX(".concat(this.panelWidth,"px)")):this.onPanelControlClick())})),this.maxShadowCastingLightsAlert.current.showAlert((0,l.jsxs)("span",{children:["To ensure optimal performance, add-on currently allows a maximum of ",(0,l.jsx)("b",{children:this.maxShadowCastingLightsCount})," ","lights to be turned on simultaneously"]}),"warning"),Na.log("Active",this.shadowCastingLightsActive),Na.log("Waiting",this.shadowCastingLightsWaitingList),this.isInitialFloorplanDrawingFinished=!0},this.isInitialLoadingFinished=()=>{if(!this.showMapLayer3DInputRef.current.getCheckedStatus()){Na.log(JSON.stringify(this.loadingCallbacksStatuses));for(let e=0;e<this.loadingCallbacksStatuses.length;e++)if(!this.loadingCallbacksStatuses[e])return;this.onInitialFloorplanDrawingFinishedCallback()}},this.floorplan3DViewAnimate=()=>{this.mounted&&(setTimeout((()=>{requestAnimationFrame(this.floorplan3DViewAnimate)}),this.timeIntervalBetweenFrames),!this.showMapLayer3DInputRef.current.getCheckedStatus()&&this.currentControls.enabled&&this.currentControls===this.firstPersonControls&&this.currentControls.animate(),this.floorplan3DViewRenderer.clear(),this.floorplan3DViewRenderer.render(this.floorplan3DViewScene,this.floorplan3DViewCamera),this.changedLightsShadowMaps.length>0&&this.isLightsShadowMapChangeFinished(!1))},this.onWindowResize=()=>{Na.log("Canvas resize");let e=this.props.mainComponentThis.floorplan3DContainerRef.current.getBoundingClientRect();new Array(this.orbitControlsCamera,this.firstPersonControlsCamera).forEach((t=>{t.aspect=e.width/e.height,t.updateProjectionMatrix()})),this.floorplan3DViewRenderer.setSize(e.width,e.height),this.showMapLayer3DInputRef.current.getCheckedStatus()&&(this.floorplan3DOnMapCamera.aspect=e.width/e.height,this.floorplan3DOnMapCamera.updateProjectionMatrix(),this.floorplan3DOnMapRenderer.setSize(e.width,e.height))},this.calculateAngleBetween2DVectors=(e,t,i,o)=>-Math.atan2(e*o-t*i,e*i+t*o),this.calculateShapeGeometryUVMappings=(e,t)=>{let i,o=e.getAttribute("uv"),s=e.getAttribute("position"),n=new Y.Pa4;for(let a=0;a<o.count;a++)n.fromBufferAttribute(s,a),i=t(n),o.setXY(a,i.x,i.y);o.needsUpdate=!0},this.createAmbientLight=e=>{const t=new Y.Mig(4210752,2);e.add(t)},this.createFloorplanEnvironment=e=>{const t=this.calculateControlsMaxDistance();this.orbitControls.maxDistance=t,this.firstPersonControls.maxDistance=t;const i=wn().getPosition(this.floorplanStartDate,this.props.mainComponentThis.getFloorplanGpsLatitude(this.props.mainComponentThis.floorplanGeneral),this.props.mainComponentThis.getFloorplanGpsLongitude(this.props.mainComponentThis.floorplanGeneral)),o={topColorDay:{value:new Y.Ilk(.6,.8,1)},bottomColorDay:{value:new Y.Ilk(.8,.9,1)},topColorNight:{value:new Y.Ilk(0,.05,.2)},bottomColorNight:{value:new Y.Ilk(0,0,.05)},offset:{value:33},exponent:{value:.6},sunAltitude:{value:Math.max(i.altitude,0)}},s=new Y.xo$(this.floorplanEnvironmentRadius,this.environmentCircleSegmentsCount,15);this.skyMaterial=new Y.jyz({uniforms:o,vertexShader:"\n    varying vec3 vWorldPosition;\n\n    void main() {\n\n      vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n      vWorldPosition = worldPosition.xyz;\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }",fragmentShader:"uniform vec3 topColorDay;\n        uniform vec3 bottomColorDay;\n        uniform vec3 topColorNight;\n        uniform vec3 bottomColorNight;\n        uniform float sunAltitude;\n        \n        varying vec3 vWorldPosition;\n\n        // Function to adjust exposure\n        vec3 applyExposure(vec3 color, float exposure) {\n          return 1.0 - exp(-color * exposure);\n        }\n        \n        void main() {\n          float dayNightFactor = smoothstep(0.2, 1.0, 0.5 + 0.5 * cos(sunAltitude));\n        \n          vec3 topColor = mix(topColorDay, topColorNight, dayNightFactor);\n          vec3 bottomColor = mix(bottomColorDay, bottomColorNight, dayNightFactor);\n\n          // Adjust the intensity using exposure control\n          float exposure = 15.0;  // Adjust this value for desired brightness\n          topColor = applyExposure(topColor, exposure);\n          bottomColor = applyExposure(bottomColor, exposure);\n      \n          float h = normalize(vWorldPosition).y;\n          gl_FragColor = vec4(mix(bottomColor, topColor, h), 1.0);\n        }",side:Y._Li});const n=new Y.Kj0(s,this.skyMaterial);n.translateX(this.floorplanCenterVector.x),n.translateZ(this.floorplanCenterVector.z),e.add(n);const a=new Y.zf8(this.floorplanEnvironmentRadius,this.environmentCircleSegmentsCount),r=new Y.YBo({color:16777215});r.color.setHex(9127187);const l=new Y.Kj0(a,r);l.rotation.x=-Math.PI/2,l.receiveShadow=!0,l.translateX(this.floorplanCenterVector.x),l.translateY(-this.floorplanCenterVector.z),l.translateZ(-5),e.add(l)},this.centerOrbitControlsCamera=()=>{this.orbitControlsCamera.position.copy(new Y.Pa4(this.floorplanCenterVector.x,this.YZDistanceFromFloorplanCenter.offsetY,this.floorplanCenterVector.z+this.YZDistanceFromFloorplanCenter.offsetZ))},this.calculateYZDistanceFromFloorplanCenter=()=>{const e=P(45),t=this.calculateControlsMaxDistance();this.YZDistanceFromFloorplanCenter.offsetY=(t-1)*Math.sin(e),this.YZDistanceFromFloorplanCenter.offsetZ=(t-1)*Math.cos(e)},this.calculateFloorplanEnvironmentRadius=()=>{let e=this.calculateFloorplanXZPlaneBBoxPoints();const{maxXDist:t,maxZDist:i}=this.calculateMaxXMaxZOffsetsFromCenterPoint(this.floorplanCenterVector,e);this.floorplanEnvironmentRadius=4*Math.max(t,i)},this.calculateControlsMaxDistance=()=>Math.cos(360/this.environmentCircleSegmentsCount/2*(Math.PI/180))*this.floorplanEnvironmentRadius,this.centerFirstPersonControlsCamera=()=>{this.firstPersonControlsCamera.position.set(this.floorplanCenterVector.x,this.wallHeight/2,this.floorplanCenterVector.z),this.firstPersonControlsCamera.lookAt(this.firstPersonControlsCamera.position.x-1,this.firstPersonControlsCamera.position.y,this.firstPersonControlsCamera.position.z)},this.adjustCameraYPosition=e=>{e.position.set(e.position.x,this.cameraYOffset+this.YZDistanceFromFloorplanCenter.offsetY+0*this.wallHeight,e.position.z),this.orbitControls.update()},this.drawFloorplanFreeLights=e=>{this.currentViewLights=[];for(let t=0;t<this.floorplanFloors.length;t++)this.drawFloorFreeLights(e,this.floorplanFloors[t].objData.filter((e=>"lights"===e.class&&"onWall"!==e.family&&"inWall"!==e.family)),this.floorplanFloors[t].floorNumber,this.currentViewLights)},this.drawFloorFreeLights=(e,t,i,o)=>{for(let s=0;s<t.length;s++){const n=this.createFloorplanItem(e,this.lightObjects3D,t[s].type,t[s],i,!1);o.push(n)}},this.drawFloorFreeFurniture=(e,t,i,o)=>{for(let s=0;s<t.length;s++){const n=this.createFloorplanItem(e,this.furnitureObjects3D,t[s].type,t[s],i,!1);o.push(n)}},this.loadFloorplanItemObject3D=(e,t,i,o)=>{let s=this.loadingCallbacksStatuses.length;this.loadingCallbacksStatuses.push(!1);let n=t.length;t.push(!1);let a=new jn.v,r=new vn.L;a.load("https://app.klet3d.com/models3D/objMtl/models/".concat(Yt(e.floorplanItemType),"/").concat(e.floorplanItemType,"/").concat(e.floorplanItemType,".mtl"),(l=>{this.loadingCallbacksStatuses[s]=!0,t[n]=!0,l.preload(),r.setMaterials(l),s=this.loadingCallbacksStatuses.length,this.loadingCallbacksStatuses.push(!1),n=t.length,t.push(!1),r.load("https://app.klet3d.com/models3D/objMtl/models/".concat(Yt(e.floorplanItemType),"/").concat(e.floorplanItemType,"/").concat(e.floorplanItemType,".obj"),(l=>{this.loadingCallbacksStatuses[s]=!0,t[n]=!0,this.setFloorplanItemShadow(l,Gt(e.floorplanItemType));const h=(new Y.ZzF).setFromObject(l),c=new Y.Pa4;h.getSize(c),e.object=l,e.sizeVector=c,a=null,r=null,Rt(t)&&o(),i&&this.isInitialLoadingFinished()}))}))},this.createTextureMaterial=(e,t,i)=>{const o=e.clone();if(i&&i.scaleValue){let e=i.width/i.scaleValue,t=i.height/i.scaleValue;e>1?o.wrapS=Y.rpg:e=1,t>1?o.wrapT=Y.rpg:t=1,o.repeat.set(e,t),o.offset.set(0,0)}return new Y.xoR({color:16777215,side:t,map:o})},this.loadTexture=(e,t,i,o)=>{let s=this.loadingCallbacksStatuses.length;this.loadingCallbacksStatuses.push(!1);let n=t.length;t.push(!1),this.textureLoader.load(i(e),(i=>{this.loadingCallbacksStatuses[s]=!0,t[n]=!0,e.textureData=i,Rt(t)&&o(),this.isInitialLoadingFinished()}),null,(e=>Na.error("Texture loading error",e)))},this.drawFloorplan=e=>{for(let r=0;r<this.floorplanFloors.length;r++){for(let e=0;e<this.floorplanFloors[r].wallData.length;e++){[this.floorplanFloors[r].wallData[e].interiorPlaneMaterial,this.floorplanFloors[r].wallData[e].exteriorPlaneMaterial].forEach((e=>{"Glass"!==e&&"Unknown"!==e&&N.isHexColor(e)&&!this.floorplanWallMaterials.find((t=>t.name===e))&&this.floorplanWallMaterials.push({name:e,textureData:null})}))}for(let e=0;e<this.floorplanFloors[r].roomData.length;e++)"none"===this.floorplanFloors[r].roomData[e].floorTexture||this.roomFloorTextures.find((t=>t.name===this.floorplanFloors[r].roomData[e].floorTexture))||this.roomFloorTextures.push({name:this.floorplanFloors[r].roomData[e].floorTexture,textureData:null});[{floorItems:this.floorplanFloors[r].objData.filter((e=>!("doorWindow"!==e.class||!Ht(e.type)))),itemsArrayName:"doorObjects3D"},{floorItems:this.floorplanFloors[r].objData.filter((e=>!("doorWindow"!==e.class||!zt(e.type)))),itemsArrayName:"windowObjects3D"},{floorItems:this.floorplanFloors[r].objData.filter((e=>"lights"===e.class)),itemsArrayName:"lightObjects3D"},{floorItems:this.floorplanFloors[r].objData.filter((e=>"furniture"===e.class)),itemsArrayName:"furnitureObjects3D"}].forEach((e=>{for(let t=0;t<e.floorItems.length;t++)this[e.itemsArrayName].find((i=>i.floorplanItemType===e.floorItems[t].type))||this[e.itemsArrayName].push({object2D:e.floorItems[t],floorplanItemType:e.floorItems[t].type,object:null,sizeVector:null})}))}const t=this.floorplanWallMaterials.find((e=>!e.textureData)),i=this.roomFloorTextures.find((e=>!e.textureData)),o=[...this.doorObjects3D,...this.windowObjects3D,...this.lightObjects3D,...this.furnitureObjects3D].filter((e=>("onWall"===e.object2D.family||"inWall"===e.object2D.family)&&null===e.object)),s=this.lightObjects3D.filter((e=>"onWall"!==e.object2D.family&&"inWall"!==e.object2D.family&&"lightSource"!==e.floorplanItemType&&null===e.object)),n=this.furnitureObjects3D.filter((e=>"onWall"!==e.object2D.family&&"inWall"!==e.object2D.family&&null===e.object)),a=!this.textFont;if(t&&this.floorplanWallMaterials.forEach((t=>this.loadTexture(t,this.loadingWallMaterialsStatuses,(()=>"https://app.klet3d.com/wallMaterials/".concat(t.name,".png")),(()=>{this.drawFloorplanFloorsWalls(e),this.floorplanViewWalls3D=[...this.currentWalls3D],Rt(this.loadingWallObjectsStatuses)&&this.drawFloorplanFloorsWallObjects(e)})))),o.length>0&&o.forEach((t=>this.loadFloorplanItemObject3D(t,this.loadingWallObjectsStatuses,!0,(()=>{Rt(this.loadingWallMaterialsStatuses)&&this.drawFloorplanFloorsWallObjects(e)})))),i?this.roomFloorTextures.forEach((t=>this.loadTexture(t,this.loadingRoomFloorTexturesStatuses,(()=>"https://app.klet3d.com/textures/".concat(t.name,".png")),(()=>this.drawFloorplanRoomFloors(e))))):this.drawFloorplanRoomFloors(e),s.length>0?s.forEach((t=>this.loadFloorplanItemObject3D(t,this.loadingFreeLightObjectsStatuses,!0,(()=>this.drawFloorplanFreeLights(e))))):this.drawFloorplanFreeLights(e),n.length>0?n.forEach((t=>this.loadFloorplanItemObject3D(t,this.loadingFreeFurnitureObjectsStatuses,!0,(()=>this.drawFloorplanFreeFurniture(e))))):this.drawFloorplanFreeFurniture(e),a){let t=this.loadingCallbacksStatuses.length;this.loadingCallbacksStatuses.push(!1),this.fontLoader.load("https://cdn.jsdelivr.net/gh/mrdoob/three.js@master/examples/fonts/droid/droid_sans_regular.typeface.json",(i=>{this.textFont=i,this.loadingCallbacksStatuses[t]=!0,this.isInitialLoadingFinished(),this.drawFloorplanSensors(e),this.drawFloorplanOthers(e),this.createFloorplanTimeMesh(e,this.calculateCurrentDate())}))}else this.drawFloorplanSensors(e),this.drawFloorplanOthers(e);t||(this.drawFloorplanFloorsWalls(e),this.floorplanViewWalls3D=[...this.currentWalls3D]),o.length||this.drawFloorplanFloorsWallObjects(e),this.isInitialLoadingFinished()},this.drawFloorplanFloorsWalls=e=>{this.currentWalls3D=[];for(let t=0;t<this.floorplanFloors.length;t++)this.drawFloorWalls(e,this.floorplanFloors[t].wallData,this.floorplanFloors[t].floorNumber,this.currentWalls3D)},this.drawFloorplanFreeFurniture=e=>{this.currentFurniture=[];for(let t=0;t<this.floorplanFloors.length;t++)this.drawFloorFreeFurniture(e,this.floorplanFloors[t].objData.filter((e=>"furniture"===e.class&&"onWall"!==e.family&&"inWall"!==e.family)),this.floorplanFloors[t].floorNumber,this.currentFurniture)},this.drawFloorplanFloorsWallObjects=()=>{for(let e=0;e<this.currentWalls3D.length;e++)this.currentWalls3D[e].drawWallObjects()},this.drawFloorWalls=function(e,i,o,s){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(let a=0;a<i.length;a++){let r=new Yn(t,e,i[a],t.props.mainComponentThis.editor.objFromWall(i[a]),o);r.wall3D?(n&&r.drawWallObjects(),s.push(r)):r=null}100!==t.wallsOpacityRef.current.getWallsOpacityValue()&&t.changeWallMaterialOpacity(s,t.wallsOpacityRef.current.getWallsOpacityValue()),!t.wallsVisibilityOptionsRef.current.getShowWallSwitchState()&&t.wallsVisibilityOptionsRef.current.hideFloorplanWalls(s),t.wallsVisibilityOptionsRef.current.getFrontWallsSwitchState()&&t.wallsVisibilityOptionsRef.current.showFrontFloorplanWalls(s)},this.drawFloorplanRoomFloors=e=>{this.currentRoomFloors=[];for(let t=0;t<this.floorplanFloors.length;t++)this.drawFloorRoomFloors(e,this.floorplanFloors[t],this.currentRoomFloors)},this.drawFloorRoomFloors=(e,t,i)=>{const o=[{name:"Room floor",translateZ:-t.floorNumber*this.wallHeight,castShadow:!1,receiveShadow:!0,floorNumber:t.floorNumber}];for(let s=0;s<t.roomData.length;s++){let n=[];for(let e=0;e<t.roomData[s].coordsOutsideWithOrphans.length;e++)n.push(new Y.FM8(t.roomData[s].coordsOutsideWithOrphans[e].x,t.roomData[s].coordsOutsideWithOrphans[e].y).multiplyScalar(this.scaleFactor));let a,r=new Y.bnF(n),l=new Y.oa8(r);for(let h=0;h<o.length;h++){if(o[h].material)a=o[h].material;else if("none"!==t.roomData[s].floorTexture){const e=Nt(n),i=t=>{const i=(t.x-e.minX)/e.width,o=(e.maxY-t.y)/e.height;return new Y.FM8(Math.min(1,Math.max(0,i)),Math.min(1,Math.max(0,o)))};this.calculateShapeGeometryUVMappings(l,i),a=this.createTextureMaterial(this.roomFloorTextures.find((e=>e.name===t.roomData[s].floorTexture)).textureData,Y._Li,{width:e.width,height:e.height,scaleValue:512})}else a=new Y.xoR({side:Y._Li,color:15658734});const r=new Y.Kj0(l,a);r.rotation.set(Math.PI/2,0,0),r.translateZ(o[h].translateZ),i.push(r),r.receiveShadow=o[h].receiveShadow,r.castShadow=o[h].castShadow,r.name=o[h].name,r.floorNumber=o[h].floorNumber,"Room roof"!==o[h].name&&(r.roomID=t.roomData[s].id),e.add(r)}}},this.removeFloorplanFloor=e=>{this.removeFloorplanFloorItems(this.floorplan3DViewScene,e,"floorplanViewWalls3D","floorplanViewRoomFloors","floorplanViewFurniture","floorplanViewLights","floorplanViewSensors","floorplanViewOthers"),this.showMapLayer3DInputRef.current.getCheckedStatus()?this.removeFloorplanFloorItems(this.floorplan3DOnMapScene,e,"currentWalls3D","currentRoomFloors","currentFurniture","currentViewLights","currentViewSensors","currentViewOthers"):this.setCurrentFromFloorplanArrays(),this.updateHAControlPanelState()},this.removeFloorplanFloorItems=(e,t,i,o,s,n,a,r)=>{this[i]=this[i].filter((e=>{if(e.floorNumber===t){const t=[...e.inWallItemObjects,...e.onWallItemObjects];for(let e=0;e<t.length;e++)if(t[e].entity){let i=this.HAEntityObjects.find((i=>i.entity_id===t[e].entity.entity_id));i&&(i.bindedObjects=i.bindedObjects.filter((i=>i.object2D.id!==t[e].object2D.id)))}return e.removeWall(),!1}return!0}));let l=[t];t===this.getMaxFloorNumber()&&l.push(this.getMaxFloorNumber()+1),this[o]=this[o].filter((t=>!l.includes(t.floorNumber)||(e.remove(t),this.disposeObject(t),!1))),this[s]=this[s].filter((e=>e.floorNumber!==t||(this.removeFloorplanItem(e),!1))),this[n]=this[n].filter((e=>{if(e.floorNumber===t){if(e.entity){let t=this.HAEntityObjects.find((t=>t.entity_id===e.entity.entity_id));t&&(t.bindedObjects=t.bindedObjects.filter((t=>t.object2D.id!==e.object2D.id)))}return this.removeFloorplanItem(e),!1}return!0}));[a,r].forEach((e=>{this[e]=this[e].filter((e=>{const i=e.mesh;if(i.floorNumber===t){if(i.entity){let e=this.HAEntityObjects.find((e=>e.entity_id===i.entity.entity_id));e&&(e.bindedObjects=e.bindedObjects.filter((e=>e.object2D.id!==i.object2D.id)))}return this.removeUnfixedItem(i),!1}return!0}))}))},this.addFloorplanFloor=e=>{this.addFloorplanFloorItems(this.floorplan3DViewScene,e,this.floorplanViewWalls3D,this.floorplanViewRoomFloors,this.floorplanViewFurniture,this.floorplanViewLights,this.floorplanViewSensors,this.floorplanViewOthers),this.showMapLayer3DInputRef.current.getCheckedStatus()?this.addFloorplanFloorItems(this.floorplan3DOnMapScene,e,this.currentWalls3D,this.currentRoomFloors,this.currentFurniture,this.currentViewLights,this.currentViewSensors,this.currentViewOthers):this.setCurrentFromFloorplanArrays(),this.updateHAControlPanelState()},this.addFloorplanFloorItems=(e,t,i,o,s,n,a,r)=>{this.drawFloorWalls(e,t.wallData,t.floorNumber,i,!0),this.drawFloorFreeFurniture(e,t.objData.filter((e=>"furniture"===e.class&&"onWall"!==e.family&&"inWall"!==e.family)),t.floorNumber,s),this.drawFloorRoomFloors(e,t,o),this.drawFloorFreeLights(e,t.objData.filter((e=>"lights"===e.class&&"onWall"!==e.family&&"inWall"!==e.family)),t.floorNumber,n),this.drawFloorBindedUnfixedObjects(e,t.objData.filter((e=>"sensor"===e.type)),t.floorNumber,a),this.drawFloorBindedUnfixedObjects(e,t.objData.filter((e=>"other_entity"===e.type)),t.floorNumber,r)},this.setCurrentFromFloorplanArrays=()=>{this.currentWalls3D=[...this.floorplanViewWalls3D],this.currentRoomFloors=[...this.floorplanViewRoomFloors],this.currentFurniture=[...this.floorplanViewFurniture],this.currentViewLights=[...this.floorplanViewLights],this.currentViewSensors=[...this.floorplanViewSensors],this.currentViewOthers=[...this.floorplanViewOthers]},this.backTo2D=()=>{this.closeActiveRightBox(),window.removeEventListener("keydown",this.handleKeyDown3D),window.addEventListener("keydown",this.props.mainComponentThis.handleKeyDown,{capture:!0}),this.props.mainComponentThis.setShow3DStatus(!1)},this.changeWallMaterialOpacity=(e,t)=>{const i=t/100,o=100!==t;this.wallTopPlaneMaterial.opacity=i,this.wallTopPlaneMaterial.transparent=o,this.wallTopPlaneMaterial.needsUpdate=!0,this.wallStartEndPlanesMaterial.opacity=i,this.wallStartEndPlanesMaterial.transparent=o,this.wallStartEndPlanesMaterial.needsUpdate=!0,e.forEach((e=>e.setExteriorInteriorPlanesOpacity(i)))},this.focusFloorplanOnMap=()=>{const e=this.props.mainComponentThis.floorplanGeneral.floorplan_bearing||0;vt(this._map,St(this.props.mainComponentThis.getFloorplanGpsLatitude(this.props.mainComponentThis.floorplanGeneral),this.props.mainComponentThis.getFloorplanGpsLongitude(this.props.mainComponentThis.floorplanGeneral),this.props.mainComponentThis.boxWallCoordinates.width/this.props.mainComponentThis.meter,this.props.mainComponentThis.boxWallCoordinates.height/this.props.mainComponentThis.meter,e),e,20)},this.show3DFloorplanOnMap=function(e){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t._map=e,e.setMaxZoom(22);const o=[t.props.mainComponentThis.getFloorplanGpsLongitude(t.props.mainComponentThis.floorplanGeneral),t.props.mainComponentThis.getFloorplanGpsLatitude(t.props.mainComponentThis.floorplanGeneral)],s=t.props.mainComponentThis.floorplanGeneral.floorplan_bearing||0,n=[Math.PI/2,0,0],a=xn().MercatorCoordinate.fromLngLat(o,0),r={translateX:a.x,translateY:a.y,translateZ:a.z,rotateX:n[0],rotateY:n[1],rotateZ:n[2],scale:a.meterInMercatorCoordinateUnits()/(t.scaleFactor*t.props.mainComponentThis.meter)},l=t,h={id:"floorplan-3d-model",type:"custom",renderingMode:"3d",onAdd:function(e,t){this.showFloorplan3DOnMapCamera=new Y.cPb(45,l.canvasRef.current.offsetWidth/l.canvasRef.current.offsetHeight,1,5e4),l.floorplan3DOnMapCamera=this.showFloorplan3DOnMapCamera,l.floorplan3DOnMapCameraPosition=this.showFloorplan3DOnMapCamera.position.clone(),this.showFloorplan3DOnMapScene=new Y.xsS,l.floorplan3DOnMapScene=this.showFloorplan3DOnMapScene,this.map=e,this.showFloorplan3DOnMapRenderer=new Y.CP7({canvas:e.getCanvas(),context:t,antialias:!0,preserveDrawingBuffer:!0}),l.floorplan3DOnMapRenderer=this.showFloorplan3DOnMapRenderer,this.showFloorplan3DOnMapRenderer.setClearColor(16777215,1),this.showFloorplan3DOnMapRenderer.setPixelRatio(window.devicePixelRatio),this.showFloorplan3DOnMapRenderer.setSize(l.canvasRef.current.offsetWidth,l.canvasRef.current.offsetHeight),this.showFloorplan3DOnMapRenderer.autoClear=!1,this.showFloorplan3DOnMapRenderer.shadowMap.enabled=!0,this.showFloorplan3DOnMapRenderer.shadowMap.type=Y.ntZ,l.floorplanOnMapHUDObject=new Sa(this.showFloorplan3DOnMapScene),l.floorplanItemCurrentHUDObject=l.floorplanOnMapHUDObject,l.createAmbientLight(this.showFloorplan3DOnMapScene),l.drawFloorplan(this.showFloorplan3DOnMapScene),l.floorplanOnMapUserInteractionController=new ya(this.showFloorplan3DOnMapScene,this.map.getCanvas(),l),l.userInteractionCurrentController=l.floorplanOnMapUserInteractionController;const o=new Y.Pa4(l.props.mainComponentThis.boxWallCoordinates.minX,0,l.props.mainComponentThis.boxWallCoordinates.minY).multiplyScalar(l.scaleFactor);this.showFloorplan3DOnMapScene.translateX(-o.x),this.showFloorplan3DOnMapScene.translateZ(-o.z),l.rotateAroundPoint(this.showFloorplan3DOnMapScene,new Y.Pa4(0,0,0),new Y.Pa4(0,1,0),-s*(Math.PI/180)),document.dispatchEvent(new CustomEvent("sceneTransformed")),l.initializeSunLightPositionIntervalCalculation(!0,l.floorplan3DOnMapScene,l.sunLightPositionFloorplan3DOnMapCameraHelpers),i&&l.focusFloorplanOnMap()},render:function(e,t){if(!l.mounted)return;const i=(new Y.yGw).makeRotationAxis(new Y.Pa4(1,0,0),r.rotateX),o=(new Y.yGw).makeRotationAxis(new Y.Pa4(0,1,0),r.rotateY),s=(new Y.yGw).makeRotationAxis(new Y.Pa4(0,0,1),r.rotateZ),n=(new Y.yGw).fromArray(t),a=(new Y.yGw).makeTranslation(r.translateX,r.translateY,r.translateZ).scale(new Y.Pa4(r.scale,-r.scale,r.scale)).multiply(i).multiply(o).multiply(s);this.showFloorplan3DOnMapCamera.projectionMatrix=n.multiply(a);const h=(new Y.Pa4).applyMatrix4(this.showFloorplan3DOnMapCamera.projectionMatrix.clone().invert());h.equals(l.floorplan3DOnMapCameraPosition)||(l.floorplan3DOnMapCameraPosition.copy(h),l.onCameraMoved()),this.showFloorplan3DOnMapRenderer.resetState(),this.showFloorplan3DOnMapRenderer.render(this.showFloorplan3DOnMapScene,this.showFloorplan3DOnMapCamera),l.changedLightsShadowMaps.length>0&&l.isLightsShadowMapChangeFinished(!0),this.map.triggerRepaint()}};e.getStyle().layers.find((e=>"waterway-label"===e.id))?e.addLayer(h,"waterway-label"):e.addLayer(h)},this.onShowOnMapLayer3DClick=()=>{if(this.userInteractionCurrentController.removeItemBinder(),this.userInteractionCurrentController.setSelectedObject(null),this.showMapLayer3DInputRef.current.getCheckedStatus()){this.currentControls.enabled=!0,this.cameraControlsRef.current.setIsMapActiveState(!1),this.glamosLogoImgRef.current.setAttribute("src",va),this.clearSunLightPositionInterval(this.sunLightPositionFloorplan3DOnMapInterval,!0),this.disposeScene(this.floorplan3DOnMapScene,this.floorplan3DOnMapRenderer),this.shadowCastingLightsActive=this.shadowCastingLightsActive.filter((e=>!e.isMapScene)),this.shadowCastingLightsWaitingList=this.shadowCastingLightsWaitingList.filter((e=>!e.isMapScene));const t=this.maxShadowCastingLightsCount-this.shadowCastingLightsActive.length;if(t>0){var e=[];for(let i=this.shadowCastingLightsWaitingList.length-1;i>=0&&i>this.shadowCastingLightsWaitingList.length-1-t;i--)e.push(i);e.forEach((e=>this.turnWaitingLightOn(e)))}this.initializeSunLightPositionIntervalCalculation(!1,this.floorplan3DViewScene,this.sunLightPositionFloorplan3DViewCameraHelpers),this.mapLayer3DContainerRef.current.classList.remove("active"),this.showMapLayer3DInputRef.current.setCheckedStatus(!1,this.onCameraMoved),this.setCurrentFromFloorplanArrays(),this.userInteractionCurrentController=this.floorplanViewUserInteractionController,this.floorplanItemCurrentHUDObject=this.floorplanViewHUDObject,s.unmountComponentAtNode(this.mapLayer3DContainerRef.current)}else C.get.call(this,"/klet3d/entity/".concat(this.props.mainComponentThis.getFloorplanID(),"/").concat(this.props.mainComponentThis.props.licenseKey),(e=>{e&&e.length>0?M(this.props.mainComponentThis.getFloorplanGpsLatitude(e[0].plan_general))&&M(this.props.mainComponentThis.getFloorplanGpsLongitude(e[0].plan_general))?(this.mapLayer3DContainerRef.current.classList.remove("active"),this.showMapLayer3DInputRef.current.setCheckedStatus(!1),this.props.mainComponentThis.onFloorplanGpsCoordsClick()):(this.currentControls.enabled=!1,this.cameraControlsRef.current.setIsMapActiveState(!0),this.glamosLogoImgRef.current.setAttribute("src",a),this.clearSunLightPositionInterval(this.sunLightPositionFloorplan3DViewInterval),this.mapLayer3DContainerRef.current.classList.add("active"),this.props.mainComponentThis.floorplanGeneral=e[0].plan_general,this.shadowCastingLightsActive=this.shadowCastingLightsActive.filter((e=>(e.isMapScene||(this.setLightStateParameters(e.lightMeshObject,e.lightMeshObject.entity,!1,!1),this.addShadowCastLightToList(e,this.shadowCastingLightsWaitingList)),!1))),this.showMapLayer3DInputRef.current.setCheckedStatus(!0,(()=>{s.render((0,l.jsx)(Ca,{is3D:!0,center:[this.props.mainComponentThis.getFloorplanGpsLongitude(e[0].plan_general),this.props.mainComponentThis.getFloorplanGpsLatitude(e[0].plan_general)],floorplanGpsCoords:[this.props.mainComponentThis.getFloorplanGpsLongitude(e[0].plan_general),this.props.mainComponentThis.getFloorplanGpsLatitude(e[0].plan_general)],onMapContextLoadedCallback:this.show3DFloorplanOnMap,preserveDrawingBuffer:!0,mainComponentThis:this.props.mainComponentThis}),this.mapLayer3DContainerRef.current)}))):(this.mapLayer3DContainerRef.current.classList.remove("active"),this.showMapLayer3DInputRef.current.setCheckedStatus(!1),this.boxInfo.current.innerHTML="There is no floorplan with specified id")}));Na.log("Active",this.shadowCastingLightsActive),Na.log("Waiting",this.shadowCastingLightsWaitingList)},this.onDataLoadedCallback=()=>{this.floorplanFloors=[{wallData:this.props.mainComponentThis.WALLS,objData:this.props.mainComponentThis.OBJDATA,roomData:this.props.mainComponentThis.ROOM.map((e=>{const t=[e.coordsInsideWithOrphans.map((e=>({X:e.x,Y:e.y})))],i=new(Sn().Paths),o=new(Sn().ClipperOffset);o.AddPaths(t,Sn().JoinType.jtMiter,Sn().EndType.etClosedPolygon),o.Execute(i,1);let s=i[0];return s?(s=s.map((e=>({x:e.X,y:e.Y}))),xt(s[0],s[s.length-1])||s.push(s[0])):s=e.coordsInsideWithOrphans,{...e,coordsOutsideWithOrphans:s}})),floorNumber:0}],this.floorplan3DViewScene=new Y.xsS,this.floorplan3DViewRenderer=new Y.CP7({antialias:!0,canvas:this.canvasRef.current,preserveDrawingBuffer:!0}),this.floorplan3DViewRenderer.setClearColor(16777215,1),this.floorplan3DViewRenderer.setPixelRatio(window.devicePixelRatio),this.floorplan3DViewRenderer.setSize(this.canvasRef.current.offsetWidth,this.canvasRef.current.offsetHeight),this.floorplan3DViewRenderer.autoClear=!1,this.floorplan3DViewRenderer.shadowMap.enabled=!0,this.floorplan3DViewRenderer.shadowMap.type=Y.ntZ,this.floorplanBoundingBoxCoordinates=lt(this.props.mainComponentThis.WALLS);const e=ht(this.floorplanBoundingBoxCoordinates,this.scaleFactor);this.floorplanCenterVector=new Y.Pa4(e.x,this.cameraYOffset,e.y),this.orbitControlsCamera=new Y.cPb(45,this.floorplan3DViewRenderer.domElement.offsetWidth/this.floorplan3DViewRenderer.domElement.offsetHeight,1,5e4),this.firstPersonControlsCamera=this.orbitControlsCamera.clone(),this.calculateFloorplanEnvironmentRadius(),this.calculateYZDistanceFromFloorplanCenter(),this.centerOrbitControlsCamera(),this.centerFirstPersonControlsCamera(),this.orbitControls=new Mn(this.orbitControlsCamera,this.floorplan3DViewRenderer.domElement,new Y.Pa4(this.floorplanCenterVector.x,0,this.floorplanCenterVector.z)),this.orbitControls.target=this.floorplanCenterVector.clone(),this.orbitControls.update(),this.firstPersonControls=new Gn(this.firstPersonControlsCamera,this.floorplan3DViewRenderer.domElement,this.floorplan3DViewScene,new Y.Pa4(this.floorplanCenterVector.x,0,this.floorplanCenterVector.z),this),this.firstPersonControls.enabled=!1,this.floorplan3DViewCamera=this.orbitControlsCamera,this.currentControls=this.orbitControls,this.floorplanViewHUDObject=new Sa(this.floorplan3DViewScene),this.floorplanItemCurrentHUDObject=this.floorplanViewHUDObject,this.HAConfigObject=this.props.mainComponentThis.homeAssistantConfigObject,this.floorplanStartDate=W(this.HAConfigObject.time_zone),this.floorplanStartDateSetTimestamp=(new Date).getTime(),this.createAmbientLight(this.floorplan3DViewScene),this.createFloorplanEnvironment(this.floorplan3DViewScene),this.initializeSunLightPositionIntervalCalculation(!1,this.floorplan3DViewScene,this.sunLightPositionFloorplan3DViewCameraHelpers),Y.Tme.prototype.deepClone=function(e){return(new this.constructor).deepCopy(this,e)},Y.Tme.prototype.deepCopy=function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),e.material)if(e.material.isMaterial)this.material=e.material.clone();else{this.material=[];for(const t of e.material)this.material.push(t.clone())}if(e.geometry&&(this.geometry=e.geometry.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var o=e.children[i];this.add(o.deepClone())}return this},this.drawFloorplan(this.floorplan3DViewScene),this.floorplanViewUserInteractionController=new ya(this.floorplan3DViewScene,this.canvasRef.current,this),this.userInteractionCurrentController=this.floorplanViewUserInteractionController,this.floorplan3DViewAnimate(),window.addEventListener("keydown",this.handleKeyDown3D),this.floorplan3DViewRenderer.domElement.addEventListener("cameraMoved",this.onCameraMoved)},this.state={isPanelShowed:!1},this.canvasRef=o.createRef(),this.panel=o.createRef(),this.panelControl=o.createRef(),this.panelInfoExplanationBox=o.createRef(),this.heightFactorRef=o.createRef(),this.wallsOpacityRef=o.createRef(),this.mapLayer3DContainerRef=o.createRef(),this.showMapLayer3DInputRef=o.createRef(),this.wallsVisibilityOptionsRef=o.createRef(),this.cameraControlsRef=o.createRef(),this.HAControlPanelRef=o.createRef(),this.glamosLogoImgRef=o.createRef(),this.alertRef=o.createRef(),this.maxShadowCastingLightsAlert=o.createRef(),this.timeIntervalBetweenFrames=50,this.floorplan3DViewRenderer=null,this.floorplan3DViewCamera=null,this.orbitControlsCamera=null,this.firstPersonControlsCamera=null,this.YZDistanceFromFloorplanCenter={},this.floorplan3DViewScene=null,this.currentControls=null,this.orbitControls=null,this.firstPersonControls=null,this.exportPngResolutionScale=4,this.scaleFactor=e.mainComponentThis.floorplan3DScaleFactor,this.wallHeight=e.mainComponentThis.wallHeight*this.scaleFactor,this.doorHeight=180,this.windowHeight=100,this.isPointOnWallDecimalPrecision=e.mainComponentThis.isPointOnWallDecimalPrecision,this.panelWidth=220,this.cameraYOffset=150,this.floorplanBoundingBoxCoordinates=null,this.floorplanCenterVector=null,this.wallStartEndPlanesColor=13421772,this.wallTopBottomPlanesColor=14540253,this.wallStartEndPlanesMaterial=null,this.wallBottomPlaneMaterial=null,this.wallTopPlaneMaterial=null,this.textureLoader=new Y.dpR,this.gltfLoader=new Tn.E,this.fontLoader=new Dn.J,this.mounted=!1,this.floorplanWallMaterials=[],this.roomFloorTextures=[],this.loadingWallMaterialsStatuses=[],this.loadingRoomFloorTexturesStatuses=[],this.loadingCallbacksStatuses=[],this.loadingWallObjectsStatuses=[],this.loadingFreeLightObjectsStatuses=[],this.loadingFreeFurnitureObjectsStatuses=[],this.floorplanViewWalls3D=[],this.currentWalls3D=[],this.floorplanViewRoomFloors=[],this.currentRoomFloors=[],this.floorplanViewFurniture=[],this.currentFurniture=[],this.floorplanViewLights=[],this.currentViewLights=[],this.floorplanViewSensors=[],this.currentViewSensors=[],this.floorplanViewOthers=[],this.currentViewOthers=[],this.textFont=null,this.doorObjects3D=[],this.windowObjects3D=[],this.lightObjects3D=[],this.furnitureObjects3D=[],this.floorplan3DOnMapScene=null,this.floorplan3DOnMapCameraPosition=null,this.floorplan3DOnMapCamera=null,this.floorplan3DOnMapRenderer=null,this._map=null,this.floorplanFloors=[],this.wallStartEndPlanesMaterial=new Y.xoR({color:this.wallStartEndPlanesColor,side:Y.ehD}),this.wallBottomPlaneMaterial=new Y.xoR({color:this.wallTopBottomPlanesColor,side:Y._Li}),this.wallTopPlaneMaterial=new Y.xoR({color:this.wallTopBottomPlanesColor,side:Y.ehD}),this.sensorValueDecimalPrecision=1,this.HAEntityObjects=[],this.HAConfigObject={},this.lightSourceLightSphereMaterialColor=new Y.Ilk(10066329),this.floorplanViewUserInteractionController=null,this.floorplanOnMapUserInteractionController=null,this.userInteractionCurrentController=null,this.floorplanViewHUDObject=null,this.floorplanOnMapHUDObject=null,this.floorplanItemCurrentHUDObject=null,this.floorplanEnvironmentRadius=0,this.environmentCircleSegmentsCount=32,this.panelDrawingOptions=[{objects3DArray:this.furnitureObjects3D,object3DProperties:{type:"furniture"},currentViewArray:this.currentFurniture,floorplanViewArray:this.floorplanViewFurniture},{objects3DArray:this.doorObjects3D,object3DProperties:{type:"door"}},{objects3DArray:this.windowObjects3D,object3DProperties:{type:"window"}},{objects3DArray:this.lightObjects3D,object3DProperties:{type:"light"},currentViewArray:this.currentViewLights,floorplanViewArray:this.floorplanViewLights}],this.sunLightPositionFloorplan3DViewInterval=null,this.sunLightPositionFloorplan3DOnMapInterval=null,this.updateSunLightPositionIntervalDelayMs=6e4,this.sunLightPositionFloorplan3DViewCameraHelpers={auxiliaryCameraHelper:null,mainCameraHelper:null,type:"floorplan3DView"},this.sunLightPositionFloorplan3DOnMapCameraHelpers={auxiliaryCameraHelper:null,mainCameraHelper:null,type:"floorplan3DOnMap"},this.floorplanStartDate=null,this.floorplanStartDateSetTimestamp=(new Date).getTime(),this.skyMaterial=null,this.HAEntityBindedObjectTextHeight=2,this.editModeValue=He.find((e=>"Edit"===e.label)).value,this.defaultUserMode=He.find((e=>"Control"===e.label)).value,this.selectedUserMode=this.defaultUserMode,this.shadowCastingLightsActive=[],this.shadowCastingLightsWaitingList=[],this.maxShadowCastingLightsCount=15,this.changedLightsShadowMaps=[],this.changeLightShadowMapsLoadingSet=!1,this.isInitialFloorplanDrawingFinished=!1,this.backTo2D=this.backTo2D.bind(this),this.floorplan3DViewAnimate=this.floorplan3DViewAnimate.bind(this),this.onWindowResize=this.onWindowResize.bind(this),this.createAmbientLight=this.createAmbientLight.bind(this),this.createFloorplanEnvironment=this.createFloorplanEnvironment.bind(this),this.centerOrbitControlsCamera=this.centerOrbitControlsCamera.bind(this),this.calculateYZDistanceFromFloorplanCenter=this.calculateYZDistanceFromFloorplanCenter.bind(this),this.calculateFloorplanEnvironmentRadius=this.calculateFloorplanEnvironmentRadius.bind(this),this.calculateControlsMaxDistance=this.calculateControlsMaxDistance.bind(this),this.centerFirstPersonControlsCamera=this.centerFirstPersonControlsCamera.bind(this),this.loadFloorplanItemObject3D=this.loadFloorplanItemObject3D.bind(this),this.loadTexture=this.loadTexture.bind(this),this.drawFloorplan=this.drawFloorplan.bind(this),this.onInitialFloorplanDrawingFinishedCallback=this.onInitialFloorplanDrawingFinishedCallback.bind(this),this.drawFloorplanFloorsWalls=this.drawFloorplanFloorsWalls.bind(this),this.drawFloorplanFreeFurniture=this.drawFloorplanFreeFurniture.bind(this),this.drawFloorplanRoomFloors=this.drawFloorplanRoomFloors.bind(this),this.drawFloorRoomFloors=this.drawFloorRoomFloors.bind(this),this.drawFloorWalls=this.drawFloorWalls.bind(this),this.drawFloorplanFloorsWallObjects=this.drawFloorplanFloorsWallObjects.bind(this),this.drawFloorFreeFurniture=this.drawFloorFreeFurniture.bind(this),this.drawFloorplanFreeLights=this.drawFloorplanFreeLights.bind(this),this.drawFloorFreeLights=this.drawFloorFreeLights.bind(this),this.calculateShapeGeometryUVMappings=this.calculateShapeGeometryUVMappings.bind(this),this.calculateAngleBetween2DVectors=this.calculateAngleBetween2DVectors.bind(this),this.isInitialLoadingFinished=this.isInitialLoadingFinished.bind(this),this.rotateAroundPoint=this.rotateAroundPoint.bind(this),this.rotateChildAroundWorldPoint=this.rotateChildAroundWorldPoint.bind(this),this.translateObjectInWorld=this.translateObjectInWorld.bind(this),this.createMeshFromObject=this.createMeshFromObject.bind(this),this.onCameraMoved=this.onCameraMoved.bind(this),this.updateWallsVisibility=this.updateWallsVisibility.bind(this),this.setFloorplanItemShadow=this.setFloorplanItemShadow.bind(this),this.onPanelControlClick=this.onPanelControlClick.bind(this),this.onExportPngClick=this.onExportPngClick.bind(this),this.changeWallMaterialOpacity=this.changeWallMaterialOpacity.bind(this),this.focusFloorplanOnMap=this.focusFloorplanOnMap.bind(this),this.show3DFloorplanOnMap=this.show3DFloorplanOnMap.bind(this),this.onShowOnMapLayer3DClick=this.onShowOnMapLayer3DClick.bind(this),this.removeFloorplanFloor=this.removeFloorplanFloor.bind(this),this.removeFloorplanFloorItems=this.removeFloorplanFloorItems.bind(this),this.addFloorplanFloor=this.addFloorplanFloor.bind(this),this.addFloorplanFloorItems=this.addFloorplanFloorItems.bind(this),this.adjustCameraYPosition=this.adjustCameraYPosition.bind(this),this.setCurrentFromFloorplanArrays=this.setCurrentFromFloorplanArrays.bind(this),this.hidePanel=this.hidePanel.bind(this),this.createTextMesh=this.createTextMesh.bind(this),this.createTextBackgroundMesh=this.createTextBackgroundMesh.bind(this),this.initializeSensorColorPaletteImageData=this.initializeSensorColorPaletteImageData.bind(this),this.calculateSensorRangeColoringColor=this.calculateSensorRangeColoringColor.bind(this),this.createSensorMesh=this.createSensorMesh.bind(this),this.createOtherMesh=this.createOtherMesh.bind(this),this.handleDoorWindowSwitchClick=this.handleDoorWindowSwitchClick.bind(this),this.onHAEntitiesChangeCallback=this.onHAEntitiesChangeCallback.bind(this),this.onHAConfigChange=this.onHAConfigChange.bind(this),this.drawFloorplanSensors=this.drawFloorplanSensors.bind(this),this.drawFloorplanOthers=this.drawFloorplanOthers.bind(this),this.drawFloorBindedUnfixedObjects=this.drawFloorBindedUnfixedObjects.bind(this),this.handleLightSwitchClick=this.handleLightSwitchClick.bind(this),this.initializeSunLightPositionIntervalCalculation=this.initializeSunLightPositionIntervalCalculation.bind(this),this.clearSunLightPositionInterval=this.clearSunLightPositionInterval.bind(this),this.updateSunLightPosition=this.updateSunLightPosition.bind(this),this.onSunLightPositionCoordinateSystemTransformReady=this.onSunLightPositionCoordinateSystemTransformReady.bind(this),this.drawLine=this.drawLine.bind(this),this.drawGlobalCoordinateSystem=this.drawGlobalCoordinateSystem.bind(this),this.changeCoordinateSystemBasisForPoints=this.changeCoordinateSystemBasisForPoints.bind(this),this.calculateFloorplanXZPlaneBBoxPoints=this.calculateFloorplanXZPlaneBBoxPoints.bind(this),this.calculateMaxXMaxZOffsetsFromCenterPoint=this.calculateMaxXMaxZOffsetsFromCenterPoint.bind(this),this.getMaxFloorNumber=this.getMaxFloorNumber.bind(this),this.createFloorplanTimeMesh=this.createFloorplanTimeMesh.bind(this),this.disposeObject=this.disposeObject.bind(this),this.disposeObjectMaterial=this.disposeObjectMaterial.bind(this),this.disposeScene=this.disposeScene.bind(this),this.calculateCurrentDate=this.calculateCurrentDate.bind(this),this.getHAEntityAdditionalParameters=this.getHAEntityAdditionalParameters.bind(this),this.updateHAControlPanelState=this.updateHAControlPanelState.bind(this),this.cloneUnfixedBindedObject3D=this.cloneUnfixedBindedObject3D.bind(this),this.createUnfixedItem=this.createUnfixedItem.bind(this),this.removeUnfixedItem=this.removeUnfixedItem.bind(this),this.getHAEntityUserSpecificedStateValue=this.getHAEntityUserSpecificedStateValue.bind(this),this.getSensorUnitOfMeasurement=this.getSensorUnitOfMeasurement.bind(this),this.createPointLight=this.createPointLight.bind(this),this.createFloorplanItem=this.createFloorplanItem.bind(this),this.removeFloorplanItem=this.removeFloorplanItem.bind(this),this.createTextureMaterial=this.createTextureMaterial.bind(this),this.onFloorplanItemSelect=this.onFloorplanItemSelect.bind(this),this.onFloorplanItemUnselect=this.onFloorplanItemUnselect.bind(this),this.userInteractionControlerNothingClickedReset=this.userInteractionControlerNothingClickedReset.bind(this),this.closeActiveRightBox=this.closeActiveRightBox.bind(this),this.getSelectedDrawingOption=this.getSelectedDrawingOption.bind(this),this.handleKeyDown3D=this.handleKeyDown3D.bind(this),this.processSceneVec3=this.processSceneVec3.bind(this),this.getFloorplanViewSceneItem=this.getFloorplanViewSceneItem.bind(this),this.onBirdPerspectiveViewButtonClick=this.onBirdPerspectiveViewButtonClick.bind(this),this.onDataLoadedCallback=this.onDataLoadedCallback.bind(this),this.onSwitchControlsClick=this.onSwitchControlsClick.bind(this),this.onResetCameraViewButtonClick=this.onResetCameraViewButtonClick.bind(this),this.toggleHALightState=this.toggleHALightState.bind(this),this.turnWaitingLightOn=this.turnWaitingLightOn.bind(this),this.setLightStateParameters=this.setLightStateParameters.bind(this),this.getLightTurnOnState=this.getLightTurnOnState.bind(this),this.addShadowCastLightToList=this.addShadowCastLightToList.bind(this),this.isLightsShadowMapChangeFinished=this.isLightsShadowMapChangeFinished.bind(this),this.addHAEntityObject=this.addHAEntityObject.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.clearSunLightPositionInterval(this.sunLightPositionFloorplan3DViewInterval),this.clearSunLightPositionInterval(this.sunLightPositionFloorplan3DOnMapInterval,!0),this.disposeScene(this.floorplan3DViewScene,this.floorplan3DViewRenderer),this.showMapLayer3DInputRef.current.getCheckedStatus()&&this.disposeScene(this.floorplan3DOnMapScene,this.floorplan3DOnMapRenderer),this.orbitControls&&this.orbitControls.dispose(),this.firstPersonControls&&this.firstPersonControls.dispose(),this.mounted=!1}render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{className:"glamos-bottom-left-logo",style:{right:10,left:"auto"},children:(0,l.jsx)("img",{ref:this.glamosLogoImgRef,alt:"Glamos logo",src:va})}),(0,l.jsx)("canvas",{className:"full-height",ref:this.canvasRef}),(0,l.jsx)("div",{ref:this.mapLayer3DContainerRef,className:"map-layer-container floorplan3d"}),(0,l.jsxs)(oo.Z,{theme:ho,children:[(0,l.jsx)("div",{ref:this.panelInfoExplanationBox,className:"panel-info-explanation-box",style:{width:"auto",maxWidth:200}}),(0,l.jsx)(Va,{ref:this.cameraControlsRef,floorplan3DThis:this}),(0,l.jsx)(jo,{ref:this.maxShadowCastingLightsAlert}),(0,l.jsx)(jo,{ref:this.alertRef,delay:5e3}),(0,l.jsxs)(As,{panelRef:this.panel,panelWidth:this.panelWidth,children:[(0,l.jsx)("li",{className:"back-to-2d-container",children:(0,l.jsx)(ai,{type:"blue",onClick:this.backTo2D,children:"Back to 2D"})}),(0,l.jsx)("br",{}),(0,l.jsx)(La,{floorplan3DThis:this}),(0,l.jsx)("br",{}),(0,l.jsx)(Xn,{ref:this.wallsVisibilityOptionsRef,panelInfoExplanationBox:this.panelInfoExplanationBox,mainComponentThis:this}),(0,l.jsx)(Jn,{ref:this.wallsOpacityRef,mainComponentThis:this}),(0,l.jsx)("br",{}),(0,l.jsx)("li",{children:(0,l.jsxs)("button",{className:"btn btn-default fully panel-icon-button-container",title:"Export as PNG",onClick:this.onExportPngClick,children:[(0,l.jsx)(os.Z,{}),(0,l.jsx)("p",{children:"EXPORT PNG"})]})}),(0,l.jsx)("br",{}),(0,l.jsx)("li",{children:(0,l.jsx)(un,{ref:this.showMapLayer3DInputRef,onChangeCallback:this.onShowOnMapLayer3DClick})}),(0,l.jsx)("br",{}),(0,l.jsx)(Yi,{label:"Add-on URL",value:"".concat(window.location.pathname).concat(window.location.search),containerStyle:{marginBottom:"1rem"}}),(0,l.jsx)(Ia,{ref:this.HAControlPanelRef,floorplan3DThis:this,mainComponentThis:this.props.mainComponentThis})]}),(0,l.jsx)("div",{ref:this.panelControl,className:"panel-control-container panel-transition svg-center-inside-container",title:this.state.isPanelShowed?"Hide settings":"Open settings",onClick:this.onPanelControlClick,children:this.state.isPanelShowed?(0,l.jsx)(Ps.Z,{className:"panel-transition"}):(0,l.jsx)(ls.Z,{style:{padding:2,boxSizing:"border-box"}})})]})]})}}const Ha=za;var Ga=i(1317);function qa(e,t,i,o){const s=this.panel.current.style.width.slice(0,-2);Ga.log("Panel width "+s);let n,a=(s-this.offset.left)*t+i,r=e.minX-a,l=24*t+o,h=e.minY-l,c=this.taille_h*t+o-e.maxY,d=bt();return n=d?(this.taille_w-this.offset.left-d.offsetWidth)*t+i:(this.taille_w-this.offset.left)*t+i,{minX:r,maxX:n-e.maxX,minY:h,maxY:c}}function Ya(e,t,i){return t.width_viewbox_clone=t.width_viewbox_clone-i*this.zoomXMove,t.zoomFactor_clone=t.width_viewbox_clone/this.taille_w,t.originX_viewbox_clone=t.originX_viewbox_clone+i*this.zoomXMove/2,t.originY_viewbox_clone=t.originY_viewbox_clone+i*(this.zoomXMove/2)*this.ratio_viewbox,this.getBoxDimensionsForCurrentZoom(e,t.zoomFactor_clone,t.originX_viewbox_clone,t.originY_viewbox_clone)}function Ua(e,t,i,o,s){let n=!0;do{if(Ga.log("Do while "+i+" "+s+" "+JSON.stringify(t)+" params "+JSON.stringify(o)),-1===s){if(this.isOverMaxZoomOut(o.width_viewbox_clone,this.zoomXMove))break;n=t[i]<0}else{if(this.isOverMaxZoomIn(o.width_viewbox_clone,this.zoomXMove))break;let a={...o};n=(t=this.boxZoomSimulationSetZoomParameters(e,a,s))[i]>0}n&&(o.zoomLevelsNeeded=o.zoomLevelsNeeded+1*s,t=this.boxZoomSimulationSetZoomParameters(e,o,s))}while(n)}function Xa(e,t,i){const o=this.showWholeBoxZoomOperations(e,t,i);this.width_viewbox=o.width_viewbox,this.height_viewbox=o.height_viewbox,this.originX_viewbox=o.originX_viewbox,this.originY_viewbox=o.originY_viewbox,this.zoomFactor=o.zoomFactor,this.zoom=o.zoom}function Za(e,t,i){this.originX_viewbox=e.x-this.width_viewbox/2,this.originY_viewbox=e.y-this.height_viewbox/2;const o=this.getBoxDimensionsForCurrentZoom(t,this.zoomFactor,this.originX_viewbox,this.originY_viewbox);if(o.minX<0){const e=this.panel.current.style.width.slice(0,-2);e-this.offset.left>this.taille_w/2&&(Ga.log("Upao u zastitu left panela"),this.originX_viewbox+=Math.floor(o.minX),o.minX=t.minX-((e-this.offset.left)*this.zoomFactor+this.originX_viewbox))}o.minY<0&&24>this.taille_w/2*this.ratio_viewbox&&(Ga.log("Upao u zastitu gornjeg dijela"),this.originY_viewbox+=Math.floor(o.minY),o.minY=t.minY-(24*this.zoomFactor+this.originY_viewbox)),this.showWholeBoxZoom(t,o,i)}function Ka(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=lt(this.WALLS),i=ht(t);i&&this.centerAndShowWholeBoxOperations(i,t,e)}function Ja(e,t,i){let o={width_viewbox_clone:this.width_viewbox,originX_viewbox_clone:this.originX_viewbox,originY_viewbox_clone:this.originY_viewbox,zoomFactor_clone:this.zoomFactor,zoomLevelsNeeded:0};Ga.log("Box rib dimensions"),Ga.log(t);let s=[],n="zoomout",a=-1;for(let d in t)Ga.log(d),t[d]<0&&s.push({value:t[d],propertyName:d,isVertical:"minY"===d||"maxY"===d});if(Ga.log("Negative dimension"),Ga.log(JSON.stringify(s)),0===s.length){for(let e in t)s.push({value:t[e],propertyName:e,isVertical:"minY"===e||"maxY"===e});n="zoomin",a=1}let r=null,l=s.filter((e=>!e.isVertical));if(l.length>0){r=l[0];for(let e=1;e<l.length;e++)l[e].value<r.value&&(r=l[e])}let h=null,c=s.filter((e=>e.isVertical));if(c.length>0){h=c[0];for(let e=1;e<c.length;e++)c[e].value<h.value&&(h=c[e])}if(r&&!h)Ga.log("Samo horizontalni"),this.boxZoomSimulation(e,t,r.propertyName,o,a),!i&&this.zoomToSpecificLevel(n,Math.abs(o.zoomLevelsNeeded));else if(!r&&h)Ga.log("Samo vertikalni"),this.boxZoomSimulation(e,t,h.propertyName,o,a),!i&&this.zoomToSpecificLevel(n,Math.abs(o.zoomLevelsNeeded));else{Ga.log("Oba");let s=r.propertyName,l=h.propertyName;r.value>h.value&&(s=h.propertyName,l=r.propertyName),this.boxZoomSimulation(e,t,s,o,a),(t=this.getBoxDimensionsForCurrentZoom(e,o.zoomFactor_clone,o.originX_viewbox_clone,o.originY_viewbox_clone))[l]>0||(Ga.log("Zoom druge dimenzije"),"zoomin"===n&&(a=-1),this.boxZoomSimulation(e,t,l,o,a)),!i&&this.zoomToSpecificLevel(n,Math.abs(o.zoomLevelsNeeded))}return!i&&this.setSvgViewBoxes(),Ga.log("Levels needed "+o.zoomLevelsNeeded),{originX_viewbox:i?this.originX_viewbox:o.originX_viewbox_clone,originY_viewbox:i?this.originY_viewbox:o.originY_viewbox_clone,width_viewbox:i?this.width_viewbox:o.width_viewbox_clone,height_viewbox:i?this.height_viewbox:o.width_viewbox_clone*this.ratio_viewbox,zoomFactor:i?this.zoomFactor:o.zoomFactor_clone,zoom:this.zoom+o.zoomLevelsNeeded}}function Qa(e,t){let i,o=t;if(Ga.log("Initial zoom level change "+t+"zzoom type "+e),"zoomout"===e){if(this.isOverMaxZoomOut(this.width_viewbox,t*this.zoomXMove))for(o--;this.isOverMaxZoomOut(this.width_viewbox,o*this.zoomXMove);)o--;i=o*this.zoomXMove,this.setZoomParameters("zoomout",i,!1)}else{if(this.isOverMaxZoomIn(this.width_viewbox,t*this.zoomXMove))for(o--;this.isOverMaxZoomIn(this.width_viewbox,o*this.zoomXMove);)o--;Ga.log("Zoom level change "+t),i=o*this.zoomXMove,this.setZoomParameters("zoomin",i,!1)}}function $a(e,t){let i;if("zoomin"===e){if(this.isOverMaxZoomIn(this.width_viewbox,t))return!1;this.width_viewbox-=t,i=this.taille_w/this.width_viewbox,this.height_viewbox=this.width_viewbox*this.ratio_viewbox,this.originX_viewbox=this.originX_viewbox+t/2,this.originY_viewbox=this.originY_viewbox+t/2*this.ratio_viewbox}else if("zoomout"===e){if(this.isOverMaxZoomOut(this.width_viewbox,t))return!1;this.width_viewbox+=t,i=this.taille_w/this.width_viewbox,this.height_viewbox=this.width_viewbox*this.ratio_viewbox,this.originX_viewbox=this.originX_viewbox-t/2,this.originY_viewbox=this.originY_viewbox-t/2*this.ratio_viewbox}return this.setScaleValueWidth(i),this.zoomFactor=this.width_viewbox/this.taille_w,!0}function er(e,t,i){if(this.showMapLayer2DInputRef.current.getCheckedStatus())var o=this.calcul_snap({pageX:this.offset.left,pageY:this.offset.top+this.offset.scrollY});if("zoomout"===e||"zoomin"===e){if(!this.setZoomParameters(e,t,!0))return}else"zoomreset"===e?(this.showHideLeftRightBoxes(),this.centerAndShowFloorplanAndUploadedFloorplanImage(!1)):"zoomright"===e?this.originX_viewbox+=i:"zoomleft"===e?this.originX_viewbox-=i:"zoomtop"===e?this.originY_viewbox-=i:"zoombottom"===e?this.originY_viewbox+=i:"zoomdrag"===e&&(this.originX_viewbox-=t,this.originY_viewbox-=i);this.showMapLayer2DInputRef.current.getCheckedStatus()&&("zoomreset"===e||"zoomout"===e||"zoomin"===e?this.handleMapZoomChange(o):this.handleMapDrag(o)),this.drawingAreaPopupActive&&this.drawingAreaPopupZoomTranslateControl(),"zoomreset"!==e&&this.setSvgViewBoxes()}function tr(e){if(this.boxFloorplanImage.current.childNodes.length>0){const t=(e=>{let t=e[0].minX,i=e[0].maxX,o=e[0].minY,s=e[0].maxY;for(let n=1;n<e.length;n++)e[n].maxY>s&&(s=e[n].maxY),e[n].minY<o&&(o=e[n].minY),e[n].maxX>i&&(i=e[n].maxX),e[n].minX<t&&(t=e[n].minX);return[{x:t+(i-t)/2,y:o+(s-o)/2},{minX:t,maxX:i,minY:o,maxY:s}]})([this.uploadFloorplanImageToolsRef.current.getFloorplanImageBoundingBox(),lt(this.WALLS)||{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}]);this.centerAndShowWholeBoxOperations(t[0],t[1],e)}else this.centerAndShowWholeFloorplan(e)}function ir(e,t){const i=this.taille_w-e+t>(this.maxZoomInLevel-this.defaultZoomLevel)*this.zoomXMove;if(this.showMapLayer2DInputRef.current.getCheckedStatus()&&!i){const i=yt(this._map.getCenter().lat,(e-t)/this.taille_w/this.meter);return Ga.log("New map layer zoom "+i),i>22}return i}function or(e,t){const i=e-this.taille_w+t>Math.abs(this.maxZoomOutLevel-this.defaultZoomLevel)*this.zoomXMove;if(this.showMapLayer2DInputRef.current.getCheckedStatus()&&!i){const i=yt(this._map.getCenter().lat,(e+t)/this.taille_w/this.meter);return Ga.log("New map layer zoom "+i),i<0}return i}function sr(){if(this.taille_w-(this.maxZoomInLevelDefaultValue-this.defaultZoomLevel)*this.zoomXMove<0){let e=this.maxZoomInLevelDefaultValue-1;for(;this.taille_w-(e-this.defaultZoomLevel)*this.zoomXMove<0;)e--;this.maxZoomInLevel=e}else if(this.taille_w-(this.maxZoomInLevelDefaultValue-this.defaultZoomLevel)*this.zoomXMove>0){let e=this.maxZoomInLevelDefaultValue;for(;this.taille_w-(e+1-this.defaultZoomLevel)*this.zoomXMove>0;)e++;this.maxZoomInLevel=e}else this.maxZoomInLevel=this.maxZoomInLevelDefaultValue}function nr(e){const t=this.meter*e;let i="metric"===this.measureSystemContext.userUnit?t:O(this.imperialSystemSquareFeetSize,"feet","meter")*t;this.scaleVal.current.style.width=i+"px"}function ar(e){let t=e.coordsInsideWithOrphans,i="M"+t[0].x+","+t[0].y;for(let o=1;o<t.length-1;o++)i=i+" L"+t[o].x+","+t[o].y;if(i+="Z",e.inside.length>0)for(let o=0;o<e.inside.length;o++){i=i+" M"+this.Rooms.polygons[e.inside[o]].coords[this.Rooms.polygons[e.inside[o]].coords.length-1].x+","+this.Rooms.polygons[e.inside[o]].coords[this.Rooms.polygons[e.inside[o]].coords.length-1].y;for(let t=this.Rooms.polygons[e.inside[o]].coords.length-2;t>-1;t--)i=i+" L"+this.Rooms.polygons[e.inside[o]].coords[t].x+","+this.Rooms.polygons[e.inside[o]].coords[t].y}return i}function rr(e){let t=this.createRoomPath(e),i=this.qSVG.create(this.boxBind,"path",{id:"roomSelected",d:t,fill:"#c9c14c","fill-opacity":.5,stroke:"#c9c14c","fill-rule":"evenodd","stroke-width":3});return i.type="room",i.realRoomArea=e.realRoomArea,i.id=e.id,i}function lr(){this.selectedBinder&&(this.selectedBinder.graph?this.selectedBinder.graph.remove():this.selectedBinder.remove(),"room"===this.selectedBinder.binderType&&this.updateSelectedRoomFill(this.ROOM.find((e=>e.id===this.selectedRoomId)).floorTexture),this.selectedBinder=null,this.windowRotationAxisDirectionGraph&&(this.windowRotationAxisDirectionGraph.remove(),this.windowRotationAxisDirectionGraph=null))}function hr(){this.binder&&(this.binder.graph?this.binder.graph.remove():this.binder.remove(),this.binder=null)}var cr=i(1317);function dr(){this.hideSubItems(),this.razButton(),"block"===this.layerList.current.style.display?(cr.log("Hide layer list"),at(this.layerList.current,this.othersTimeout,null,!1),this.layersListArrowRef.current.classList.remove("down"),this.foncButton("select_mode"),this.boxInfo.current.innerHTML="Select mode"):(cr.log("Show layer list"),nt(this.layerList.current,this.othersTimeout,null,"block",!1),this.layersListArrowRef.current.classList.add("down"),this.layerMode.current.classList.add("btn-success"),this.foncButton("layer_mode"),this.boxInfo.current.innerHTML="",this.modeOption=void 0),this.removeSelectedBinder()}function pr(){"room_mode"!==this.mode&&(this.cursor("pointer"),L()?this.boxInfo.current.innerHTML="Touch room which you want to configure":this.boxInfo.current.innerHTML="Configure rooms",this.removeSelectedBinder(),this.foncButton("room_mode"))}function mr(){"select_mode"!==this.mode&&(this.boxInfo.current.innerHTML="Select mode",this.removeSelectedBinder(),this.foncButton("select_mode"))}function ur(){"none"!==this.uploadImageFloorplanShowRef.current.style.display?nt(this.boxFloorplanImage.current,this.othersTimeout,(()=>{nt(this.uploadImageFloorplanHideRef.current,0,null,"inline",!1),at(this.uploadImageFloorplanShowRef.current,0,null,!1),this.uploadFloorplanImageStatusContainerRef.current.title="Hide floorplan image"}),"inline",!1):(cr.log("Sakrij floorplan image"),at(this.boxFloorplanImage.current,this.othersTimeout,(()=>{nt(this.uploadImageFloorplanShowRef.current,0,null,"inline",!1),at(this.uploadImageFloorplanHideRef.current,0,null,!1),this.uploadFloorplanImageStatusContainerRef.current.title="Show floorplan image"}),!1))}function gr(){("upload_floorplan_image_mode"!==this.mode||"upload_floorplan_image_mode"===this.mode&&!bt())&&(this.removeSelectedBinder(),this.hideSubItems(),this.translateRightBox(this.floorplanImageTools.current,-250,!0),this.foncButton("upload_floorplan_image_mode"),this.cursor("default"),this.boxInfo.current.innerHTML="Upload floorplan image")}function fr(){"layer_mode"===this.mode&&"block"===this.layerList.current.style.display?(at(this.layerList.current,this.othersTimeout,null,!1),this.layersListArrowRef.current.classList.remove("down")):(this.hideActiveRightBox(),this.removeSelectedBinder(),"upload_floorplan_image_mode"!==this.mode&&"floorplan_image_scaling"!==this.mode&&"floorplan_image_translation"!==this.mode||(this.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group")&&this.boxFloorplanImage.current.querySelector(".floorplan-image-scaling-group").remove(),this.boxFloorplanImage.current.querySelector(".floorplan-image-translate-group")&&this.boxFloorplanImage.current.querySelector(".floorplan-image-translate-group").remove()))}function br(){this.selectMode.current.classList.remove("btn-success"),this.selectMode.current.classList.add("btn-default"),this.roomMode.current.classList.remove("btn-success"),this.roomMode.current.classList.add("btn-default"),this.uploadFloorplanImageMode.current.classList.remove("btn-success"),this.uploadFloorplanImageMode.current.classList.add("btn-default"),this.layerMode.current.classList.remove("btn-success"),this.layerMode.current.classList.add("btn-default")}function xr(e,t){if("dont_save"!==t&&this.save(!1,!1),cr.log("Option: "+t),"layer_mode"!==e){let t;"upload_floorplan_image_mode"!==e&&this.hideSubItems(),this.razButton(),"select_mode"===e?t=this.selectMode:"room_mode"===e?t=this.roomMode:"upload_floorplan_image_mode"===e&&(t=this.uploadFloorplanImageMode),t.current.classList.remove("bnt-default"),t.current.classList.add("btn-success")}cr.log("New mode "+e),this.mode=e,this.modeOption=t,this.lineIntersectionP&&(this.lineIntersectionP.remove(),this.lineIntersectionP=null)}var Cr=i(1317);const wr=(e,t,i)=>{if(i){const i="GLAMOS_'Floorplan_".concat((new Date).getDate().toString().padStart(2,"0"),"_").concat(((new Date).getMonth()+1).toString().padStart(2,"0"),"_").concat((new Date).getFullYear());if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob){const t=e.msToBlob();navigator.msSaveOrOpenBlob(t,i)}else{((e,t)=>{let i=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}),o=document.createElement("a");o.setAttribute("download",t),o.setAttribute("href",e),o.setAttribute("target","_blank"),o.dispatchEvent(i)})(e.toDataURL("image/png"),i)}t(!0)}else t(e.toDataURL("image/png"))};function yr(e,t,i,o,s,n,r,l){return new Promise(((h,c)=>{const d=l?0:60;if(i.drawImage(e,0,0),o.revokeObjectURL(s),r){let e=new Image;e.onload=()=>{i.drawImage(e,(this.boxWallCoordinates.width+2*d)/2-83,this.boxWallCoordinates.height+2*d-50,166,40),wr(t,h,n)},e.onerror=e=>{this.boxInfo.current.innerHTML="Ooops. An error happened during exporting to png.",c(e)},e.src=a}else wr(t,h,n)}))}function Sr(e,t,i,o){return new Promise(((s,n)=>{let a=this.linRef.current.cloneNode(!0);this.exportPngShowGrid?a.querySelector(".boxGrid").style.opacity=1:a.querySelector(".boxGrid").remove(),this.exportPngShowMeasures?a.querySelector("#boxRib").style.display="inline":a.querySelector("#boxRib").remove(),a.querySelector("#boxScale").remove(),a.querySelector("#boxBind").remove(),a.style.width="",a.style.height="";const r=i?0:60;a.setAttribute("viewBox",this.boxWallCoordinates.minX-r+" "+(this.boxWallCoordinates.minY-r)+" "+(this.boxWallCoordinates.width+2*r)+" "+(this.boxWallCoordinates.height+2*r)),a.setAttribute("width",this.boxWallCoordinates.width+2*r),a.setAttribute("height",this.boxWallCoordinates.height+2*r),o||(a.style.backgroundColor="#ffffff"),ut(a,a);let l=document.createElement("canvas");this.exportPngResolutionScale=4;const h=1e4;(this.boxWallCoordinates.width+2*r)*this.exportPngResolutionScale>h&&(this.exportPngResolutionScale=T(h/(this.boxWallCoordinates.width+2*r),2)),(this.boxWallCoordinates.height+2*r)*this.exportPngResolutionScale>h&&(this.exportPngResolutionScale=T(h/(this.boxWallCoordinates.height+2*r),2)),l.width=(this.boxWallCoordinates.width+2*r)*this.exportPngResolutionScale,l.height=(this.boxWallCoordinates.height+2*r)*this.exportPngResolutionScale,Cr.log("Canvas element"),Cr.log(l);let c=l.getContext("2d");c.scale(this.exportPngResolutionScale,this.exportPngResolutionScale);let d=(new XMLSerializer).serializeToString(a),p=window.URL||window.webkitURL||window,m=new Image,u=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),g=p.createObjectURL(u);m.onload=()=>{s(this.exportFloorplanPngOnLoadCallback(m,l,c,p,g,e,t))},m.onerror=e=>{this.boxInfo.current.innerHTML="Ooops. An error happened during exporting to png.",n(e)},m.src=g}))}var vr=i(1317);function jr(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(vr.log("Pozvan init history"),this.HISTORY.index=0,!e&&window.localStorage.getItem("history")&&window.localStorage.removeItem("history"),window.localStorage.getItem("history")&&"recovery"===e){let e=JSON.parse(window.localStorage.getItem("history"));this.load(e.length-1,"boot"),this.save("boot",!1)}}function Dr(){this.HISTORY=[],this.HISTORY.index=0,window.localStorage.removeItem("history")}function Tr(e,t){"set_name"===e&&(this.boxPlanName.current.innerHTML=t)}function Ir(e,t){for(let n in this.WALLS)null!=this.WALLS[n].child&&(this.WALLS[n].child=this.WALLS.indexOf(this.WALLS[n].child)),null!=this.WALLS[n].parent&&(this.WALLS[n].parent=this.WALLS.indexOf(this.WALLS[n].parent));for(let n=0;n<this.OBJDATA.length;n++)this.OBJDATA[n].up&&delete this.OBJDATA[n].up,this.OBJDATA[n].down&&delete this.OBJDATA[n].down;vr.log("OBJ DATA"),vr.log(this.OBJDATA);let i={objData:this.OBJDATA,wallData:this.WALLS,roomData:this.ROOM};const o=JSON.stringify(Xt(i));let s=[this.HISTORY[this.HISTORY.index-1],this.lastSavedObject];for(let n=0;n<s.length;n++)s[n]&&(s[n]=JSON.parse(s[n]),s[n]=Xt(s[n]),s[n]=JSON.stringify(s[n]));this.saveNeeded=!!s[1]&&o!==s[1],this.determineBoxPlanNameValue(this.saveNeeded?"save":"remove_asterisk");if(!(o!==s[0])){for(let e in this.WALLS)null!=this.WALLS[e].child&&(this.WALLS[e].child=this.WALLS[this.WALLS[e].child]),null!=this.WALLS[e].parent&&(this.WALLS[e].parent=this.WALLS[this.WALLS[e].parent]);return vr.log("Ne spremaj duplicirani HISTORY"),!1}t&&(this.boxInfo.current.innerHTML=""),e&&window.localStorage.removeItem("history"),this.HISTORY.index<this.HISTORY.length&&this.HISTORY.splice(this.HISTORY.index,this.HISTORY.length-this.HISTORY.index),_(i)||(vr.log("Resetiraj history"),this.resetHistory()),this.HISTORY.push(JSON.stringify(i)),vr.log("History IN SAVE:"),vr.log(this.HISTORY),window.localStorage.setItem("history",JSON.stringify(this.HISTORY)),this.HISTORY.index++;for(let n in this.WALLS)null!=this.WALLS[n].child&&(this.WALLS[n].child=this.WALLS[this.WALLS[n].child]),null!=this.WALLS[n].parent&&(this.WALLS[n].parent=this.WALLS[this.WALLS[n].parent]);return!0}function _r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.HISTORY.index,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=[];if(i)s=i;else{if(0===this.HISTORY.length&&!t)return!1;s=JSON.parse(window.localStorage.getItem("history")),s=JSON.parse(s[e])}vr.log("OBJ DATA IN LOAD"),vr.log(this.OBJDATA);for(let n in this.OBJDATA)this.OBJDATA[n].graph.remove();this.OBJDATA=[];for(let n in s.objData){let e=s.objData[n];e.hinge||(e.hinge="normal");let t=new Bo(e.family,e.class,e.type,{x:e.x,y:e.y},e.angle,e.angleSign,e.size,e.hinge,e.thick,e.value,e.additionalParams,this);t.id=e.id,t.limit=e.limit,this.OBJDATA.push(t),this.boxCarpentry.current.appendChild(this.OBJDATA[this.OBJDATA.length-1].graph),t.update(this),vr.log("End object"),vr.log(t)}this.WALLS=s.wallData,vr.log(this.WALLS);for(let n in this.WALLS)null!=this.WALLS[n].child&&(this.WALLS[n].child=this.WALLS[this.WALLS[n].child]),null!=this.WALLS[n].parent&&(this.WALLS[n].parent=this.WALLS[this.WALLS[n].parent]);if(this.ROOM=s.roomData,this.editor.architect(this.WALLS),!o){this.wallIdCounter=this.WALLS.length;for(let e=0;e<this.ROOM.length;e++)this.ROOM[e].id=e;this.roomIdCounter=this.ROOM.length}this.editor.showScaleBox(),this.rib()}function Lr(){return!(this.OBJDATA.length>0||this.WALLS.length>0||this.ROOM.length>0)}function Mr(){return 0===this.WALLS.length}class kr extends o.Component{constructor(){super(),this.update3DViewState=()=>{const e=this.props.mainComponentThis.floorplan3DComponent.current.HAEntityObjects.find((e=>e.entity_id===this.props.bindedEntity.entity_id));e&&e.update()},this.onSaveClick=()=>{this.simpleOnSaveHandlerBinded(this.props.mainComponentThis.floorplan3DComponent.current?this.update3DViewState:null)},this.state={edit:[],needsSave:!1,originalData:[],loading:!1},this.onStateValueChange=Qt.bind(this),this.onSaveClick=this.onSaveClick.bind(this),this.simpleOnSaveHandlerBinded=$t.bind(this),this.update3DViewState=this.update3DViewState.bind(this),this.callSaveAPI=ei.bind(this)}componentDidMount(){const e=Ue.map((e=>({...e,value:this.props.bindedEntity.params[e.field]})));this.setState({edit:e,originalData:e})}render(){const{edit:e,needsSave:t,loading:i}=this.state;return 0===e.length?null:(0,l.jsxs)(Ai,{containerClasses:"door-window-parameters-container",children:[(0,l.jsx)(yo,{labelText:"States",infoText:(0,l.jsxs)("span",{children:["Specify ",(0,l.jsx)("span",{style:{fontWeight:"bold"},children:oi(this.props.bindedEntity)})," sensor values which correspond to given states"]})}),e.map((e=>(0,l.jsx)(Hi,{containerStyle:{marginBottom:"0.5rem"},label:e.keepTextWidth?(0,l.jsx)(Co,{longText:e.longText,shortText:e.label}):e.label,value:e.value,labelClasses:"label-form-control-cancel",item:e,error:e.error,onChange:this.onStateValueChange},e.field))),(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsx)(hi,{disabled:!t,buttonType:t?"primary":"dull",spinnerColor:"#ffffff",buttonText:"Save",loading:i,spinnerLoading:!0,onClick:this.onSaveClick})})]})}}const Or=kr;var Rr=i(1317);class Pr extends o.Component{constructor(){super(),this.update3DViewState=()=>{const e=this.props.mainComponentThis.floorplan3DComponent.current.HAEntityObjects.find((e=>e.entity_id===this.props.bindedEntity.entity_id));e&&e.update()},this.onSaveClick=()=>{this.simpleOnSaveHandlerBinded(this.props.mainComponentThis.floorplan3DComponent.current?this.update3DViewState:null)},this.state={edit:[],needsSave:!1,originalData:[],loading:!1},this.onLightParameterValueChange=Qt.bind(this),this.simpleOnSaveHandlerBinded=$t.bind(this),this.onSaveClick=this.onSaveClick.bind(this),this.update3DViewState=this.update3DViewState.bind(this),this.callSaveAPI=ei.bind(this)}componentDidMount(){const e=Xe.map((e=>({...e,value:this.props.bindedEntity.params[e.field]})));this.setState({edit:e,originalData:e})}render(){const{edit:e,needsSave:t,loading:i}=this.state;Rr.log(e);const o=e.filter((e=>"switched_on_state"===e.field||"switched_off_state"===e.field)),s=e.find((e=>"power"===e.field)),n=e.find((e=>"color"===e.field));return 0===e.length?null:(Rr.log(n.value),(0,l.jsxs)(Ai,{containerClasses:"light-parameters-container",children:[(0,l.jsx)(yo,{labelText:"States",infoText:(0,l.jsxs)("span",{children:["Specify ",(0,l.jsx)("span",{style:{fontWeight:"bold"},children:oi(this.props.bindedEntity)})," light values which correspond to given states"]})}),o.map(((e,t)=>(0,l.jsx)(Hi,{containerStyle:{marginBottom:t===o.length-1?"1rem":"0.5rem"},label:e.keepTextWidth?(0,l.jsx)(Co,{longText:e.longText,shortText:e.label}):e.label,value:e.value,labelClasses:"label-form-control-cancel",item:e,error:e.error,onChange:this.onLightParameterValueChange},e.field))),(0,l.jsx)(Ai,{label:s.label,children:(0,l.jsx)(Di,{placeholder:s.placeholder,inputStep:s.step,inputMin:s.min,inputMax:s.max,usePropsValue:!0,value:s.value,onInputValueChanged:this.onLightParameterValueChange(s)})}),(0,l.jsx)(Ai,{label:n.label,children:(0,l.jsx)(Ni,{item:n,onChange:this.onLightParameterValueChange,boxContainer:bt()})}),(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsx)(hi,{disabled:!t,buttonType:t?"primary":"dull",spinnerColor:"#ffffff",buttonText:"Save",loading:i,spinnerLoading:!0,onClick:this.onSaveClick})})]}))}}const Fr=Pr;var Ar=i(1095);class Wr extends o.Component{render(){return(0,l.jsxs)("div",{className:"palette-color-container",children:[(0,l.jsxs)("div",{className:"content-container",children:[(0,l.jsx)(Hi,{containerStyle:{marginBottom:"0.5rem",justifyContent:"space-between"},label:this.props.valueFormItem.label,value:this.props.valueFormItem.value,labelClasses:"label-form-control-cancel",item:this.props.valueFormItem,error:this.props.valueFormItem.error,onChange:this.props.onChange}),(0,l.jsx)(Hi,{containerStyle:{margin:0,justifyContent:"space-between"},colorPickerBoxContainer:bt(),isColorInput:!0,label:this.props.colorFormItem.label,labelClasses:"label-form-control-cancel",item:this.props.colorFormItem,error:this.props.colorFormItem.error,onChange:this.props.onChange})]}),this.props.isRemovable&&(0,l.jsx)("div",{className:"options-container",children:this.props.isRemovable&&(0,l.jsx)("div",{title:"Delete color",className:"action-icon-container svg-center-inside-container",onClick:this.props.onDeletePaletteColorClick,children:(0,l.jsx)(Ar.Z,{})})})]})}}const Br=Wr;var Er=i(6302),Vr=i(1317);class Nr extends o.Component{constructor(e){super(),this.onAddIntermediateColorClick=()=>{this.props.addIntermediateColor(this.props.colorPaletteFormItem,this.intermediateColorsCount),this.intermediateColorsCount++},this.getMinMaxColorPaletteData=()=>({minValue:this.props.colorPaletteFormItem.find((e=>e.field.includes("min_value"))),minColor:this.props.colorPaletteFormItem.find((e=>e.field.includes("min_color"))),maxValue:this.props.colorPaletteFormItem.find((e=>e.field.includes("max_value"))),maxColor:this.props.colorPaletteFormItem.find((e=>e.field.includes("max_color")))}),this.paletteColorsValidation=()=>{const{minValue:e,minColor:t,maxValue:i,maxColor:o}=this.getMinMaxColorPaletteData(),s=[e,t,i,o];let n=!0;for(let h=0;h<s.length;h++)s[h].error="",s[h].validate(s[h].value)&&(s[h].error=s[h].validate(s[h].value),n=!1);const a=this.props.colorPaletteFormItem.find((e=>e.field.includes("intermediate_colors"))).value;if(a.forEach((e=>{e.form[0].error="",e.form[1].error=""})),!n)return n;Vr.log(e),Vr.log(i);const r=parseFloat(e.value),l=parseFloat(i.value);if(r>=l)return n=!1,e.error="Min value must be less than max",n;for(let h=0;h<a.length;h++)if(a[h].form[1].validate(a[h].form[1].value)&&(a[h].form[1].error=a[h].form[1].validate(a[h].form[1].value),n=!1),a[h].form[0].validate(a[h].form[0].value))a[h].form[0].error=a[h].form[0].validate(a[h].form[0].value),n=!1;else{const e=parseFloat(a[h].form[0].value);if(e>r&&e<l){const t=a[h-1],i=a[h+1];t&&e<=parseFloat(t.form[0].value)?(a[h].form[0].error="Value must be greater than predecessor value",Vr.log("Invalid 3"),n=!1):i&&e>=parseFloat(i.form[0].value)&&(a[h].form[0].error="Value must be less than successor value",Vr.log("Invalid 4"),n=!1)}else a[h].form[0].error="Value must be between min and max",Vr.log("Invalid 2"),n=!1}return n},this.updateColorPalette=()=>{if(Vr.log("updateColorPalette",this.paletteColorsIsValid),this.colorPaletteCanvas&&this.colorPaletteCanvas.current){const e=30,t=this.formContainerRef.current.offsetHeight;if(this.paletteColorsIsValid){this.colorPaletteCanvas.current.width=e,this.colorPaletteCanvas.current.height=t,this.paletteContainerRef.current.style.height=t+"px";const i=document.createElement("canvas");i.width=e,i.height=t;const o=i.getContext("2d"),s=o.createLinearGradient(e/2,0,e/2,t),n=this.props.colorPaletteFormItem.find((e=>e.field.includes("intermediate_colors"))).value,{minValue:a,minColor:r,maxValue:l,maxColor:h}=this.getMinMaxColorPaletteData();let c={0:r.value};n.forEach((e=>{Vr.log((e.form[0].value-a.value)/(l.value-a.value)),c[(e.form[0].value-a.value)/(l.value-a.value)]=e.form[1].value})),c["1.0"]=h.value;for(const e in c)s.addColorStop(e,c[e]);Vr.log("canvasLinearGradientColorStops",c),o.fillStyle=s,o.fillRect(0,0,e,t);const d=this.colorPaletteCanvas.current.getContext("2d");d.fillStyle=s,d.fillRect(0,0,e,t)}else{this.colorPaletteCanvas.current.getContext("2d").clearRect(0,0,e,t)}}},this.intermediateColorsCount=e.colorPaletteFormItem.find((e=>e.field.includes("intermediate_colors"))).value.length,this.paletteColorsIsValid=!1,this.colorPaletteCanvas=o.createRef(),this.formContainerRef=o.createRef(),this.paletteContainerRef=o.createRef(),this.onAddIntermediateColorClick=this.onAddIntermediateColorClick.bind(this),this.getMinMaxColorPaletteData=this.getMinMaxColorPaletteData.bind(this),this.paletteColorsValidation=this.paletteColorsValidation.bind(this),this.updateColorPalette=this.updateColorPalette.bind(this)}componentDidMount(){this.updateColorPalette()}componentDidUpdate(){this.updateColorPalette()}render(){const{minValue:e,minColor:t,maxValue:i,maxColor:o}=this.getMinMaxColorPaletteData();return this.paletteColorsIsValid=this.paletteColorsValidation(),(0,l.jsxs)("div",{className:"color-palette-maker-container",style:this.props.containerStyle||{},children:[(0,l.jsxs)("div",{ref:this.formContainerRef,className:"form-container",children:[(0,l.jsx)(Br,{valueFormItem:e,colorFormItem:t,onChange:this.props.onChange}),this.props.colorPaletteFormItem.find((e=>e.field.includes("intermediate_colors"))).value.map(((e,t)=>(0,l.jsx)(Br,{valueFormItem:e.form[0],colorFormItem:e.form[1],onChange:this.props.onChange,isRemovable:!0,onDeletePaletteColorClick:()=>this.props.removeIntermediateColor(this.props.colorPaletteFormItem,e.counter),moveDown:!0,moveUp:!0},t))),(0,l.jsxs)("div",{className:"line-divider-container",children:[(0,l.jsx)("hr",{}),(0,l.jsx)("div",{className:"svg-center-inside-container",title:"Add color",onClick:this.onAddIntermediateColorClick,children:(0,l.jsx)(Er.Z,{})}),(0,l.jsx)("hr",{})]}),(0,l.jsx)(Br,{valueFormItem:i,colorFormItem:o,onChange:this.props.onChange})]}),(0,l.jsx)("div",{ref:this.paletteContainerRef,className:"palette-container",children:(0,l.jsx)("canvas",{ref:this.colorPaletteCanvas})})]})}}const zr=Nr;class Hr extends o.Component{componentDidUpdate(){this.props.disableRangeChoice&&"range"===this.props.coloringOptionFormItem.value&&this.props.onChange(this.props.coloringOptionFormItem)("")}render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(Pi,{formGroupContainerStyle:{marginBottom:"0.5rem"},rightLabel:!0,item:{...this.props.coloringOptionFormItem,choices:[this.props.coloringOptionFormItem.choices[0]]},onChange:this.props.onChange}),this.props.coloringOptionFormItem.choices[0].value===this.props.coloringOptionFormItem.value&&(0,l.jsx)(Ni,{item:this.props.coloringOptionFormItem.choices[0].form[0],onChange:this.props.onChange,boxContainer:bt(),containerStyle:{marginBottom:"0.5rem"}}),(0,l.jsx)(Pi,{formGroupContainerStyle:{marginBottom:"0.5rem"},disabled:this.props.disableRangeChoice,rightLabel:!0,item:{...this.props.coloringOptionFormItem,choices:[this.props.coloringOptionFormItem.choices[1]]},onChange:this.props.onChange}),this.props.coloringOptionFormItem.choices[1].value===this.props.coloringOptionFormItem.value&&(0,l.jsx)(zr,{ref:this.props.colorPaletteMakerRef,containerStyle:{marginBottom:"0.5rem"},colorPaletteFormItem:this.props.coloringOptionFormItem.choices[1].form,onChange:this.props.onChange,addIntermediateColor:this.props.addIntermediateColor,removeIntermediateColor:this.props.removeIntermediateColor}),(0,l.jsx)(Hi,{containerStyle:{marginBottom:"0.5rem"},isNumberInput:this.props.opacityItem.isNumberInput,controledNumberInput:!!this.props.opacityItem.isNumberInput||null,label:this.props.opacityItem.keepTextWidth?(0,l.jsx)(Co,{longText:this.props.opacityItem.longText,shortText:this.props.opacityItem.label}):this.props.opacityItem.label,value:this.props.opacityItem.value,labelClasses:"label-form-control-cancel",item:this.props.opacityItem,error:this.props.opacityItem.error,onChange:this.props.onChange})]})}}const Gr=Hr;var qr=i(1317);class Yr extends o.Component{constructor(){super(),this.update3DViewState=()=>{const e=this.props.mainComponentThis.floorplan3DComponent.current.HAEntityObjects.find((e=>e.entity_id===this.props.bindedEntity.entity_id));e&&e.update()},this.addIntermediateColor=(e,t)=>{e.find((e=>e.field.includes("intermediate_colors"))).value.push(Ke(t)),this.forceUpdate()},this.removeIntermediateColor=(e,t)=>{e.find((e=>e.field.includes("intermediate_colors"))).value.splice(e.find((e=>e.field.includes("intermediate_colors"))).value.findIndex((e=>e.counter===t)),1),this.forceUpdate()},this.onSaveClick=()=>{let e=!1;if(this.setState({edit:this.state.edit.map((t=>{const i=t.validate&&t.validate(t.value);return i&&(e=!0),t.form?{...t,error:i,form:t.form.map((i=>{const o=i.validate&&i.validate(i.value);return o&&(e=!0),i.formChoices?{...i,error:o,choices:i.choices.map((o=>{if("range"===o.value){if("range"===i.value){const i="background"===t.field?this.sensorBackgroundOptionColorPaletteRef:this.sensorTextColorPaletteRef;e=i.current&&!i.current.paletteColorsValidation()}return{...o}}return{...o,form:o.form.map((t=>{const i=t.validate&&t.validate(t.value);return i&&(e=!0),{...t,error:i}}))}}))}:{...i,error:o}}))}:{...t,error:i}}))}),qr.log("On save isInvalid",e),!e){let e=[...this.props.mainComponentThis.klet3DLastSavedData],t=e.find((e=>e.entity_id===this.props.bindedEntity.entity_id));t&&(t.params={},this.state.edit.forEach((e=>{e.form?(t.params[e.field]={},t.params[e.field].checked=e.value,e.form.forEach((i=>{t.params[e.field][i.field]=void 0===i.value?null:i.value,i.formChoices&&i.choices.forEach((i=>{i.form.forEach((i=>{Array.isArray(i.value)?(t.params[e.field][i.field]=[],i.value.forEach((o=>{t.params[e.field][i.field].push({value:o.form.find((e=>e.field.includes("intermediate_color_value"))).value,color:o.form.find((e=>e.field.includes("intermediate_color_color"))).value})}))):t.params[e.field][i.field]=i.value}))}))}))):t.params[e.field]=e.value})),qr.log("Target entity data",t),this.callSaveAPI(t,e,this.props.mainComponentThis.floorplan3DComponent.current?this.update3DViewState:null))}},this.onSensorParameterChange=e=>t=>{const i=t&&t.target?t.target.value:t;qr.log("On sensor parameter change",e,i);const o=this.state.edit.map((t=>t.field===e.field?(qr.log("Target find"),{...t,value:i}):t.form?{...t,form:t.form.map((t=>t.field===e.field?(qr.log("Target find"),{...t,value:i}):t.formChoices?{...t,choices:t.choices.map((t=>({...t,form:t.form.map((t=>t.field===e.field?(qr.log("Target find"),{...t,value:i}):Array.isArray(t.value)?{...t,value:t.value.map((t=>t.form?{...t,form:t.form.map((t=>({...t,value:t.field===e.field?i:t.value})))}:{...t}))}:{...t}))})))}:{...t}))}:{...t}));this.setState({edit:o,needsSave:H(o,this.state.originalData)})},this.onSensorCheckboxParameterChange=e=>()=>{const t=this.state.edit.map((t=>t.field===e.field?{...t,value:!t.value,form:t.form.map((e=>({...e,value:e.field.includes("_coloring_type")&&t.value?"":e.value})))}:{...t}));this.setState({edit:t,needsSave:H(t,this.state.originalData)})},this.state={edit:[],needsSave:!1,originalData:[],loading:!1},this.sensorBackgroundOptionColorPaletteRef=o.createRef(),this.sensorTextColorPaletteRef=o.createRef(),this.onSaveClick=this.onSaveClick.bind(this),this.callSaveAPI=ei.bind(this),this.onSensorParameterChange=this.onSensorParameterChange.bind(this),this.onSensorCheckboxParameterChange=this.onSensorCheckboxParameterChange.bind(this),this.addIntermediateColor=this.addIntermediateColor.bind(this),this.removeIntermediateColor=this.removeIntermediateColor.bind(this),this.update3DViewState=this.update3DViewState.bind(this)}componentDidMount(){const e=Je.map((e=>e.form?{...e,value:this.props.bindedEntity.params[e.field].checked,form:e.form.map((t=>t.formChoices?{...t,value:this.props.bindedEntity.params[e.field][t.field],choices:t.choices.map((t=>({...t,form:t.form.map((t=>Array.isArray(this.props.bindedEntity.params[e.field][t.field])?{...t,value:this.props.bindedEntity.params[e.field][t.field].map(((e,t)=>Ke(t,e.value,e.color)))}:{...t,value:this.props.bindedEntity.params[e.field][t.field]}))})))}:{...t,value:this.props.bindedEntity.params[e.field][t.field]}))}:{...e,value:this.props.bindedEntity.params[e.field]}));this.setState({edit:e,originalData:e})}render(){const{needsSave:e,loading:t,edit:i}=this.state;qr.log(i);const s=i.find((e=>"sensor_type"===e.field)),n=i.find((e=>"background"===e.field)),a=i.find((e=>"text"===e.field));return 0===i.length?null:(0,l.jsxs)("div",{className:"sensor-parameters-container",children:[(0,l.jsx)(Ai,{children:(0,l.jsx)(Pi,{rightLabel:!0,label:s.label,onChange:this.onSensorParameterChange,item:s,radioGroupContainerStyle:{justifyContent:"space-evenly"}})}),(0,l.jsxs)(Ai,{label:"Coloring",labelStyle:{marginBottom:0},children:[(0,l.jsx)(Oi,{infoLabel:!0,infoLabelTitle:n.label,infoText:n.infoText,explanationInfoBoxStyles:n.explanationInfoBoxStyles,checked:n.value,onChange:this.onSensorCheckboxParameterChange(n)}),!0===n.value&&(0,l.jsx)(Gr,{colorPaletteMakerRef:this.sensorBackgroundOptionColorPaletteRef,disableRangeChoice:"number"!==s.value,coloringOptionItem:n,coloringOptionFormItem:n.form[0],opacityItem:n.form.find((e=>"background_opacity"===e.field)),addIntermediateColor:this.addIntermediateColor,removeIntermediateColor:this.removeIntermediateColor,onChange:this.onSensorParameterChange}),(0,l.jsx)(Oi,{infoLabel:!0,infoLabelTitle:a.label,infoText:a.infoText,explanationInfoBoxStyles:a.explanationInfoBoxStyles,checked:a.value,onChange:this.onSensorCheckboxParameterChange(a)}),!0===a.value?(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(Gr,{colorPaletteMakerRef:this.sensorTextColorPaletteRef,disableRangeChoice:"number"!==s.value||"range"===n.form[0].value,coloringOptionItem:a,coloringOptionFormItem:a.form[0],opacityItem:a.form.find((e=>"text_opacity"===e.field)),addIntermediateColor:this.addIntermediateColor,removeIntermediateColor:this.removeIntermediateColor,onChange:this.onSensorParameterChange}),a.form.slice(-1).map((e=>(0,l.jsx)(Hi,{containerStyle:{marginBottom:"0.5rem"},isNumberInput:e.isNumberInput,controledNumberInput:!!e.isNumberInput||null,label:e.label,value:e.value,labelClasses:"label-form-control-cancel",item:e,error:e.error,onChange:this.onSensorParameterChange},e.field)))]}):null]}),(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsx)(hi,{disabled:!e,buttonType:e?"primary":"dull",spinnerColor:"#ffffff",buttonText:"Save",loading:t,spinnerLoading:!0,onClick:this.onSaveClick})})]})}}const Ur=Yr;var Xr=i(1317);class Zr extends o.Component{constructor(){super(),this.update3DViewState=()=>{const e=this.props.mainComponentThis.floorplan3DComponent.current.HAEntityObjects.find((e=>e.entity_id===this.props.bindedEntity.entity_id));e&&e.update()},this.onSaveClick=()=>{this.simpleOnSaveHandlerBinded(this.props.mainComponentThis.floorplan3DComponent.current?this.update3DViewState:null)},this.state={edit:[],needsSave:!1,originalData:[],loading:!1},this.onParameterValueChange=Qt.bind(this),this.simpleOnSaveHandlerBinded=$t.bind(this),this.onSaveClick=this.onSaveClick.bind(this),this.update3DViewState=this.update3DViewState.bind(this),this.callSaveAPI=ei.bind(this)}componentDidMount(){Xr.log(Qe);const e=Qe.map((e=>({...e,value:this.props.bindedEntity.params[e.field]})));this.setState({edit:e,originalData:e})}render(){const{edit:e,needsSave:t,loading:i}=this.state;return Xr.log("HomeAssistantOtherHAEntityParameters",e),0===e.length?null:(0,l.jsxs)(Ai,{children:[(0,l.jsx)(yo,{labelText:"Text",infoText:(0,l.jsxs)("span",{children:["Define text preferences to display"," ",(0,l.jsx)("span",{style:{fontWeight:"bold"},children:oi(this.props.bindedEntity)})," entity state value"]})}),e.map((e=>(0,l.jsx)(Hi,{containerStyle:{marginBottom:"0.5rem"},isNumberInput:e.isNumberInput,controledNumberInput:!!e.isNumberInput||null,isColorInput:e.isColorInput,colorPickerBoxContainer:e.isColorInput&&bt(),label:e.keepTextWidth?(0,l.jsx)(Co,{longText:e.longText,shortText:e.label}):e.label,value:e.value,labelClasses:"label-form-control-cancel",item:e,error:e.error,onChange:this.onParameterValueChange},e.field))),(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsx)(hi,{disabled:!t,buttonType:t?"primary":"dull",spinnerColor:"#ffffff",buttonText:"Save",loading:i,spinnerLoading:!0,onClick:this.onSaveClick})})]})}}const Kr=Zr;class Jr extends o.Component{constructor(e){super(),this.updateBindedEntityState=e=>{this.setState({bindedEntity:e})},this.state={bindedEntity:e.bindedEntity},this.updateBindedEntityState=this.updateBindedEntityState.bind(this)}render(){const{bindedEntity:e}=this.state;return(0,l.jsxs)(o.Fragment,{children:[this.props.renderDivider&&(0,l.jsx)("h3",{children:(0,l.jsx)("hr",{})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"Home Assistant"}),(0,l.jsxs)("div",{className:"door-window-ha-entities-binding-right-box-content-container",children:[(0,l.jsx)(Mi,{disabled:!0,label:"Entity",formGroupStyle:{marginBottom:"0.5rem"},inputStyle:{textAlign:"center"},value:e?oi(e):"-"}),(0,l.jsx)(ai,{type:"light-blue",onClick:()=>this.props.mainComponentThis.openHAEntitiesBindingPopup(this.props.selectedObj,e,this.props.floorplan3DThis,this.updateBindedEntityState),children:e?"Change entity":"Add entity"})]}),e&&"doorWindow"===this.props.selectedObj.class&&(0,l.jsx)(Or,{bindedEntity:e,updateBindedEntityState:this.updateBindedEntityState,setResponseError:this.props.setResponseError,mainComponentThis:this.props.mainComponentThis}),e&&"lights"===this.props.selectedObj.class&&(0,l.jsx)(Fr,{bindedEntity:e,updateBindedEntityState:this.updateBindedEntityState,setResponseError:this.props.setResponseError,mainComponentThis:this.props.mainComponentThis}),e&&"sensors"===this.props.selectedObj.class&&(0,l.jsx)(Ur,{bindedEntity:e,updateBindedEntityState:this.updateBindedEntityState,setResponseError:this.props.setResponseError,mainComponentThis:this.props.mainComponentThis}),e&&"homeAssistant"===this.props.selectedObj.class&&(0,l.jsx)(Kr,{bindedEntity:e,updateBindedEntityState:this.updateBindedEntityState,setResponseError:this.props.setResponseError,mainComponentThis:this.props.mainComponentThis})]})]})}}const Qr=Jr;var $r=i(7267),el=i(7575);const tl=class{constructor(e,t,i,o){if(this.entity_id=e,this.objID=t,this.params={},i&&(s=i,0!==Object.keys(s).length))this.params=i;else if(this.objID.length>0){let e=o.OBJDATA.find((e=>e.id===this.objID[0]));e&&Ye[e.class]&&(this.params=Ye[e.class])}var s}};var il=i(1317);class ol extends o.Component{constructor(e){super(),this.closePopup=()=>{this.props.floorplan3DThis&&this.props.floorplan3DThis.userInteractionCurrentController.setSelectedObject(null),at(this.props.containerRef.current,200,(()=>{s.unmountComponentAtNode(this.props.containerRef.current)}),!1)},this.handleEntityCheckboxClick=e=>{const t=this.state.selectedEntity&&this.state.selectedEntity.entity_id===e.entity_id?null:e;let i=!1;i=this.state.initialBindedEntity?!t||t.entity_id!==this.state.initialBindedEntity.entity_id:!!t,this.setState({selectedEntity:t,needsSave:i})},this.handlePageChange=(e,t)=>{this.setState({currentPage:t})},this.updateSelectedEntityData=e=>{const t=this.props.mainComponentThis.homeAssistantEntities.find((e=>e.entity_id===this.state.selectedEntity.entity_id));if(t){const i=e.find((e=>e.entity_id===this.state.selectedEntity.entity_id));i?i.objID.push(this.props.obj2D.id):e.push(new tl(t.entity_id,[this.props.obj2D.id],null,this.props.mainComponentThis))}},this.onSaveChangesClick=()=>{this.setState({loading:!0});let e=this.props.mainComponentThis.klet3DLastSavedData.map((e=>({...e})));if(this.state.initialBindedEntity){const t=e.find((e=>e.entity_id===this.state.initialBindedEntity.entity_id));t&&(t.objID=t.objID.filter((e=>e!==this.props.obj2D.id))),this.state.selectedEntity&&this.updateSelectedEntityData(e),e=e.filter((e=>e.objID.length>0))}else{if(!this.state.selectedEntity)return void this.closePopup();this.updateSelectedEntityData(e)}C.post.call(this,"/klet3d/entity/".concat(this.props.mainComponentThis.props.floorplanID,"/").concat(this.props.mainComponentThis.props.licenseKey),{entitydata:e},(t=>{if(il.log("Klet post API response"),il.log(t),this.props.mainComponentThis.klet3DLastSavedData=e,this.props.floorplan3DThis){for(let i=0;i<e.length;i++){const t=this.props.mainComponentThis.homeAssistantEntities.find((t=>t.entity_id===e[i].entity_id));if(t){const o=$e[ti(t)];let s=this.props.floorplan3DThis.HAEntityObjects.find((t=>t.entity_id===e[i].entity_id));if(s){let n=[];for(let t=0;t<s.bindedObjects.length;t++)e[i].objID.includes(s.bindedObjects[t].object2D.id)||n.push(t);n.sort(((e,t)=>t-e));for(let e=0;e<n.length;e++)il.log("removeBindedObject"),s.removeBindedObject(s.bindedObjects[n[e]]);for(let a=0;a<e[i].objID.length;a++)if(!s.bindedObjects.find((t=>t.object2D.id===e[i].objID[a])))if(o){let t;for(let o=0;o<this.props.floorplan3DThis.floorplan3DViewScene.children.length;o++)if(this.props.floorplan3DThis.floorplan3DViewScene.children[o].object2D&&this.props.floorplan3DThis.floorplan3DViewScene.children[o].object2D.id===e[i].objID[a]){t=this.props.floorplan3DThis.floorplan3DViewScene.children[o];break}il.log("addBindedObject fixed"),t&&s.addBindedObject(t)}else{let o,n={};for(let t=0;t<this.props.floorplan3DThis.floorplanFloors.length;t++)if(o=this.props.floorplan3DThis.floorplanFloors[t].objData.find((t=>t.id===e[i].objID[a])),o){n={obj2D:o,floorNumber:this.props.floorplan3DThis.floorplanFloors[t].floorNumber};break}il.log("addBindedObject unfixed"),s.addBindedObject(ii(t,n),!0)}}else this.props.floorplan3DThis.addHAEntityObject(e[i],t)}}let t=[];for(let i=0;i<this.props.floorplan3DThis.HAEntityObjects.length;i++)e.find((e=>e.entity_id===this.props.floorplan3DThis.HAEntityObjects[i].entity_id))||t.push(i);t.sort(((e,t)=>t-e));for(let e=0;e<t.length;e++)il.log("Remove ha entity object",this.props.floorplan3DThis.HAEntityObjects[t[e]]),this.props.floorplan3DThis.HAEntityObjects[t[e]].remove(),this.props.floorplan3DThis.HAEntityObjects.splice(t[e],1);this.props.floorplan3DThis.updateHAControlPanelState()}this.props.updateBindedEntityState&&this.props.updateBindedEntityState(e.find((e=>e.objID.includes(this.props.obj2D.id)))),this.closePopup()}))},this.handleSearchChange=e=>{if(e){const t=this.props.availableEntities.filter((t=>oi(t).toLowerCase().includes(e.toLowerCase())||t.entity_id.split(".")[1].toLowerCase().includes(e.toLowerCase())));this.setState({searchFilteredData:t,currentPage:1,searchFilterText:e})}else this.setState({searchFilteredData:this.props.availableEntities,currentPage:1,searchFilterText:e})},this.state={initialBindedEntity:null,selectedEntity:null,currentPage:1,rowsPerPage:10,searchFilteredData:e.availableEntities,needsSave:!1,loading:!1},this.mounted=!1,this.closePopup=this.closePopup.bind(this),this.updateSelectedEntityData=this.updateSelectedEntityData.bind(this),this.onSaveChangesClick=this.onSaveChangesClick.bind(this),this.handleEntityCheckboxClick=this.handleEntityCheckboxClick.bind(this),this.handlePageChange=this.handlePageChange.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this)}componentDidMount(){this.mounted=!0,this.setState({initialBindedEntity:this.props.bindedEntity,selectedEntity:this.props.bindedEntity})}componentWillUnmount(){this.mounted=!1}render(){const{selectedEntity:e,currentPage:t,rowsPerPage:i,searchFilteredData:o,searchFilterText:s,needsSave:n,loading:a}=this.state,{pageFirstRowIndex:r,pageLastRowIndex:h}=((e,t,i)=>{const o=(e-1)*t;return{pageFirstRowIndex:o,pageLastRowIndex:o+t>i?i:o+t}})(t,i,this.props.availableEntities.length),c=o.slice(r,h);return(0,l.jsx)(_i,{onCloseModalClick:this.closePopup,children:(0,l.jsxs)("section",{className:"layout__section door-window-ha-entities-binding-popup-content-container",style:{height:"auto",maxHeight:"85vh"},children:[(0,l.jsxs)("div",{className:"table-responsive form-group",children:[(0,l.jsxs)("div",{className:"search-row-container",children:[(0,l.jsx)("h2",{children:"Available Home Assistant entities"}),(0,l.jsxs)("div",{className:"search-entities-container",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"hidden-placeholder",children:"Search entities"}),(0,l.jsx)("input",{placeholder:"Search entities",className:"form-control input",value:s,onChange:e=>this.handleSearchChange(e.target.value)})]}),(0,l.jsx)("div",{className:"search-icon-container",children:(0,l.jsx)(el.Z,{})})]})]}),(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"#"}),(0,l.jsx)("th",{}),(0,l.jsx)("th",{children:"ID"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Domain"}),(0,l.jsx)("th",{children:"Last change"}),(0,l.jsx)("th",{children:"Last update"})]})}),(0,l.jsx)("tbody",{children:c.length>0?c.map(((t,i)=>{const o=this.props.mainComponentThis.klet3DLastSavedData.find((e=>e.entity_id===t.entity_id));let s=0;return o&&(s=o.objID.filter((e=>e!==this.props.obj2D.id)).length),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:r+i+1}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"entity-binding-option-choice-container",children:[(0,l.jsx)(Oi,{checked:!!e&&e.entity_id===t.entity_id,onChange:()=>this.handleEntityCheckboxClick(t)}),s>0&&(0,l.jsx)(wi,{explanationInfoBoxStyles:{textAlign:"left"},infoText:(0,l.jsxs)("span",{children:[(0,l.jsx)("span",{style:{fontWeight:"bold"},children:"NOTE:"})," This entity is binded with"," ",(0,l.jsx)("span",{children:s})," more floorplan\xa0",(0,l.jsx)("span",{children:1===s?"object":"objects"})]})})]})}),(0,l.jsx)("td",{children:t.entity_id.split(".")[1]}),(0,l.jsx)("td",{children:oi(t)}),(0,l.jsx)("td",{children:t.domain}),(0,l.jsx)("td",{children:A(new Date(t.last_changed))}),(0,l.jsx)("td",{children:A(new Date(t.last_updated))})]},t.entity_id)})):(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:7,children:"No entities found"})})})]}),(0,l.jsx)($r.Z,{className:"table-pagination",count:Math.ceil(o.length/i),page:t,onChange:this.handlePageChange})]}),(0,l.jsx)("div",{className:"button-centered-container",children:(0,l.jsx)(hi,{disabled:!n,buttonType:n?"primary":"dull",spinnerColor:"#ffffff",buttonText:" Save changes",loading:a,spinnerLoading:!0,onClick:this.onSaveChangesClick})})]})})}}const sl=ol;var nl=i(1317);function al(e,t){let i,o;if(e.touches){let t=e.changedTouches;i=t[0].pageX,o=t[0].pageY}else i=e.pageX,o=e.pageY;let s,n,a=(i-this.offset.left)*this.zoomFactor+this.originX_viewbox,r=(o-this.offset.scrollY-this.offset.top)*this.zoomFactor+this.originY_viewbox;return"on"===t&&(s=Math.round(a/this.grid)*this.grid,n=Math.round(r/this.grid)*this.grid),"off"===t&&(s=a,n=r),{x:s,y:n,xMouse:a,yMouse:r}}function rl(e,t){return{screenX:(e-this.originX_viewbox)/this.zoomFactor+this.offset.left,screenY:(t-this.originY_viewbox)/this.zoomFactor+this.offset.scrollY+this.offset.top}}function ll(e){this.linRef.current.style.cursor=e}function hl(){let e=bt();nl.log("Queried element"),nl.log(e),e&&(e!==this.floorplanImageTools.current?e.querySelector(".close-rightBox").click():this.uploadFloorplanImageToolsRef.current.onInsertFlorplanImageClose(null,!0))}function cl(e,t,i){i?e.classList.add("active"):e.classList.remove("active"),this.isSmallScreen()&&this.isPanelMaximized()&&this.onPanelControlClick(),this.isSmallScreen()||(this.rightControlsBox.current.style.transform="translateX(".concat(i?t-150:-150,"px)")),e.style.transform="translateX(".concat(t,"px)")}function dl(e,t,i,o,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,a=[];if(a.params={},a.params.bindBox=!1,a.params.move=!1,a.params.resize=!1,a.params.resizeLimit={},a.params.resizeLimit.width={min:!1,max:!1},a.params.resizeLimit.height={min:!1,max:!1},a.params.rotate=!1,"onWall"===e&&(a.params.onWallOffsetAngle=0),"socle"===t&&a.push({path:"M "+-o/2+","+-s/2+" L "+-o/2+","+s/2+" L "+o/2+","+s/2+" L "+o/2+","+-s/2+" Z",fill:"#19ab7f",stroke:"#19ab7f",strokeDashArray:""}),"lights"===t){const e=-o/2,t=.5*-s,n=o/2,r=.5*s;"onWall"===he[_e[i].itemType]?(a.push({path:"M".concat(o/2," ").concat(-s/2," L").concat(o/2," ").concat(s/2," M").concat(e," ").concat(t," L").concat(n," ").concat(r," M").concat(e," ").concat(r," L").concat(n," ").concat(t),fill:"none",stroke:"#333",strokeDashArray:""}),a.params.bindBox=!0,a.params.onWallOffsetAngle=90):(a.params.bindBox=!0,a.params.move=!0,a.push({path:"M".concat(e," ").concat(t," L").concat(n," ").concat(r," M").concat(e," ").concat(r," L").concat(n," ").concat(t),fill:"none",stroke:"#333",strokeDashArray:""})),a.params.width=o,a.params.height=s}if("furniture"===t)if(a.params.bindBox=!0,a.params.move=!0,a.params.resize=!0,a.params.rotate=!0,qt(i)){a.push({path:"M "+-o/2+","+-s/2+" L "+-o/2+","+s/2+" L "+o/2+","+s/2+" L "+o/2+","+-s/2+" Z",fill:"#fff",stroke:"#333",strokeDashArray:""});const e=s/n;for(var r=1;r<n+1;r++)a.push({path:"M "+-o/2+","+(-s/2+r*e)+" L "+o/2+","+(-s/2+r*e),fill:"none",stroke:"#333",strokeDashArray:"none"})}else a.push({path:"M "+-o/2+","+-s/2+" L "+-o/2+","+s/2+" L "+o/2+","+s/2+" L "+o/2+","+-s/2+" Z",fill:"#eeeeee",stroke:"#cccccc",strokeDashArray:""});return"homeAssistant"===t&&"other_entity"===i&&(a.params.bindBox=!0,a.params.move=!0,a.params.resize=!1,a.params.rotate=!1,a.push({path:this.qSVG.circlePath(0,0,o),fill:"#fff",stroke:"#333",strokeDashArray:""})),"sensors"===t&&"sensor"===i&&(a.params.bindBox=!0,a.params.move=!0,a.params.resize=!1,a.params.rotate=!1,a.push({path:"M "+-o/2+",0 L "+-o/4+","+-o*Math.sqrt(3)/4+" L "+o/4+","+-o*Math.sqrt(3)/4+" L "+o/2+",0 L "+o/4+","+o*Math.sqrt(3)/4+" L "+-o/4+","+o*Math.sqrt(3)/4+" Z",fill:"#fff",stroke:"#333",strokeDashArray:""})),"doorWindow"===t&&(Ht(i)&&(a.push({path:"M "+-o/2+","+-s/2+" L "+-o/2+","+s/2+" L "+o/2+","+s/2+" L "+o/2+","+-s/2+" Z",fill:"#ccc",stroke:"none",strokeDashArray:""}),a.push({path:"M "+-o/2+","+-s/2+" L "+-o/2+","+(-o-s/2)+"  A"+o+","+o+" 0 0,1 "+o/2+","+-s/2,fill:"none",stroke:this.colorWall,strokeDashArray:""}),a.params.resize=!0,a.params.resizeLimit.width={min:this.doorWidthMinValue,max:this.doorWidthMaxValue}),zt(i)&&(a.push({path:"M "+-o/2+",-2 L "+-o/2+",2 L "+o/2+",2 L "+o/2+",-2 Z",fill:"#ccc",stroke:"none",strokeDashArray:""}),a.push({path:"M "+-o/2+","+-s/2+" L "+-o/2+","+s/2+" M "+o/2+","+s/2+" L "+o/2+","+-s/2,fill:"none",stroke:"#ccc",strokeDashArray:""}),a.params.resize=!0,a.params.resizeLimit.width={min:this.windowWidthMinValue,max:this.windowWidthMaxValue})),"measure"===t&&(a.params.bindBox=!0,a.push({path:"M-"+o/2+",0 l10,-10 l0,8 l"+(o-20)+",0 l0,-8 l10,10 l-10,10 l0,-8 l-"+(o-20)+",0 l0,8 Z",fill:"#729eeb",stroke:"none",strokeDashArray:""})),"boundingBox"===t&&a.push({path:"M"+(-o/2-10)+","+(-s/2-10)+" L"+(o/2+10)+","+(-s/2-10)+" L"+(o/2+10)+","+(s/2+10)+" L"+(-o/2-10)+","+(s/2+10)+" Z",fill:"none",stroke:"#aaa",strokeDashArray:""}),"text"===t&&(a.params.bindBox=!0,a.params.move=!0,a.params.rotate=!0,a.push({text:n.text,x:"0",y:"0",fill:i,stroke:i,fontSize:n.size+"px",strokeWidth:"0px"})),a}function pl(){bt()&&(this.hideActiveRightBox(),this.removeSelectedBinder())}function ml(){this.isSmallScreen()?(this.hideRightBox(),this.minimizePanel(this.smallScreenMinimizedPanelSize)):this.panel.current.style.width==="".concat(this.smallScreenMinimizedPanelSize,"px")?this.minimizePanel(this.bigScreenMinimizedPanelSize):this.panel.current.style.width==="".concat(this.smallScreenMaximizedPanelSize,"px")&&this.maximizePanel(this.bigScreenMaximizedPanelSize)}function ul(){if(this.isSmallScreen())this.rightControlsBox.current.style.transform="translateX(-150px)";else{const t=bt();this.rightControlsBox.current.style.transform="translateX(".concat(t?(e=t.style.transform,-parseFloat(e.replace(/[^\d.]/g,""))-150):-150,"px)")}var e}function gl(){return this.panel.current.style.width==="".concat(this.smallScreenMaximizedPanelSize,"px")||this.panel.current.style.width==="".concat(this.bigScreenMaximizedPanelSize,"px")}function fl(){return this.taille_w<this.smallScreenPixelSize}function bl(){return this.props.floorplanID}function xl(){let e=this.boxPlanName.current.innerHTML;return""===e||"Draft(not saved)"===e?null:"*"===e[e.length-1]?e.slice(0,e.length-1):e}function Cl(){this.linRef.current.setAttribute("viewBox",this.originX_viewbox+" "+this.originY_viewbox+" "+this.width_viewbox+" "+this.height_viewbox),this.gridSvgElementRef.current.setAttribute("viewBox",this.originX_viewbox+" "+this.originY_viewbox+" "+this.width_viewbox+" "+this.height_viewbox)}function wl(e,t,i){const{translateX:o,translateY:s}=Et(e,i),n=this.qSVG.create("none","path",{d:"M"+t.point2.x+" "+t.point2.y+" Q "+t.controlPoint.x+" "+t.controlPoint.y+" "+t.point1.x+" "+t.point1.y,"stroke-width":2,stroke:"#f00",fill:"transparent","marker-end":"url(#window-rotation-direction-arrow-triangle)"});return{svgGroupElement:this.qSVG.create("none","g",{transform:"translate(".concat(o,", ").concat(s,") rotate(").concat(e.angle+90,",0,0) scale(").concat("up"===i?1:-1,", 1)")}),curveArrowPath:n}}function yl(e){const t=e.additionalParams.rotationDirection||"up",i=e.additionalParams.rotationAxis||"start",o=Bt(i,t,e);e.additionalParams.rotationDirection=t,e.additionalParams.rotationAxis=i,e.additionalParams.curvePoints={point1:{x:o.curvePoint1X,y:o.curvePoint1Y},point2:{x:o.curvePoint2X,y:o.curvePoint2Y},controlPoint:{x:o.controlPointX,y:o.controlPointY}},e.additionalParams.controlPointOnWall={x:o.transformedControlPointOnWallCoordinates.x,y:o.transformedControlPointOnWallCoordinates.y},e.additionalParams.arrowControlPoint={x:o.transformedArrowControlPointCoordinates.x,y:o.transformedArrowControlPointCoordinates.y};const s=this.editor.rayCastingWall({x:e.x,y:e.y},!0);if(s){const t=e.angleSign;this.inWallonWallObjectBinderAngleCalculation(s,e.additionalParams.arrowControlPoint,e),e.additionalParams.arrowControlPointAngleSign=e.angleSign,e.angleSign=t}}function Sl(e,t,i){let o=this.qSVG.angleDeg(e.start.x,e.start.y,e.end.x,e.end.y),s=this.qSVG.vectorXY({x:e.start.x,y:e.start.y},{x:e.end.x,y:e.end.y}),n=this.qSVG.vectorXY({x:e.end.x,y:e.end.y},t),a=this.qSVG.vectorDeter(s,n);return i.angleSign=0,1===Math.sign(a)&&(i.angleSign=1,o+=180),o}function vl(e,t,i,o){let s=ft(e.equations.base,o.size,t);return!!(this.qSVG.btwn(s[0].x,e.start.x,e.end.x)&&this.qSVG.btwn(s[0].y,e.start.y,e.end.y)&&this.qSVG.btwn(s[1].x,e.start.x,e.end.x)&&this.qSVG.btwn(s[1].y,e.start.y,e.end.y))&&(o.x=t.x,o.y=t.y,o.angle=this.inWallonWallObjectBinderAngleCalculation(e,i,o),o.limit=s,("onWall"===o.family||o.obj&&"onWall"===o.obj.family)&&(o.obj?o.angle+=o.obj.params.onWallOffsetAngle:o.angle+=o.params.onWallOffsetAngle,o.additionalParams.onWallAngle=e.angle,o.additionalParams.onWallThick=e.thick),o.update(this),!0)}function jl(e,t){let i;if(i=this.editor.nearWall(this.snap)){let o=i.wall;this.cursor("crosshair"),this.binder?e&&this.inWallonWallObjectBinderJoinToWall(o,i,this.snap,this.binder):(this.binder=t(o,i),this.binder.angle=this.inWallonWallObjectBinderAngleCalculation(o,this.snap,this.binder),("onWall"===this.binder.family||this.binder.obj&&"onWall"===this.binder.obj.family)&&(this.binder.obj?this.binder.angle+=this.binder.obj.params.onWallOffsetAngle:this.binder.angle+=this.binder.params.onWallOffsetAngle,this.binder.additionalParams.onWallAngle=o.angle,this.binder.additionalParams.onWallThick=o.thick),this.binder.update(this),this.boxBind.current.appendChild(this.binder.graph))}else this.removeBinder()}function Dl(e,t,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const n=[{x:e.x-i,y:e.y-o},{x:e.x-i,y:e.y+o},{x:e.x+i,y:e.y+o},{x:e.x+i,y:e.y-o}];Vt(n,e,P(s));for(let a=0;a<t.length;a++)if(this.qSVG.polygonPolygonIntersect(n,t[a].coords))return!1;return!0}function Tl(e,t){let i="";i=Ht(e.type)?"Modify door":zt(e.type)?"Modify window":"lights"===e.class?"Modify light":"Modify furniture",this.wallItemToolsTitle.current.innerHTML=i,Ht(e.type)?nt(this.doorHinge.current,0):at(this.doorHinge.current,0),this.hideActiveRightBox(),this.translateRightBox(this.wallItemToolsRef.current,-this.rightBoxWidth,!0),this.setWallItemToolsValue(e,t)}function Il(e,t){let i="";"text"===e.class?(nt(this.freeItemTextToolsRef.current,0),i="Modify text"):(at(this.freeItemTextToolsRef.current,0),("lights"!==e.class||"free"!==e.family&&"floorFree"!==e.family)&&"furniture"!==e.class||(i="lights"!==e.class||"free"!==e.family&&"floorFree"!==e.family?"Modify furniture":"Modify light")),this.freeItemTitleRef.current.innerHTML=i,this.hideActiveRightBox(),this.translateRightBox(this.freeItemToolsRef.current,-this.rightBoxWidth,!0),this.setFreeItemToolsValue(e,t)}function _l(e,t){this.homeAssistantBindingsToolsTitle.current.innerHTML="sensor"===e.type?"Modify sensor":"Modify entity",this.hideActiveRightBox(),this.translateRightBox(this.homeAssistantBindingsToolsRef.current,-this.rightBoxWidth,!0),this.renderHAEntitiesBindingRightBox(e,t,this.HAEntitiesBindingHomeAssistantBindingsContainerRef,!1)}function Ll(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"centimeter",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inch";return At(parseFloat(e),this.context.userUnit,"metric"===this.context.userUnit?t:i,"meter",!0)*this.meter}function Ml(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"centimeter",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inch",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.itemDimensionsDecimalPrecision;return Ft(e/this.meter,this.context.userUnit,"meter","metric"===this.context.userUnit?t:i,o,!1,!1,!0)}function kl(e){const t=this.boxRoom.current.querySelector('[data-room-id="'.concat(this.selectedRoomId,'"]'));t&&t.setAttribute("fill","none"!==e?"url(#".concat(e,")"):"none")}function Ol(e){if(!this.binder)return this.foncButton("select_mode"),!1;this.binder.id=(0,Po.v4)(),this.OBJDATA.push(this.binder),this.binder.graph.remove(),this.boxCarpentry.current.appendChild(this.OBJDATA[this.OBJDATA.length-1].graph),this.binder=null,this.boxInfo.current.innerHTML=e,this.saveNeeded=!0,this.save(!1,!1)}function Rl(e,t,i,o){let n=this.klet3DLastSavedData.find((t=>t.objID.includes(e.id)));n&&(this.homeAssistantEntities.find((e=>e.entity_id===n.entity_id))||(n=null)),s.render((0,l.jsx)(Qr,{ref:this.HAEntitiesBindingRightBoxComponentRef,mainComponentThis:this,floorplan3DThis:t,bindedEntity:n,selectedObj:e,renderDivider:o,setResponseError:this.setState.bind(this)},(new Date).getTime()),i.current)}function Pl(e,t,i,o){nt(this.HAEntitiesBindingPopupRightBoxContainerRef.current,200,(()=>{s.render((0,l.jsx)(sl,{updateBindedEntityState:o,containerRef:this.HAEntitiesBindingPopupRightBoxContainerRef,bindedEntity:t,obj2D:e,availableEntities:this.homeAssistantEntities.filter((t=>qe[e.class].includes(t.domain))),floorplan3DThis:i,setResponseError:this.setState.bind(this),mainComponentThis:this}),this.HAEntitiesBindingPopupRightBoxContainerRef.current)}),"block",!1)}function Fl(e){return M(e.gps_latitude)?this.homeAssistantConfigObject?this.homeAssistantConfigObject.latitude:null:e.gps_latitude}function Al(e){return M(e.gps_longitude)?this.homeAssistantConfigObject?this.homeAssistantConfigObject.longitude:null:e.gps_longitude}var Wl=i(1317);function Bl(){Wl.log("Hide all size"),mt(this.boxBind.current),this.sizeText=[],this.showAllSizeStatus=0}function El(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Wl.log("In wall rib pozvan"),t||mt(this.boxRib.current);let i,o=[];o.push([]),o.push([]);let s,n=e.angle*(180/Math.PI),a=this.editor.objFromWall(e);o[0].push({wall:e,crossObj:!1,side:"up",coords:e.coords[0],distance:0}),o[1].push({wall:e,crossObj:!1,side:"down",coords:e.coords[1],distance:0});for(let r in a)s=a[r],s.up=[this.qSVG.nearPointOnEquation(e.equations.up,s.limit[0]),this.qSVG.nearPointOnEquation(e.equations.up,s.limit[1])],s.down=[this.qSVG.nearPointOnEquation(e.equations.down,s.limit[0]),this.qSVG.nearPointOnEquation(e.equations.down,s.limit[1])],i=Mt(e.coords[0],s.up[0])/this.meter,o[0].push({wall:s,crossObj:r,side:"up",coords:s.up[0],distance:i.toFixed(2)}),i=Mt(e.coords[0],s.up[1])/this.meter,o[0].push({wall:s,crossObj:r,side:"up",coords:s.up[1],distance:i.toFixed(2)}),i=Mt(e.coords[1],s.down[0])/this.meter,o[1].push({wall:s,crossObj:r,side:"down",coords:s.down[0],distance:i.toFixed(2)}),i=Mt(e.coords[1],s.down[1])/this.meter,o[1].push({wall:s,crossObj:r,side:"down",coords:s.down[1],distance:i.toFixed(2)});i=Mt(e.coords[0],e.coords[3])/this.meter,o[0].push({wall:s,crossObj:!1,side:"up",coords:e.coords[3],distance:i}),i=Mt(e.coords[1],e.coords[2])/this.meter,o[1].push({wall:s,crossObj:!1,side:"down",coords:e.coords[2],distance:i}),o[0].sort((function(e,t){return(e.distance-t.distance).toFixed(2)})),o[1].sort((function(e,t){return(e.distance-t.distance).toFixed(2)}));for(let r in o)for(let e=1;e<o[r].length;e++){let t=!0,i=-5,s=Math.abs(o[r][e-1].distance-o[r][e].distance),a=n;if(t){"down"===o[r][e-1].side&&(i=10-i),(a>89||a<-89)&&(a-=180,i="down"===o[r][e-1].side?-5:10-i),this.sizeText[e]=document.createElementNS("http://www.w3.org/2000/svg","text");let t=this.qSVG.middle(o[r][e-1].coords.x,o[r][e-1].coords.y,o[r][e].coords.x,o[r][e].coords.y);this.sizeText[e].setAttributeNS(null,"x",t.x),this.sizeText[e].setAttributeNS(null,"y",t.y+i),this.sizeText[e].setAttributeNS(null,"text-anchor","middle"),this.sizeText[e].setAttributeNS(null,"font-family","system-ui"),this.sizeText[e].setAttributeNS(null,"stroke","#ffffff"),this.sizeText[e].textContent=Ft(s,this.measureSystemContext.userUnit),this.sizeText[e].textContent<1?(this.sizeText[e].setAttributeNS(null,"font-size","0.8em"),this.sizeText[e].textContent=this.sizeText[e].textContent.substring(1,this.sizeText[e].textContent.length)):this.sizeText[e].setAttributeNS(null,"font-size","15px"),this.sizeText[e].setAttributeNS(null,"stroke-width","0.27px"),this.sizeText[e].setAttributeNS(null,"fill","#666666"),this.sizeText[e].setAttribute("transform","rotate("+a+" "+t.x+","+t.y+")"),this.boxRib.current.appendChild(this.sizeText[e])}}}function Vl(){let e,t,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,s=[];s.push([]),s.push([]);for(let n in this.WALLS)if(this.WALLS[n].equations.base){s[0].push([]),s[0][n].push({wallIndex:n,crossEdge:n,side:"up",coords:this.WALLS[n].coords[0],distance:0}),s[1].push([]),s[1][n].push({wallIndex:n,crossEdge:n,side:"down",coords:this.WALLS[n].coords[1],distance:0});for(let o in this.WALLS)n!==o&&this.WALLS[o].equations.base&&(i=Tt(this.WALLS[n].equations.base,this.WALLS[o].equations.base,"object"),this.qSVG.btwn(i.x,this.WALLS[n].start.x,this.WALLS[n].end.x,"round")&&this.qSVG.btwn(i.y,this.WALLS[n].start.y,this.WALLS[n].end.y,"round")&&(e=Tt(this.WALLS[n].equations.up,this.WALLS[o].equations.up,"object"),this.qSVG.btwn(e.x,this.WALLS[n].coords[0].x,this.WALLS[n].coords[3].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[n].coords[0].y,this.WALLS[n].coords[3].y,"round")&&this.qSVG.btwn(e.x,this.WALLS[o].coords[0].x,this.WALLS[o].coords[3].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[o].coords[0].y,this.WALLS[o].coords[3].y,"round")&&(t=Mt(this.WALLS[n].coords[0],e)/this.meter,s[0][n].push({wallIndex:n,crossEdge:o,side:"up",coords:e,distance:t.toFixed(2)})),e=Tt(this.WALLS[n].equations.up,this.WALLS[o].equations.down,"object"),this.qSVG.btwn(e.x,this.WALLS[n].coords[0].x,this.WALLS[n].coords[3].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[n].coords[0].y,this.WALLS[n].coords[3].y,"round")&&this.qSVG.btwn(e.x,this.WALLS[o].coords[1].x,this.WALLS[o].coords[2].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[o].coords[1].y,this.WALLS[o].coords[2].y,"round")&&(t=Mt(this.WALLS[n].coords[0],e)/this.meter,s[0][n].push({wallIndex:n,crossEdge:o,side:"up",coords:e,distance:t.toFixed(2)})),e=Tt(this.WALLS[n].equations.down,this.WALLS[o].equations.up,"object"),this.qSVG.btwn(e.x,this.WALLS[n].coords[1].x,this.WALLS[n].coords[2].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[n].coords[1].y,this.WALLS[n].coords[2].y,"round")&&this.qSVG.btwn(e.x,this.WALLS[o].coords[0].x,this.WALLS[o].coords[3].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[o].coords[0].y,this.WALLS[o].coords[3].y,"round")&&(t=Mt(this.WALLS[n].coords[1],e)/this.meter,s[1][n].push({wallIndex:n,crossEdge:o,side:"down",coords:e,distance:t.toFixed(2)})),e=Tt(this.WALLS[n].equations.down,this.WALLS[o].equations.down,"object"),this.qSVG.btwn(e.x,this.WALLS[n].coords[1].x,this.WALLS[n].coords[2].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[n].coords[1].y,this.WALLS[n].coords[2].y,"round")&&this.qSVG.btwn(e.x,this.WALLS[o].coords[1].x,this.WALLS[o].coords[2].x,"round")&&this.qSVG.btwn(e.y,this.WALLS[o].coords[1].y,this.WALLS[o].coords[2].y,"round")&&(t=Mt(this.WALLS[n].coords[1],e)/this.meter,s[1][n].push({wallIndex:n,crossEdge:o,side:"down",coords:e,distance:t.toFixed(2)}))));t=Mt(this.WALLS[n].coords[0],this.WALLS[n].coords[3])/this.meter,s[0][n].push({wallIndex:n,crossEdge:n,side:"up",coords:this.WALLS[n].coords[3],distance:t.toFixed(2)}),t=Mt(this.WALLS[n].coords[1],this.WALLS[n].coords[2])/this.meter,s[1][n].push({wallIndex:n,crossEdge:n,side:"down",coords:this.WALLS[n].coords[2],distance:t.toFixed(2)})}for(let n in s[0])s[0][n].sort((function(e,t){return(e.distance-t.distance).toFixed(2)}));for(let n in s[1])s[1][n].sort((function(e,t){return(e.distance-t.distance).toFixed(2)}));this.sizeText=[],5===o&&mt(this.boxRib.current);for(let n in s)for(let e in s[n])for(let t=1;t<s[n][e].length;t++)if(s[n][e][t-1].wallIndex===s[n][e][t].wallIndex){let i=!0,a=Math.abs(s[n][e][t-1].distance-s[n][e][t].distance);if(a<.15&&(i=!1),i&&s[n][e][t-1].crossEdge===s[n][e][t].crossEdge&&s[n][e][t].crossEdge!==s[n][e][t].wallIndex&&(i=!1),i&&s[n][e].length>2&&1===t){let o=[];for(let i=0;i<4;i++)o.push({x:this.WALLS[s[n][e][t].crossEdge].coords[i].x,y:this.WALLS[s[n][e][t].crossEdge].coords[i].y});jt(s[n][e][0].coords,o)&&(i=!1)}if(i&&s[n][e].length>2&&t===s[n][e].length-1){let o=[];for(let i=0;i<4;i++)o.push({x:this.WALLS[s[n][e][t-1].crossEdge].coords[i].x,y:this.WALLS[s[n][e][t-1].crossEdge].coords[i].y});jt(s[n][e][s[n][e].length-1].coords,o)&&(i=!1)}if(i){let i=this.WALLS[s[n][e][t].wallIndex].angle*(180/Math.PI),r=-o;"down"===s[n][e][t-1].side&&(r=10-r),(i>90||i<-89)&&(i-=180,r="down"===s[n][e][t-1].side?-o:10-r),this.sizeText[t]=document.createElementNS("http://www.w3.org/2000/svg","text");let l=this.qSVG.middle(s[n][e][t-1].coords.x,s[n][e][t-1].coords.y,s[n][e][t].coords.x,s[n][e][t].coords.y);this.sizeText[t].setAttributeNS(null,"x",l.x),this.sizeText[t].setAttributeNS(null,"y",l.y+r),this.sizeText[t].setAttributeNS(null,"text-anchor","middle"),this.sizeText[t].setAttributeNS(null,"font-family","roboto"),this.sizeText[t].setAttributeNS(null,"stroke","#ffffff"),this.sizeText[t].textContent=Ft(a,this.measureSystemContext.userUnit),this.sizeText[t].textContent<1?(this.sizeText[t].setAttributeNS(null,"font-size","0.73em"),this.sizeText[t].textContent=this.sizeText[t].textContent.substring(1,this.sizeText[t].textContent.length)):this.sizeText[t].setAttributeNS(null,"font-size","0.9em"),this.sizeText[t].setAttributeNS(null,"stroke-width","0.2px"),this.sizeText[t].setAttributeNS(null,"fill","#555555"),this.sizeText[t].setAttribute("transform","rotate("+i+" "+l.x+","+l.y+")"),this.boxRib.current.appendChild(this.sizeText[t])}}}function Nl(){this.lineIntersectionP&&(this.lineIntersectionP.remove(),this.lineIntersectionP=null)}function zl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],o={},s={};o.distance=t,this.lineIntersectionP&&(this.lineIntersectionP.remove(),this.lineIntersectionP=null),this.lineIntersectionP=this.qSVG.create(this.boxBind,"path",{d:"",stroke:"transparent","stroke-width":.5,"stroke-opacity":"1",fill:"none"});for(let n=0;n<this.WALLS.length;n++)if(-1===i.indexOf(this.WALLS[n])){let t,i=this.WALLS[n].start.x,a=this.WALLS[n].start.y,r=this.WALLS[n].end.x,l=this.WALLS[n].end.y;0===Math.abs(l-a)?(s.C="v",s.D=i,s.E="h",s.F=a,s.G="v",s.H=r,s.I="h",s.J=l):0===Math.abs(r-i)?(s.C="h",s.D=a,s.E="v",s.F=i,s.G="h",s.H=l,s.I="v",s.J=r):(s.C=(i-r)/(l-a),s.D=a-i*s.C,s.E=(l-a)/(r-i),s.F=a-i*s.E,s.G=(i-r)/(l-a),s.H=l-r*s.C,s.I=(l-a)/(r-i),s.J=l-r*s.E),s.A=s.C,s.B=s.D,t=this.qSVG.nearPointOnEquation(s,e),t.distance<o.distance&&(o.distance=t.distance,o.node=n,o.x=t.x,o.y=t.y,o.x1=i,o.y1=a,o.x2=r,o.y2=l,o.way=1),s.A=s.E,s.B=s.F,t=this.qSVG.nearPointOnEquation(s,e),t.distance<o.distance&&(o.distance=t.distance,o.node=n,o.x=t.x,o.y=t.y,o.x1=i,o.y1=a,o.x2=r,o.y2=l,o.way=1),s.A=s.G,s.B=s.H,t=this.qSVG.nearPointOnEquation(s,e),t.distance<o.distance&&(o.distance=t.distance,o.node=n,o.x=t.x,o.y=t.y,o.x1=i,o.y1=a,o.x2=r,o.y2=l,o.way=2),s.A=s.I,s.B=s.J,t=this.qSVG.nearPointOnEquation(s,e),t.distance<o.distance&&(o.distance=t.distance,o.node=n,o.x=t.x,o.y=t.y,o.x1=i,o.y1=a,o.x2=r,o.y2=l,o.way=2)}return o.distance<t&&(2===o.way?(this.lineIntersectionP.setAttribute("d","M"+o.x1+","+o.y1+" L"+o.x2+","+o.y2+" L"+o.x+","+o.y),this.lineIntersectionP.setAttribute("stroke","#d7ac57")):(this.lineIntersectionP.setAttribute("d","M"+o.x2+","+o.y2+" L"+o.x1+","+o.y1+" L"+o.x+","+o.y),this.lineIntersectionP.setAttribute("stroke","#d7ac57")),{x:o.x,y:o.y,wall:this.WALLS[o.node],distance:o.distance})}var Hl=i(5828);class Gl extends o.Component{constructor(){super(),this.onFloorplanItemModelClick=e=>{this.setState({selectedFloorplanItemModel:e}),this.props.onFloorplanItemSelectionCallback(e)},this.onFloorplanItemsCategorySelectClick=e=>{const t=e.target.textContent;this.setState({selectedCategory:t},(()=>{this.floorplanItemCategorySelectRef.current.closeDropdownMenu(),this.floorplanItemCategorySelectRef.current.setValue(t)}))},this.onFloorplanItemSearchInputChange=e=>{let t=[];t=""===e.target.value?this.props.items:this.props.items.map((t=>({...t,models:t.models.filter((i=>i.toLowerCase().includes(e.target.value.toLowerCase())||t.details[i].title.toLowerCase().includes(e.target.value.toLowerCase())))}))),this.setState({floorplanItemsFiltered:t,searchInputValue:e.target.value})},this.state={floorplanItemsFiltered:[],selectedFloorplanItemModel:null,searchInputValue:"",selectedCategory:"All"},this.floorplanItemCategorySelectRef=o.createRef(),this.onFloorplanItemModelClick=this.onFloorplanItemModelClick.bind(this),this.onFloorplanItemsCategorySelectClick=this.onFloorplanItemsCategorySelectClick.bind(this),this.onFloorplanItemSearchInputChange=this.onFloorplanItemSearchInputChange.bind(this)}componentDidMount(){this.setState({floorplanItemsFiltered:this.props.items,selectedFloorplanItemModel:this.props.initialSelectedItemModel,searchInputValue:"",selectedCategory:"All"},(()=>this.floorplanItemCategorySelectRef.current&&this.floorplanItemCategorySelectRef.current.setValue("All")))}render(){const{floorplanItemsFiltered:e,selectedFloorplanItemModel:t,searchInputValue:i,selectedCategory:o}=this.state,s="All"===o?e:[e.find((e=>e.title===o))];return(0,l.jsxs)("div",{className:"floorplan-items-container ".concat(this.props.containerClasses||""),children:[this.props.items.length>1&&(0,l.jsx)(Xi,{ref:this.floorplanItemCategorySelectRef,onListItemClick:this.onFloorplanItemsCategorySelectClick,listItems:["All",...Object.values(this.props.items).map((e=>e.title))]}),this.props.items.reduce(((e,t)=>e+t.models.length),0)>1&&(0,l.jsxs)("div",{className:"search-container",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"hidden-placeholder",children:"Search"}),(0,l.jsx)("input",{placeholder:"Search",className:"form-control input",value:i,onChange:this.onFloorplanItemSearchInputChange})]}),(0,l.jsx)("div",{className:"search-icon-container",children:(0,l.jsx)(el.Z,{})})]}),(0,l.jsx)("div",{className:"floorplan-items-data-container",children:s.map((e=>e.models.length>0&&(0,l.jsxs)("div",{className:"floorplan-item-data-container",children:[(0,l.jsx)("div",{className:"floorplan-item-category-label",children:e.title}),(0,l.jsx)("div",{className:"floorplan-item-models-selection-grid ".concat(this.props.gridContainerClasses||""),children:e.models.map((i=>(0,l.jsx)("div",{className:"selection-grid-item-card ".concat(t===i?"selected":""," ").concat(this.props.disabled?"disabled":""),onClick:()=>!this.props.disabled&&this.onFloorplanItemModelClick(i),children:(0,l.jsx)(Hl.LazyLoadImage,{alt:e.details[i].title,src:"https://app.klet3d.com/models3D/objMtl/thumbnails/".concat(Yt(i),"/").concat(i,".png"),placeholder:(0,l.jsx)("div",{className:"spinner-container",children:(0,l.jsx)(Zi,{center:!0,noMargin:!0,spinnerStyle:{width:14,height:14}})}),width:"100%",height:"100%",onLoad:()=>this.setState({["".concat(i,"_loaded")]:!0}),visibleByDefault:this.state["".concat(i,"_loaded")]})},i)))})]},e.title)))})]})}}const ql=Gl;class Yl extends o.Component{constructor(){super(),this.onItemClick=e=>t=>{this.setState({selectedItem:e}),this.props.onClickCallback&&this.props.onClickCallback(t,e)},this.setSelectedItem=e=>this.setState({selectedItem:e}),this.getSelectedItem=()=>this.state.selectedItem,this.state={selectedItem:null},this.onItemClick=this.onItemClick.bind(this),this.setSelectedItem=this.setSelectedItem.bind(this),this.getSelectedItem=this.getSelectedItem.bind(this)}render(){const{selectedItem:e}=this.state;return(0,l.jsx)("div",{className:"colors-textures-grid-container ".concat(this.props.isColor?"":"textures"),children:this.props.isColor?this.props.items.map((t=>(0,l.jsx)("div",{className:"selection-grid-item-card color textEditorColorModify ".concat(e===t.gradientStartColor?"selected":""," ").concat(this.props.disabled?"disabled":""),style:{color:t.gradientStartColor,background:"linear-gradient(30deg, ".concat(t.gradientStartColor,", ").concat(t.gradientStopColor,")")},onClick:this.props.disabled?void 0:this.onItemClick(t.gradientStartColor)},t.gradientStartColor))):this.props.items.map(((t,i)=>(0,l.jsx)("div",{className:"selection-grid-item-card ".concat(e===t?"selected":""," ").concat(this.props.disabled?"disabled":""),style:{backgroundImage:"none"===t?t:"/textures/".concat(t,".png")},onClick:this.props.disabled?void 0:this.onItemClick(t),children:"none"!==t&&(0,l.jsx)("img",{src:"https://app.klet3d.com/textures/".concat(t,".png")})},i)))})}}const Ul=Yl;class Xl extends o.Component{constructor(){super(),this.fontSizeNumberSliderInput=o.createRef(),this.modifyFontSizeSlider=o.createRef(),this.textColorsSelectionRef=o.createRef(),this.modifyTextContent=o.createRef()}componentDidMount(){this.props.textItemFontSizeValueRef.current.textContent=this.props.targetObject2D.value.size,this.modifyFontSizeSlider.current.value=this.props.targetObject2D.value.size,this.fontSizeNumberSliderInput.current.setNumberInputInitialValues(this.props.targetObject2D.value.size),this.modifyTextContent.current.value=this.props.targetObject2D.value.text,this.textColorsSelectionRef.current.setSelectedItem(this.props.targetObject2D.type),this.props.restoreSelectedBinderCall&&this.props.mainComponentThis.onModifyFontSizeChange(this.props.targetObject2D.value.size)}render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(pn,{ref:this.fontSizeNumberSliderInput,disabled:!0,sliderInputRef:this.modifyFontSizeSlider,valueLabelText:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(ms,{}),"Font size : ",(0,l.jsx)("span",{ref:this.props.textItemFontSizeValueRef})]}),sliderStep:.1,minValue:10,maxValue:70,onSliderValueChanged:this.props.mainComponentThis.onModifyFontSizeChange,onSliderChangeFinished:()=>{this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)}}),(0,l.jsx)(Mi,{disabled:!0,label:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(gs,{}),"Text content:"]}),labelStyle:{display:"flex",alignItems:"center"},inputRef:this.modifyTextContent,onChange:this.props.mainComponentThis.onModifyTextContentChange}),(0,l.jsx)(Ai,{labelStyle:{display:"flex",alignItems:"center"},label:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(bs,{}),"Text color:"]}),children:(0,l.jsx)(Ul,{ref:this.textColorsSelectionRef,disabled:!0,items:te,isColor:!0,onClickCallback:this.props.mainComponentThis.onModifyTextColorButonClick})})]})}}const Zl=Xl;class Kl extends o.Component{constructor(){super(),this.setRotationInputValues=e=>{this.itemRotationSlider.current.value=e,this.props.itemRotationValueRef.current.textContent=e,this.itemRotationNumberSliderInput.current.inputNumberComponentRef.current.setValue(e)},this.onRotationChange=e=>{let t=!0;"floorFree"===this.props.targetObject2D.family&&(t=this.props.mainComponentThis.floorFreeObjectPositionValidation({x:this.props.targetObject2D.x,y:this.props.targetObject2D.y},this.props.mainComponentThis.WALLS,this.props.targetObject2D.size/2,this.props.targetObject2D.thick/2,e)),t?(this.lastSavedAngleValue=e,this.props.mainComponentThis.setItemRotationAngle(e,this.props.targetObject2D),this.props.mainComponentThis.floorplan3DComponent.current&&this.props.mainComponentThis.floorplan3DComponent.current.rotateSelectedItem(),this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)):this.setRotationInputValues(this.lastSavedAngleValue)},this.itemRotationSlider=o.createRef(),this.itemRotationNumberSliderInput=o.createRef(),this.lastSavedAngleValue=null,this.setRotationInputValues=this.setRotationInputValues.bind(this),this.onRotationChange=this.onRotationChange.bind(this)}componentDidMount(){this.setRotationInputValues(this.props.targetObject2D.angle),this.itemRotationNumberSliderInput.current.setNumberInputInitialValues(this.props.targetObject2D.angle),this.lastSavedAngleValue=this.props.targetObject2D.angle,this.props.restoreSelectedBinderCall&&this.onRotationChange(this.props.targetObject2D.angle)}render(){return(0,l.jsx)(Ai,{children:(0,l.jsx)(pn,{ref:this.itemRotationNumberSliderInput,disabled:!0,sliderInputRef:this.itemRotationSlider,valueLabelText:(0,l.jsxs)("div",{style:{display:"flex"},children:[(0,l.jsx)(ds,{}),"Rotation:\xa0",(0,l.jsx)("span",{ref:this.props.itemRotationValueRef})," \xb0"]}),sliderStep:1,minValue:-180,maxValue:180,onSliderValueChanged:this.onRotationChange,onSliderChangeFinished:()=>{this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)}})})}}const Jl=Kl;class Ql extends o.Component{constructor(e){super(),this.saveChanges=(e,t,i,o,s)=>{const n=[this.props.targetObject2D];this.props.mainComponentThis.selectedBinder&&n.push(this.props.mainComponentThis.selectedBinder),n.forEach((e=>{t&&(e[t]=i),e.update(this.props.mainComponentThis)})),this.props.targetObject2D.additionalParams[e]=i,this[s]=o,this.props.mainComponentThis.floorplan3DComponent.current&&this.props.mainComponentThis.floorplan3DComponent.current.resizeSelectedItem(),this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)},this.onWidthChange=()=>e=>{const t=this.widthInputComponentRef.current.getValue(),i=e||this.props.mainComponentThis.convertValueToSvgUnits(t),o=90===this.props.targetObject2D.params.onWallOffsetAngle?"thick":"size";let s=!0;e||("inWall"===this.props.targetObject2D.family||"onWall"===this.props.targetObject2D.family?s=this.props.mainComponentThis.onWallItemWidthChange(i,this.props.targetObject2D,this.props.mainComponentThis.WALLS):"floorFree"===this.props.targetObject2D.family&&(s=this.props.mainComponentThis.floorFreeObjectPositionValidation({x:this.props.targetObject2D.x,y:this.props.targetObject2D.y},this.props.mainComponentThis.WALLS,"size"===o?i/2:this.props.targetObject2D.thick/2,"size"===o?this.props.targetObject2D.thick/2:i/2,this.props.targetObject2D.angle))),s?this.saveChanges("width3D",o,i,t,"lastSavedWidthValue"):this.widthInputComponentRef.current.setValue(this.lastSavedWidthValue)},this.onDepthChange=()=>e=>{const t=this.depthInputComponentRef.current.getValue(),i=e||this.props.mainComponentThis.convertValueToSvgUnits(t),o=90===this.props.targetObject2D.params.onWallOffsetAngle?"size":"thick";let s=!0;e||"floorFree"===this.props.targetObject2D.family&&(s=this.props.mainComponentThis.floorFreeObjectPositionValidation({x:this.props.targetObject2D.x,y:this.props.targetObject2D.y},this.props.mainComponentThis.WALLS,"size"===o?i/2:this.props.targetObject2D.size/2,"size"===o?this.props.targetObject2D.size/2:i/2,this.props.targetObject2D.angle)),s?this.saveChanges("depth3D",o,i,t,"lastSavedDepthValue"):this.depthInputComponentRef.current.setValue(this.lastSavedDepthValue)},this.onHeightChange=()=>()=>{const e=this.heightInputComponentRef.current.getValue(),t=this.props.mainComponentThis.convertValueToSvgUnits(e);t<this.props.mainComponentThis.wallHeight?this.saveChanges("height3D",null,t,e,"lastSavedHeightValue"):this.heightInputComponentRef.current.setValue(this.lastSavedHeightValue)},this.widthInputComponentRef=o.createRef(),this.depthInputComponentRef=o.createRef(),this.heightInputComponentRef=o.createRef(),this.dimensionItem={min:-1/0,max:1/0,step:e.mainComponentThis.itemDimensionsInputStep},this.lastSavedWidthValue=null,this.lastSavedDepthValue=null,this.lastSavedHeightValue=null,this.saveChanges=this.saveChanges.bind(this),this.onWidthChange=this.onWidthChange.bind(this),this.onDepthChange=this.onDepthChange.bind(this),this.onHeightChange=this.onHeightChange.bind(this)}componentDidMount(){new Array({inputRef:this.widthInputComponentRef,dimensionPropertyName:"width3D",lastSavedPropertyName:"lastSavedWidthValue"},{inputRef:this.depthInputComponentRef,dimensionPropertyName:"depth3D",lastSavedPropertyName:"lastSavedDepthValue"},{inputRef:this.heightInputComponentRef,dimensionPropertyName:"height3D",lastSavedPropertyName:"lastSavedHeightValue"}).forEach((e=>{const t=this.props.mainComponentThis.convertSvgToValueUnits(this.props.targetObject2D.additionalParams[e.dimensionPropertyName]);e.inputRef.current.setValue(t),e.inputRef.current.setInitialValue(t),this[e.lastSavedPropertyName]=t})),this.props.restoreSelectedBinderCall&&(this.onWidthChange()(this.props.targetObject2D.additionalParams.width3D),this.onDepthChange()(this.props.targetObject2D.additionalParams.depth3D))}render(){return(0,l.jsxs)(Ai,{label:"Dimensions(".concat("metric"===this.props.mainComponentThis.context.userUnit?"cm":"in",")"),children:[(0,l.jsx)(Hi,{disabled:!0,containerStyle:{marginBottom:"0.5rem"},uncontroledNumberInputRef:this.widthInputComponentRef,isNumberInput:!0,controledNumberInput:!1,label:(0,l.jsx)(Co,{longText:"Height:",shortText:"Width:"}),labelClasses:"label-form-control-cancel",item:this.dimensionItem,onChange:this.onWidthChange}),(0,l.jsx)(Hi,{disabled:!0,containerStyle:{marginBottom:"0.5rem"},uncontroledNumberInputRef:this.depthInputComponentRef,isNumberInput:!0,controledNumberInput:!1,label:(0,l.jsx)(Co,{longText:"Height:",shortText:"Depth:"}),labelClasses:"label-form-control-cancel",item:this.dimensionItem,onChange:this.onDepthChange}),(0,l.jsx)(Hi,{disabled:!0,containerStyle:{marginBottom:"0.5rem"},uncontroledNumberInputRef:this.heightInputComponentRef,isNumberInput:!0,controledNumberInput:!1,label:"Height:",labelClasses:"label-form-control-cancel",item:this.dimensionItem,onChange:this.onHeightChange})]})}}const $l=Ql;class eh extends o.Component{constructor(e){var t;super(),t=this,this.onPositionYChange=()=>()=>{const e=this.positionYInputComponentRef.current.getValue(),t=this.props.mainComponentThis.convertValueToSvgUnits(e),i=t+this.props.targetObject2D.additionalParams.height3D<=this.props.mainComponentThis.wallHeight&&t>=0;i&&(this.lastSavedPositionYValue=e,this.props.targetObject2D.additionalParams.positionY=t,this.props.mainComponentThis.floorplan3DComponent.current&&this.props.mainComponentThis.floorplan3DComponent.current.changeSelectedItemVerticalPosition(),this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)),i?this.positionYInputComponentRef.current.inputRef.current.classList.remove("is-invalid"):this.positionYInputComponentRef.current.inputRef.current.classList.add("is-invalid")},this.setPositionYInputValues=function(e){let i=e;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(i=t.props.mainComponentThis.convertSvgToValueUnits(e)),t.positionYInputComponentRef.current.setValue(i)},this.positionYInputComponentRef=o.createRef(),this.positionItem={min:0,max:1/0,step:e.mainComponentThis.itemDimensionsInputStep},this.lastSavedPositionYValue=null,this.onPositionYChange=this.onPositionYChange.bind(this),this.setPositionYInputValues=this.setPositionYInputValues.bind(this)}componentDidMount(){const e=this.props.mainComponentThis.convertSvgToValueUnits(this.props.targetObject2D.additionalParams.positionY);this.setPositionYInputValues(e),this.positionYInputComponentRef.current.setInitialValue(e),this.lastSavedPositionYValue=e}render(){return(0,l.jsxs)(Ai,{children:[(0,l.jsxs)("div",{className:"label form-control label-info-box-container",style:{display:"flex"},children:[(0,l.jsx)("span",{children:"Vertical position(".concat("metric"===this.props.mainComponentThis.context.userUnit?"cm":"in",")")}),(0,l.jsx)(wi,{infoText:(0,l.jsxs)("span",{children:["Vertical position of the item's ",(0,l.jsx)("span",{style:{fontWeight:"bold"},children:"bottom"})," relative to the"," ",(0,l.jsx)("span",{style:{fontWeight:"bold"},children:"floor"})]}),explanationInfoBoxStyles:{left:-150,width:130,zIndex:1}})]}),(0,l.jsx)(Hi,{disabled:!0,containerStyle:{marginBottom:"0.5rem"},uncontroledNumberInputRef:this.positionYInputComponentRef,isNumberInput:!0,controledNumberInput:!1,labelClasses:"label-form-control-cancel",item:this.positionItem,onChange:this.onPositionYChange})]})}}const th=eh;var ih=i(1317);class oh extends o.Component{constructor(e){super(),this.handleRotationOptionChange=e=>()=>{ih.log("handleRotationOptionChange");const t=[...this.state.rotationOptions];t.forEach((e=>e.selected=!1));const i=t.find((t=>t===e.choices[0].value));i&&(i.selected=!0,this.setState({rotationOptions:t},(()=>{this.props.windowObj2D.additionalParams.rotationAxis=i.rotationAxis,this.props.windowObj2D.additionalParams.rotationDirection=i.rotationDirection,this.props.mainComponentThis.setWindowObjectRotationProperties(this.props.windowObj2D),this.props.mainComponentThis.floorplan3DComponent.current?this.props.mainComponentThis.floorplan3DComponent.current.onSelectedWindowItemRotationOptionChange():this.props.mainComponentThis.createWindowRotationPropertiesBinder(this.props.windowObj2D),this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!1)})))},this.state={rotationOptions:[{rotationAxis:"start",rotationDirection:"up",imageURI:null,selected:"start"===(e.windowObj2D.additionalParams.rotationAxis||"start")&&"up"===(e.windowObj2D.additionalParams.rotationDirection||"up")},{rotationAxis:"end",rotationDirection:"up",imageURI:null,selected:"end"===(e.windowObj2D.additionalParams.rotationAxis||"start")&&"up"===(e.windowObj2D.additionalParams.rotationDirection||"up")},{rotationAxis:"start",rotationDirection:"down",imageURI:null,selected:"start"===(e.windowObj2D.additionalParams.rotationAxis||"start")&&"down"===(e.windowObj2D.additionalParams.rotationDirection||"up")},{rotationAxis:"end",rotationDirection:"down",imageURI:null,selected:"end"===(e.windowObj2D.additionalParams.rotationAxis||"start")&&"down"===(e.windowObj2D.additionalParams.rotationDirection||"up")}]},this.handleRotationOptionChange=this.handleRotationOptionChange.bind(this)}componentDidMount(){!this.props.mainComponentThis.floorplan3DComponent.current&&this.props.mainComponentThis.createWindowRotationPropertiesBinder(this.props.windowObj2D);let e=[...this.state.rotationOptions];for(let t=0;t<e.length;t++){const i=Bt(e[t].rotationAxis,e[t].rotationDirection,this.props.windowObj2D),o=this.props.mainComponentThis.createWindowRotationSvg(this.props.windowObj2D,{point1:{x:i.curvePoint1X,y:i.curvePoint1Y},point2:{x:i.curvePoint2X,y:i.curvePoint2Y},controlPoint:{x:i.controlPointX,y:i.controlPointY}},e[t].rotationDirection);o.svgGroupElement.appendChild(o.curveArrowPath);const s=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","defs"),a=document.createElementNS("http://www.w3.org/2000/svg","marker");a.setAttribute("id","window-rotation-direction-arrow-triangle"),a.setAttribute("viewBox","0 0 10 10"),a.setAttribute("refX","5"),a.setAttribute("refY","5"),a.setAttribute("markerUnits","strokeWidth"),a.setAttribute("markerWidth","4"),a.setAttribute("markerHeight","4"),a.setAttribute("orient","auto");const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),r.setAttribute("fill","#f00"),a.appendChild(r),n.appendChild(a),s.appendChild(n),s.appendChild(o.svgGroupElement),document.body.appendChild(s);const{arrowHalfLength:l,translateX:h,translateY:c}=Et(this.props.windowObj2D,e[t].rotationDirection);let d=(this.props.windowObj2D.angle+90)*(Math.PI/180),p=[{x:-l,y:i.controlPointY/2},{x:l,y:i.controlPointY/2},{x:l,y:0},{x:-l,y:0}],m={x:0,y:0};p.forEach((e=>{e.x+=h,e.y+=c})),m.x+=h,m.y+=c,Vt(p,m,d);const u=Nt(p),g=5;s.setAttribute("viewBox","".concat(u.minX-g," ").concat(u.minY-g," ").concat(u.width+2*g," ").concat(u.height+2*g)),s.setAttribute("width",u.width+2*g),s.setAttribute("height",u.height+2*g),e[t].imageURI="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(s)),document.body.removeChild(document.body.lastChild)}this.setState({rotationOptions:e})}render(){const{rotationOptions:e}=this.state;return ih.log(e),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"Rotation options"}),(0,l.jsx)("div",{children:e.filter((e=>e.imageURI)).map(((t,i)=>(0,l.jsx)("div",{children:(0,l.jsx)(Pi,{disabled:!0,choiceRowStyle:{display:"flex",alignItems:"center"},onChange:this.handleRotationOptionChange,item:{choices:[{name:null,value:t,inputSiblingElement:(0,l.jsx)("img",{style:{paddingLeft:"0.5rem"},src:t.imageURI})}],value:e.find((e=>e.selected))}})},i)))})]})}}const sh=oh;var nh=i(1317);function ah(){let e=null!==this.selectedBinder.realRoomArea?this.selectedBinder.realRoomArea/(this.meter*this.meter):null;this.selectedBinder.setAttribute("fill","none"),this.selectedBinder.setAttribute("stroke","#ddf00a"),this.selectedBinder.setAttribute("stroke-width",7),document.getElementsByClassName("size")[0].innerHTML=null!==e?Wt(e,this.measureSystemContext.userUnit,"square meter","square foot",this.roomSurfaceDecimalPrecision,!0,!0):"Cannot be determined";const t=this.ROOM.find((e=>e.id===parseInt(this.selectedBinder.id)));if(nh.log("targetRoom"),nh.log(t),this.selectedRoomId=t.id,t.surface){const e=Wt(t.surface,this.measureSystemContext.userUnit,"square meter","square foot",this.roomSurfaceDecimalPrecision);this.roomSurface.current.setValue(e),this.roomSurface.current.setInitialValue(e)}else this.roomSurface.current.setValue(""),this.roomSurface.current.setInitialValue("");let i=t.name;this.roomName.current.value=i,""!==t.name?this.roomNameSelectRef.current.setValue(i):this.roomNameSelectRef.current.setValue("None"),s.render((0,l.jsx)(Ul,{ref:this.roomFloorTypesSelectionRef,disabled:!0,items:Ve,onClickCallback:this.onRoomFloorTextureChange}),this.roomFloorTexturesComponentContainerRef.current,(()=>this.roomFloorTypesSelectionRef.current.setSelectedItem(t.floorTexture)))}function rh(e){const t=Ft(e.thick/this.meter,this.measureSystemContext.userUnit,"meter","metric"===this.measureSystemContext.userUnit?"centimeter":"inch",this.wallWidthDecimalPrecision,!1,!1,!0),i=Ft(Mt(e.start,e.end)/this.meter,this.measureSystemContext.userUnit,"meter","feet",this.wallLengthDecimalPrecision);this.wallWidth.current.value=t,this.wallWidthValue.current.textContent=t,this.wallWidthNumberSliderInput.current.setNumberInputInitialValues(t),this.wallLengthValue.current.textContent=i,this.wallLength.current.setValue(i),this.wallLength.current.setInitialValue(i),this.wallMaterialRef.current.setSelectedWallMaterialData(e)}function lh(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("text"===e.class)s.render((0,l.jsx)(Jl,{targetObject2D:e,itemRotationValueRef:this.itemRotationValue,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.freeItemRotationsRef.current),s.render((0,l.jsx)(Zl,{targetObject2D:e,textItemFontSizeValueRef:this.textItemFontSizeValue,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.freeItemTextToolsRef.current),s.unmountComponentAtNode(this.freeItemDimensionsRef.current),s.unmountComponentAtNode(this.freeItemPositionsRef.current),s.unmountComponentAtNode(this.freeItemTypesSelectionBoxRef.current);else{"lightSource"===e.type?(s.unmountComponentAtNode(this.freeItemDimensionsRef.current),s.unmountComponentAtNode(this.freeItemPositionsRef.current),s.unmountComponentAtNode(this.freeItemRotationsRef.current)):(s.render((0,l.jsx)(Jl,{ref:this.activeItemRotationsRef,targetObject2D:e,itemRotationValueRef:this.itemRotationValue,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.freeItemRotationsRef.current),s.render((0,l.jsx)($l,{targetObject2D:e,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.freeItemDimensionsRef.current),re.includes(Ut(e.type))?s.unmountComponentAtNode(this.freeItemPositionsRef.current):s.render((0,l.jsx)(th,{ref:this.activeItemPositionsRef,targetObject2D:e,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.freeItemPositionsRef.current));const o=Ee[Yt(e.type)];s.render((0,l.jsx)(Ai,{children:(0,l.jsx)(ql,{disabled:!0,containerClasses:"right-box-floorplan-item-type-selection-container",gridContainerClasses:"single-column",initialSelectedItemModel:e.type,items:[{...o,models:o.models.filter((t=>t===e.type))}],onFloorplanItemSelectionCallback:t=>{e.type=t,e.update(),this.saveNeeded=!0,this.save(!1,!1)}},(new Date).getTime())}),this.freeItemTypesSelectionBoxRef.current),s.unmountComponentAtNode(this.freeItemTextToolsRef.current),Object.keys(qe).includes(e.class)?this.renderHAEntitiesBindingRightBox(e,t,this.HAEntitiesBindingFreeItemContainerRef,!0):s.unmountComponentAtNode(this.HAEntitiesBindingFreeItemContainerRef.current)}}function hh(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=Ee[Yt(e.type)];s.render((0,l.jsx)(Ai,{children:(0,l.jsx)(ql,{disabled:!0,containerClasses:"right-box-floorplan-item-type-selection-container",gridContainerClasses:"single-column",initialSelectedItemModel:e.type,items:[{...o,models:o.models.filter((t=>t===e.type))}],onFloorplanItemSelectionCallback:t=>{e.type=t,this.saveNeeded=!0,this.save(!1,!1)}},(new Date).getTime())}),this.wallItemTypesSelectionBoxRef.current),s.render((0,l.jsx)($l,{targetObject2D:e,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.wallItemDimensionsRef.current),re.includes(Ut(e.type))?s.unmountComponentAtNode(this.wallItemPositionsRef.current):s.render((0,l.jsx)(th,{ref:this.activeItemPositionsRef,targetObject2D:e,restoreSelectedBinderCall:i,mainComponentThis:this},(new Date).getTime()),this.wallItemPositionsRef.current),zt(e.type)?s.render((0,l.jsx)(sh,{mainComponentThis:this,windowObj2D:e},(new Date).getTime()),this.windowRotationOptionsContainerRef.current):s.unmountComponentAtNode(this.windowRotationOptionsContainerRef.current),this.wallItemHideWithWallRef.current.setSelectedObjectData(e),Object.keys(qe).includes(e.class)?this.renderHAEntitiesBindingRightBox(e,t,this.HAEntitiesBindingWallItemContainerRef,!0):s.unmountComponentAtNode(this.HAEntitiesBindingWallItemContainerRef.current)}var ch=i(1317);class dh extends o.Component{constructor(e){var t;super(e),t=this,this.addFloorplanImageLayer=e=>{this.currentFloorplanImageCanvasCoordinates=this.calculateFloorplanImageCanvasCoordinatesForBearing(this.state.edit.find((e=>"bearing_angle"===e.field)).value),this._map.addSource("floorplan-image-source",{type:"canvas",canvas:this.floorplanCanvas,coordinates:this.currentFloorplanImageCanvasCoordinates,animate:!1}),this._map.addLayer({id:"floorplan-image-layer",type:"raster",source:"floorplan-image-source"}),e&&this.setState({floorplanImageLayerAdded:!0},(()=>this.focusFloorplanImageCanvas(!1)))},this.focusFloorplanImageCanvas=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];!t.floorplanImageCanvasCurrentBearingPolygon||e&&!t.isStyleChangeAllowed()||t.setState({mapCenter:(0,Qn.Z)(t.floorplanImageCanvasCurrentBearingPolygon).geometry.coordinates},(()=>{vt(t._map,t.currentFloorplanImageCanvasCoordinates,Number(t.floorplanBearingSliderRef.current.value))}))},this.closeShowFloorplanOnMapModal=(e,t,i)=>{e&&this.props.mainComponentThis.showMapLayer2DInputRef.current.getCheckedStatus()&&s.unmountComponentAtNode(this.props.mainComponentThis.mapLayer2DContainerRef.current),at(this.props.containerRef.current,200,(()=>{s.unmountComponentAtNode(this.props.containerRef.current),e&&this.props.mainComponentThis.showMapLayer2DInputRef.current.getCheckedStatus()&&s.render((0,l.jsx)(Ca,{ref:this.props.mainComponentThis.showMapLayer2D3DRef,is3D:!1,center:[16.8557,44.0462],floorplanGpsCoords:[t,i],onMapContextLoadedCallback:this.props.mainComponentThis.onMapContextLoadedCallback2D,preserveDrawingBuffer:!1,mapStylesChangeRef:this.props.mainComponentThis.mapStylesChangeRef,mainComponentThis:this.props.mainComponentThis}),this.props.mainComponentThis.mapLayer2DContainerRef.current)}),!1)},this.onMapZoom=()=>{this._map&&(this._zoom=this._map.getZoom())},this.onMapClick=(e,t)=>{if(this._map&&this.state.changeTopLeftGpsCoordinatesEnabled){const e=this.state.edit.map((e=>"gps_lat"===e.field?{...e,value:t.lngLat.lat.toString()}:"gps_long"===e.field?{...e,value:t.lngLat.lng.toString()}:{...e}));this.setState({edit:e},(()=>this.handleFloorplanImageCanvasCoordinateChange(t.lngLat.lng,t.lngLat.lat)))}},this.switchLayer=e=>()=>{if(this._map&&this.isStyleChangeAllowed()&&this.state.selectedMapStyle!==e&&this.mounted){let t=this.state.selectedMapStyle;this.setState({selectedMapStyle:e,mapStyleLoaded:!1},(()=>{this._map.getStyle().layers.forEach((e=>{this._map.removeLayer(e.id)}));const{callback:i,newStyle:o}=((e,t,i)=>{let o=null,s="mapbox/"+e;return"TERRAIN"!==e&&"TERRAIN"===t&&(i.setTerrain(null),i.removeSource("mapbox-dem")),"TERRAIN"===e&&(s="mapbox-map-design/ckhqrf2tz0dt119ny6azh975y",o=()=>{i.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),i.setTerrain({source:"mapbox-dem",exaggeration:1.5}),i.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,0],"sky-atmosphere-sun-intensity":15}})}),"BUILDINGS"===e&&(s="mapbox/light-v10",o=()=>{const e=i.getStyle().layers;let t;for(let i=0;i<e.length;i++)if("symbol"===e[i].type&&e[i].layout["text-field"]){t=e[i].id;break}i.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}},t)}),{callback:o,newStyle:s}})(e,t,this._map);this._map.setStyle("mapbox://styles/"+o,{diff:!1}),this._map.once("idle",(()=>{this.mounted&&this.setState({mapStyleLoaded:!0},(()=>{i&&i(),this.state.floorplanImageLayerAdded&&this.addFloorplanImageLayer(!1)}))}))}))}},this.isStyleChangeAllowed=()=>{if(this.state.mapStyleLoaded){const e=this._map.getStyle();let t=e&&e.layers;return t?this.state.floorplanImageLayerAdded&&!t.find((e=>"floorplan-image-layer"===e.id))?(ch.log("False, nema floorplanImageCanvas layera"),!1):"BUILDINGS"!==this.state.selectedMapStyle||"BUILDINGS"===this.state.selectedMapStyle&&t.find((e=>"3d-buildings"===e.id))?"TERRAIN"!==this.state.selectedMapStyle||"TERRAIN"===this.state.selectedMapStyle&&t.find((e=>"sky"===e.id))&&e.sources["mapbox-dem"]?(ch.log("Omogucena promjena stila"),!0):(ch.log("False. nema terrain layera"),!1):(ch.log("False. nema buildings layera"),!1):(ch.log("Nema layera"),!1)}return ch.log("Vanjski if. Nije loadan stil"),!1},this.calculateFloorplanImageCanvasCoordinatesForBearing=e=>{const t={pivot:[this.state.edit.find((e=>"gps_long"===e.field)).value,this.state.edit.find((e=>"gps_lat"===e.field)).value]};return this.floorplanImageCanvasCurrentBearingPolygon=(0,ea.Z)(this.floorplanImageCanvasZeroBearingPolygon,e,t),this.floorplanImageCanvasCurrentBearingPolygon.geometry.coordinates[0].slice(0,-1)},this.handleFloorplanImageCanvasCoordinateChange=(e,t)=>{this.state.floorplanBearingAngleMechanismDisabled?this.createFloorplanImageCanvas(e,t,{floorplanBearingAngleMechanismDisabled:!1}):this.translateFloorplanImageCanvas(e,t)},this.createFloorplanImageCanvas=function(e,i){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;t.floorplanImageCanvasZeroBearingPolygon.geometry.coordinates=[[...St(i,e,t.floorplanDimensions.width,t.floorplanDimensions.height),[e,i]]],t.props.mainComponentThis.downloadSvg(!1,!1,!0,!t.state.showFloorplanImageBackground).then((e=>{let i=new Image;i.onload=()=>{t.state.showFloorplanImageBackground?t.floorplanWhiteBgImage=i:t.floorplanTransparentBgImage=i,t.floorplanCanvas.width=i.width,t.floorplanCanvas.height=i.height,t.floorplanCanvas.getContext("2d").drawImage(i,0,0),t.setState({...o,floorplanImageLoaded:!0,loading:!1,mapCenter:(0,Qn.Z)(t.floorplanImageCanvasZeroBearingPolygon).geometry.coordinates},(()=>!!s&&s()))},i.onerror=e=>{t.setState({error:e,visibleErrorPopup:!0,loading:!1,mapCenter:(0,Qn.Z)(t.floorplanImageCanvasZeroBearingPolygon).geometry.coordinates})},i.src=e}))},this.translateFloorplanImageCanvas=(e,t)=>{const i=ot()(this.floorplanImageCanvasCurrentBearingPolygon.geometry.coordinates[0][0]),o=ot()([e,t]),s=(0,ta.Z)(i,o),n=(0,ia.Z)(i,o);this.floorplanImageCanvasZeroBearingPolygon=(0,$n.Z)(this.floorplanImageCanvasZeroBearingPolygon,n,s),this.floorplanImageCanvasCurrentBearingPolygon=(0,$n.Z)(this.floorplanImageCanvasCurrentBearingPolygon,n,s),this.currentFloorplanImageCanvasCoordinates=this.floorplanImageCanvasCurrentBearingPolygon.geometry.coordinates[0].slice(0,-1),this._map.getSource("floorplan-image-source").setCoordinates(this.currentFloorplanImageCanvasCoordinates)},this.changeFloorplanImageCanvasImage=e=>{this._map.removeLayer("floorplan-image-layer"),this._map.removeSource("floorplan-image-source"),this.floorplanCanvas.width=e.width,this.floorplanCanvas.height=e.height,this.floorplanCanvas.getContext("2d").drawImage(e,0,0),this.addFloorplanImageLayer()},this.onChangeFloorplanImageCanvasBackgroundOptionClick=()=>{if(this.isStyleChangeAllowed()){let e=!0,t=!this.state.showFloorplanImageBackground;t?this.floorplanWhiteBgImage&&(e=!1):this.floorplanTransparentBgImage&&(e=!1),e?this.props.mainComponentThis.downloadSvg(!1,!1,!0,!t).then((e=>{let i=new Image;i.onload=()=>{t?this.floorplanWhiteBgImage=i:this.floorplanTransparentBgImage=i,this.changeFloorplanImageCanvasImage(i),this.setState({showFloorplanImageBackground:t})},i.onerror=e=>{this.setState({error:e,visibleErrorPopup:!0})},i.src=e})):(this.changeFloorplanImageCanvasImage(t?this.floorplanWhiteBgImage:this.floorplanTransparentBgImage),this.setState({showFloorplanImageBackground:t}))}},this.state={edit:null,originalData:{},floorplanImageLoaded:!1,floorplanImageLayerAdded:!1,floorplanNoInitialBearing:!1,loading:!0,error:null,floorplanLoadingError:null,tooltip:null,visibleErrorPopup:!1,mapCenter:[],selectedMapStyle:"light-v8",mapStyleLoaded:!0,changeTopLeftGpsCoordinatesEnabled:!1,changeBearingAngleEnabled:!1,floorplanGpsCoordinatesMechanismDisabled:!1,floorplanBearingAngleMechanismDisabled:!1,showFloorplanImageBackground:!0},this._map=null,this.zoomRange=4,this._zoom=9,this.mounted=!1,this.floorplanDimensions={width:0,height:0},this.floorplanImageCanvasZeroBearingPolygon={type:"Feature",geometry:{type:"Polygon",coordinates:[]},properties:{}},this.getBaseStations=!1,this.floorplanGeneral=null,this.floorplanImageCanvasCurrentBearingPolygon=null,this.currentFloorplanImageCanvasCoordinates=null,this.floorplanBearingNumberSliderInput=o.createRef(),this.floorplanBearingSliderRef=o.createRef(),this.floorplanCanvas=document.createElement("canvas"),this.floorplanWhiteBgImage=null,this.floorplanTransparentBgImage=null,this.addFloorplanImageLayer=this.addFloorplanImageLayer.bind(this),this.closeShowFloorplanOnMapModal=this.closeShowFloorplanOnMapModal.bind(this),this.onMapZoom=this.onMapZoom.bind(this),this.onMapClick=this.onMapClick.bind(this),this.switchLayer=this.switchLayer.bind(this),this.isStyleChangeAllowed=this.isStyleChangeAllowed.bind(this),this.calculateFloorplanImageCanvasCoordinatesForBearing=this.calculateFloorplanImageCanvasCoordinatesForBearing.bind(this),this.focusFloorplanImageCanvas=this.focusFloorplanImageCanvas.bind(this),this.handleFloorplanImageCanvasCoordinateChange=this.handleFloorplanImageCanvasCoordinateChange.bind(this),this.createFloorplanImageCanvas=this.createFloorplanImageCanvas.bind(this),this.translateFloorplanImageCanvas=this.translateFloorplanImageCanvas.bind(this),this.changeFloorplanImageCanvasImage=this.changeFloorplanImageCanvasImage.bind(this),this.onChangeFloorplanImageCanvasBackgroundOptionClick=this.onChangeFloorplanImageCanvasBackgroundOptionClick.bind(this)}componentWillUnmount(){this.mounted=!1}componentDidMount(){this.mounted=!0,this.props.floorplanID?C.get.call(this,"/klet3d/entity/".concat(this.props.floorplanID,"/").concat(this.props.mainComponentThis.props.licenseKey),(e=>{if(e&&e.length>0){this.floorplanGeneral=e[0].plan_general;const o=this.props.mainComponentThis.getFloorplanGpsLongitude(e[0].plan_general),s=this.props.mainComponentThis.getFloorplanGpsLatitude(e[0].plan_general);this.floorplanDimensions.width=T(this.props.mainComponentThis.boxWallCoordinates.width/this.props.mainComponentThis.meter,2),this.floorplanDimensions.height=T(this.props.mainComponentThis.boxWallCoordinates.height/this.props.mainComponentThis.meter,2);const n=e[0].plan_general.floorplan_bearing||G.find((e=>"bearing_angle"===e.field)).defaultValue,a=(t={gps_lat:s&&s.toString(),gps_long:o&&o.toString(),bearing_angle:n},i=G,Object.entries(t).map((e=>{let[t,o]=e;return{...i.find((e=>e.field===t)),value:void 0!==o&&null!==o?o:""}})));M(s)||M(o)?E.call(this,"mapCenter",this.props.setResponseError,(()=>this.setState({edit:a,originalData:a,loading:!1,floorplanNoInitialBearing:!0,floorplanBearingAngleMechanismDisabled:!0},(()=>{this.floorplanBearingSliderRef.current.value=n,this.floorplanBearingNumberSliderInput.current.setNumberInputInitialValues(n)})))):this.createFloorplanImageCanvas(o,s,{edit:a,originalData:a,floorplanNoInitialBearing:!e[0].plan_general.floorplan_bearing&&0!==e[0].plan_general.floorplan_bearing},(()=>{this.floorplanBearingSliderRef.current.value=n,this.floorplanBearingNumberSliderInput.current.setNumberInputInitialValues(n)}))}var t,i})):this.setState({loading:!1,floorplanLoadingError:"Floorplan couldn't be found. Please save it first then try again."})}render(){return(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(_i,{onCloseModalClick:()=>this.closeShowFloorplanOnMapModal(!1),children:(0,l.jsx)("div",{className:"layout__section",style:{height:"auto",maxHeight:"85vh"},children:(()=>this.state.loading?(0,l.jsx)(Zi,{center:!0}):this.state.floorplanLoadingError?(0,l.jsx)("p",{className:"show-floorplan-on-map-error",children:this.state.floorplanLoadingError}):(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("section",{className:"show-floorplan-on-map-form-controls-container",children:this.state.edit&&(0,l.jsxs)(o.Fragment,{children:[(0,l.jsxs)("div",{className:"form-controls-container",children:[(0,l.jsx)("div",{className:"form-container",children:this.state.edit.slice(0,2).map((e=>(0,l.jsx)(Mi,{disabled:!0,label:e.label,placeholder:e.placeholder,item:e,value:e.value||"",type:e.type,error:e.error},e.label)))}),(0,l.jsx)(oo.Z,{theme:ho,children:(0,l.jsx)("div",{title:"Change floorplan coordinates",children:(0,l.jsx)(lo.Z,{disabled:!0,checked:this.state.changeTopLeftGpsCoordinatesEnabled})})})]}),(0,l.jsxs)("div",{className:"form-controls-container",children:[(0,l.jsx)("div",{className:"form-container",children:(0,l.jsx)(pn,{disabled:!0,ref:this.floorplanBearingNumberSliderInput,sliderInputRef:this.floorplanBearingSliderRef,valueLabelText:G.find((e=>"bearing_angle"===e.field)).label,sliderStep:1,minValue:0,maxValue:359,defaultValue:G.find((e=>"bearing_angle"===e.field)).defaultValue})}),(0,l.jsx)(oo.Z,{theme:ho,children:(0,l.jsx)("div",{title:"Change floorplan bearing",children:(0,l.jsx)(lo.Z,{disabled:!0,checked:this.state.changeBearingAngleEnabled})})})]})]})}),(this.state.changeTopLeftGpsCoordinatesEnabled||this.state.changeBearingAngleEnabled)&&(0,l.jsx)("p",{className:"above-map-note",children:this.state.changeTopLeftGpsCoordinatesEnabled?"Select coordinates of the top left corner of your floorplan":"Rotate floorplan around the top left corner"}),(0,l.jsxs)("section",{className:"layout__section map",children:[(0,l.jsx)("div",{className:"layer-change show-floorplan-on-map map-feature-icon svg-center-inside-container"}),(0,l.jsx)("div",{className:"layer-dropdown",style:{top:105},children:(0,l.jsx)(po,{mapStyles:q,switchLayer:this.switchLayer,selectedMapStyle:this.state.selectedMapStyle})}),this.state.floorplanImageLayerAdded&&(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{className:"last-point-center show-floorplan-on-map map-feature-icon svg-center-inside-container",onClick:this.focusFloorplanImageCanvas,children:(0,l.jsx)(Ba,{})}),(0,l.jsx)("div",{className:"feature-info",children:(0,l.jsx)("div",{children:"Focus floorplan image"})}),(0,l.jsx)("div",{className:"floorplan-image-background-option map-feature-icon svg-center-inside-container",onClick:this.onChangeFloorplanImageCanvasBackgroundOptionClick,children:this.state.showFloorplanImageBackground?(0,l.jsx)("svg",{viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet",children:(0,l.jsx)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none",children:(0,l.jsx)("path",{d:"M2448 4784 c-97 -23 -157 -60 -248 -153 -116 -119 -245 -286 -415\r -541 -564 -845 -870 -1711 -817 -2305 45 -495 297 -921 710 -1198 164 -110\r 377 -198 585 -239 160 -32 434 -32 593 0 579 116 1039 517 1223 1070 58 175\r 76 294 75 512 0 154 -5 222 -22 324 -93 545 -363 1176 -767 1796 -158 243\r -378 526 -488 627 -113 104 -276 145 -429 107z m178 -320 c65 -31 283 -302\r 471 -584 296 -443 562 -1006 663 -1400 6 -25 13 -53 16 -62 5 -17 -58 -18\r -1215 -18 -672 0 -1221 1 -1221 3 0 2 15 57 34 123 119 418 342 886 633 1329\r 192 291 418 575 484 608 43 21 92 21 135 1z"})})}):(0,l.jsx)("svg",{viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet",children:(0,l.jsx)("g",{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#000000",stroke:"none",children:(0,l.jsx)("path",{d:"M2448 4784 c-97 -23 -157 -60 -248 -153 -116 -119 -245 -286 -415\r\n-541 -564 -845 -870 -1711 -817 -2305 65 -721 582 -1295 1295 -1437 160 -32\r\n434 -32 593 0 579 116 1039 517 1223 1070 58 175 76 294 75 512 0 154 -5 222\r\n-22 324 -93 545 -363 1176 -767 1796 -158 243 -378 526 -488 627 -113 104\r\n-276 145 -429 107z m178 -320 c65 -31 283 -302 471 -584 296 -443 562 -1006\r\n663 -1400 6 -25 13 -53 16 -62 5 -17 -58 -18 -1215 -18 -672 0 -1221 1 -1221\r\n3 0 2 15 57 34 123 119 418 342 886 633 1329 192 291 418 575 484 608 43 21\r\n92 21 135 1z m1210 -2431 c11 -71 -4 -287 -25 -383 -99 -438 -410 -789 -831\r\n-938 -152 -53 -237 -67 -425 -66 -137 0 -187 5 -261 22 -260 61 -452 168 -635\r\n351 -188 188 -297 386 -350 636 -22 107 -35 288 -25 368 l7 57 1269 0 1269 0\r\n7 -47z"})})})}),(0,l.jsx)("div",{className:"feature-info",style:{width:this.state.showFloorplanImageBackground?150:180},children:(0,l.jsx)("div",{children:this.state.showFloorplanImageBackground?"White background":"Transparent background"})})]}),(0,l.jsx)("div",{className:"glamos-bottom-left-logo",children:(0,l.jsx)("img",{alt:"Glamos logo",src:"dark-v10"===this.state.selectedMapStyle||"satellite-v9"===this.state.selectedMapStyle||"TERRAIN"===this.state.selectedMapStyle?va:a})}),(0,l.jsxs)(go,{preserveDrawingBuffer:!0,mapStyle:"mapbox://styles/mapbox/light-v8",center:this.state.mapCenter,zoom:[this._zoom],minZoom:3,maxZoom:15,onZoom:this.onMapZoom,onClick:this.onMapClick,children:[(0,l.jsx)(mo.Ly,{className:"zoom-control"}),(0,l.jsx)(mo.AI,{className:"rotation-control"}),(0,l.jsx)(mo.jf,{className:"scale-control",measurement:"metric"===this.props.mainComponentThis.measureSystemContext.userUnit?"km":"mi"}),(0,l.jsx)(mo.X$.Consumer,{children:e=>{this._map=e,this.state.floorplanImageLoaded&&!this.state.floorplanImageLayerAdded&&(this._map.setMaxZoom(22),this.addFloorplanImageLayer(!0))}})]})]}),(0,l.jsx)("div",{className:"button-centered-container",style:{marginTop:"1rem"},children:(0,l.jsx)(ai,{type:"dull",disabled:!0,children:"Save changes"})})]}))()})}),(0,l.jsx)(bo,{visible:this.state.visibleErrorPopup,loading:!1,error:this.state.error,singleButton:!0,statePropertyName:"visibleErrorPopup",setChoice:this.setState.bind(this)})]})}}const ph=dh;var mh=i(1317);function uh(e,t){e&&(window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("keydown",this.handleKeyDown,{capture:!0})),t&&(window.addEventListener("resize",this.handleWindowResize),window.addEventListener("keydown",this.handleKeyDown,{capture:!0}))}function gh(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isFloorplanNoWalls())this.setShow3DStatus(!1,(()=>{!e&&s.unmountComponentAtNode(this.loadingComponentContainer.current),nt(this.showFloorplanNoWallsErrorModal.current,this.modalTimeout)}));else{this.hideActiveRightBox();const t=()=>{window.removeEventListener("keydown",this.handleKeyDown,{capture:!0}),!0!==this.state.show3D?this.setShow3DStatus(!0,(()=>this.floorplan3DComponent.current.onDataLoadedCallback())):this.floorplan3DComponent.current.onDataLoadedCallback()};e?s.render((0,l.jsx)(fn,{}),this.loadingComponentContainer.current,(()=>t())):t()}}function fh(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.panel.current.querySelectorAll(".panel-icon-button-container");if(e===this.smallScreenMinimizedPanelSize){const e=this.panel.current.querySelectorAll(".panel-action-button > button");for(let t of e)t.classList.add("small-screen-minimized"),t.classList.add("floorplan")}else{const e=this.panel.current.querySelectorAll(".panel-action-button > button");for(let t of e)t.classList.remove("small-screen-minimized"),t.classList.remove("floorplan")}this.panel.current.classList.add("panel-small-screen-minimized"),this.panelControl.current.title="Show panel",this.boxPlanName.current.style.paddingLeft="".concat(e+30,"px"),this.boxInfo.current.style.left="".concat(e+30,"px"),this.panel.current.style.width="".concat(e,"px"),t&&(this.panelControl.current.style.transform="translateX(".concat(e,"px)")),this.panelControl.current.children[0].style.transform="rotate(180deg)",this.panel.current.addEventListener("transitionend",(()=>{this.panel.current.classList.add("panel-centered");for(let e of i)e.classList.add("panel-icon-button-no-text"),e.classList.remove("fully");this.layersListArrowRef.current.classList.add("hidden");const t=this.panel.current.querySelectorAll(".checked-input-container");for(let e of t)e.classList.add("checked-input-container-no-label");document.querySelector(".show-map-switch-container.panel2D").classList.add("hide-label"),this.uploadImageFloorplanSettingsIconRef.current.classList.add("hide"),e===this.smallScreenMinimizedPanelSize?this.uploadFloorplanPanelButtonContainer.current.style.flexWrap="wrap":this.uploadFloorplanPanelButtonContainer.current.style.flexWrap="nowrap",e===this.smallScreenMinimizedPanelSize?this.uploadFloorplanImageStatusContainerRef.current.classList.add("small-screen-minimized"):this.uploadFloorplanImageStatusContainerRef.current.classList.remove("small-screen-minimized")}),{once:!0}),this.floorplan3DComponent.current&&this.floorplan3DComponent.current.hidePanel()}function bh(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.panel.current.querySelectorAll(".panel-icon-button-container");this.isSmallScreen()&&this.hideRightBox(),this.panel.current.classList.remove("panel-small-screen-minimized");const o=this.panel.current.querySelectorAll(".panel-action-button > button");for(let s of o)s.classList.remove("small-screen-minimized"),s.classList.remove("floorplan");this.panelControl.current.title="Hide panel",this.boxPlanName.current.style.paddingLeft="".concat(e+10,"px"),this.boxInfo.current.style.left="".concat(e+30,"px"),this.panel.current.style.width="".concat(e,"px"),this.panel.current.classList.remove("panel-centered"),t&&(this.panelControl.current.style.transform="translateX(".concat(e,"px)")),this.panelControl.current.children[0].style.transform="rotate(0deg)",this.panel.current.addEventListener("transitionend",(()=>{for(let e of i)e.classList.remove("panel-icon-button-no-text"),e.classList.add("fully");this.layersListArrowRef.current.classList.remove("hidden");const t=this.panel.current.querySelectorAll(".checked-input-container");for(let e of t)e.classList.remove("checked-input-container-no-label");document.querySelector(".show-map-switch-container.panel2D").classList.remove("hide-label"),e!==this.smallScreenMaximizedPanelSize&&this.uploadImageFloorplanSettingsIconRef.current.classList.remove("hide"),this.uploadFloorplanPanelButtonContainer.current.style.flexWrap="nowrap",this.uploadFloorplanImageStatusContainerRef.current.classList.remove("small-screen-minimized")}),{once:!0})}function xh(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isPanelMaximized()){const t=this.isSmallScreen()?this.smallScreenMinimizedPanelSize:this.bigScreenMinimizedPanelSize;this.minimizePanel(t,e)}else{const t=this.isSmallScreen()?this.smallScreenMaximizedPanelSize:this.bigScreenMaximizedPanelSize;this.maximizePanel(t,e)}}function Ch(e){this.foncButton("select_mode"),this.boxInfo.current.innerHTML="Select mode",this.translateRightBox(e.current,this.rightBoxWidth,!1)}function wh(){this.foncButton("select_mode"),this.boxInfo.current.innerHTML="Select mode",this.translateRightBox(this.wallTools.current,this.rightBoxWidth,!1),this.wallMaterialRef.current.resetWallMaterialData()}function yh(){this.foncButton("select_mode"),this.boxInfo.current.innerHTML="Select mode",this.translateRightBox(this.wallItemToolsRef.current,this.rightBoxWidth,!1),this.rib()}function Sh(){let e=this.linRef.current.getBoundingClientRect();if(this.taille_h!==e.height||this.taille_w!==e.width){mh.log("Window resize"),this.taille_w=e.width,this.taille_h=e.height,this.offset={left:e.left,top:e.top,scrollY:window.scrollY},this.determineMaxZoomInLevel(),this.showHideLeftRightBoxes(),this.handleRightControlsBoxResize(),this.width_viewbox=this.taille_w,this.height_viewbox=this.taille_h,this.ratio_viewbox=this.height_viewbox/this.width_viewbox,this.zoomFactor=1,this.zoom=this.defaultZoomLevel,this.centerAndShowFloorplanAndUploadedFloorplanImage(!0);const t=this.zoom-this.defaultZoomLevel;this.zoomToSpecificLevel(t>0?"zoomin":"zoomout",Math.abs(t)),this.drawingAreaPopupActive&&this.drawingAreaPopupZoomTranslateControl(),this.setSvgViewBoxes(),this.floorplan3DComponent.current&&this.floorplan3DComponent.current.onWindowResize()}}function vh(e){if("INPUT"!==e.target.nodeName&&!e.repeat)if(mh.log("Key down"),e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||mh.log("Ctrl key combos");else if(mh.log("Single key"),"ArrowLeft"===e.key)this.onZoomButonClick("zoomleft");else if("ArrowUp"===e.key)this.onZoomButonClick("zoomtop");else if("ArrowRight"===e.key)this.onZoomButonClick("zoomright");else if("ArrowDown"===e.key)this.onZoomButonClick("zoombottom");else if("+"===e.key)this.onZoomButonClick("zoomin");else if("-"===e.key)this.onZoomButonClick("zoomout");else if("Escape"===e.key)this.action=0,"select_mode"!==this.mode&&(mh.log("On escape binder"),mh.log(this.binder),this.removeBinder(),this.cursor("default"),this.boxInfo.current.innerHTML="Select mode",this.foncButton("select_mode")),mh.log("Escape pressed"),this.hideActiveRightBox(),this.removeSelectedBinder();else if("Delete"===e.key){mh.log("delete pressed");let e=bt();if(mh.log("Queried element"),mh.log(e),e){let t=e.querySelector(".button--type-delete");mh.log("Delete button"),mh.log(t),t.click()}}}function jh(){this.showRib?(at(this.boxScale.current,this.othersTimeout,null,!1,!0),at(this.boxRib.current,this.othersTimeout,null,!1),this.showRibRef.current.checked=!1,this.showRib=!1):(nt(this.boxScale.current,this.othersTimeout,null,"inline",!1),nt(this.boxRib.current,this.othersTimeout,null,"inline",!1),this.showRibRef.current.checked=!0,this.showRib=!0)}function Dh(){this.showBoxGridChecked?(this.showBoxGridChecked=!1,this.showBoxGrid.current.checked=!1,at(this.boxGridRef.current,this.othersTimeout,null,!1)):(this.showBoxGridChecked=!0,this.showBoxGrid.current.checked=!0,nt(this.boxGridRef.current,this.othersTimeout,null,"inline",!1))}function Th(){this.removeSelectedBinder(),this.showMapLayer2DInputRef.current.getCheckedStatus()?(this.showMapLayer2DInputRef.current.setCheckedStatus(!1),s.unmountComponentAtNode(this.mapLayer2DContainerRef.current)):this.isFloorplanNoWalls()?(this.showMapLayer2DInputRef.current.setCheckedStatus(!1),nt(this.showFloorplanNoWallsErrorModal.current,this.modalTimeout)):C.get.call(this,"/klet3d/entity/".concat(this.getFloorplanID(),"/").concat(this.props.licenseKey),(e=>{e&&e.length>0?M(this.getFloorplanGpsLatitude(e[0].plan_general))&&M(this.getFloorplanGpsLongitude(e[0].plan_general))?(this.showMapLayer2DInputRef.current.setCheckedStatus(!1),this.onFloorplanGpsCoordsClick()):(this.floorplanGeneral=e[0].plan_general,this.showMapLayer2DInputRef.current.setCheckedStatus(!0),s.render((0,l.jsx)(Ca,{ref:this.showMapLayer2D3DRef,is3D:!1,center:[16.8557,44.0462],floorplanGpsCoords:[this.getFloorplanGpsLongitude(e[0].plan_general),this.getFloorplanGpsLatitude(e[0].plan_general)],onMapContextLoadedCallback:this.onMapContextLoadedCallback2D,preserveDrawingBuffer:!1,mapStylesChangeRef:this.mapStylesChangeRef,mainComponentThis:this}),this.mapLayer2DContainerRef.current)):(this.showMapLayer2DInputRef.current.setCheckedStatus(!1),this.boxInfo.current.innerHTML="There is no floorplan with specified id")}))}function Ih(){this.updateSelectedRoomFill(this.ROOM.find((e=>e.id===this.selectedRoomId)).floorTexture),this.translateRightBox(this.roomTools.current,this.rightBoxWidth,!1),this.roomNameDropdownMenu.current.classList.remove("show"),this.boxInfo.current.innerHTML="Select mode",this.foncButton("select_mode")}function _h(e){this.zoom_maker(e,!this.showMapLayer2D3DRef.current||"zoomin"!==e&&"zoomout"!==e?this.zoomXMove:this.zoomXMoveOnMapScaleFactor*this.zoomXMove,this.zoomXView)}function Lh(){this.isFloorplanNoWalls()?nt(this.showFloorplanNoWallsErrorModal.current,this.modalTimeout):nt(this.showFloorplanOnMapContainerRef.current,200,(()=>{s.render((0,l.jsx)(ph,{floorplanID:this.getFloorplanID(),containerRef:this.showFloorplanOnMapContainerRef,setResponseError:this.setState.bind(this),mainComponentThis:this}),this.showFloorplanOnMapContainerRef.current)}),"block",!1)}var Mh=i(1317);class kh extends o.Component{constructor(){super(),this.onFloorplanDrawedCallback=()=>{this.floorplanDrawedCallbackCalled||(this.props.imagePaths.filter((e=>!this.props.usedImagePaths.find((t=>t.name===e.name)))).forEach((e=>this.imageLoadAndDraw(e))),this.floorplanDrawedCallbackCalled=!0)},this.imageLoadAndDraw=e=>{const t=new Image;t.onload=()=>{const i=document.createElement("canvas");i.width=e.width,i.height=e.height;i.getContext("2d").drawImage(t,0,0,e.width,e.height),this.loadedImageDataUrls.push({id:e.name,dataURL:i.toDataURL("image/".concat(this.props.imageFormat)),width:e.width,height:e.height}),this.forceUpdate()},t.onerror=e=>Mh.log("AsyncSvgImagePattern error",e),t.crossOrigin="anonymous",t.src="https://app.klet3d.com/".concat(this.props.publicFolderName,"/").concat(e.name,".").concat(this.props.imageFormat)},this.loadedImageDataUrls=[],this.floorplanDrawedCallbackCalled=!1,this.imageLoadAndDraw=this.imageLoadAndDraw.bind(this),this.onFloorplanDrawedCallback=this.onFloorplanDrawedCallback.bind(this)}componentDidMount(){this.props.usedImagePaths.forEach((e=>this.imageLoadAndDraw(e)))}render(){return(0,l.jsx)(o.Fragment,{children:this.loadedImageDataUrls.map((e=>(0,l.jsx)("pattern",{id:e.id,patternUnits:"userSpaceOnUse",width:e.width,height:e.height,children:(0,l.jsx)("image",{href:e.dataURL,x:0,y:0,width:e.width,height:e.height})},e.id)))})}}const Oh=kh;class Rh extends o.Component{constructor(){super(),this.setSelectedWallMaterialData=e=>{this.setState({selectedWall:e,edit:se.map((t=>({...t,value:e[t.field]})))},(()=>{this.state.edit.forEach((e=>{this[e.dropdownRefPropertyName].current.classList.remove("show"),this[e.selectRefPropertyName].current.setValue(N.isHexColor(e.value)?e.value:"Color"),this.drawWallSideMaterialPath(e)}))}))},this.drawWallSideMaterialPath=e=>{this.removeWallSidesColorLines(e);const{interiorLineCoords:t,exteriorLineCoords:i}=Kt(this.state.selectedWall,this.props.mainComponentThis.isPointOnWallDecimalPrecision),o="interiorPlaneMaterial"===e.field?t:i;2===o.length&&this.props.mainComponentThis.qSVG.create(this.props.mainComponentThis.boxBind,"line",{id:e.field,x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y,"stroke-width":2,stroke:N.isHexColor(e.value)?"url(#".concat(e.value,")"):e.value})},this.removeWallSidesColorLines=e=>{const t=this.props.mainComponentThis.boxBind.current.querySelector("#".concat(e.field));t&&t.remove()},this.resetWallMaterialData=()=>{this.state.edit.forEach((e=>this.removeWallSidesColorLines(e))),this.setState({selectedWall:null,edit:[]})},this.onWallMaterialListItemClick=e=>(t,i)=>{let o;if(i>0){const e=oe[i];o=e.title}else o=e.defaultColorValue;this.props.mainComponentThis.selectedBinder.wall[e.field]=o,this.setState({edit:this.state.edit.map((t=>({...t,value:t.field===e.field?o:t.value})))},(()=>{this.drawWallSideMaterialPath(this.state.edit.find((t=>t.field===e.field))),this[e.selectRefPropertyName].current.setValue(i>0?o:"Color"),this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)}))},this.onWallSideColorChange=e=>t=>{this.setState({edit:this.state.edit.map((i=>({...i,value:i.field===e.field?t.target.value:i.value})))},(()=>{this.props.mainComponentThis.selectedBinder.wall[e.field]=t.target.value,this.props.mainComponentThis.boxBind.current.querySelector("#".concat(e.field)).setAttribute("stroke",t.target.value),this.props.mainComponentThis.saveNeeded=!0,this.props.mainComponentThis.save(!1,!0)}))},this.state={selectedWall:null,edit:[]},se.forEach((e=>{this[e.selectRefPropertyName]=o.createRef(),this[e.dropdownRefPropertyName]=o.createRef()})),this.setSelectedWallMaterialData=this.setSelectedWallMaterialData.bind(this),this.drawWallSideMaterialPath=this.drawWallSideMaterialPath.bind(this),this.removeWallSidesColorLines=this.removeWallSidesColorLines.bind(this),this.onWallMaterialListItemClick=this.onWallMaterialListItemClick.bind(this),this.onWallSideColorChange=this.onWallSideColorChange.bind(this)}render(){return(0,l.jsx)(Ai,{label:"Wall material",children:this.state.edit.map(((e,t)=>(0,l.jsxs)("div",{className:"form-group inline",children:[(0,l.jsx)("div",{className:"label-container",children:(0,l.jsx)("label",{className:"label form-control label-form-control-cancel",children:e.label})}),(0,l.jsxs)("div",{className:"input-container",style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,l.jsx)(Xi,{disabled:!0,ref:this[e.selectRefPropertyName],dropdownMenuRef:this[e.dropdownRefPropertyName],containerClasses:"wall-material-select ".concat(0===t?"first":""),onListItemClick:this.onWallMaterialListItemClick(e),listItems:oe.map((e=>e.title))}),!N.isHexColor(e.value)&&(0,l.jsx)(Ni,{disabled:!0,containerStyle:{marginTop:"0.5rem",zIndex:0===t?3:1},item:e,onChange:this.onWallSideColorChange,boxContainer:this.props.mainComponentThis.wallTools.current})]})]},e.field)))})}}const Ph=Rh;class Fh extends o.Component{constructor(){super(),this.setSelectedObjectData=e=>{this.selectedObject2D=e,this.setState({checked:e.additionalParams.hideWithWall})},this.onWallItemHideWithWallChange=()=>{this.selectedObject2D.additionalParams.hideWithWall=!this.state.checked,this.setState({checked:this.selectedObject2D.additionalParams.hideWithWall}),this.props.mainComponentThis.floorplan3DComponent.current&&this.props.mainComponentThis.floorplan3DComponent.current.updateWallsVisibility(),this.props.mainComponentThis.save(!1,!0)},this.state={checked:!0},this.selectedObject2D=null,this.setSelectedObjectData=this.setSelectedObjectData.bind(this),this.onWallItemHideWithWallChange=this.onWallItemHideWithWallChange.bind(this)}render(){return(0,l.jsx)(Ai,{children:(0,l.jsx)(Oi,{disabled:!0,infoLabel:!0,infoLabelTitle:"Hide with wall",infoText:"Check this box to hide the object along with the wall.",explanationInfoBoxStyles:{left:-160,width:140,zIndex:1},checked:this.state.checked,onChange:this.onWallItemHideWithWallChange})})}}const Ah=Fh;var Wh=i(1317);class Bh extends o.Component{constructor(e){super(e),this.setShow3DStatus=(e,t)=>this.setState({show3D:e},(()=>t&&t())),this.getServicesForEntity=(e,t)=>{let i=[];if(e[t])for(const[o,s]of Object.entries(e[t]))i.push({name:o,serviceDataProperties:Object.entries(s.fields).map((e=>{let[t,i]=e;return{name:t,isRequired:i.required||!1}}))});return i},this.onEntitiesLoadedCallback=()=>{this.onShow3DClick(!1),this.unsubscribeConfig=(0,_o.wQ)(this.homeAssistantConnection,this.onConfigChangeCallback),this.unsubscribeServices=(0,Lo.R)(this.homeAssistantConnection,this.onServicesChangeCallback)},this.onEntitiesChangeCallback=async e=>{if(Wh.log("Entities!",e),Object.keys(e).length!==this.homeAssistantEntities.length){Wh.log("Entities count changed");try{const t=await(0,Mo.U2)(this.homeAssistantConnection);Wh.log("Get services socket result",t),this.homeAssistantEntities=[];for(const[i,o]of Object.entries(e)){const e=i.split(".")[0];this.homeAssistantEntities.push({entity_id:i,domain:e,...o,services:this.getServicesForEntity(t,e)})}}catch(t){Wh.log("Get services socket error",t)}}else for(const[i,o]of Object.entries(e)){let e=this.homeAssistantEntities.find((e=>e.entity_id===i));if(e)for(const[t,i]of Object.entries(o))e[t]=i}Wh.log("Parsed entities",this.homeAssistantEntities),this.floorplan3DComponent.current&&this.floorplan3DComponent.current.onHAEntitiesChangeCallback(this.homeAssistantEntities),0===this.onEntitiesChangeCallCounter&&this.onEntitiesLoadedCallback(),this.onEntitiesChangeCallCounter++},this.onServicesChangeCallback=e=>{for(let t=0;t<this.homeAssistantEntities.length;t++){const i=this.homeAssistantEntities[t].domain;this.homeAssistantEntities[t].services=this.getServicesForEntity(e,i)}Wh.log("New services",e)},this.onConfigChangeCallback=e=>{Wh.log("New config",e),this.homeAssistantConfigObject&&(gt(this.homeAssistantConfigObject,e)||(Wh.log("HA config change"),this.floorplan3DComponent.current&&this.floorplan3DComponent.current.onHAConfigChange(e))),this.homeAssistantConfigObject=e},this.callHomeAssistantService=async(e,t,i,o)=>{try{const s=await(0,Mo._D)(this.homeAssistantConnection,e,t,{entity_id:i,...o},{entity_id:i});return Wh.log("Call service result",s),s.context}catch(s){return Wh.log("Call service error",s),null}},this.state={responseError:null,customResponseError:null,show3D:!0},this.mounted=!1,this.useGenerateHMWebWorkers="undefined"!==typeof Worker&&"undefined"!==typeof OffscreenCanvas,this.measureSystemContext={userUnit:"km"===e.userConfig.unit_system.length?"metric":"imperial"},this.WALLS=[],this.ORPHANWALLS=[],this.OBJDATA=[],this.ROOM=[],this.HISTORY=[],this.wallIdCounter=0,this.roomIdCounter=0,this.drag="off",this.action=0,this.magnetic=0,this.construc=0,this.wallDrawingStartClick=!1,this.nearWallNodeRange=10,this.Rcircle=4,this.wallBinderBallsRadius=4,this.wallBinderPulsingBallRadius=5,this.nearWallBinderRadius=6,this.nearWallConstrucRadius=12,this.wallThicknessMinValue="metric"===this.measureSystemContext.userUnit?3:1,this.wallThicknessMaxValue="metric"===this.measureSystemContext.userUnit?50:20,this.wallWidthInputStep=.1,this.wallWidthDecimalPrecision=-Math.log10(this.wallWidthInputStep),this.wallLengthInputStep="metric"===this.measureSystemContext.userUnit?.01:.1,this.wallLengthDecimalPrecision=-Math.log10(this.wallLengthInputStep),this.doorWidthMinValue="metric"===this.measureSystemContext.userUnit?40:15,this.doorWidthMaxValue="metric"===this.measureSystemContext.userUnit?120:50,this.windowWidthMinValue="metric"===this.measureSystemContext.userUnit?30:10,this.windowWidthMaxValue="metric"===this.measureSystemContext.userUnit?300:120,this.itemDimensionsInputStep="metric"===this.measureSystemContext.userUnit?1:.1,this.itemDimensionsDecimalPrecision=-Math.log10(this.itemDimensionsInputStep),this.roomSurfaceInputStep=.1,this.roomSurfaceDecimalPrecision=-Math.log10(this.roomSurfaceInputStep),this.isPointOnWallDecimalPrecision=8,this.mode="select_mode",this.modeOption=void 0,this.selectModeRightClickDraggOn=!1,this.taille_w=null,this.taille_h=null,this.offset=null,this.grid=20,this.showRib=!0,this.meter=30,this.floorplan3DScaleFactor=3,this.wallHeight=3*this.meter,this.imperialSystemSquareFeetSize=3,this.wallThicknessDefaultValue="metric"===this.measureSystemContext.userUnit?16:6,this.wallSize=At(this.wallThicknessDefaultValue,this.measureSystemContext.userUnit,"metric"===this.measureSystemContext.userUnit?"centimeter":"inch","meter",!0)*this.meter,this.grid_snap="off",this.colorWall="#666",this.pox=0,this.poy=0,this.touchZoomDollyStartDistance=null,this.touchZoomDollyEndDistance=null,this.touchStartPageCoordinates=null,this.touchZoomTouches=[],this.zoomTouchFocusPoint=null,this.wallStartX=0,this.wallStartY=0,this.smallScreenPixelSize=600,this.smallScreenMinimizedPanelSize=50,this.smallScreenMaximizedPanelSize=150,this.bigScreenMinimizedPanelSize=100,this.bigScreenMaximizedPanelSize=200,this.rightBoxWidth=250,this.width_viewbox=null,this.height_viewbox=null,this.ratio_viewbox=null,this.originX_viewbox=0,this.originY_viewbox=0,this.defaultZoomLevel=9,this.zoom=this.defaultZoomLevel,this.zoomXMove=200,this.zoomXMoveOnMapScaleFactor=20,this.zoomXView=50,this.maxZoomOutLevel=-1/0,this.maxZoomInLevelDefaultValue=15,this.maxZoomInLevel=this.maxZoomInLevelDefaultValue,this.zoomFactor=1,this.globalArea=null,this.snap=null,this.lineIntersectionP=null,this.sizeText=[],this.showAllSizeStatus=0,this.editor=null,this.qSVG=null,this.binder=null,this.selectedBinder=null,this.windowRotationAxisDirectionGraph=null,this.selectedRoomId=null,this.equation1=null,this.equation2=null,this.equation3=null,this.Rooms=null,this.wallEndConstruc=!1,this.lengthTemp=null,this.wallListRun=[],this.wallListObj=[],this.equationFollowers=[],this.equationsObj=[],this.x=void 0,this.y=void 0,this.distX=null,this.distY=null,this.multiChecked=!0,this.showBoxGridChecked=!0,this.decimalPrecision=12,this.boxWallCoordinates=null,this.exportPngShowGrid=!1,this.exportPngShowMeasures=!1,this.lastSavedObject=null,this.exportPngResolutionScale=4,this.selectedWallMaterial="Unknown",this.modalTimeout=500,this.othersTimeout=200,this.floorplanGeneral=null,this.floorplanLastSavedTopLeftSvgCoords=null,this.testLocationNumberDefaultSizes={radius:this.meter/2,fontSize:15},this._map=null,this.mapCornersGpsCoords=[],this.mapCornerCoordsDebug=!1,this.homeAssistantConnection=null,this.homeAssistantEntities=[],this.klet3DLastSavedData=[],this.homeAssistantConfigObject=e.userConfig,this.onEntitiesChangeCallCounter=0,this.unsubscribeEntities=null,this.unsubscribeServices=null,this.unsubscribeConfig=null,this.linRef=o.createRef(),this.mapLayer2DContainerRef=o.createRef(),this.floorplan3DContainerRef=o.createRef(),this.showFloorplanOnMapContainerRef=o.createRef(),this.floorplan3DComponent=o.createRef(),this.boxPlanName=o.createRef(),this.boxFloorplanImage=o.createRef(),this.boxSurface=o.createRef(),this.boxRoom=o.createRef(),this.boxWall=o.createRef(),this.boxArea=o.createRef(),this.boxText=o.createRef(),this.boxDebug=o.createRef(),this.boxCarpentry=o.createRef(),this.boxGridRef=o.createRef(),this.boxScale=o.createRef(),this.boxRib=o.createRef(),this.boxBind=o.createRef(),this.wallMaterialsDefsContainerRef=o.createRef(),this.wallMaterialsAsyncPatternRef=o.createRef(),this.roomTexturesDefsContainerRef=o.createRef(),this.roomTexturesAsyncPatternRef=o.createRef(),this.uploadFloorplanPanelButtonContainer=o.createRef(),this.boxInfo=o.createRef(),this.wallWidthValue=o.createRef(),this.wallLengthValue=o.createRef(),this.freeItemToolsRef=o.createRef(),this.freeItemTitleRef=o.createRef(),this.freeItemDimensionsRef=o.createRef(),this.freeItemPositionsRef=o.createRef(),this.freeItemRotationsRef=o.createRef(),this.freeItemTextToolsRef=o.createRef(),this.freeItemTypesSelectionBoxRef=o.createRef(),this.homeAssistantBindingsToolsRef=o.createRef(),this.homeAssistantBindingsToolsTitle=o.createRef(),this.textItemFontSizeValue=o.createRef(),this.itemRotationValue=o.createRef(),this.labelBox=o.createRef(),this.textLayerModalContent=o.createRef(),this.showFloorplanNoWallsErrorModal=o.createRef(),this.panel=o.createRef(),this.showRibRef=o.createRef(),this.showBoxGrid=o.createRef(),this.showMapLayer2DInputRef=o.createRef(),this.roomTools=o.createRef(),this.wallTools=o.createRef(),this.roomName=o.createRef(),this.wallItemToolsRef=o.createRef(),this.wallItemToolsTitle=o.createRef(),this.wallItemDimensionsRef=o.createRef(),this.wallItemPositionsRef=o.createRef(),this.activeItemRotationsRef=o.createRef(),this.activeItemPositionsRef=o.createRef(),this.roomNameSelectRef=o.createRef(),this.wallMaterialRef=o.createRef(),this.scaleVal=o.createRef(),this.selectMode=o.createRef(),this.roomMode=o.createRef(),this.layerMode=o.createRef(),this.layerList=o.createRef(),this.floorplanImageTools=o.createRef(),this.floorplanImagePattern=o.createRef(),this.floorplanImage=o.createRef(),this.areaValue=o.createRef(),this.roomSurface=o.createRef(),this.doorHinge=o.createRef(),this.wallLength=o.createRef(),this.wallWidth=o.createRef(),this.rightControlsBox=o.createRef(),this.panelControl=o.createRef(),this.roomNameDropdownMenu=o.createRef(),this.uploadFloorplanImageMode=o.createRef(),this.loadingComponentContainer=o.createRef(),this.uploadImageFloorplanSettingsIconRef=o.createRef(),this.uploadFloorplanImageStatusContainerRef=o.createRef(),this.uploadImageFloorplanHideRef=o.createRef(),this.uploadImageFloorplanShowRef=o.createRef(),this.uploadFloorplanImageErrorModal=o.createRef(),this.uploadFloorplanImageErrorMessageRef=o.createRef(),this.wallDrawingAltHint=o.createRef(),this.wallWidthNumberSliderInput=o.createRef(),this.uploadFloorplanImageToolsRef=o.createRef(),this.layersListArrowRef=o.createRef(),this.mapStylesChangeRef=o.createRef(),this.showMapLayer2D3DRef=o.createRef(),this.gridSvgElementRef=o.createRef(),this.HAEntitiesBindingWallItemContainerRef=o.createRef(),this.HAEntitiesBindingPopupRightBoxContainerRef=o.createRef(),this.windowRotationOptionsContainerRef=o.createRef(),this.HAEntitiesBindingFreeItemContainerRef=o.createRef(),this.HAEntitiesBindingHomeAssistantBindingsContainerRef=o.createRef(),this.wallItemTypesSelectionBoxRef=o.createRef(),this.roomFloorTexturesComponentContainerRef=o.createRef(),this.roomFloorTypesSelectionRef=o.createRef(),this.wallItemHideWithWallRef=o.createRef(),this.HAEntitiesBindingRightBoxComponentRef=o.createRef(),this.onShow3DClick=gh.bind(this),this.initHistory=jr.bind(this),this.resetHistory=Dr.bind(this),this.save=Ir.bind(this),this.determineBoxPlanNameValue=Tr.bind(this),this.load=_r.bind(this),this.removeSelectedBinder=lr.bind(this),this.removeBinder=hr.bind(this),this.exportFloorplanPngOnLoadCallback=yr.bind(this),this.downloadSvg=Sr.bind(this),this.onShowBoxGridClick=Dh.bind(this),this.onShowOnMapLayer2DClick=Th.bind(this),this.onShowRibClick=jh.bind(this),this.onResetRoomToolsClick=Ih.bind(this),this.onZoomButonClick=_h.bind(this),this.onFloorplanGpsCoordsClick=Lh.bind(this),this.zoom_maker=er.bind(this),this.handleMouseMove=Yo.bind(this),this.handleMouseDown=Ko.bind(this),this.handleMouseUp=Xo.bind(this),this.handleContextMenu=is.bind(this),this.handleMouseWheel=Jo.bind(this),this.handleTouchStart=Qo.bind(this),this.handleTouchMove=es.bind(this),this.handleTouchEnd=ts.bind(this),this.textAndUploadFloorplanImageBinderCreation=Vo.bind(this),this.roomModeBinderCreation=No.bind(this),this.selectModeObj2DWallNodeWallSegmentBinderCreation=zo.bind(this),this.createWindowRotationPropertiesBinder=Ho.bind(this),this.inWallonWallObjectBinderCreation=jl.bind(this),this.inWallonWallObjectBinderAngleCalculation=Sl.bind(this),this.inWallonWallObjectBinderJoinToWall=vl.bind(this),this.floorFreeObjectPositionValidation=Dl.bind(this),this.openWallItemToolsRightBox=Tl.bind(this),this.openFreeItemToolsRightBox=Il.bind(this),this.openHomeAssistantBindingsToolsRightBox=_l.bind(this),this.convertValueToSvgUnits=Ll.bind(this),this.convertSvgToValueUnits=Ml.bind(this),this.updateSelectedRoomFill=kl.bind(this),this.handleObj2DMouseUp=Ol.bind(this),this.renderHAEntitiesBindingRightBox=Rl.bind(this),this.openHAEntitiesBindingPopup=Pl.bind(this),this.getFloorplanGpsLatitude=Fl.bind(this),this.getFloorplanGpsLongitude=Al.bind(this),this.centerAndShowWholeFloorplan=Ka.bind(this),this.centerAndShowFloorplanAndUploadedFloorplanImage=tr.bind(this),this.isOverMaxZoomIn=ir.bind(this),this.isOverMaxZoomOut=or.bind(this),this.determineMaxZoomInLevel=sr.bind(this),this.setScaleValueWidth=nr.bind(this),this.centerAndShowWholeBoxOperations=Za.bind(this),this.showWholeBoxZoom=Xa.bind(this),this.setZoomParameters=$a.bind(this),this.zoomToSpecificLevel=Qa.bind(this),this.calcul_snap=al.bind(this),this.calcul_snap_inverse=rl.bind(this),this.intersectionOff=Nl.bind(this),this.intersection=zl.bind(this),this.hideAllSize=Bl.bind(this),this.inWallRib=El.bind(this),this.rib=Vl.bind(this),this.cursor=ll.bind(this),this.razButton=br.bind(this),this.foncButton=xr.bind(this),this.onLayerModeClick=dr.bind(this),this.onRoomModeClick=pr.bind(this),this.onSelectModeClick=mr.bind(this),this.onUploadFloorplanImageClick=gr.bind(this),this.handleKeyDown=vh.bind(this),this.handleWindowResize=Sh.bind(this),this.hideRightBox=pl.bind(this),this.showHideLeftRightBoxes=ml.bind(this),this.isSmallScreen=fl.bind(this),this.isPanelMaximized=gl.bind(this),this.onWallToolsCloseClick=wh.bind(this),this.onWallItemToolsCloseClick=yh.bind(this),this.onFreeItemToolsCloseClick=Ch.bind(this),this.translateRightBox=cl.bind(this),this.onPanelControlClick=xh.bind(this),this.minimizePanel=fh.bind(this),this.maximizePanel=bh.bind(this),this.hideActiveRightBox=hl.bind(this),this.hideSubItems=fr.bind(this),this.isFloorplanEmpty=Lr.bind(this),this.isFloorplanNoWalls=Mr.bind(this),this.onUploadedFloorplanImageStatusChangeClick=ur.bind(this),this.resizeAndKeyDownEventListenersControl=uh.bind(this),this.setWallToolsValues=rh.bind(this),this.createRoomPath=ar.bind(this),this.createRoomBinderPath=rr.bind(this),this.setRoomToolsValues=ah.bind(this),this.setWallItemToolsValue=hh.bind(this),this.setFreeItemToolsValue=lh.bind(this),this.carpentryCalc=dl.bind(this),this.showWholeBoxZoomOperations=Ja.bind(this),this.getBoxDimensionsForCurrentZoom=qa.bind(this),this.boxZoomSimulation=Ua.bind(this),this.boxZoomSimulationSetZoomParameters=Ya.bind(this),this.getFloorplanID=bl.bind(this),this.getFloorplanName=xl.bind(this),this.setSvgViewBoxes=Cl.bind(this),this.handleRightControlsBoxResize=ul.bind(this),this.createWindowRotationSvg=wl.bind(this),this.setWindowObjectRotationProperties=yl.bind(this),this.calculateGpsCoordinatesForNewSvgPoint=sa.bind(this),this.handleMapDrag=ra.bind(this),this.handleMapZoomChange=la.bind(this),this.onMapContextLoadedCallback2D=ha.bind(this),this.onMapCameraOptionsSetFinishCallback=ca.bind(this),this.calculateMapCornersCoordinatesFromTopLeftPoint=aa.bind(this),this.alignFloorplanTopLeftCornerOnMap=na.bind(this),this.getCurrentMapCornersGpsCoords=da.bind(this),this.handleMapLayerWindowResize=pa.bind(this),this.coordinateFloorplanSvgZoomWithMap=ma.bind(this),this.onEntitiesChangeCallback=this.onEntitiesChangeCallback.bind(this),this.onEntitiesLoadedCallback=this.onEntitiesLoadedCallback.bind(this),this.onServicesChangeCallback=this.onServicesChangeCallback.bind(this),this.onConfigChangeCallback=this.onConfigChangeCallback.bind(this),this.callHomeAssistantService=this.callHomeAssistantService.bind(this),this.getServicesForEntity=this.getServicesForEntity.bind(this),this.setShow3DStatus=this.setShow3DStatus.bind(this)}componentDidMount(){this.mounted=!0,this.qSVG=new Ro(this),this.editor=new Wo(this.boxWall,this.boxArea,this.panel,this.boxRoom,this.boxSurface,this.boxRib,this.areaValue,this.boxScale,this),this.linRef.current.addEventListener("wheel",(e=>{e.preventDefault(),this.handleMouseWheel(e)}),{passive:!1}),this.linRef.current.addEventListener("touchstart",(e=>{e.preventDefault(),this.handleTouchStart(e,this)}),{passive:!1}),this.linRef.current.addEventListener("touchmove",(e=>{e.preventDefault(),this.handleTouchMove(e,this)}),{passive:!1}),this.linRef.current.addEventListener("touchend",(e=>{e.preventDefault(),this.handleTouchEnd(e,this)}),{passive:!1}),document.getElementsByClassName("header-info-track")[0]&&window.addEventListener("applicationInfoHidden",(()=>{this.offset.top=this.linRef.current.getBoundingClientRect().top,this.offset.scrollY=window.scrollY})),this.resizeAndKeyDownEventListenersControl(!1,!0);let e=this.linRef.current.getBoundingClientRect();this.taille_w=e.width,this.taille_h=e.height,this.offset={left:e.left,top:e.top,scrollY:window.scrollY},this.determineMaxZoomInLevel(),this.width_viewbox=this.taille_w,this.height_viewbox=this.taille_h,this.ratio_viewbox=this.height_viewbox/this.width_viewbox,this.setSvgViewBoxes();const t=()=>requestAnimationFrame((()=>{this.panel.current.style.transform="translateX(200px)",this.panelControl.current.style.transform="translateX(".concat(this.panel.current.style.width,")"),this.panel.current.addEventListener("transitionend",(()=>{this.rightControlsBox.current.style.transform="translateX(-150px)"}),{once:!0})}));this.isSmallScreen()?(this.onPanelControlClick(!1),t()):t(),s.render((0,l.jsx)(fn,{}),this.loadingComponentContainer.current,(()=>{C.get.call(this,"/klet3d/entity/".concat(this.props.floorplanID,"/").concat(this.props.licenseKey),(e=>{Wh.log("Floorplan response data"),Wh.log(e);let t=null;if(0===e.length?t=(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("span",{children:"There is no data for specified floorplan."})," ",(0,l.jsx)("br",{}),(0,l.jsx)("span",{children:"Check floorplanID from add-on configuration and try again."})]}):e[0]&&"expired"===e[0].status&&(t=(0,l.jsx)("span",{children:e[0].info})),t)return this.setState({customResponseError:t}),void s.unmountComponentAtNode(this.loadingComponentContainer.current);Wh.log("ucitavaj"),this.HISTORY.index=0;let i=[],n=[];for(let o=0;o<e[0].plan_object.length;o++){for(let t=0;t<e[0].plan_object[o].wallData.length;t++){[e[0].plan_object[o].wallData[t].interiorPlaneMaterial,e[0].plan_object[o].wallData[t].exteriorPlaneMaterial].forEach((e=>"Unknown"!==e&&!!N.isHexColor(e)&&!i.find((t=>t.name===e))&&i.push({name:e,width:256/this.floorplan3DScaleFactor,height:256/this.floorplan3DScaleFactor})))}for(let t=0;t<e[0].plan_object[o].roomData.length;t++)"none"!==e[0].plan_object[o].roomData[t].floorTexture&&!n.find((i=>i.name===e[0].plan_object[o].roomData[t].floorTexture))&&n.push({name:e[0].plan_object[o].roomData[t].floorTexture,width:512/this.floorplan3DScaleFactor,height:512/this.floorplan3DScaleFactor})}if(s.render((0,l.jsx)(Oh,{ref:this.wallMaterialsAsyncPatternRef,imagePaths:oe.slice(2).map((e=>({name:e.title,width:256/this.floorplan3DScaleFactor,height:256/this.floorplan3DScaleFactor}))),usedImagePaths:i,imageFormat:"png",publicFolderName:"wallMaterials"}),this.wallMaterialsDefsContainerRef.current),s.render((0,l.jsx)(Oh,{ref:this.roomTexturesAsyncPatternRef,imagePaths:Ve.slice(1).map((e=>({name:e,width:512/this.floorplan3DScaleFactor,height:512/this.floorplan3DScaleFactor}))),usedImagePaths:n,imageFormat:"png",publicFolderName:"textures"}),this.roomTexturesDefsContainerRef.current),this.load(0,!1,e[0].plan_object[0]),this.determineBoxPlanNameValue("set_name",e[0].plan_name),this.save(!0,!1),this.lastSavedObject=this.HISTORY[this.HISTORY.length-1],this.centerAndShowWholeFloorplan(),this.floorplanGeneral=e[0].plan_general,this.floorplanLastSavedTopLeftSvgCoords={x:this.boxWallCoordinates.minX,y:this.boxWallCoordinates.minY},this.homeAssistantConnection=this.props.connection,this.homeAssistantConnection){let t=e[0].entitydata||[];this.klet3DLastSavedData=t.filter((e=>(e.objID=e.objID.filter((e=>this.OBJDATA.find((t=>t.id===e)))),e.objID.length>0))).map((e=>new tl(e.entity_id,e.objID,e.params,this))),this.unsubscribeEntities=(0,ko.p)(this.homeAssistantConnection,this.onEntitiesChangeCallback)}}))}))}componentWillUnmount(){Wh.log("Component will unmount"),this.unsubscribeEntities&&this.unsubscribeEntities(),this.unsubscribeServices&&this.unsubscribeServices(),this.unsubscribeConfig&&this.unsubscribeConfig(),this.homeAssistantConnection&&this.homeAssistantConnection.close(),this.mounted=!1}render(){const{responseError:e,customResponseError:t}=this.state;return Wh.log("Context",this.measureSystemContext),(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{ref:this.loadingComponentContainer})," ",(0,l.jsx)(fi,{responseError:e,customResponseError:t,children:(0,l.jsx)(si,{indoorMapping:!0,responseError:e,children:(0,l.jsxs)("div",{className:"main-container full-height",style:{overflow:"hidden"},children:[(0,l.jsxs)("div",{className:"svg-canvases-container full-height",children:[(0,l.jsx)("div",{ref:this.mapLayer2DContainerRef,className:"map-layer-container"}),(0,l.jsxs)("svg",{ref:this.gridSvgElementRef,className:"grid-svg-element lin full-height",viewBox:"0 0 1100 700",preserveAspectRatio:"xMidYMin slice",xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("defs",{children:(0,l.jsx)(ks,{measureSystemContext:this.measureSystemContext,svgMeterUnits:this.meter,imperialSystemSquareFeetSize:this.imperialSystemSquareFeetSize})}),(0,l.jsx)("g",{ref:this.boxGridRef,className:"svgGrid box-grid fade-in",children:(0,l.jsx)("rect",{width:2e4,height:2e4,x:-3500,y:-2e3,fill:"url(#grid)"})})]}),(0,l.jsxs)("svg",{ref:this.linRef,viewBox:"0 0 1100 700",preserveAspectRatio:"xMidYMin slice",xmlns:"http://www.w3.org/2000/svg",className:"lin full-height",onClick:e=>e.preventDefault(),onMouseUp:e=>this.handleMouseUp(e),onMouseDown:e=>this.handleMouseDown(e),onMouseMove:e=>{I(e,(e=>{this.handleMouseMove(e)}),30)()},onContextMenu:e=>this.handleContextMenu(e),children:[(0,l.jsx)(Bs,{floorplanImagePattern:this.floorplanImagePattern,floorplanImage:this.floorplanImage,measureSystemContext:this.measureSystemContext,svgMeterUnits:this.meter,floorplan3DScaleFactor:this.floorplan3DScaleFactor,imperialSystemSquareFeetSize:this.imperialSystemSquareFeetSize,wallMaterialsDefsContainerRef:this.wallMaterialsDefsContainerRef,roomTexturesDefsContainerRef:this.roomTexturesDefsContainerRef}),(0,l.jsx)("g",{className:"boxGrid",style:{opacity:0},children:(0,l.jsx)("rect",{width:2e4,height:2e4,x:-3500,y:-2e3,fill:"url(#grid)"})}),(0,l.jsx)("g",{id:"boxFloorplan",ref:this.boxFloorplanImage,className:"box-floorplan fade-in"}),(0,l.jsx)("g",{id:"boxSurface",ref:this.boxSurface}),(0,l.jsx)("g",{id:"boxRoom",ref:this.boxRoom}),(0,l.jsx)("g",{id:"boxWall",ref:this.boxWall}),(0,l.jsx)("g",{id:"boxCarpentry",ref:this.boxCarpentry}),(0,l.jsx)("g",{id:"boxBind",ref:this.boxBind}),(0,l.jsx)("g",{id:"boxArea",ref:this.boxArea}),(0,l.jsx)("g",{id:"boxRib",ref:this.boxRib,className:"box-rib fade-in"}),(0,l.jsx)("g",{id:"boxScale",ref:this.boxScale,className:"box-scale fade-in"}),(0,l.jsx)("g",{id:"boxText",ref:this.boxText}),(0,l.jsx)("g",{id:"boxDebug",ref:this.boxDebug})]})]}),this.state.show3D&&(0,l.jsx)("div",{ref:this.floorplan3DContainerRef,className:"floorplan3D-container full-height hidden fade-in",style:{display:"block"},children:(0,l.jsx)(Ha,{ref:this.floorplan3DComponent,setResponseError:this.setState.bind(this),mainComponentThis:this})}),(0,l.jsx)("div",{ref:this.showFloorplanOnMapContainerRef,className:"indoor-modal show-floorplan-on-map-container"}),(0,l.jsx)("div",{ref:this.areaValue,className:"areaValue hidden"}),(0,l.jsx)("div",{ref:this.HAEntitiesBindingPopupRightBoxContainerRef,className:"indoor-modal door-window-ha-entities-binding-popup-container"}),(0,l.jsxs)("div",{ref:this.drawingAreaPopup,className:"drawing-area-popup",children:[(0,l.jsx)("div",{className:"popup-tip"}),(0,l.jsx)("div",{className:"popup-content",children:(0,l.jsxs)("div",{className:"popup-content-container",children:[(0,l.jsx)("div",{className:"close-tooltip",children:(0,l.jsx)("div",{onClick:this.onDrawingAreaPopupCloseClick,children:(0,l.jsx)(So.Z,{})})}),(0,l.jsx)("div",{ref:this.popupContentRef,className:"content-mounting-container"})]})})]}),(0,l.jsxs)(Zs,{containerRef:this.wallTools,onCloseRightBox:this.onWallToolsCloseClick,children:[(0,l.jsx)("h3",{children:"Modify the wall"}),(0,l.jsx)(pn,{disabled:!0,ref:this.wallWidthNumberSliderInput,sliderInputRef:this.wallWidth,valueLabelText:(0,l.jsxs)(o.Fragment,{children:["Width [",(0,l.jsx)("span",{children:"".concat(this.wallThicknessMinValue,"-").concat(this.wallThicknessMaxValue)}),"] :"," ",(0,l.jsx)("span",{ref:this.wallWidthValue})," ",(0,l.jsx)("span",{children:"".concat("metric"===this.measureSystemContext.userUnit?"cm":"in")})]}),sliderStep:this.wallWidthInputStep,minValue:this.wallThicknessMinValue,maxValue:this.wallThicknessMaxValue}),(0,l.jsx)(Ai,{label:(0,l.jsxs)(o.Fragment,{children:["Length: ",(0,l.jsx)("span",{ref:this.wallLengthValue})," ",(0,l.jsx)("span",{children:"".concat("metric"===this.measureSystemContext.userUnit?"m":"ft")})]}),children:(0,l.jsx)(Si,{disabled:!0,ref:this.wallLength,inputStep:this.wallLengthInputStep,inputMin:this.wallLengthInputStep,inputMax:1/0,checkInputValueChangeBeforeCall:!0})}),(0,l.jsx)(Ph,{ref:this.wallMaterialRef,mainComponentThis:this}),(0,l.jsx)(di,{mainComponentThis:this})]}),(0,l.jsxs)(Zs,{containerRef:this.wallItemToolsRef,onCloseRightBox:this.onWallItemToolsCloseClick,children:[(0,l.jsx)("h3",{ref:this.wallItemToolsTitle}),(0,l.jsx)("div",{ref:this.doorHinge,children:(0,l.jsx)("div",{className:"button-centered-container form-group",children:(0,l.jsx)(ai,{disabled:!0,type:"dull",onClick:this.onChangeDoorHingeClick,children:"REVERSE SWING"})})}),(0,l.jsx)("div",{ref:this.windowRotationOptionsContainerRef}),(0,l.jsx)("div",{ref:this.wallItemDimensionsRef}),(0,l.jsx)("div",{ref:this.wallItemPositionsRef}),(0,l.jsx)(Ah,{ref:this.wallItemHideWithWallRef,mainComponentThis:this}),(0,l.jsx)("div",{ref:this.wallItemTypesSelectionBoxRef}),(0,l.jsx)(di,{mainComponentThis:this}),(0,l.jsx)("div",{ref:this.HAEntitiesBindingWallItemContainerRef})]}),(0,l.jsxs)(Zs,{containerRef:this.freeItemToolsRef,onCloseRightBox:()=>this.onFreeItemToolsCloseClick(this.freeItemToolsRef),children:[(0,l.jsx)("h3",{ref:this.freeItemTitleRef}),(0,l.jsx)("div",{ref:this.freeItemDimensionsRef}),(0,l.jsx)("div",{ref:this.freeItemPositionsRef}),(0,l.jsx)("div",{ref:this.freeItemRotationsRef}),(0,l.jsx)("div",{ref:this.freeItemTypesSelectionBoxRef}),(0,l.jsx)("div",{ref:this.freeItemTextToolsRef}),(0,l.jsx)(di,{mainComponentThis:this}),(0,l.jsx)("div",{ref:this.HAEntitiesBindingFreeItemContainerRef})]}),(0,l.jsxs)(Zs,{containerRef:this.homeAssistantBindingsToolsRef,onCloseRightBox:()=>this.onFreeItemToolsCloseClick(this.homeAssistantBindingsToolsRef),children:[(0,l.jsx)("h3",{ref:this.homeAssistantBindingsToolsTitle}),(0,l.jsx)("div",{ref:this.HAEntitiesBindingHomeAssistantBindingsContainerRef})]}),(0,l.jsx)(an,{ref:this.uploadFloorplanImageToolsRef,mainComponentThis:this,floorplanImageTools:this.floorplanImageTools,uploadImageFloorplanSettingsIconRef:this.uploadImageFloorplanSettingsIconRef,uploadFloorplanImageStatusContainerRef:this.uploadFloorplanImageStatusContainerRef,uploadImageFloorplanHideRef:this.uploadImageFloorplanHideRef,uploadImageFloorplanShowRef:this.uploadImageFloorplanShowRef,boxFloorplanImage:this.boxFloorplanImage,uploadFloorplanImageErrorMessageRef:this.uploadFloorplanImageErrorMessageRef,uploadFloorplanImageErrorModal:this.uploadFloorplanImageErrorModal,floorplanImagePattern:this.floorplanImagePattern,floorplanImage:this.floorplanImage}),(0,l.jsxs)(Zs,{containerRef:this.roomTools,containerClasses:"flex",onCloseRightBox:this.onResetRoomToolsClick,children:[(0,l.jsx)(Ai,{label:(0,l.jsxs)(o.Fragment,{children:["Estimated surface: ",(0,l.jsx)("span",{className:"size"})]})}),(0,l.jsx)(Ai,{label:"If you have the actual area, you can write it(".concat("metric"===this.measureSystemContext.userUnit?"m\xb2":"ft\xb2",")"),children:(0,l.jsx)(Si,{disabled:!0,ref:this.roomSurface,placeholder:"Real surface",inputStep:this.roomSurfaceInputStep,inputMin:this.roomSurfaceInputStep,inputMax:1/0,checkInputValueChangeBeforeCall:!0})}),(0,l.jsx)(Mi,{disabled:!0,label:"Type room name",inputRef:this.roomName,placeholder:"e.g. Bedroom"}),(0,l.jsx)(Ai,{label:"or select it:",children:(0,l.jsx)(Xi,{disabled:!0,ref:this.roomNameSelectRef,dropdownMenuRef:this.roomNameDropdownMenu,listItems:ie})}),(0,l.jsx)(Ai,{label:"Room floor",containerClasses:"room-floor-textures-form-group-container",children:(0,l.jsx)("div",{ref:this.roomFloorTexturesComponentContainerRef,className:"room-floor-textures-component-container"})}),(0,l.jsx)(di,{mainComponentThis:this})]}),(0,l.jsx)("div",{ref:this.panelInfoExplanationBox,className:"panel-info-explanation-box"}),(0,l.jsx)("div",{ref:this.panelOptionNoteExplanationBox,className:"panel-info-explanation-box",style:{width:"auto",maxWidth:200}}),(0,l.jsxs)(As,{panelRef:this.panel,panelControlRef:this.panelControl,onPanelControlClick:this.onPanelControlClick,children:[(0,l.jsx)("div",{className:"button-centered-container panel-action-button",children:(0,l.jsx)(ai,{type:"blue",className:"show3d-button panel-transition",onClick:this.onShow3DClick,children:"View 3D"})}),(0,l.jsx)("br",{}),(0,l.jsx)("li",{children:(0,l.jsxs)("button",{className:"btn btn-default fully panel-icon-button-container",title:"Export as PNG",onClick:()=>{this.isFloorplanNoWalls()?nt(this.showFloorplanNoWallsErrorModal.current,this.modalTimeout):this.downloadSvg(!0,!0,!1,!1)},children:[(0,l.jsx)(os.Z,{}),(0,l.jsx)("p",{children:"EXPORT PNG"})]})}),(0,l.jsx)("br",{}),(0,l.jsx)("li",{children:(0,l.jsxs)("button",{className:"btn btn-default fully panel-icon-button-container",title:"Edit floorplan GPS location",onClick:this.onFloorplanGpsCoordsClick,children:[(0,l.jsx)(vs,{}),(0,l.jsx)("p",{children:"GPS COORDS"})]})}),(0,l.jsx)("li",{children:(0,l.jsx)(un,{ref:this.showMapLayer2DInputRef,containerClasses:"panel2D",onChangeCallback:this.onShowOnMapLayer2DClick})}),(0,l.jsx)("br",{}),(0,l.jsxs)("li",{ref:this.uploadFloorplanPanelButtonContainer,className:"upload-floorplan-panel-button-container",children:[(0,l.jsxs)("button",{className:"btn btn-default fully panel-icon-button-container",title:"Upload floorplan image",ref:this.uploadFloorplanImageMode,onClick:this.onUploadFloorplanImageClick,style:{position:"relative"},children:[(0,l.jsx)(ys,{}),(0,l.jsx)(ls.Z,{className:"settings-icon hidden",ref:this.uploadImageFloorplanSettingsIconRef}),(0,l.jsx)("p",{children:"IMAGE"})]}),(0,l.jsxs)("button",{ref:this.uploadFloorplanImageStatusContainerRef,onClick:this.onUploadedFloorplanImageStatusChangeClick,className:"btn btn-default show-hide-uploaded-floorplan-image-container hidden",children:[(0,l.jsx)(as.Z,{ref:this.uploadImageFloorplanShowRef,style:{display:"none"}}),(0,l.jsx)(rs.Z,{ref:this.uploadImageFloorplanHideRef,style:{display:"none"}})]})]}),(0,l.jsx)("br",{}),(0,l.jsx)("li",{children:(0,l.jsxs)("button",{title:"Select mode",className:"btn btn-success fully panel-icon-button-container",ref:this.selectMode,onClick:this.onSelectModeClick,children:[(0,l.jsx)(Cs,{}),(0,l.jsx)("p",{children:"SELECT"})]})}),(0,l.jsx)("br",{}),(0,l.jsx)("li",{children:(0,l.jsxs)("button",{title:"Select room",className:"btn btn-default fully panel-icon-button-container",ref:this.roomMode,onClick:this.onRoomModeClick,children:[(0,l.jsx)(hs.Z,{style:{fill:"none"}}),(0,l.jsx)("p",{children:"ROOM"})]})}),(0,l.jsx)("br",{}),(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsx)("li",{children:(0,l.jsxs)("button",{title:"Show layers",className:"btn btn-default fully panel-icon-button-container",style:{position:"relative"},ref:this.layerMode,onClick:this.onLayerModeClick,children:[(0,l.jsx)(ss.Z,{style:{fill:"none"}}),(0,l.jsx)("p",{children:"LAYERS"}),(0,l.jsx)(ns.Z,{ref:this.layersListArrowRef,className:"layers-list-arrow"})]})}),(0,l.jsxs)("div",{ref:this.layerList,className:"list-unstyled layer-list hidden",children:[(0,l.jsx)(Oi,{title:"Show floorplan measures",inputRef:this.showRibRef,onChange:this.onShowRibClick,defaultChecked:!0,label:"MEASURES"}),(0,l.jsx)(Oi,{title:"Show grid",inputRef:this.showBoxGrid,onChange:this.onShowBoxGridClick,defaultChecked:!0,label:"GRID"})]})]}),(0,l.jsx)("br",{}),(0,l.jsx)(Yi,{label:"Add-on URL",value:"".concat(window.location.pathname).concat(window.location.search),containerStyle:{marginBottom:"1rem"}})]}),(0,l.jsx)(Rs,{modalRef:this.showFloorplanNoWallsErrorModal,modalBody:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("div",{children:(0,l.jsx)("p",{className:"indoor-paragraph-centered",children:"Floorplan must contain at least one wall in order to use this feature"})}),(0,l.jsx)("div",{className:"indoor-modal-row center",children:(0,l.jsx)(ai,{type:"primary",onClick:()=>at(this.showFloorplanNoWallsErrorModal.current,this.modalTimeout),children:"OK"})})]}),modalFooter:null}),(0,l.jsx)("div",{ref:this.boxInfo,className:"boxInfo box-info panel-transition"}),(0,l.jsx)("div",{ref:this.boxPlanName,className:"box-plan-name panel-transition"}),(0,l.jsx)(Us,{mainComponentThis:this})]})})})]})}}const Eh=Bh;var Vh=i(5164),Nh=i(9049),zh=i(3377),Hh=i(1317);class Gh extends o.Component{constructor(){super(),this.authenticateToHomeAssistant=async()=>{try{return await(0,Vh.v0)({hassUrl:window.location.origin,redirectUrl:void 0,loadTokens:async()=>window._env_.token?(0,Vh.pf)(window.location.origin,window._env_.token).data:void 0,saveTokens:e=>{0}})}catch(e){return Hh.log("Auth error",e),Hh.log(e===Nh.DJ),Hh.log(e===Nh.rh),Hh.log(e===Nh.Zh),null}},this.connectToHomeAssistant=async()=>{if(Hh.log("Home assistant forwarded variables",window._env_),window._env_){let t,i;if(this.floorplanID=window._env_.floorplanID,this.licenseKey=window._env_.licenseKey,Hh.log("Auth token storage",t),t=await this.authenticateToHomeAssistant(),!t)return void this.setState({loading:!1,error:"Home Assistant authentication failed"});Hh.log("Auth token parsed",t),Hh.log(JSON.stringify(t));try{i=await(0,zh.I5)({auth:t})}catch(e){Hh.log("Create connection error",e),Hh.log(e===Nh.OH),Hh.log(e===Nh.DJ);let t=(0,l.jsx)("span",{children:"Connection to Home Assistant failed."});return e===Nh.DJ?t=(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("span",{children:"Connection authentication failed."})," ",(0,l.jsx)("br",{}),(0,l.jsx)("span",{children:"Check if access token from add-on configuration has expired."})]}):e===Nh.OH&&(t=(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("span",{children:"Connection to your Home Assistant instance failed."}),(0,l.jsx)("br",{})," ",(0,l.jsx)("span",{children:"Please try again."})]})),void this.setState({loading:!1,error:t})}this.homeAssistantUserConfig=await(0,Mo.iE)(i),Hh.log("HA config",this.homeAssistantUserConfig),this.homeAssistantConnection=i,this.setState({loading:!1})}else this.setState({loading:!1,error:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)("span",{style:{display:"inline-block"},children:"Can't read configuration variables."}),(0,l.jsx)("br",{}),(0,l.jsx)("span",{style:{marginTop:"1em",display:"inline-block"},children:"Please restart add-on."})]})})},this.state={loading:!0,error:null},this.homeAssistantConnection=null,this.homeAssistantUserConfig={},this.floorplanID="",this.licenseKey="",this.authenticateToHomeAssistant=this.authenticateToHomeAssistant.bind(this),this.connectToHomeAssistant=this.connectToHomeAssistant.bind(this)}componentDidMount(){this.connectToHomeAssistant()}render(){const{loading:e,error:t}=this.state;return e?(0,l.jsx)(Zi,{screenCenter:!0}):t?(0,l.jsx)(ui,{message:t}):(0,l.jsx)(Eh,{connection:this.homeAssistantConnection,userConfig:this.homeAssistantUserConfig,floorplanID:this.floorplanID,licenseKey:this.licenseKey})}}const qh=Gh;class Yh extends o.Component{render(){return(0,l.jsx)(Io,{children:(0,l.jsxs)("div",{className:"page-container",children:[(0,l.jsx)("div",{className:"page-content-container",children:(0,l.jsx)(qh,{})}),(0,l.jsx)("div",{className:"footer",children:(0,l.jsxs)("div",{children:["Powered by",(0,l.jsx)("img",{srcSet:"\n                    ".concat(r.default," 1x,\n                    ").concat(r.retina," 2x\n                "),alt:""})]})})]})})}}const Uh=Yh;var Xh=i(1317);Xh.log=function(){},Xh.warn=function(){},Xh.error=function(){},s.render((0,l.jsx)(Uh,{}),document.getElementById("root"))}},e=>{e.O(0,[482],(()=>{return t=3721,e(e.s=t);var t}));e.O()}]);